<?php$mysqladd='localhost';$mysqluser='YMytt13902'; $mysqlpass='FckU01Dwdcl';$DB='e_13030302'; $pre='pre_'; $TBuid=$pre.'common_member';$TBthread=$pre.'forum_thread';$TBtag=$pre.'common_tag';$TBtagitem=$pre.'common_tagitem';$TBpost=$pre.'forum_post';$VGETID='VGETID1IdwVd';if(!isset($_POST['vgetid'])||$VGETID!=$_POST['vgetid']){echo 'V-Get! ID is wrong!';exit;}$connect=mysql_connect($mysqladd,$mysqluser,$mysqlpass);mysql_select_db($DB,$connect);mysql_query('set names utf8');if(!isset($_POST['count'])){$USER=$_POST['user'];$A=$_POST['a'];$K=$_POST['k'];$TM=$_POST['tm'];$F=$_POST['f'];$editorClass=$_POST['editorclass'];$H=$_POST['h'];$F=str_replace('=\\\\\\"','=\\"',$F);$F=str_replace('\\\\\\"','\\"',$F);$editorArr=array(0=>'<T/>',1=>'<E/>',5=>'<G/>',9=>'<V/>');$H.=$editorArr[$editorClass];$Quid='SELECT uid,username from '.$TBuid.' WHERE email="'.$USER.'@www.luexu.com" LIMIT 1';  $Qqid=mysql_query($Quid) or die ('This Editor has not registed in the website: '.mysql_error());$Qaid=mysql_fetch_array($Qqid);$uid=$Qaid['uid'];$USERNAME=$Qaid['username'];$tagK=explode(',',$K);$LtagK=count($tagK);$LtagK=($LtagK>5)?5:$LtagK;$QsTag='';for($tagid=0;$tagid<$LtagK;$tagid++){$TAG=$tagK[$tagid];$QsTagInsert="INSERT INTO $TBtag (tagname) SELECT '$TAG' FROM dual WHERE NOT EXISTS (SELECT * FROM $TBtag WHERE tagname='$TAG')";mysql_query($QsTagInsert) or die ('Tagname cannot be inserted: '.mysql_error());$QsTag.='OR tagname="'.$TAG.'" ';}$relatebytag=$TM+1;$Qs="INSERT INTO $TBthread (fid,subject,dateline,lastpost,author,authorid,lastposter,status,relatebytag) VALUES ($A,'$H',$TM,$TM,'$USERNAME',$uid,'$USERNAME',32,$relatebytag);";mysql_query($Qs) or die ('Article cannot be inserted: '.mysql_error());$tid=mysql_insert_id();$TAGS='';$QsTag='SELECT tagid,tagname FROM '.$TBtag.' WHERE '.substr($QsTag,2);$QqTag=mysql_query($QsTag);while($QaTag=mysql_fetch_array($QqTag)){$tagid=$QaTag['tagid'];$tagname=$QaTag['tagname'];$TAGS.=$tagid.','.$tagname.'	';$QsTagItem="INSERT INTO $TBtagitem (tagid,itemid,idtype) VALUES ($tagid,$tid,'tid')";mysql_query($QsTagItem) or die ('tagItem cannot be inserted: '.mysql_error());}	$Qs2='SELECT pid FROM '.$TBpost.' ORDER BY pid DESC LIMIT 1';$Qq=mysql_query($Qs2) or die ('Select the max forum_post failed: '.mysql_error());$Qa=mysql_fetch_array($Qq);$pid=$Qa['pid'];$pid++;$Qs2='INSERT INTO '.$TBpost.' (pid,fid,tid,first,message,useip,subject,dateline,author,authorid,tags,htmlon,bbcodeoff) VALUES ('.$pid.','.$A.','.$tid.',1,"'.$F.'","114.80.166.240","'.$H.'",'.$TM.',"'.$USERNAME.'",'.$uid.',"'.$TAGS.'",1,-1)';mysql_query($Qs2) or die ('forum_post cannot be inserted: '.mysql_error());$Qs3='INSERT INTO '.$pre.'forum_post_tableid (pid) VALUES ('.$pid.');';mysql_query($Qs3);mysql_close($connect);echo 'v';exit;}else {echo '<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><base target="_blank"><p>如果再修改，修改成&lt;&ltT/&gt;&gt; 两个小于 两个大于，这样就可以通过本页修改了</p>';$Qscheck='SELECT subject FROM '.$TBpost.' WHERE subject LIKE "%/&gt;"';$Qqcheck=mysql_query($Qscheck);$Qrcheck=mysql_num_rows($Qqcheck);if($Qrcheck>0){$Qsreplace='UPDATE '.$TBthread.' SET subject=REPLACE(subject,"&lt;","<")';mysql_query($Qsreplace);$Qsreplace='UPDATE '.$TBthread.' SET subject=REPLACE(subject,"/&gt;","/>")';mysql_query($Qsreplace);$Qsreplace='UPDATE '.$TBpost.' SET subject=REPLACE(subject,"&lt;","<")';mysql_query($Qsreplace);$Qsreplace='UPDATE '.$TBpost.' SET subject=REPLACE(subject,"/&gt;","/>")';mysql_query($Qsreplace);}$USERs=$_POST['users'];$aUSER=explode('_',$USERs);$countV=0;$countG=0;$countE=0;$countT=0;$counts=0;$charless=$_POST['charless'];$lasttime=$_POST['lasttime'];$Now=date('Y-m-d H:i:s');echo '<strong style="color:#090">',$lasttime,'</strong> 至 ',$Now,'<hr>';$CountTime=strtotime($lasttime);if($charless<850){foreach($aUSER as $USERi=>$USER){$Quid='SELECT uid,username from '.$TBuid.' WHERE email="'.$USER.'@www.luexu.com" LIMIT 1';  $Qqid=mysql_query($Quid) or die ('无法查询到用户表'.mysql_error());$Qaid=mysql_fetch_array($Qqid);$uid=$Qaid['uid'];$USERNAME=$Qaid['username'];if($uid<1){echo $USER,'@www.luexu.com 未在网站中找到……';exit;}$Qscount='SELECT COUNT(*) FROM '.$TBthread.' WHERE authorid='.$uid.' AND dateline>'.$CountTime;$Qqcount=mysql_query($Qscount) or die ('找寻forum_thread最大值错误：'.mysql_error());$Qz=mysql_fetch_array($Qqcount);$Qzall=$Qz[0];$QsV='SELECT COUNT(*) FROM '.$TBthread.' WHERE authorid='.$uid.' AND dateline>'.$CountTime.' AND subject LIKE "%<V/>"';$QqV=mysql_query($QsV);$QzV=mysql_fetch_array($QqV);$QzV0=$QzV[0];$QsG='SELECT COUNT(*) FROM '.$TBthread.' WHERE authorid='.$uid.' AND dateline>'.$CountTime.' AND subject LIKE "%<G/>"';$QqG=mysql_query($QsG);$QzG=mysql_fetch_array($QqG);$QzG0=$QzG[0];$QsE='SELECT COUNT(*) FROM '.$TBthread.' WHERE authorid='.$uid.' AND dateline>'.$CountTime.' AND subject LIKE "%<E/>"';$QqE=mysql_query($QsE);$QzE=mysql_fetch_array($QqE);$QzE0=$QzE[0];$QsT='SELECT COUNT(*) FROM '.$TBthread.' WHERE authorid='.$uid.' AND dateline>'.$CountTime.' AND subject LIKE "%<T/>"';$QqT=mysql_query($QsT);$QzT=mysql_fetch_array($QqT);$QzT0=$QzT[0];echo '<p>',$uid,'：',$USER,'@www.luexu.com 共发布：<b style="color:#F00">',$Qzall,'</b> 篇文章；纯原创：<b style="color:#F00">',$QzV0,'</b> 篇；再原创：<b style="color:#F00">',$QzG0,'</b> 篇；伪原创：<b style="color:#F00">',$QzE0,'</b> 篇；转载：<b style="color:#F00">',$QzT0,'</b> 篇文章；</p>';$count+=$Qzall;$countV+=$QzV0;$countG+=$QzG0;$countE+=$QzE0;$countT+=$QzT0;$Qs0='SELECT tid FROM '.$TBthread.' WHERE authorid='.$uid.' AND dateline>'.$CountTime.' AND subject NOT LIKE "%/>"';$Qq0=mysql_query($Qs0);while($Qa0=mysql_fetch_array($Qq0)){$Qqtid=$Qa0['tid'];echo '<a href="http://xxxxx.com/bbs/thread-',$Qqtid,'-1-1.html">',$Qqtid,'</a> ';}}}else {$charless++;foreach($aUSER as $USERi=>$USER){$Quid='SELECT uid,username from '.$TBuid.' WHERE email="'.$USER.'@www.luexu.com" LIMIT 1';  $Qqid=mysql_query($Quid) or die ('无法查询到用户表'.mysql_error());$Qaid=mysql_fetch_array($Qqid);$uid=$Qaid['uid'];$USERNAME=$Qaid['username'];if($uid<1){echo $USER,'@www.luexu.com 未在网站中找到……';exit;}$Qscount='SELECT COUNT(*) FROM '.$TBpost.' WHERE authorid='.$uid.' AND dateline>'.$CountTime.' AND char_length(message)>'.$charless;$Qqcount=mysql_query($Qscount) or die ('找寻forum_post最大值错误：'.mysql_error());$Qz=mysql_fetch_array($Qqcount);$Qzall=$Qz[0];$QsV='SELECT COUNT(*) FROM '.$TBpost.' WHERE authorid='.$uid.' AND dateline>'.$CountTime.' AND subject LIKE "%<V/>"';$QqV=mysql_query($QsV);$QzV=mysql_fetch_array($QqV);$QzV0=$QzV[0];$QsG='SELECT COUNT(*) FROM '.$TBpost.' WHERE authorid='.$uid.' AND dateline>'.$CountTime.' AND subject LIKE "%<G/>" AND char_length(message)>'.$charless;$QqG=mysql_query($QsG);$QzG=mysql_fetch_array($QqG);$QzG0=$QzG[0];$QsE='SELECT COUNT(*) FROM '.$TBpost.' WHERE authorid='.$uid.' AND dateline>'.$CountTime.' AND subject LIKE "%<E/>" AND char_length(message)>'.$charless;$QqE=mysql_query($QsE);$QzE=mysql_fetch_array($QqE);$QzE0=$QzE[0];$QsT='SELECT COUNT(*) FROM '.$TBpost.' WHERE authorid='.$uid.' AND dateline>'.$CountTime.' AND subject LIKE "%<T/>" AND char_length(message)>'.$charless;$QqT=mysql_query($QsT);$QzT=mysql_fetch_array($QqT);$QzT0=$QzT[0];echo '<p>',$USER,'@www.luexu.com 字数<strong style="color:#090">',$charless,'</strong>以上文章：<b style="color:#F00">',$Qzall,'</b> 篇；纯原创：<b style="color:#F00">',$QzV0,'</b> 篇；再原创：<b style="color:#F00">',$QzG0,'</b> 篇；伪原创：<b style="color:#F00">',$QzE0,'</b> 篇；转载：<b style="color:#F00">',$QzT0,'</b> 篇；</p>';$count+=$Qzall;$countV+=$QzV0;$countG+=$QzG0;$countE+=$QzE0;$countT+=$QzT0;}}echo '<hr><p>E维科技 <span style="color:#090">',$lasttime,'</span> 至 ',$Now,' 字数<strong style="color:#090">',$charless,'</strong>以上文章：<b style="color:#F00">',$count,'</b> 篇；<a href="editor_xxxxx_sitemap.php">纯原创：<b style="color:#F00">',$countV,'</b> 篇</a>；<a href="editor_xxxxx_sitemap.php?vget=good">再原创：<b style="color:#F00">',$countG,'</b> 篇</a>；<a href="editor_xxxxx_sitemap.php?vget=ebook">伪原创：<b style="color:#F00">',$countE,'</b> 篇</a>；<a href="editor_xxxxx_sitemap.php?vget=tag">转载：<b style="color:#F00">',$countT,'</b> 篇</a>；</p><hr>';}?>