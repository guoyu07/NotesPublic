/*pub-1|2012-07-02 19:22:34*/KISSY.add(function(B,D){var C=B.all;function A(){this.init()}B.augment(A,{init:function(){var E=this;B.getScript("http://jipiao.trip.taobao.com/remote/get_city.htm",{success:function(){E._setDefaultCity(window.DATA_DTABLE);E.renderGN();E.renderGJ();E.renderJD();E.renderLX()}});E.atpImage=new Image();E.atpImage.onerror=function(){E.atpImage=null;E.atpImage=new Image()};E.atpImage.src="http://ju.atpanel.com/?url=http://www.atpanel.com?ad_id=&am_id=&cm_id=&pm_id=150101668994f710a687"},renderGN:function(){var E=this;var J=new D(["#J_ds_y_gn","#J_ds_m_gn","#J_ds_d_gn"],{});var G=encodeURI(E._getText(C("#neDepCity")[0]));var I=C("#neDepCity").val();var H=encodeURI(E._getText(C("#neArrCity")[0]));var F=C("#neArrCity").val();var K={type:"domestic",depCity:G,depCityCode:I,arrCity:H,arrCityCode:F,depDate:this._formatDate(J.getCurDate()),mmpid:tbk_pid};J.on("change",function(L){K.depDate=E._formatDate(L.date);if(K.arrCityCode&&K.depCityCode){E._getClickurl(B.param(K),function(M){C("#J_gn_submit").attr("href",M.click_url)})}});C("#neDepCity").on("change",function(N){var L=E._getText(this);var M=C(this).val();K.depCity=encodeURI(L);K.depCityCode=M;if(K.arrCityCode){E._getClickurl(B.param(K),function(O){C("#J_gn_submit").attr("href",O.click_url)})}});C("#neArrCity").on("change",function(N){var M=E._getText(this);var L=C(this).val();K.arrCity=encodeURI(M);K.arrCityCode=L;if(K.depCityCode){E._getClickurl(B.param(K),function(O){C("#J_gn_submit").attr("href",O.click_url)})}});C("#J_gn_submit").on("click",function(L){if(!C("#neDepCity").val()){alert("\u8bf7\u9009\u62e9\u51fa\u53d1\u57ce\u5e02");return false}if(!C("#neArrCity").val()){alert("\u8bf7\u9009\u62e9\u5230\u8fbe\u57ce\u5e02");return false}})},renderGJ:function(){var F=this;var E=new D(["#J_ds_y_gj","#J_ds_m_gj","#J_ds_d_gj"],{});var H=encodeURI(F._getText(C("#ieDepCity")[0]));var J=C("#ieDepCity").val();var I=encodeURI(F._getText(C("#ieArrCity")[0]));var G=C("#ieArrCity").val();var K={type:"international",depCity:H,depCityCode:J,arrCity:I,arrCityCode:G,depDate:this._formatDate(E.getCurDate()),mmpid:tbk_pid};E.on("change",function(L){K.depDate=F._formatDate(L.date);if(K.arrCityCode&&K.depCityCode){F._getClickurl(B.param(K),function(M){C("#J_gj_submit").attr("href",M.click_url)})}});C("#ieDepCity").on("change",function(N){var L=F._getText(this);var M=C(this).val();K.depCity=encodeURI(L);K.depCityCode=M;if(K.arrCityCode){F._getClickurl(B.param(K),function(O){C("#J_gj_submit").attr("href",O.click_url)})}});C("#ieArrCity").on("change",function(N){var M=F._getText(this);var L=C(this).val();K.arrCity=encodeURI(M);K.arrCityCode=L;if(K.depCityCode){F._getClickurl(B.param(K),function(O){C("#J_gj_submit").attr("href",O.click_url)})}});C("#J_gj_submit").on("click",function(L){if(!C("#ieDepCity").val()){alert("\u8bf7\u9009\u62e9\u51fa\u53d1\u57ce\u5e02");return false}if(!C("#ieArrCity").val()){alert("\u8bf7\u9009\u62e9\u5230\u8fbe\u57ce\u5e02");return false}})},renderJD:function(){var G=this;var F=new Date();var I=new Date();I=new Date(I.setDate(I.getDate()+1));if(!C("#J_ds_y_jdi")){return }var E=new D(["#J_ds_y_jdi","#J_ds_m_jdi","#J_ds_d_jdi"],{curDate:F});var H=new D(["#J_ds_y_jdo","#J_ds_m_jdo","#J_ds_d_jdo"],{curDate:I});C("#J_jd_submit").on("click",function(J){if(!C("#J_HotelDestination").val()){alert("\u8bf7\u9009\u62e9\u5165\u4f4f\u57ce\u5e02");return false}if(G._compareDate(H.getCurDate(),E.getCurDate())){alert("\u79bb\u5e97\u65e5\u671f\u4e0d\u80fd\u5c0f\u4e8e\u6216\u7b49\u4e8e\u5165\u4f4f\u65e5\u671f");return false}C("#J_hotelInDate").val(G._formatDate(E.getCurDate()));C("#J_hotelOutDate").val(G._formatDate(H.getCurDate()));C("#J_CityCode").val(C("#J_HotelDestination").val());C("#J_HotelSearchForm")[0].submit()})},renderLX:function(){C("#J_lx_submit").on("click",function(){if(!C("#J_TravelDestination").val()){alert("\u8bf7\u586b\u5199\u65c5\u884c\u76ee\u7684\u5730");return false}C("#J_TravelSearchForm1")[0].submit()})},_getClickurl:function(F,G){var E=this;B.io({dataType:"jsonp",url:"http://www.alimama.com/jipiao/jipiao.do",data:F,jsonp:"callback",success:function(H){if(G){G(H)}}})},_formatDate:function(G){var F=G.getFullYear();var H=G.getMonth()+1;var E=G.getDate();if(H<10){H="0"+H}if(E<10){E="0"+E}return F+"-"+H+"-"+E},_compareDate:function(G,E){var H=new Date(G).getTime();var F=new Date(E).getTime();return H<=F},_getText:function(E){return(E&&E.options)?(E.options[E.selectedIndex]?E.options[E.selectedIndex].text:""):""},_setDefaultCity:function(F){if(!(F&&F.result)){return }var I=F.result;for(var G=0,E=C("#neDepCity")[0].options.length;G<E;G++){var H=C("#neDepCity")[0].options[G];if(H.value==I.cityCode){H.selected="selected";H.defaultSelected=true}}for(var G=0,E=C("#ieDepCity")[0].options.length;G<E;G++){var H=C("#ieDepCity")[0].options[G];if(H.value==I.cityCode){H.selected="selected";H.defaultSelected=true}}}});return A},{requires:["./dateselect"]});