/*pub-1|2012-05-11 13:42:33*/KISSY.app("TCCTelephone");TCCTelephone.add("tcc/telephone/main",function(C){var A=KISSY,H=A.DOM,F=A.Event,I=C.history,B=C.core;function G(){this.telInputNode=A.one("#J_TelInput");this.denomNode=A.one("#J_Dnomination");this.denomRadioNode=A.all(".denom-r");this.telPriceNode=A.one("#J_TelPrice");this.telPriceNodeTitle=this.telPriceNode.parent().one(".tel-section-title");this.submitBtn=A.one("#J_TelSubmitBtn");this.zoneAndSPDefNode=A.one("#J_ZoneAndSP_def");this.zoneAndSPShowNode=A.one("#J_ZoneAndSP_show");this.telInfoCfmNode=A.one("#J_TelInfoCfm");this.priceRange={"100":"98\u5143-99.6\u5143","50":"49.3\u5143-49.9\u5143","30":"29.58\u5143-31.5\u5143","10":"10\u5143-10.6\u5143","20":"19.84\u5143-20.8\u5143","200":"199\u5143-199.5\u5143","300":"299\u5143-299.3\u5143","500":"498\u5143-498.9\u5143","1000":"980\u5143-990\u5143"};this.price_id_g="30679";this.price_text_g=this.priceRange["100"];this.errorType=0;this.phoneNumber={number:"",province:"",provinceText:"",carrier:"",carrierText:""};this.init()}A.augment(G,A.EventTarget,{init:function(){var D=this;if(!this.telPriceNodeTitle){this.telPriceNodeTitle=this.telPriceNode.parent().parent().one(".tel-section-title")}if(window.phonecard){this.__bindDnomination(window.phonecard)}else{A.io({dataType:"jsonp",url:taokeUrl+"chongzhi/phone_list.do",jsonp:"callback",success:function(E){D.__bindDnomination(E)}})}this.bind()},bind:function(){var N=this.telInputNode,E=this.submitBtn,M=this.denomNode,D=this.denomRadioNode,L=N.val(),K=this;if(window.__isHistory){var O,J;O=new I.Core({KEY:"TBTelNumHistory",HISTORY_MAX_LEN:3});J=new I.Menu();J.init(H.parent("#J_TelInput",".wrapper"));J.on("load",function(P){if(P.number!==L){L=P.number;N.val(P.number);K.__checkTel()}});J.on("del",function(P){O.setHistory(P.history)});O.init(function(P){if(P){if(L===""){N.val(P[0].number)}else{N.val("")}K.__checkTel();J.buildMenu(P)}else{N.val("")}})}N.on("valuechange",function(){var P=N.val();if(P.match(/[^0-9]/g)){N.val(P.replace(/[^0-9]/g,""))}if(P.length==11){if(P!=L){L=P;K.__checkTel()}}});N.on("focus",function(){L=N.val()});N.on("blur",function(){if(L!=N.val()){K.__checkTel()}});E.on("click",function(P){if(E.attr("href")=="#"){P.halt();switch(K.errorType){case 0:alert("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u53f7\u7801\u3002");break;case 1:alert("\u8be5\u624b\u673a\u53f7\u65e0\u6cd5\u627e\u5230\u5bf9\u5e94\u7684\u7701\u4efd\u548c\u8fd0\u8425\u5546");break;case 2:alert("\u8be5\u624b\u673a\u53f7\u5bf9\u5e94\u7684\u5546\u54c1\u6682\u7f3a");break}}else{K.phoneNumber.number=N.val();if(window.__isHistory){O.addHistory({number:K.phoneNumber.number,info:K.phoneNumber.provinceText+K.phoneNumber.carrierText});J.buildMenu(O.getHistory())}}});if(window.__isDenominationElse){D.each(function(P){P.on("click",function(Q){if(P.val()!="-1"){K.price_id_g=P.attr("data-id");K.price_text_g=K.priceRange[P.val()]}else{K.price_id_g=M.val();K.price_text_g=K.priceRange[M[0].options[M[0].selectedIndex].text.replace("\u5143","")]}K.__getPrice()})})}M.on("change",function(P){K.price_id_g=A.one(this).val();K.price_text_g=K.priceRange[this.options[this.selectedIndex].text.replace("\u5143","")];if(window.__isDenominationElse){A.one("#denom-else").attr("checked",true)}K.__getPrice()})},__bindDnomination:function(L){var J=this.denomNode,K=L.denomination,D=this;J[0].options.length=0;for(var E=0;E<K.length;E++){var M=K[E];if(window.__isDenominationElse&&((M.id=="30678")||(M.id=="30679"))){continue}J.append('<option value="'+M.id+'">'+M.name+"</option>")}setTimeout(function(){J[0].value=window.__isDenominationElse?"30688":"30679";D.__getPrice();D.__checkTel()},100)},__checkTel:function(){var E=this.telInputNode,M=this.telPriceNode,J=this.telPriceNodeTitle,P=this.zoneAndSPDefNode,L=this.zoneAndSPShowNode,Q=this.telInfoCfmNode,D=this.submitBtn,N=this;var O=E.val();J.html("\u552e\u3000\u4ef7:");if(O.length==11){A.io({dataType:"jsonp",url:taokeUrl+"chongzhi/phone_search.do",data:"phone="+O,jsonp:"callback",success:function(R){if(R.success){if(R.cat_name.indexOf("\u79fb\u52a8")>=0){Q.html(R.province_name+"\u79fb\u52a8");N.phoneNumber.carrierText="\u79fb\u52a8"}else{if(R.cat_name.indexOf("\u8054\u901a")>=0){Q.html(R.province_name+"\u8054\u901a");N.phoneNumber.carrierText="\u8054\u901a"}else{if(R.cat_name.indexOf("\u7535\u4fe1")>=0){Q.html(R.province_name+"\u7535\u4fe1");N.phoneNumber.carrierText="\u7535\u4fe1"}}}N.phoneNumber.province=R.province_id;N.phoneNumber.provinceText=R.province_name;if(R.province_name=="\u897f\u85cf"){N.phoneNumber.province="27009"}N.phoneNumber.carrier=R.cat_id;P.css("display","none");L.css("display","inline");N.__getPrice()}else{N.errorType=1;N.phoneNumber.province="";N.phoneNumber.carrier="";P.css("display","inline");L.css("display","none");var S=N.priceRange[N.price_text_g];M.html(S);D.attr("href","#")}}})}else{N.errorType=0;N.phoneNumber.province="";N.phoneNumber.carrier="";P.css("display","inline");L.css("display","none");var K=N.priceRange[N.price_text_g];M.html(K);D.attr("href","#")}},__getPrice:function(){var K=this.telInputNode,O=this.telPriceNode,L=this.telPriceNodeTitle,D=this.submitBtn,P=this;var M=this.price_id_g,N=this.price_text_g,J=this.phoneNumber.carrier,R=this.phoneNumber.province,Q=K.val();L.html("\u552e\u3000\u4ef7:");if(!N){N="\u6682\u3000\u7f3a"}if(J!=""&&R!=""&&Q.length==11){var E={cat_id:J,phone:Q,price_id:M,province_id:R,mm_id:pid};if(window.uid){E.u=uid}A.io({dataType:"jsonp",url:taokeUrl+"chongzhi/phone_card.do",data:E,jsonp:"callback",success:function(V){if(V.success){P.errorType=-1;O.html(V.price+"\u5143");A.getScript(V.visitor_validate_url,{success:function(){if(window.loginIndicator&&window.loginIndicator.isFastBuy){D.attr("href",V.phone_visitor_url)}else{D.attr("href",V.click_url)}},error:function(){D.attr("href",V.click_url)}})}else{P.errorType=2;L.html("\u7f3a\u3000\u8d27:");var T={"150401":"20780:"+R+";20779:"+M,"150402":"20782:"+R+";20781:"+M,"50018446":"1626918:"+R+";1626917:"+M,"150406":"20792:"+R+";20791:"+M};var W=encodeURIComponent(T[J]);var S="";if(window.uid){S="&unid="+uid}var U="http://s8.taobao.com/search?q=&cat="+J+"&pid="+pid+S+"&ppath="+W;O.html('<a target="_blank" href="'+U+'">\u70b9\u51fb\u641c\u7d22</a>');D.attr("href",U)}}})}else{if(Q.length!=11){errorType=0}else{errorType=1}O.html(N);D.attr("href","#")}}});C.Main=G});KISSY.ready(function(A){new TCCTelephone.Main()});