<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../c3.css" />
<title>XSLT - 编辑 XML</title>
</head>
<body class="xml">
<div id="wrapper">
<div id="header">
<a href="http://e.v-get.com/w3cschool/" style="float:left;">W3CSchool 在线教程</a>
<div class="q g"><script type="text/javascript">var cpro_id="u1163355"</script><script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script></div>
</div>
<div id="navfirst">
<ul id="menu">
<li id="h"><a href="../h.html">HTML教程</a></li>
<li id="x"><a href="../x.html">XML教程</a></li>
<li id="b"><a href="../b.html">浏览器脚本</a></li>
<li id="s"><a href="../s.html">服务器脚本</a></li>
<li id="d"><a href="../d.html">dot net教程</a></li>
<li id="m"><a href="../m.html">多媒体教程</a></li>
<li id="w"><a href="../w.html">建站手册</a></li>
</ul>
</div><div id="navsecond">
<div id="course">
<h2>XSLT 基础</h2>
<ul>
<li><a href="http://e.v-get.com/w3cschool/">XSLT 首页</a></li>
<li><a href="xsl_languages.html">XSL  语言</a></li>
<li><a href="xsl_intro.html">XSLT 简介</a></li>
<li><a href="xsl_browsers.html">XSLT 浏览器</a></li>
<li><a href="xsl_transformation.html">XSLT 转换</a></li>
<li><a href="xsl_templates.html">XSLT &lt;template&gt;</a></li>
<li><a href="xsl_value_of.html">XSLT &lt;xsl:value-of&gt;</a></li>
<li><a href="xsl_for_each.html">XSLT &lt;for-each&gt;</a></li>
<li><a href="xsl_sort.html">XSLT &lt;sort&gt;</a></li>
<li><a href="xsl_if.html">XSLT &lt;if&gt;</a></li>
<li><a href="xsl_choose.html">XSLT &lt;choose&gt;</a></li>
<li><a href="xsl_apply_templates.html">XSLT apply</a></li>
</ul>
<h2>XSLT 高级</h2>
<ul>
<li><a href="xsl_client.html">XSLT 在客户端</a></li>
<li><a href="xsl_server.html">XSLT 在服务器端</a></li>
<li><a href="xsl_editxml.html">XSLT 编辑XML</a></li>
<li><a href="xsl_editors.html">XSLT 编辑器</a></li>
<li><a href="xsl_summary.html">XSLT 总结</a></li>
</ul>
<h2>参考手册</h2>
<ul>
<li><a href="xsl_w3celementref.html">XSLT 元素</a></li>
<li><a href="xsl_functions.html">XSLT 函数</a></li>
</ul>
</div>
<div id="selected">
<h2>建站手册</h2>
<ul>
<li><a href="../site/">网站构建</a></li>
<li><a href="../w3c/">万维网联盟</a></li>
<li><a href="http://e.v-get.com/w3c/">W3CSchool 教程</a></li>
<li><a href="../quality/">网站品质</a></li>
<li><a href="../semweb/">语义网</a></li>
<li><a href="../hosting/">网站主机</a></li>
</ul>
<h2><a href="http://e.v-get.com/w3c/" class="f13">W3CSchool 教程</a></h2><div class="a120x90"><script type="text/javascript">var cpro_id="u1210867";</script><script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script></div></div>
</div>
<div id="maincontent">
<h1>XSLT - 编辑 XML</h1>
<div id="tpn">
<ul class="prenext">
<li class="pre"><a href="xsl_server.html">上一页</a></li>
<li class="next"><a href="xsl_editors.html">下一页</a></li>
</ul>
</div>
<div id="intro">
<p><strong>存储在 XML 文件中的数据可通过因特网浏览器进行编辑。</strong></p>
</div>
<div>
<h2>打开、编辑并保存 XML</h2>
<p>现在，我们会为您展示如何打开、编辑及保存存储于服务器上的 XML 文件。</p>
<p>我们将使用 XSL 把 XML 文档转换到一个 HTML 表单中。XML 元素的值会被写到 HTML 表单中的 HTML 输入域。此表单是可编辑的。在被编辑完成后，数据会被提交回服务器，XML 文件会得到更新 (这部分由 ASP 完成）。</p>
</div>
<div>
<h2>XML 文件和 XSL 文件</h2>
<p>首先，请看将被使用的 XML 文档 (&#34;tool.xml&#34;)：</p>
<pre>&lt;?xml version=&#34;1.0&#34; encoding=&#34;ISO-8859-1&#34;?&gt;
&lt;tool&gt;
  &lt;field id=&#34;prodName&#34;&gt;
    &lt;value&gt;HAMMER HG2606&lt;/value&gt; 
  &lt;/field&gt;
  &lt;field id=&#34;prodNo&#34;&gt;
    &lt;value&gt;32456240&lt;/value&gt; 
  &lt;/field&gt;
  &lt;field id=&#34;price&#34;&gt;
    &lt;value&gt;$30.00&lt;/value&gt; 
  &lt;/field&gt;
&lt;/tool&gt;</pre>
<p><a href="tool.xml">查看 XML 文件</a>。</p>
<p>接着，请看下面的样式表(&#34;tool.xsl&#34;)：</p>
<pre>&lt;?xml version=&#34;1.0&#34; encoding=&#34;ISO-8859-1&#34;?&gt;
&lt;xsl:stylesheet version=&#34;1.0&#34;
xmlns:xsl=&#34;http://www.w3.org/1999/XSL/Transform&#34;&gt;
&lt;xsl:template match=&#34;/&#34;&gt;
&lt;html&gt;
&lt;body&gt;
&lt;form method=&#34;post&#34; action=&#34;edittool.asp&#34;&gt;
&lt;h2&gt;Tool Information (edit):&lt;/h2&gt;
&lt;table border=&#34;0&#34;&gt;
&lt;xsl:for-each select=&#34;tool/field&#34;&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;xsl:value-of select=&#34;@id&#34;/&gt;
&lt;/td&gt;
&lt;td&gt;
&lt;input type=&#34;text&#34;&gt;
&lt;xsl:attribute name=&#34;id&#34;&gt;
  &lt;xsl:value-of select=&#34;@id&#34; /&gt;
&lt;/xsl:attribute&gt;
&lt;xsl:attribute name=&#34;name&#34;&gt;
  &lt;xsl:value-of select=&#34;@id&#34; /&gt;
&lt;/xsl:attribute&gt;
&lt;xsl:attribute name=&#34;value&#34;&gt;
  &lt;xsl:value-of select=&#34;value&#34; /&gt;
&lt;/xsl:attribute&gt;
&lt;/input&gt; 
&lt;/td&gt;
&lt;/tr&gt;
&lt;/xsl:for-each&gt;
&lt;/table&gt;
&lt;br /&gt;
&lt;input type=&#34;submit&#34; id=&#34;btn_sub&#34; name=&#34;btn_sub&#34; value=&#34;Submit&#34; /&gt;
&lt;input type=&#34;reset&#34; id=&#34;btn_res&#34; name=&#34;btn_res&#34; value=&#34;Reset&#34; /&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
&lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;</pre>
<p><a href="tool.xsl">查看 XSL 文件</a>。</p>
<p>上面这个 XSL 文件会循环遍历 XML 文件中的元素，并为每个 XML &#34;field&#34; 元素创建一个输入域。field 元素的 id 属性的值被添加到每个 HTML 输入域的 id 和 name 属性。&#34;value&#34; 元素的值被添加到每个 HTML 输入域的 &#34;value&#34; 属性。结果是，可以得到一个包含 XML 文件中值的可编辑的 HTML 表单。</p>
<p>然后，我们还有第二个样式表：&#34;tool_updated.xsl&#34;。这个 XSL 文件会被用来显示已更新的 XML 数据。这个样式表不会输出可编辑 HTML 表单，而是一个静态的 HTML 表格：</p>
<pre>&lt;?xml version=&#34;1.0&#34; encoding=&#34;ISO-8859-1&#34;?&gt;
&lt;xsl:stylesheet version=&#34;1.0&#34;
xmlns:xsl=&#34;http://www.w3.org/1999/XSL/Transform&#34;&gt;
&lt;xsl:template match=&#34;/&#34;&gt;
&lt;html&gt;
&lt;body&gt;
&lt;h2&gt;Updated Tool Information:&lt;/h2&gt;
&lt;table border=&#34;1&#34;&gt;
&lt;xsl:for-each select=&#34;tool/field&#34;&gt;
&lt;tr&gt;
&lt;td&gt;&lt;xsl:value-of select=&#34;@id&#34; /&gt;&lt;/td&gt;
&lt;td&gt;&lt;xsl:value-of select=&#34;value&#34; /&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/xsl:for-each&gt;
&lt;/table&gt;
&lt;/body&gt;
&lt;/html&gt;
&lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;</pre>
<p><a href="tool_updated.xsl">查看 XSL 文件</a>。</p>
</div>
<div>
<h2>ASP 文件</h2>
<p>在上面 &#34;tool.xsl&#34; 文件中， HTML 表单的 action 属性的值是 &#34;edittool.asp&#34; 。</p>
<p>&#34;edittool.asp&#34; 页面包含两个函数：loadFile() 载入并转换 XML 文件，updateFile() 函数更新 XML 文件：</p>
<pre>&lt;%
function loadFile(xmlfile,xslfile)
Dim xmlDoc,xslDoc
<span>'加载 XML 文件</span>
set xmlDoc = Server.CreateObject(&#34;Microsoft.XMLDOM&#34;)
xmlDoc.async = false
xmlDoc.load(xmlfile)
<span>'加载 XSL 文件</span>
set xslDoc = Server.CreateObject(&#34;Microsoft.XMLDOM&#34;)
xslDoc.async = false
xslDoc.load(xslfile)
<span>'转换文件</span>
Response.Write(xmlDoc.transformNode(xslDoc))
end function
function updateFile(xmlfile)
Dim xmlDoc,rootEl,f
Dim i
<span>'加载 XML 文件</span>
set xmlDoc = Server.CreateObject(&#34;Microsoft.XMLDOM&#34;)
xmlDoc.async = false
xmlDoc.load(xmlfile)
<span>'设置 rootEl 变量为根元素</span>
Set rootEl = xmlDoc.documentElement
<span>'循环遍历 form 集</span>
for i = 1 To Request.Form.Count
   <span>'除去表单中的按钮元素</span>
   if instr(1,Request.Form.Key(i),&#34;btn_&#34;)=0 then
   <span>'selectSingleNode 方法可查询匹配某个查询的 XML 文件中的某个单一节点。
   '此查询会请求 value 元素，此 value 元素是 field 元素的子元素，
   '而此 field 元素拥有可匹配表单集中当前 key 值的 id 属性。
   '如果存在匹配，则设置 text 属性为表单集中当前域的值。</span>
   set f = rootEl.selectSingleNode(&#34;field[@id='&#34; &amp; _
   Request.Form.Key(i) &amp; &#34;']/value&#34;)
   f.Text = Request.Form(i)
   end if
next
<span>'保存已修改的 XML 文件</span>
xmlDoc.save xmlfile
<span>'释放所有的对象引用</span>
set xmlDoc=nothing
set rootEl=nothing
set f=nothing
<span>'通过一个样式表加载已修改的 XML 文件，这样客户端就可以看到所编辑的信息</span>
loadFile xmlfile,server.MapPath(&#34;tool_updated.xsl&#34;)
end function
<span>'如果表单已被提交，则更新XML文件并显示结果，如果没有被提交，则转换此 XML 文件以供编辑</span>
if Request.Form(&#34;btn_sub&#34;)=&#34;&#34; then
loadFile server.MapPath(&#34;tool.xml&#34;),server.MapPath(&#34;tool.xsl&#34;)
else
updateFile server.MapPath(&#34;tool.xml&#34;)
end if
%&gt;</pre>
<p class="tip"><span>提示：</span>假如您不了解如何编写 ASP，请学习我们的《<a href="../asp/">ASP 教程</a>》。</p>
<p class="note"><span>注释：</span>我们正在转换并更新位于服务器上的 XML 文件。这是一个跨平台的解决方案。客户端仅能获得从服务器返回的 HTML - 而 HTML 可运行于任何浏览器。</p>
</div>
<div id="bpn">
<ul class="prenext">
<li class="pre"><a href="xsl_server.html">上一页</a></li>
<li class="next"><a href="xsl_editors.html">下一页</a></li>
</ul>
</div>
</div>
<div id="sidebar">
<div class="rs"></div>
<div id="tools">
<h5 id="tools_reference"><a href="xsl_w3celementref.html">XSLT 参考手册</a></h5>
</div>
<div class="a120x600"><script type="text/javascript">var cpro_id="u1293136";</script><script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script></div>
</div><div class="b"></div>
</div>
</body>
</html>