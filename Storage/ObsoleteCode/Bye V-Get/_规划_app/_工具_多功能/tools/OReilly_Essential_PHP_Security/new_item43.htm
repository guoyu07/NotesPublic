<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>


   <title>7.1. &#26292;&#21147;&#25915;&#20987;</title>
   <meta name="generator" content="Help &amp; Manual" />
   <meta name="keywords" content="" />
   <meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
   <meta http-equiv="Content-Style-Type" content="text/css" />
   <link type="text/css" href="default.css" rel="stylesheet" />
</head>
<body style="margin: 0px 0px 0px 0px; background: #FFFFFF;">


<table width="100%" border="0" cellspacing="0" cellpadding="5" bgcolor="#649CCC">
  <tr valign="middle">
    <td align="left">
      <p class="p_Heading1"><span class="f_Heading1">7.1. &#26292;&#21147;&#25915;&#20987;</span></p>

    </td>
    <td align="right">
     <span style="font-size: 9pt">
     <a href="introduction.htm">Top</a>&nbsp;
     <a href="new_item42.htm">Previous</a>&nbsp;
     <a href="new_item44.htm">Next</a>
     </span>
    </td>
  </tr>
</table>


<!-- Placeholder for topic body. -->
<table width="100%" border="0" cellspacing="0" cellpadding="5"><tr valign="top"><td align="left">
<p style="line-height: 1.50;">7.1. &#26292;&#21147;&#25915;&#20987;</p>
<p style="line-height: 1.50;">  &nbsp; &#26292;&#21147;&#25915;&#20987;&#26159;&#19968;&#31181;&#19981;&#20351;&#29992;&#20219;&#20309;&#29305;&#27530;&#25163;&#27573;&#32780;&#21435;&#31351;&#23613;&#21508;&#31181;&#21487;&#33021;&#24615;&#30340;&#25915;&#20987;&#26041;&#24335;&#12290;&#23427;&#30340;&#26356;&#27491;&#24335;&#30340;&#21483;&#27861;&#26159;&#31351;&#20030;&#25915;&#20987;&#8212;&#8212;&#31351;&#20030;&#21508;&#31181;&#21487;&#33021;&#24615;&#30340;&#25915;&#20987;&#12290;</p>
<p style="line-height: 1.50;">  &nbsp; &#23545;&#20110;&#35775;&#38382;&#25511;&#21046;&#65292;&#20856;&#22411;&#30340;&#26292;&#21147;&#25915;&#20987;&#34920;&#29616;&#20026;&#25915;&#20987;&#32773;&#36890;&#36807;&#22823;&#37327;&#30340;&#23581;&#35797;&#21435;&#35797;&#22270;&#30331;&#24405;&#31995;&#32479;&#12290;&#22312;&#22810;&#25968;&#24773;&#20917;&#19979;&#65292;&#29992;&#25143;&#21517;&#26159;&#24050;&#30693;&#30340;&#65292;&#32780;&#21482;&#38656;&#35201;&#29468;&#27979;&#23494;&#30721;&#12290;</p>
<p style="line-height: 1.50;">  &nbsp; &#23613;&#31649;&#26292;&#21147;&#25915;&#20987;&#27809;&#26377;&#25216;&#24039;&#24615;&#21487;&#35328;&#65292;&#20294;&#35789;&#20856;&#25915;&#20987;&#20284;&#20046;&#26377;&#19968;&#23450;&#30340;&#25216;&#24039;&#24615;&#12290;&#26368;&#22823;&#30340;&#21306;&#21035;&#26159;&#22312;&#36827;&#34892;&#29468;&#27979;&#26102;&#30340;&#26234;&#33021;&#21270;&#12290;&#35789;&#20856;&#25915;&#20987;&#21482;&#20250;&#26368;&#21487;&#33021;&#30340;&#24773;&#20917;&#21015;&#34920;&#20013;&#36827;&#34892;&#31351;&#20030;&#65292;&#32780;&#19981;&#20687;&#26292;&#21147;&#25915;&#20987;&#19968;&#26679;&#21435;&#31351;&#20030;&#25152;&#26377;&#30340;&#21487;&#33021;&#24773;&#20917;&#12290;</p>
<p style="line-height: 1.50;">  &nbsp; &#38450;&#27490;&#36827;&#34892;&#39564;&#35777;&#23581;&#35797;&#25110;&#38480;&#21046;&#20801;&#35768;&#38169;&#35823;&#30340;&#27425;&#25968;&#36824;&#31639;&#26159;&#19968;&#20010;&#27604;&#36739;&#26377;&#25928;&#30340;&#23433;&#20840;&#25163;&#27573;&#65292;&#20294;&#26159;&#36825;&#26679;&#20570;&#30340;&#20004;&#38590;&#20043;&#22788;&#22312;&#20110;&#22914;&#20309;&#22312;&#19981;&#24433;&#21709;&#21512;&#27861;&#29992;&#25143;&#20351;&#29992;&#30340;&#24773;&#20917;&#19979;&#35782;&#21035;&#19982;&#38459;&#27490;&#25915;&#20987;&#32773;&#12290;</p>
<p style="line-height: 1.50;">  &nbsp; &#22312;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#23545;&#19968;&#33268;&#24615;&#30340;&#21028;&#23450;&#21487;&#20197;&#24110;&#21161;&#20320;&#21306;&#20998;&#20108;&#32773;&#12290;&#36825;&#20010;&#26041;&#27861;&#19982;&#31532;&#22235;&#31456;&#20013;&#25152;&#36848;&#30340;&#38450;&#27490;&#20250;&#35805;&#21163;&#25345;&#30340;&#20570;&#27861;&#24456;&#30456;&#20284;&#65292;&#20294;&#21306;&#21035;&#26159;&#20320;&#35201;&#30830;&#23450;&#30340;&#26159;&#19968;&#20010;&#25915;&#20987;&#32773;&#32780;&#19981;&#26159;&#19968;&#20010;&#21512;&#27861;&#29992;&#25143;&#12290;</p>
<p style="line-height: 1.50;">  &nbsp; &#32771;&#34385;&#19979;&#38754;&#30340;HTML&#34920;&#21333;&#65306;</p>
<p style="line-height: 1.50;">CODE:</p>
<p style="line-height: 1.50;">&nbsp;</p>
<p style="line-height: 1.50;">  &nbsp; &lt;form action="http://example.org/login.php" method="POST"&gt;</p>
<p style="line-height: 1.50;">  &nbsp; &lt;p&gt;Username: &lt;input type="text" name="username" /&gt;&lt;/p&gt;</p>
<p style="line-height: 1.50;">  &nbsp; &lt;p&gt;Password: &lt;input type="password" name="password" /&gt;&lt;/p&gt;</p>
<p style="line-height: 1.50;">  &nbsp; &lt;p&gt;&lt;input type="submit" /&gt;&lt;/p&gt;</p>
<p style="line-height: 1.50;">  &nbsp; &lt;/form&gt;</p>
<p style="line-height: 1.50;">&#25915;&#20987;&#32773;&#20250;&#23519;&#30475;&#36825;&#20010;&#34920;&#21333;&#24182;&#24314;&#31435;&#19968;&#27573;&#33050;&#26412;&#26469;POST&#21512;&#27861;&#30340;&#25968;&#25454;&#32473;http://example.org/login.php&#65306;</p>
<p style="line-height: 1.50;">CODE:</p>
<p style="line-height: 1.50;">&nbsp;</p>
<p style="line-height: 1.50;">  &nbsp;&lt;?php</p>
<p style="line-height: 1.50;">&nbsp;</p>
<p style="line-height: 1.50;">  &nbsp; $username = 'victim';</p>
<p style="line-height: 1.50;">  &nbsp; $password = 'guess';</p>
<p style="line-height: 1.50;">&nbsp;</p>
<p style="line-height: 1.50;">  &nbsp; $content = "username=$username&amp;password=$password";</p>
<p style="line-height: 1.50;">  &nbsp; $content_length = strlen($content);</p>
<p style="line-height: 1.50;">&nbsp;</p>
<p style="line-height: 1.50;">  &nbsp; $http_request = '';</p>
<p style="line-height: 1.50;">  &nbsp; $http_response = '';</p>
<p style="line-height: 1.50;">&nbsp;</p>
<p style="line-height: 1.50;">  &nbsp; $http_request .= "POST /login.php HTTP/1.1\r\n";</p>
<p style="line-height: 1.50;">  &nbsp; $http_request .= "Host: example.org\r\n";</p>
<p style="line-height: 1.50;">  &nbsp; $http_request .= "Content-Type: application/x-www-form-urlencoded\r\n";</p>
<p style="line-height: 1.50;">  &nbsp; $http_request .= "Content-Length: $content_length\r\n";</p>
<p style="line-height: 1.50;">  &nbsp; $http_request .= "Connection: close\r\n";</p>
<p style="line-height: 1.50;">  &nbsp; $http_request .= "\r\n";</p>
<p style="line-height: 1.50;">  &nbsp; $http_request .= $content;</p>
<p style="line-height: 1.50;">&nbsp;</p>
<p style="line-height: 1.50;">  &nbsp; if ($handle = fsockopen('example.org', 80))</p>
<p style="line-height: 1.50;">  &nbsp; {</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; fputs($handle, $http_request);</p>
<p style="line-height: 1.50;">&nbsp;</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; while (!feof($handle))</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; {</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; &nbsp; $http_response .= fgets($handle, 1024);</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; }</p>
<p style="line-height: 1.50;">&nbsp;</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; fclose($handle);</p>
<p style="line-height: 1.50;">&nbsp;</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; /* Check Response */</p>
<p style="line-height: 1.50;">  &nbsp; }</p>
<p style="line-height: 1.50;">  &nbsp; else</p>
<p style="line-height: 1.50;">  &nbsp; {</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; /* Error */</p>
<p style="line-height: 1.50;">  &nbsp; }</p>
<p style="line-height: 1.50;">&nbsp;</p>
<p style="line-height: 1.50;">  &nbsp; ?&gt;</p>
<p style="line-height: 1.50;">&#20351;&#36825;&#27573;&#33050;&#26412;&#65292;&#25915;&#20987;&#32773;&#36824;&#21487;&#20197;&#31616;&#21333;&#22320;&#21152;&#20837;&#19968;&#20010;&#24490;&#29615;&#26469;&#32487;&#32493;&#23581;&#35797;&#19981;&#21516;&#30340;&#23494;&#30721;&#65292;&#24182;&#22312;&#27599;&#27425;&#23581;&#35797;&#21518;&#26816;&#26597;$http_response&#21464;&#37327;&#12290;&#19968;&#26086;$http_response&#21464;&#37327;&#26377;&#21464;&#21270;&#65292;&#23601;&#21487;&#20197;&#35748;&#20026;&#29468;&#27979;&#21040;&#20102;&#27491;&#30830;&#30340;&#23494;&#30721;&#12290;</p>
<p style="line-height: 1.50;">  &nbsp; &#20320;&#21487;&#20197;&#36890;&#36807;&#24456;&#22810;&#23433;&#20840;&#25514;&#26045;&#21435;&#38450;&#27490;&#27492;&#31867;&#25915;&#20987;&#12290;&#25105;&#20204;&#27880;&#24847;&#21040;&#65292;&#22312;&#26292;&#21147;&#25915;&#20987;&#20013;&#27599;&#27425;&#30340;HTTP&#35831;&#27714;&#38500;&#20102;&#23494;&#30721;&#26159;&#19981;&#21516;&#30340;&#65292;&#20854;&#20182;&#37096;&#20998;&#23436;&#20840;&#30456;&#21516;&#65292;&#36825;&#19968;&#28857;&#26159;&#24456;&#26377;&#20215;&#20540;&#30340;&#12290;</p>
<p style="line-height: 1.50;">  &nbsp; &#23613;&#31649;&#22312;&#36229;&#36807;&#19968;&#23450;&#25968;&#37327;&#30340;&#22833;&#36133;&#23581;&#35797;&#21518;&#20020;&#26102;&#20923;&#32467;&#24080;&#21495;&#26159;&#19968;&#31181;&#26377;&#25928;&#30340;&#38450;&#33539;&#25163;&#27573;&#65292;&#20294;&#20320;&#21487;&#33021;&#20250;&#21435;&#32771;&#34385;&#37319;&#29992;&#26356;&#30830;&#23450;&#30340;&#26041;&#24335;&#21435;&#20923;&#32467;&#24080;&#21495;&#65292;&#20197;&#20351;&#25915;&#20987;&#32773;&#26356;&#23569;&#22320;&#24433;&#21709;&#21512;&#27861;&#29992;&#25143;&#23545;&#20320;&#30340;&#24212;&#29992;&#30340;&#27491;&#24120;&#20351;&#29992;&#12290;</p>
<p style="line-height: 1.50;">  &nbsp; &#36824;&#26377;&#19968;&#20123;&#27969;&#31243;&#20063;&#21487;&#20197;&#22686;&#22823;&#26292;&#21147;&#25915;&#20987;&#30340;&#38590;&#24230;&#65292;&#20351;&#23427;&#19981;&#22826;&#21487;&#33021;&#25104;&#21151;&#12290;&#19968;&#20010;&#31616;&#21333;&#30340;&#36943;&#21046;&#26426;&#21046;&#23601;&#33021;&#26377;&#25928;&#22320;&#20570;&#21040;&#36825;&#19968;&#28857;&#65306;</p>
<p style="line-height: 1.50;">CODE:</p>
<p style="line-height: 1.50;">&nbsp;</p>
<p style="line-height: 1.50;">  &nbsp;&lt;?php</p>
<p style="line-height: 1.50;">&nbsp;</p>
<p style="line-height: 1.50;">  &nbsp; /* mysql_connect() */</p>
<p style="line-height: 1.50;">  &nbsp; /* mysql_select_db() */</p>
<p style="line-height: 1.50;">&nbsp;</p>
<p style="line-height: 1.50;">  &nbsp; $clean = array();</p>
<p style="line-height: 1.50;">  &nbsp; $mysql = array();</p>
<p style="line-height: 1.50;">&nbsp;</p>
<p style="line-height: 1.50;">  &nbsp; $now = time();</p>
<p style="line-height: 1.50;">  &nbsp; $max = $now - 15;</p>
<p style="line-height: 1.50;">&nbsp;</p>
<p style="line-height: 1.50;">  &nbsp; $salt = 'SHIFLETT';</p>
<p style="line-height: 1.50;">&nbsp;</p>
<p style="line-height: 1.50;">  &nbsp; if (ctype_alnum($_POST['username']))</p>
<p style="line-height: 1.50;">  &nbsp; {</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; $clean['username'] = $_POST['username'];</p>
<p style="line-height: 1.50;">  &nbsp; }</p>
<p style="line-height: 1.50;">  &nbsp; else</p>
<p style="line-height: 1.50;">  &nbsp; {</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; /* ... */</p>
<p style="line-height: 1.50;">  &nbsp; }</p>
<p style="line-height: 1.50;">  &nbsp; $clean['password'] = md5($salt . md5($_POST['password'] . $salt));</p>
<p style="line-height: 1.50;">  &nbsp; $mysql['username'] = mysql_real_escape_string($clean['username']);</p>
<p style="line-height: 1.50;">&nbsp;</p>
<p style="line-height: 1.50;">  &nbsp; $sql = "SELECT last_failure, password</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FROM &nbsp; users</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; WHERE &nbsp;username = '{$mysql['username']}'";</p>
<p style="line-height: 1.50;">&nbsp;</p>
<p style="line-height: 1.50;">  &nbsp; if ($result = mysql_query($sql))</p>
<p style="line-height: 1.50;">  &nbsp; {</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; if (mysql_num_rows($result))</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; {</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; &nbsp; $record = mysql_fetch_assoc($result);</p>
<p style="line-height: 1.50;">&nbsp;</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; &nbsp; if ($record['last_failure']&gt; $max)</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; &nbsp; {</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; &nbsp; &nbsp; /* Less than 15 seconds since last failure */</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; &nbsp; }</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; &nbsp; elseif ($record['password'] == $clean['password'])</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; &nbsp; {</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; &nbsp; &nbsp; /* Successful Login */</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; &nbsp; }</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; &nbsp; else</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; &nbsp; {</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; &nbsp; &nbsp; /* Failed Login */</p>
<p style="line-height: 1.50;">&nbsp;</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; &nbsp; &nbsp; $sql = "UPDATE users</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SET &nbsp; &nbsp;last_failure = '$now'</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; WHERE &nbsp;username = '{$mysql['username']}'";</p>
<p style="line-height: 1.50;">&nbsp;</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; &nbsp; &nbsp; mysql_query($sql);</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; &nbsp; }</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; }</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; else</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; {</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; &nbsp; /* Invalid Username */</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; }</p>
<p style="line-height: 1.50;">  &nbsp; }</p>
<p style="line-height: 1.50;">  &nbsp; else</p>
<p style="line-height: 1.50;">  &nbsp; {</p>
<p style="line-height: 1.50;">  &nbsp; &nbsp; /* Error */</p>
<p style="line-height: 1.50;">  &nbsp; }</p>
<p style="line-height: 1.50;">&nbsp;</p>
<p style="line-height: 1.50;">  &nbsp; ?&gt;</p>
<p style="line-height: 1.50;">&#19978;&#20363;&#20250;&#38480;&#21046;&#22312;&#19978;&#27425;&#39564;&#35777;&#22833;&#36133;&#21518;&#23545;&#21516;&#19968;&#29992;&#25143;&#20877;&#35797;&#23581;&#35797;&#30340;&#39057;&#29575;&#12290;&#22914;&#26524;&#22312;&#19968;&#27425;&#23581;&#35797;&#22833;&#36133;&#21518;&#30340;15&#31186;&#20869;&#20877;&#27425;&#23581;&#35797;&#65292;&#19981;&#31649;&#23494;&#30721;&#26159;&#21542;&#27491;&#30830;&#65292;&#39564;&#35777;&#37117;&#20250;&#22833;&#36133;&#12290;&#36825;&#23601;&#26159;&#36825;&#20010;&#26041;&#26696;&#30340;&#20851;&#38190;&#28857;&#12290;&#20294;&#31616;&#21333;&#22320;&#22312;&#19968;&#27425;&#22833;&#36133;&#23581;&#35797;&#21518;15&#31186;&#20869;&#38459;&#27490;&#35775;&#38382;&#36824;&#26159;&#19981;&#22815;&#30340;&#8212;&#8212;&#22312;&#27492;&#26102;&#19981;&#31649;&#36755;&#20837;&#26159;&#20160;&#20040;&#65292;&#36755;&#20986;&#20063;&#20250;&#26159;&#19968;&#33268;&#30340;&#65292;&#21482;&#26377;&#22312;&#30331;&#24405;&#25104;&#21151;&#21518;&#25165;&#20250;&#19981;&#21516;&#12290;&#21542;&#21017;&#65292;&#25915;&#20987;&#32773;&#21482;&#35201;&#31616;&#21333;&#22320;&#26816;&#26597;&#19981;&#19968;&#33268;&#30340;&#36755;&#20986;&#21363;&#21487;&#30830;&#23450;&#30331;&#24405;&#26159;&#21542;&#25104;&#21151;&#12290;</p>
<p style="line-height: 1.50;">&nbsp;</p>
<hr noshade size=1 ><p style="line-height: 1.50;">&nbsp;</p>

</td></tr></table>

</body>
</html>
