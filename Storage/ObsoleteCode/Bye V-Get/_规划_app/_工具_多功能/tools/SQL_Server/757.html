<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>Tables,&nbsp;Rows,&nbsp;Columns,&nbsp;Primary&nbsp;Keys</B><BR>This&nbsp;procedure&nbsp;will&nbsp;give&nbsp;you&nbsp;the&nbsp;list&nbsp;of&nbsp;tables&nbsp;in&nbsp;the&nbsp;current&nbsp;database&nbsp;along&nbsp;with&nbsp;total&nbsp;columns&nbsp;in&nbsp;the&nbsp;table,&nbsp;no.&nbsp;of&nbsp;rows&nbsp;and&nbsp;the&nbsp;primary&nbsp;key(s)&nbsp;defined&nbsp;for&nbsp;the&nbsp;table.
<P></P>
<P>CREATE&nbsp;proc&nbsp;sp_DBDetails&nbsp;&nbsp;<BR>as&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>/*<BR>This&nbsp;procedure&nbsp;will&nbsp;give&nbsp;you&nbsp;the&nbsp;list&nbsp;of&nbsp;tables&nbsp;in&nbsp;the&nbsp;current&nbsp;database&nbsp;along&nbsp;with&nbsp;total&nbsp;columns&nbsp;in&nbsp;the&nbsp;table,&nbsp;no.&nbsp;of&nbsp;rows&nbsp;and&nbsp;the&nbsp;primary&nbsp;key(s)&nbsp;defined&nbsp;for&nbsp;the&nbsp;table.</P>
<P>Mohit&nbsp;Nayyar<BR>MCP&nbsp;(.Net),&nbsp;MCSD,&nbsp;MCDBA<BR>*/<BR>set&nbsp;nocount&nbsp;on&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>declare&nbsp;@id&nbsp;int,&nbsp;@name&nbsp;varchar(255),&nbsp;@cnt&nbsp;int,&nbsp;@sql&nbsp;nvarchar(4000),&nbsp;@temp&nbsp;varchar(900),&nbsp;@pcol&nbsp;varchar(255)&nbsp;&nbsp;<BR>create&nbsp;table&nbsp;#temptable&nbsp;(TableName&nbsp;varchar(255),&nbsp;TotalColumns&nbsp;int,&nbsp;TotalRows&nbsp;int,&nbsp;PrimaryKeyCols&nbsp;varchar(900))&nbsp;&nbsp;&nbsp;&nbsp;<BR>declare&nbsp;tempCursor&nbsp;cursor&nbsp;for&nbsp;&nbsp;&nbsp;&nbsp;<BR>select&nbsp;name,&nbsp;id&nbsp;from&nbsp;sysObjects&nbsp;where&nbsp;type='U'&nbsp;and&nbsp;name&nbsp;not&nbsp;like&nbsp;'dt%'&nbsp;&nbsp;&nbsp;&nbsp;<BR>open&nbsp;tempCursor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>fetch&nbsp;next&nbsp;from&nbsp;tempCursor&nbsp;into&nbsp;@name,&nbsp;@id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>while(@@fetch_status=0)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>begin&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;set&nbsp;@cnt=0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;set&nbsp;@sql='select&nbsp;@cnt&nbsp;=&nbsp;count(*)&nbsp;from&nbsp;['&nbsp;+&nbsp;@name&nbsp;+&nbsp;']'&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;EXEC&nbsp;sp_executesql&nbsp;@sql,&nbsp;N'@cnt&nbsp;int&nbsp;out',&nbsp;@cnt&nbsp;out&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;set&nbsp;@temp=''&nbsp;&nbsp;<BR>&nbsp;&nbsp;declare&nbsp;intemp&nbsp;cursor&nbsp;for&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;select&nbsp;a.Column_Name&nbsp;from&nbsp;INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE&nbsp;a,&nbsp;INFORMATION_SCHEMA.TABLE_CONSTRAINTS&nbsp;b&nbsp;where&nbsp;b.constraint_type='PRIMARY&nbsp;KEY'&nbsp;and&nbsp;a.constraint_name&nbsp;=&nbsp;b.constraint_name&nbsp;and&nbsp;a.table_name=ltrim(rtrim(@name))&nbsp;&nbsp;<BR>&nbsp;&nbsp;open&nbsp;intemp&nbsp;&nbsp;<BR>&nbsp;&nbsp;fetch&nbsp;next&nbsp;from&nbsp;intemp&nbsp;into&nbsp;@pcol&nbsp;&nbsp;<BR>&nbsp;&nbsp;while(@@fetch_status=0)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;begin&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;set&nbsp;@temp=@temp&nbsp;+&nbsp;','&nbsp;+&nbsp;@pcol&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;fetch&nbsp;next&nbsp;from&nbsp;intemp&nbsp;into&nbsp;@pcol&nbsp;&nbsp;<BR>&nbsp;&nbsp;end&nbsp;&nbsp;<BR>&nbsp;&nbsp;close&nbsp;intemp&nbsp;&nbsp;<BR>&nbsp;&nbsp;deallocate&nbsp;intemp&nbsp;&nbsp;<BR>&nbsp;&nbsp;<BR>&nbsp;set&nbsp;@temp=''''&nbsp;+&nbsp;substring(@temp,2,900)&nbsp;+&nbsp;''''&nbsp;&nbsp;<BR>&nbsp;&nbsp;<BR>&nbsp;set&nbsp;@sql='insert&nbsp;into&nbsp;#temptable&nbsp;(tablename,&nbsp;PrimaryKeyCols,&nbsp;TotalRows,&nbsp;TotalColumns)&nbsp;values&nbsp;('''&nbsp;+&nbsp;@name&nbsp;+&nbsp;''','&nbsp;+&nbsp;@temp&nbsp;+&nbsp;','&nbsp;+&nbsp;cast(@cnt&nbsp;as&nbsp;varchar)&nbsp;+&nbsp;','&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;select&nbsp;@cnt=count(*)&nbsp;from&nbsp;sysColumns&nbsp;where&nbsp;id=@id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;set&nbsp;@sql=@sql&nbsp;+&nbsp;cast(@cnt&nbsp;as&nbsp;varchar)&nbsp;+&nbsp;')'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;EXEC&nbsp;sp_executesql&nbsp;@sql&nbsp;&nbsp;&nbsp;&nbsp;<BR>fetch&nbsp;next&nbsp;from&nbsp;tempCursor&nbsp;into&nbsp;@name,&nbsp;@id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>end&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>close&nbsp;tempCursor&nbsp;&nbsp;&nbsp;&nbsp;<BR>deallocate&nbsp;tempCursor&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;<BR>select&nbsp;*&nbsp;from&nbsp;#tempTable&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>drop&nbsp;table&nbsp;#temptable&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>set&nbsp;nocount&nbsp;off</P></FONT>