<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>SQL&nbsp;Server&nbsp;7.0数据库的六种数据移动方法</B><BR>转贴自：2002-9-10&nbsp;&nbsp;动网先锋&nbsp;&nbsp;
<P></P>
<P>本人从事的工作是数据库管理员，要维护多台服务器中的数据库，经常把某台服务器中的某个数据库移动到另外一台服务器，对数据的移动有些心得体会，希望和大家共同交流。&nbsp;<BR>1.&nbsp;通过工具DTS的设计器进行导入或导出&nbsp;<BR>DTS的设计器功能强大，支持多任务，也是可视化界面，容易操作，但知道的人一般不多，如果只是进行SQL&nbsp;Server数据库中部分表的移动，用这种方法最好，当然，也可以进行全部表的移动。在SQL&nbsp;Server&nbsp;Enterprise&nbsp;Manager中，展开服务器左边的+，选择数据库，右击，选择All&nbsp;tasks/Import&nbsp;Data...(或All&nbsp;tasks/Export&nbsp;Data...)，进入向导模式，按提示一步一步走就行了，里面分得很细，可以灵活的在不同数据源之间复制数据，很方便的。而且可以另存成DTS包，如果以后还有相同的复制任务，直接运行DTS包就行，省时省力。也可以直接打开DTS设计器，方法是展开服务器名称下面的Data&nbsp;Transformation&nbsp;Services，选Local&nbsp;Packages，在右边的窗口中右击，选New&nbsp;Package，就打开了DTS设计器。值得注意的是：如果源数据库要拷贝的表有外键，注意移动的顺序，有时要分批移动，否则外键主键，索引可能丢失，移动的时候选项旁边的提示说的很明白，或者一次性的复制到目标数据库中，再重新建立外键，主键，索引。&nbsp;<BR>其实建立数据库时，建立外键，主键，索引的文件应该和建表文件分开，而且用的数据文件也分开，并分别放在不同的驱动器上，有利于数据库的优化。&nbsp;<BR>2.&nbsp;利用Bcp工具&nbsp;<BR>这种工具虽然在SQL&nbsp;Server7的版本中不推荐使用，但许多数据库管理员仍很喜欢用它，尤其是用过SQL&nbsp;Server早期版本的人。Bcp有局限性，首先它的界面不是图形化的，其次它只是在SQL&nbsp;Server的表（视图）与文本文件之间进行复制，但它的优点是性能好，开销小，占用内存少，速度快。有兴趣的朋友可以查参考手册。&nbsp;<BR>3.&nbsp;利用备份和恢复&nbsp;<BR>先对源数据库进行完全备份，备份到一个设备（device）上，然后把备份文件复制到目的服务器上（恢复的速度快），进行数据库的恢复操作，在恢复的数据库名中填上源数据库的名字（名字必须相同），选择强制型恢复（可以覆盖以前数据库的选项），在选择从设备中进行恢复，浏览时选中备份的文件就行了。这种方法可以完全恢复数据库，包括外键，主键，索引。&nbsp;<BR>4.&nbsp;直接拷贝数据文件&nbsp;<BR>把数据库的数据文件（*.mdf）和日志文件（*.ldf）都拷贝到目的服务器，在SQL&nbsp;Server&nbsp;Query&nbsp;Analyzer中用语句进行恢复:&nbsp;<BR>EXEC&nbsp;sp_attach_db&nbsp;@dbname&nbsp;=&nbsp;'test',&nbsp;<BR>@filename1&nbsp;=&nbsp;'d:\mssql7\data\test_data.mdf',&nbsp;<BR>@filename2&nbsp;=&nbsp;'d:\mssql7\data\test_log.ldf'&nbsp;<BR>这样就把test数据库附加到SQL&nbsp;Server中，可以照常使用。如果不想用原来的日志文件，可以用如下的命令：&nbsp;<BR>EXEC&nbsp;sp_detach_db&nbsp;@dbname&nbsp;=&nbsp;'test'&nbsp;<BR>EXEC&nbsp;sp_attach_single_file_db&nbsp;@dbname&nbsp;=&nbsp;'test',&nbsp;<BR>@physname&nbsp;=&nbsp;'d:\mssql7\data\test_data.mdf'&nbsp;<BR>这个语句的作用是仅仅加载数据文件，日志文件可以由SQL&nbsp;Server数据库自动添加，但是原来的日志文件中记录的数据就丢失了。&nbsp;<BR>5.&nbsp;在应用程序中定制&nbsp;<BR>可以在应用程序（PB、VB）中执行自己编写的程序，也可以在Query&nbsp;Analyzer中执行，这种方法比较灵活，其实是利用一个平台连接到数据库，在平台中用的主要时SQL语句，这种方法对数据库的影响小，但是如果用到远程链接服务器，要求网络之间的传输性能好，一般有两种语句：&nbsp;<BR>1&gt;&nbsp;select&nbsp;...&nbsp;into&nbsp;new_tablename&nbsp;where&nbsp;...&nbsp;<BR>2&gt;&nbsp;insert&nbsp;(into)&nbsp;old_tablename&nbsp;select&nbsp;...&nbsp;from&nbsp;...&nbsp;where&nbsp;...&nbsp;<BR>区别是前者把数据插入一个新表（先建立表，再插入数据），后者是把数据插入已经存在的一个表中，我个人喜欢后者，因为在编程的结构上，应用的范围上，第二条语句强于前者。&nbsp;<BR>6.&nbsp;SQL&nbsp;Server的复制功能&nbsp;<BR>SQL&nbsp;Server提供了强大的数据复制功能，也是最不易掌握的，具体应用请参考相关资料，值得注意的是要想成功进行数据的复制工作，有些条件是必不可少的：&nbsp;<BR>1&gt;SQL&nbsp;Server&nbsp;Agent必须启动，MSDTC必须启动。&nbsp;<BR>2&gt;所有要复制的表必须有主键。&nbsp;<BR>3&gt;如果表中有text或image数据类型，必须使用with&nbsp;log选项，不能使用with&nbsp;no_log选项。&nbsp;<BR>另外max&nbsp;text&nbsp;repl&nbsp;size选项控制可以复制的文本和图像数据的最大规模，超过这个限制的操作将失败。&nbsp;<BR>4&gt;在要进行复制的计算机上，应该至少是隐含共享，即共享名是C$或D$…。&nbsp;<BR>5&gt;为SQL&nbsp;Server代理使用的Windows&nbsp;NT帐号不能是一个本地的系统帐号，因为本地的系统帐号不允许网络存取。&nbsp;<BR>6&gt;如果参与复制的服务器在另外的计算机域中，必须在这些域之间建立信任关系。&nbsp;<BR>&nbsp;<BR></P></FONT>