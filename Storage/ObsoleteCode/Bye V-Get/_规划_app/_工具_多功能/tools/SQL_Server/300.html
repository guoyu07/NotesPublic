<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>GenerateSP</B><BR>Version:&nbsp;SQL&nbsp;Server&nbsp;7.0/2000<BR>Created&nbsp;by:&nbsp;Alexander&nbsp;Chigrik
<P></P>
<P>This&nbsp;script&nbsp;will&nbsp;generate&nbsp;script&nbsp;for&nbsp;all&nbsp;stored&nbsp;procedures&nbsp;for&nbsp;the<BR>given&nbsp;database.<BR>You&nbsp;can&nbsp;pass&nbsp;the&nbsp;Server&nbsp;name,&nbsp;user&nbsp;name,&nbsp;user&nbsp;password,&nbsp;database&nbsp;name<BR>and&nbsp;file&nbsp;name&nbsp;into&nbsp;GenerateSP&nbsp;stored&nbsp;procedure,&nbsp;as&nbsp;in&nbsp;the&nbsp;example<BR>below:</P>
<P>EXEC&nbsp;GenerateSP&nbsp;@server&nbsp;=&nbsp;'Server_Name',<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@uname&nbsp;=&nbsp;'User_Name',<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@pwd&nbsp;=&nbsp;'Password',<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@dbname&nbsp;=&nbsp;'Database_Name',<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@filename&nbsp;=&nbsp;'c:\script.sql'</P>
<P>/*<BR>Version:&nbsp;SQL&nbsp;Server&nbsp;7.0/2000<BR>Created&nbsp;by:&nbsp;Alexander&nbsp;Chigrik<BR><IMG 
src="http://www.pigtwo.com/forum/pic/url.gif" align=absMiddle border=0><A href="http://www.MSSQLCity.com/" 
target=_blank>http://www.MSSQLCity.com/</A>&nbsp;-&nbsp;all&nbsp;about&nbsp;MS&nbsp;SQL<BR>(SQL&nbsp;Server&nbsp;Articles,&nbsp;FAQ,&nbsp;Scripts,&nbsp;Tips&nbsp;and&nbsp;Test&nbsp;Exams).</P>
<P>This&nbsp;script&nbsp;will&nbsp;generate&nbsp;script&nbsp;for&nbsp;all&nbsp;stored&nbsp;procedures&nbsp;for&nbsp;the&nbsp;<BR>given&nbsp;database.<BR>You&nbsp;can&nbsp;pass&nbsp;the&nbsp;Server&nbsp;name,&nbsp;user&nbsp;name,&nbsp;user&nbsp;password,&nbsp;database&nbsp;name<BR>and&nbsp;file&nbsp;name&nbsp;into&nbsp;GenerateSP&nbsp;stored&nbsp;procedure,&nbsp;as&nbsp;in&nbsp;the&nbsp;example<BR>below:</P>
<P>EXEC&nbsp;GenerateSP&nbsp;@server&nbsp;=&nbsp;'Server_Name',<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@uname&nbsp;=&nbsp;'User_Name',&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@pwd&nbsp;=&nbsp;'Password',<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@dbname&nbsp;=&nbsp;'Database_Name',&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@filename&nbsp;=&nbsp;'c:\script.sql'</P>
<P>You&nbsp;can&nbsp;specify&nbsp;different&nbsp;number&nbsp;of&nbsp;parameters&nbsp;(from&nbsp;zero&nbsp;to&nbsp;five&nbsp;parameters).<BR>If&nbsp;you&nbsp;do&nbsp;not&nbsp;specify&nbsp;server&nbsp;name,&nbsp;then&nbsp;the&nbsp;current&nbsp;server&nbsp;will&nbsp;be&nbsp;used;<BR>if&nbsp;you&nbsp;do&nbsp;not&nbsp;specify&nbsp;user&nbsp;name,&nbsp;then&nbsp;the&nbsp;current&nbsp;user&nbsp;name&nbsp;will&nbsp;be&nbsp;used;<BR>if&nbsp;you&nbsp;do&nbsp;not&nbsp;specify&nbsp;database&nbsp;name,&nbsp;then&nbsp;the&nbsp;current&nbsp;database&nbsp;will&nbsp;be&nbsp;used;<BR>if&nbsp;you&nbsp;do&nbsp;not&nbsp;specify&nbsp;file&nbsp;name,&nbsp;then&nbsp;script&nbsp;will&nbsp;be&nbsp;placed&nbsp;into&nbsp;file<BR>script.sql&nbsp;on&nbsp;drive&nbsp;'c:';&nbsp;if&nbsp;you&nbsp;do&nbsp;not&nbsp;specify&nbsp;password,&nbsp;the&nbsp;password<BR>will&nbsp;not&nbsp;be&nbsp;used&nbsp;(for&nbsp;example:&nbsp;username&nbsp;=&nbsp;'sa'&nbsp;and&nbsp;empty&nbsp;password,&nbsp;you&nbsp;can<BR>pass&nbsp;in&nbsp;this&nbsp;case&nbsp;only&nbsp;username).</P>
<P>My&nbsp;stored&nbsp;procedure&nbsp;can&nbsp;be&nbsp;used&nbsp;for&nbsp;learning&nbsp;some&nbsp;general&nbsp;SQL&nbsp;Server<BR>features&nbsp;(how&nbsp;to&nbsp;work&nbsp;with&nbsp;OLE&nbsp;objects&nbsp;from&nbsp;the&nbsp;SQL&nbsp;Server,&nbsp;how&nbsp;to&nbsp;use<BR>some&nbsp;system&nbsp;functions,&nbsp;how&nbsp;to&nbsp;work&nbsp;with&nbsp;cursors&nbsp;and&nbsp;so&nbsp;on).<BR>*/</P>
<P>IF&nbsp;OBJECT_ID('GenerateSP')&nbsp;IS&nbsp;NOT&nbsp;NULL&nbsp;DROP&nbsp;PROC&nbsp;GenerateSP<BR>GO</P>
<P>CREATE&nbsp;PROC&nbsp;GenerateSP&nbsp;(<BR>&nbsp;&nbsp;@server&nbsp;varchar(30)&nbsp;=&nbsp;null,<BR>&nbsp;&nbsp;@uname&nbsp;varchar(30)&nbsp;=&nbsp;null,<BR>&nbsp;&nbsp;@pwd&nbsp;varchar(30)&nbsp;=&nbsp;null,<BR>&nbsp;&nbsp;@dbname&nbsp;varchar(30)&nbsp;=&nbsp;null,&nbsp;<BR>&nbsp;&nbsp;@filename&nbsp;varchar(200)&nbsp;=&nbsp;'c:\script.sql'<BR>)<BR>AS</P>
<P>DECLARE&nbsp;@object&nbsp;int<BR>DECLARE&nbsp;@hr&nbsp;int<BR>DECLARE&nbsp;@return&nbsp;varchar(200)<BR>DECLARE&nbsp;@exec_str&nbsp;varchar(2000)<BR>DECLARE&nbsp;@spname&nbsp;sysname</P>
<P>SET&nbsp;NOCOUNT&nbsp;ON</P>
<P>--&nbsp;Sets&nbsp;the&nbsp;server&nbsp;to&nbsp;the&nbsp;local&nbsp;server<BR>IF&nbsp;@server&nbsp;is&nbsp;NULL<BR>&nbsp;&nbsp;SELECT&nbsp;@server&nbsp;=&nbsp;@@servername</P>
<P>--&nbsp;Sets&nbsp;the&nbsp;database&nbsp;to&nbsp;the&nbsp;current&nbsp;database<BR>IF&nbsp;@dbname&nbsp;is&nbsp;NULL<BR>&nbsp;&nbsp;SELECT&nbsp;@dbname&nbsp;=&nbsp;db_name()</P>
<P>--&nbsp;Sets&nbsp;the&nbsp;username&nbsp;to&nbsp;the&nbsp;current&nbsp;user&nbsp;name<BR>IF&nbsp;@uname&nbsp;is&nbsp;NULL<BR>&nbsp;&nbsp;SELECT&nbsp;@uname&nbsp;=&nbsp;SYSTEM_USER</P>
<P>--&nbsp;Create&nbsp;an&nbsp;object&nbsp;that&nbsp;points&nbsp;to&nbsp;the&nbsp;SQL&nbsp;Server<BR>EXEC&nbsp;@hr&nbsp;=&nbsp;sp_OACreate&nbsp;'SQLDMO.SQLServer',&nbsp;@object&nbsp;OUT<BR>IF&nbsp;@hr&nbsp;&lt;&gt;&nbsp;0<BR>BEGIN<BR>&nbsp;&nbsp;PRINT&nbsp;'error&nbsp;create&nbsp;SQLOLE.SQLServer'<BR>&nbsp;&nbsp;RETURN<BR>END</P>
<P>--&nbsp;&nbsp;Connect&nbsp;to&nbsp;the&nbsp;SQL&nbsp;Server<BR>IF&nbsp;@pwd&nbsp;is&nbsp;NULL<BR>&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;EXEC&nbsp;@hr&nbsp;=&nbsp;sp_OAMethod&nbsp;@object,&nbsp;'Connect',&nbsp;NULL,&nbsp;&nbsp;@server,&nbsp;@uname<BR>&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;@hr&nbsp;&lt;&gt;&nbsp;0<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PRINT&nbsp;'error&nbsp;Connect'<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END<BR>&nbsp;&nbsp;END<BR>ELSE<BR>&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;EXEC&nbsp;@hr&nbsp;=&nbsp;sp_OAMethod&nbsp;@object,&nbsp;'Connect',&nbsp;NULL,&nbsp;&nbsp;@server,&nbsp;@uname,&nbsp;@pwd<BR>&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;@hr&nbsp;&lt;&gt;&nbsp;0<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PRINT&nbsp;'error&nbsp;Connect'<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END<BR>&nbsp;&nbsp;END</P>
<P>--Verify&nbsp;the&nbsp;connection<BR>EXEC&nbsp;@hr&nbsp;=&nbsp;sp_OAMethod&nbsp;@object,&nbsp;'VerifyConnection',&nbsp;@return&nbsp;OUT<BR>IF&nbsp;@hr&nbsp;&lt;&gt;&nbsp;0<BR>BEGIN<BR>&nbsp;&nbsp;PRINT&nbsp;'error&nbsp;VerifyConnection'<BR>&nbsp;&nbsp;RETURN<BR>END</P>
<P>SET&nbsp;@exec_str&nbsp;=&nbsp;'DECLARE&nbsp;script_cursor&nbsp;CURSOR&nbsp;FOR&nbsp;SELECT&nbsp;name&nbsp;FROM&nbsp;'&nbsp;+&nbsp;@dbname&nbsp;+&nbsp;'..sysobjects&nbsp;WHERE&nbsp;type&nbsp;=&nbsp;''P''&nbsp;ORDER&nbsp;BY&nbsp;Name'<BR>EXEC&nbsp;(@exec_str)</P>
<P>OPEN&nbsp;script_cursor<BR>FETCH&nbsp;NEXT&nbsp;FROM&nbsp;script_cursor&nbsp;INTO&nbsp;@spname<BR>WHILE&nbsp;(@@fetch_status&nbsp;&lt;&gt;&nbsp;-1)<BR>BEGIN<BR>&nbsp;&nbsp;SET&nbsp;@exec_str&nbsp;=&nbsp;'Databases("'+&nbsp;@dbname&nbsp;+'").StoredProcedures("'+RTRIM(UPPER(@spname))+'").Script(74077,"'+&nbsp;@filename&nbsp;+'")'<BR>&nbsp;&nbsp;EXEC&nbsp;@hr&nbsp;=&nbsp;sp_OAMethod&nbsp;@object,&nbsp;@exec_str,&nbsp;@return&nbsp;OUT<BR>&nbsp;&nbsp;IF&nbsp;@hr&nbsp;&lt;&gt;&nbsp;0<BR>&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PRINT&nbsp;'error&nbsp;Script'<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;END<BR>&nbsp;&nbsp;FETCH&nbsp;NEXT&nbsp;FROM&nbsp;script_cursor&nbsp;INTO&nbsp;@spname<BR>END<BR>CLOSE&nbsp;script_cursor<BR>DEALLOCATE&nbsp;script_cursor<BR>&nbsp;&nbsp;<BR>--&nbsp;Destroy&nbsp;the&nbsp;object<BR>EXEC&nbsp;@hr&nbsp;=&nbsp;sp_OADestroy&nbsp;@object<BR>IF&nbsp;@hr&nbsp;&lt;&gt;&nbsp;0<BR>BEGIN<BR>&nbsp;&nbsp;PRINT&nbsp;'error&nbsp;destroy&nbsp;object'<BR>&nbsp;&nbsp;RETURN<BR>END<BR>GO</P></FONT>