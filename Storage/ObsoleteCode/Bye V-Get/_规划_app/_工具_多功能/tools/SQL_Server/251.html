<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>交叉制表-验证对象的存在(3)</B><BR>第一步检查三个列名称和源表或视图的存在性之后需要确认聚合操作合适于value列的数据类型,最后,数据分组参数需要针对列头进行验证.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;通过考察sysobjects&nbsp;表可以验证源对象的存在性.所有提供的三个列分别被检查以查看他们对于提供的源对象在syscolumns表中是否存在.<BR>&nbsp;--check&nbsp;if&nbsp;source&nbsp;exists&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>if&nbsp;not&nbsp;exists<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(select&nbsp;*&nbsp;from&nbsp;sysobjects&nbsp;where&nbsp;name=@chrsource&nbsp;and&nbsp;type&nbsp;in(''v'',''u''))<BR>&nbsp;&nbsp;&nbsp;&nbsp;begin<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raiserror&nbsp;51001&nbsp;''source&nbsp;does&nbsp;not&nbsp;exist.''<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-1<BR>&nbsp;&nbsp;&nbsp;&nbsp;end<BR>--check&nbsp;for&nbsp;column&nbsp;existence<BR>&nbsp;&nbsp;if&nbsp;not&nbsp;exists<BR>&nbsp;&nbsp;(select&nbsp;sc.name&nbsp;from&nbsp;syscolumns&nbsp;sc&nbsp;join&nbsp;sysobjects&nbsp;so&nbsp;on&nbsp;sc.id=so.id&nbsp;<BR>&nbsp;&nbsp;&nbsp;where&nbsp;so.name=@chrsource&nbsp;and&nbsp;sc.name=@chrhead)<BR>&nbsp;begin<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raiserror&nbsp;51002&nbsp;''invalid&nbsp;@chrcolhead&nbsp;name''<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-1<BR>&nbsp;end<BR>&nbsp;&nbsp;if&nbsp;not&nbsp;exists<BR>&nbsp;&nbsp;&nbsp;(select&nbsp;sc.name&nbsp;from&nbsp;syscolumns&nbsp;sc&nbsp;join&nbsp;sysobjects&nbsp;so&nbsp;on&nbsp;sc.id=so.id<BR>&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;so.name=@chrsource&nbsp;and&nbsp;sc.name=@chrrowhead)<BR>&nbsp;&nbsp;begin<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raiserror&nbsp;51002&nbsp;''invalid&nbsp;@chrrowhead&nbsp;name''<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-1<BR>&nbsp;end<BR>&nbsp;&nbsp;<BR>&nbsp;&nbsp;if&nbsp;not&nbsp;exists<BR>&nbsp;&nbsp;(select&nbsp;sc.name&nbsp;from&nbsp;syscolumns&nbsp;sc&nbsp;join&nbsp;sysobjects&nbsp;so&nbsp;on&nbsp;sc.id=so.id<BR>&nbsp;&nbsp;&nbsp;where&nbsp;so.name=@chrsource&nbsp;and&nbsp;sc.name=@chrvalue)<BR>&nbsp;begin<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raiserror&nbsp;51002&nbsp;''invalid&nbsp;@chrvalue&nbsp;name''<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-1<BR>&nbsp;end<BR>--verify&nbsp;type&nbsp;&nbsp;is&nbsp;valid&nbsp;1(sum)&nbsp;2(avg)&nbsp;etc...<BR>&nbsp;if&nbsp;@inytype&lt;1&nbsp;or&nbsp;@inytype&gt;5<BR>--&nbsp;if&nbsp;@inytype&nbsp;not&nbsp;between&nbsp;1&nbsp;and&nbsp;5<BR>&nbsp;begin<BR>&nbsp;&nbsp;&nbsp;&nbsp;raiserror&nbsp;51000&nbsp;''invalid&nbsp;crosstab&nbsp;type''<BR>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-1<BR>&nbsp;end</FONT>