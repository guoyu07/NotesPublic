<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>交叉制表--检查列的计数值和长度并加入行数据(9)</B><BR>除了需要证实列的计数值和名称长度,如果一切正常用户还需要填写#rownames表<BR>--check&nbsp;column&nbsp;count<BR>if&nbsp;(select&nbsp;&nbsp;count(*)&nbsp;from&nbsp;#colnames)&gt;1023<BR>begin<BR>&nbsp;&nbsp;drop&nbsp;table&nbsp;#colnames<BR>&nbsp;&nbsp;raiserror&nbsp;&nbsp;51004&nbsp;'distinct&nbsp;column&nbsp;count&nbsp;exceeded&nbsp;max&nbsp;of&nbsp;1023'<BR>&nbsp;&nbsp;return&nbsp;-1<BR>end<BR>--verify&nbsp;colnames&nbsp;do&nbsp;not&nbsp;exceed&nbsp;max&nbsp;length<BR>if&nbsp;(select&nbsp;max(datalength(rtrim(colname))-1)&nbsp;from&nbsp;#colnames)&gt;29<BR>begin<BR>&nbsp;&nbsp;drop&nbsp;table&nbsp;#colnames<BR>&nbsp;&nbsp;&nbsp;raiserror&nbsp;51050&nbsp;'column&nbsp;data&nbsp;length&nbsp;exceeded&nbsp;max&nbsp;of&nbsp;30'<BR>&nbsp;&nbsp;return&nbsp;-1<BR>end<BR>--if&nbsp;all&nbsp;is&nbsp;ok&nbsp;,continue&nbsp;to&nbsp;add&nbsp;#rownames&nbsp;data<BR>select&nbsp;@chvexec='insert&nbsp;#rownames&nbsp;select&nbsp;distinct&nbsp;'+<BR>&nbsp;&nbsp;case&nbsp;@introwtype<BR>&nbsp;&nbsp;when&nbsp;1&nbsp;then&nbsp;'convert(varchar(255),'&nbsp;else&nbsp;''<BR>&nbsp;&nbsp;end&nbsp;+rtrim(@chrrowhead)+<BR>&nbsp;&nbsp;case&nbsp;@introwtype<BR>&nbsp;&nbsp;when&nbsp;1&nbsp;then&nbsp;')'<BR>&nbsp;&nbsp;else&nbsp;''<BR>&nbsp;&nbsp;end&nbsp;+'from&nbsp;'+@chrsource<BR>--print&nbsp;@chvexec<BR>exec(@chvexec)&nbsp;&nbsp;<BR></FONT>