<meta http-equiv="content-type" content="text/html; charset=gb2312">&nbsp;<FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>List&nbsp;objects&nbsp;from&nbsp;databases</B><BR>User&nbsp;Stored&nbsp;Procedure&nbsp;-&nbsp;List&nbsp;objects&nbsp;from&nbsp;databases
<P></P>
<P></P>
<P><BR>&gt;&gt;Script&nbsp;Language&nbsp;and&nbsp;Platform:&nbsp;MS&nbsp;SQL&nbsp;2000/MS&nbsp;SQL&nbsp;7.0<BR>This&nbsp;SP&nbsp;lists&nbsp;all&nbsp;of&nbsp;the&nbsp;objects&nbsp;from&nbsp;either&nbsp;all&nbsp;databases&nbsp;or&nbsp;from&nbsp;certain&nbsp;databases.&nbsp;</P>
<P>There&nbsp;are&nbsp;several&nbsp;special&nbsp;advantages&nbsp;of&nbsp;this&nbsp;stored&nbsp;procedure.&nbsp;</P>
<P>Without&nbsp;passing&nbsp;any&nbsp;database&nbsp;name&nbsp;or&nbsp;passing&nbsp;null&nbsp;value,this&nbsp;SP&nbsp;lists&nbsp;all&nbsp;the&nbsp;objects&nbsp;in&nbsp;every&nbsp;database&nbsp;<BR>Without&nbsp;giving&nbsp;the&nbsp;exact&nbsp;database&nbsp;names,this&nbsp;SP&nbsp;automatically&nbsp;offers&nbsp;wildcard&nbsp;function&nbsp;to&nbsp;provide&nbsp;users&nbsp;all&nbsp;the&nbsp;possible&nbsp;databases&nbsp;they&nbsp;are&nbsp;looking&nbsp;for.&nbsp;<BR>It&nbsp;can&nbsp;accept&nbsp;database&nbsp;name&nbsp;multiply&nbsp;like&nbsp;[Finance&nbsp;project&nbsp;plan]&nbsp;,&nbsp;[master]&nbsp;,msdb&nbsp;<BR>It&nbsp;can&nbsp;also&nbsp;accept&nbsp;combinational&nbsp;databases&nbsp;name&nbsp;ex.''[master],msdb,[Finance&nbsp;project&nbsp;plan]'',which&nbsp;can&nbsp;be&nbsp;passed&nbsp;at&nbsp;the&nbsp;same&nbsp;time&nbsp;<BR>It&nbsp;also&nbsp;provide&nbsp;naming&nbsp;convention,user&nbsp;no&nbsp;need&nbsp;of&nbsp;checking&nbsp;which&nbsp;letter&nbsp;represents&nbsp;what&nbsp;object&nbsp;type&nbsp;</P>
<P>Author:&nbsp;Claire&nbsp;Hsu&nbsp;</P>
<P></P>
<P>Create&nbsp;proc&nbsp;USP_listobject&nbsp;@dbname&nbsp;varchar(200)='%'&nbsp;as<BR>--Script&nbsp;Language&nbsp;and&nbsp;Platform:MS&nbsp;SQL&nbsp;2000<BR>--Objective:&nbsp;List&nbsp;all&nbsp;the&nbsp;objects&nbsp;in&nbsp;all&nbsp;the&nbsp;databases,certain&nbsp;databases<BR>--Author:&nbsp;Claire&nbsp;Hsu<BR>--Objective:&nbsp;To&nbsp;display&nbsp;all&nbsp;the&nbsp;objects&nbsp;from&nbsp;the&nbsp;list&nbsp;of&nbsp;databases<BR>--Date:&nbsp;May&nbsp;20,2003<BR>--Email:&nbsp;messageclaire@yahoo.com<BR>set&nbsp;nocount&nbsp;on<BR>set&nbsp;@dbname&nbsp;=&nbsp;replace(@dbname,'[','')<BR>set&nbsp;@dbname&nbsp;=&nbsp;replace(@dbname,']','')<BR>declare&nbsp;@string&nbsp;varchar(50)<BR>declare&nbsp;@db&nbsp;varchar(50)<BR>Create&nbsp;table&nbsp;#object_dis&nbsp;(name&nbsp;sysname,xtype&nbsp;char(20),DBname&nbsp;varchar(200))<BR>declare&nbsp;cur1&nbsp;cursor&nbsp;for&nbsp;select&nbsp;'['+name+']'&nbsp;from&nbsp;sysdatabases<BR>open&nbsp;cur1<BR>fetch&nbsp;next&nbsp;from&nbsp;cur1&nbsp;into&nbsp;@db<BR>while&nbsp;@@fetch_status&nbsp;=&nbsp;0<BR>begin<BR>set&nbsp;@string&nbsp;=&nbsp;'use&nbsp;'+@db<BR>exec(@string)<BR>set&nbsp;@db&nbsp;=&nbsp;replace(@db,'[','')<BR>set&nbsp;@db&nbsp;=&nbsp;replace(@db,']','')<BR>insert&nbsp;into&nbsp;#object_dis&nbsp;select&nbsp;name,xtype,@db&nbsp;as&nbsp;dbname&nbsp;from&nbsp;sysobjects&nbsp;</P>
<P>fetch&nbsp;next&nbsp;from&nbsp;cur1&nbsp;into&nbsp;@db<BR>end<BR>if&nbsp;@dbname&nbsp;&lt;&gt;'%'&nbsp;and&nbsp;@dbname&nbsp;&lt;&gt;''<BR>begin<BR>set&nbsp;@dbname&nbsp;=&nbsp;replace(@dbname,',','%"&nbsp;or&nbsp;dbname&nbsp;like&nbsp;"')<BR>exec('<BR>select&nbsp;name,<BR>(case&nbsp;xtype&nbsp;when&nbsp;"c"&nbsp;then&nbsp;"CHECK&nbsp;constraint"&nbsp;when&nbsp;"D"&nbsp;then&nbsp;"Default"&nbsp;when&nbsp;"F"&nbsp;then&nbsp;"FOREIGN&nbsp;KEY"<BR>when&nbsp;"FN"&nbsp;then&nbsp;"Scalar&nbsp;function"&nbsp;when&nbsp;"IF"&nbsp;then&nbsp;"Inlined&nbsp;table-function"&nbsp;when&nbsp;"K"&nbsp;then&nbsp;"Primary&nbsp;Key"<BR>when&nbsp;"L"&nbsp;then&nbsp;"Log"&nbsp;when&nbsp;"P"&nbsp;then&nbsp;"Stored&nbsp;procedure"&nbsp;when&nbsp;"R"&nbsp;then&nbsp;"Rule"&nbsp;when&nbsp;"RF"&nbsp;then&nbsp;"Replication&nbsp;filter&nbsp;stored&nbsp;procedure"<BR>when&nbsp;"PK"&nbsp;then&nbsp;"PRIMARY&nbsp;KEY"&nbsp;when&nbsp;"S"&nbsp;then&nbsp;"System&nbsp;table"&nbsp;when&nbsp;"TF"&nbsp;then&nbsp;"Table&nbsp;function"&nbsp;when&nbsp;"TR"&nbsp;then&nbsp;"Trigger"&nbsp;when&nbsp;"U"&nbsp;then&nbsp;"User&nbsp;table"<BR>when&nbsp;"UQ"&nbsp;then&nbsp;"UNIQUE&nbsp;constraint"&nbsp;when&nbsp;"U"&nbsp;then&nbsp;"User&nbsp;Table"<BR>when&nbsp;"V"&nbsp;then&nbsp;"VIEW"&nbsp;when&nbsp;"X"&nbsp;then&nbsp;"Extended&nbsp;stored&nbsp;procedure"&nbsp;end)&nbsp;as&nbsp;"xtype"<BR>,dbname<BR>from&nbsp;#object_dis&nbsp;where&nbsp;dbname&nbsp;like&nbsp;"'+@dbname+'%"&nbsp;group&nbsp;by&nbsp;dbname,xtype,name&nbsp;')<BR>end<BR>if&nbsp;@dbname&nbsp;=&nbsp;'%'&nbsp;or&nbsp;@dbname&nbsp;=&nbsp;''<BR>exec('select&nbsp;name,<BR>(case&nbsp;xtype&nbsp;when&nbsp;"c"&nbsp;then&nbsp;"CHECK&nbsp;constraint"&nbsp;when&nbsp;"D"&nbsp;then&nbsp;"Default"&nbsp;when&nbsp;"F"&nbsp;then&nbsp;"FOREIGN&nbsp;KEY"<BR>when&nbsp;"FN"&nbsp;then&nbsp;"Scalar&nbsp;function"&nbsp;when&nbsp;"IF"&nbsp;then&nbsp;"Inlined&nbsp;table-function"&nbsp;when&nbsp;"K"&nbsp;then&nbsp;"Primary&nbsp;Key"<BR>when&nbsp;"L"&nbsp;then&nbsp;"Log"&nbsp;when&nbsp;"P"&nbsp;then&nbsp;"Stored&nbsp;procedure"&nbsp;when&nbsp;"R"&nbsp;then&nbsp;"Rule"&nbsp;when&nbsp;"RF"&nbsp;then&nbsp;"Replication&nbsp;filter&nbsp;stored&nbsp;procedure"<BR>when&nbsp;"PK"&nbsp;then&nbsp;"PRIMARY&nbsp;KEY"&nbsp;when&nbsp;"S"&nbsp;then&nbsp;"System&nbsp;table"&nbsp;when&nbsp;"TF"&nbsp;then&nbsp;"Table&nbsp;function"&nbsp;when&nbsp;"TR"&nbsp;then&nbsp;"Trigger"&nbsp;when&nbsp;"U"&nbsp;then&nbsp;"User&nbsp;table"<BR>when&nbsp;"UQ"&nbsp;then&nbsp;"UNIQUE&nbsp;constraint"&nbsp;when&nbsp;"U"&nbsp;then&nbsp;"User&nbsp;Table"<BR>when&nbsp;"V"&nbsp;then&nbsp;"VIEW"&nbsp;when&nbsp;"X"&nbsp;then&nbsp;"Extended&nbsp;stored&nbsp;procedure"&nbsp;end)&nbsp;as&nbsp;"xtype",<BR>dbname&nbsp;from&nbsp;#object_dis&nbsp;where&nbsp;dbname&nbsp;like&nbsp;"%"&nbsp;group&nbsp;by&nbsp;dbname,xtype,name')<BR>drop&nbsp;table&nbsp;#object_dis<BR>close&nbsp;cur1<BR>deallocate&nbsp;cur1</P>
<P>--Usage<BR>--exec&nbsp;USP_listobject<BR>--exec&nbsp;USP_listobject''<BR>--exec&nbsp;USP_listobject&nbsp;'msdb'<BR>--exec&nbsp;USP_listobject&nbsp;'[ma]'<BR>--exec&nbsp;USP_listobject&nbsp;'ma'<BR>--exec&nbsp;USP_listobject&nbsp;'ma'<BR>--exec&nbsp;USP_listobject&nbsp;'claire,ma'<BR>--exec&nbsp;USP_listobject&nbsp;'[claire],ma'<BR>--exec&nbsp;USP_listobject&nbsp;'[I&nbsp;am&nbsp;],master'&nbsp;<BR>--exec&nbsp;USP_listobject&nbsp;'[I&nbsp;am&nbsp;],[ms]'</P></FONT>