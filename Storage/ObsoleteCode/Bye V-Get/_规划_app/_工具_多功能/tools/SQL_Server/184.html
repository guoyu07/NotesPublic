<meta http-equiv="content-type" content="text/html; charset=gb2312"><B>找含匹配列的行－T-SQL系列</B><BR><BR>查找含匹配列的行
<P></P>
<P>//--为col2与col3查找出重复的行</P>
<P>//match_cols表</P>
<P>row_no&nbsp;col2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;col3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>------&nbsp;&nbsp;----------&nbsp;&nbsp;----------&nbsp;<BR>1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</P>
<P>(10&nbsp;row(s)&nbsp;affected)</P>
<P><BR>方法一：自联结法</P>
<P>对于到大量数据，它的效率不高。</P>
<P>SELECT&nbsp;DISTINCT&nbsp;A.row_no,A.col2,A.col3<BR>FROM&nbsp;match_cols&nbsp;A,match_cols&nbsp;B<BR>WHERE&nbsp;A.col2=B.col2&nbsp;AND&nbsp;A.col3=B.col3<BR>&nbsp;AND&nbsp;A.row_no&lt;&gt;B.row_no<BR>ORDER&nbsp;BY&nbsp;A.col2,A.col3</P>
<P><BR>方法二：相关子查询</P>
<P>SELECT&nbsp;A.row_no,A.col2,A.col3<BR>FROM&nbsp;match_cols&nbsp;A<BR>WHERE&nbsp;EXISTS(SELECT&nbsp;B.col2,B.col3<BR>&nbsp;FROM&nbsp;match_cols&nbsp;AS&nbsp;B<BR>&nbsp;WHERE&nbsp;A.col2=B.col2&nbsp;AND&nbsp;A.col3=B.col3<BR>&nbsp;GROUP&nbsp;BY&nbsp;B.col2,B.col3<BR>&nbsp;HAVING&nbsp;COUNT(*)&gt;1)<BR>ORDER&nbsp;BY&nbsp;A.col2,A.col3</P>
<P><BR>方法三：具体化非唯一的值，然后联结到结果</P>
<P>SELECT&nbsp;col2,col3&nbsp;INTO&nbsp;#mytemp<BR>FROM&nbsp;match_cols<BR>GROUP&nbsp;BY&nbsp;col2,col3&nbsp;HAVING&nbsp;COUNT(*)&gt;1</P>
<P>SELECT&nbsp;#mytemp.col2,#mytemp.col3,#mytemp.row_num<BR>FROM&nbsp;#mytemp<BR>JOIN&nbsp;match_cols<BR>ON(#mytemp.col2=match_cols.col2&nbsp;AND<BR>&nbsp;&nbsp;&nbsp;#mytemp.col3=match_cols.col3)<BR>ORDER&nbsp;BY&nbsp;1,2,3</P>
<P>这种方法速度快。因只有16种可能的组合，因此只有16种出现重复的方式，该临时表也就只包含16行。该临时表就成为该联结的外表。然后对这16行中的每一行扫描（利用索引）一次主表match_cols。这样就不象前面介绍的方法中那样，扫描次数高达5000，而是只扫描16次。这种方法是到现在为止最快的。纯SQL查询最适合这类工作，效率也高。</P>
<P><BR>方法四：使用导出表<BR>使用导出表的效果相当好，处理方法与临时表几乎完全相同。</P>
<P>SELECT&nbsp;A.row_num,A.col2,A.col3<BR>FROM&nbsp;match_cols&nbsp;AS&nbsp;A<BR>JOIN&nbsp;<BR>(SELECT&nbsp;col2,col3&nbsp;FROM&nbsp;match_cols&nbsp;AS&nbsp;B<BR>&nbsp;&nbsp;GROUP&nbsp;BY&nbsp;col2,col3&nbsp;HAVING&nbsp;COUNT(*)&gt;1)&nbsp;AS&nbsp;B<BR>ON(A.col2=B.col2&nbsp;AND&nbsp;A.col3=B.col3)<BR>ORDER&nbsp;BY&nbsp;A.col2,A.col3,A.row_num</P>
<P>********************************<BR>row_no&nbsp;col2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;col3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>------&nbsp;----------&nbsp;----------&nbsp;<BR>4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</P>
<P>(4&nbsp;row(s)&nbsp;affected)</P>
<P></P>
<P><BR></P>