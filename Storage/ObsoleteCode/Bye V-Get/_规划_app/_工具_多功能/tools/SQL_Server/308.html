<meta http-equiv="content-type" content="text/html; charset=gb2312"><B>&amp;PL/SQL书写规范(xzh2000收集)</B><BR>一、&nbsp;Sql&amp;PL/SQL书写规范：&nbsp;<BR>1、&nbsp;语句中出现的所有表名、字段名全部小写，系统保留字、内置函数名、Sql保留字大写。&nbsp;<BR>2、&nbsp;连接符or、in、and、以及＝、&lt;=、&gt;=等前后加上一个空格。<BR>3、&nbsp;对较为复杂的sql语句加上注释，说明算法、功能。<BR>&nbsp;&nbsp;注释风格：注释单独成行、放在语句前面。&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;(1)&nbsp;&nbsp;&nbsp;应对不易理解的分支条件表达式加注释；&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;(2)&nbsp;&nbsp;&nbsp;对重要的计算应说明其功能；&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;(3)&nbsp;&nbsp;&nbsp;过长的函数实现，应将其语句按实现的功能分段加以概括性说明；&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;(4)&nbsp;&nbsp;&nbsp;每条SQL语句均应有注释说明（表名、字段名）。&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;(5)&nbsp;&nbsp;常量及变量注释时，应注释被保存值的含义(必须)，合法取值的范围(可选)&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;(6)&nbsp;&nbsp;可采用单行/多行注释。（--&nbsp;或&nbsp;/*&nbsp;*/&nbsp;方式）&nbsp;<BR>4、&nbsp;SQL语句的缩进风格&nbsp;<BR>(1)&nbsp;&nbsp;一行有多列，超过80个字符时，基于列对齐原则，采用下行缩进&nbsp;<BR>&nbsp;&nbsp;&nbsp;(2)&nbsp;&nbsp;where子句书写时，每个条件占一行，语句令起一行时，以保留字或者连接符开始，连接符右对齐。&nbsp;<BR>5、&nbsp;多表连接时，使用表的别名来引用列。&nbsp;<BR>6、&nbsp;供别的文件或函数调用的函数，绝不应使用全局变量交换数据；&nbsp;<BR>7、&nbsp;变量令名不能超出ORACLE的限制（30个字符），令名要规范，要用英文令名，从变量上能看到变量的作用，如<BR>g名称&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;全局变量<BR>m名称&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;局部变量<BR>c名称&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;光标<BR>p名称&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;参数<BR>8、&nbsp;查找数据库表或视图时，只能取出确实需要的那些字段，不要使用*来代替所有列名。要清楚明白地使用列名，而不能使用列的序号。<BR>9、&nbsp;功能相似的过程和函数，尽量写到同一个包中，加强管理。
<P></P>
<P>如例（1）</P>
<P>二、&nbsp;书写优化性能建议&nbsp;<BR>&nbsp;1、避免嵌套连接。例如：A&nbsp;=&nbsp;B&nbsp;and&nbsp;B&nbsp;=&nbsp;C&nbsp;and&nbsp;C&nbsp;=&nbsp;D&nbsp;<BR>&nbsp;2、where条件中尽量减少使用常量比较，改用主机变量<BR>&nbsp;3、系统可能选择基于规则的优化器，所以将结果集返回数据量小的表作为驱动表（from后边最后一个表）。&nbsp;<BR>&nbsp;4、大量的排序操作影响系统性能，所以尽量减少order&nbsp;by和group&nbsp;by排序操作。&nbsp;</P>
<P>如必须使用排序操作，请遵循如下规则：&nbsp;<BR>(1)&nbsp;排序尽量建立在有索引的列上。&nbsp;<BR>(2)&nbsp;如结果集不需唯一，使用union&nbsp;all代替union。&nbsp;<BR>5、索引的使用。<BR>(1)&nbsp;尽量避免对索引列进行计算。如对索引列计算较多，请提请系统管理员建立函数索引。<BR>(2)&nbsp;尽量注意比较值与索引列数据类型的一致性。<BR>(3)&nbsp;对于复合索引，SQL语句必须使用主索引列&nbsp;<BR>(4)&nbsp;索引中，尽量避免使用NULL。<BR>(5)&nbsp;对于索引的比较，尽量避免使用NOT=（!=）<BR>(6)&nbsp;查询列和排序列与索引列次序保持一致&nbsp;</P>
<P>&nbsp;6、尽量避免相同语句由于书写格式的不同，而导致多次语法分析，尽量使用Bind变量。&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7、尽量使用共享的SQL语句。<BR>8、查询的WHERE过滤原则，应使过滤记录数最多的条件放在最前面。&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;9、任何对列的操作都将导致表扫描，它包括数据库函数、计算表达式等等，查询时要尽可能将操作移至等号右边。&nbsp;<BR>10、in、or子句常会使用工作表，使索引失效；如果不产生大量重复值，可以考虑把子句拆开；拆开的子句中应该包含索引。</P>
<P>三、其他经验性规则&nbsp;<BR>&nbsp;&nbsp;&nbsp;1、尽量少用嵌套查询。如必须，请用not&nbsp;exist代替not&nbsp;in子句。如例（2）&nbsp;<BR>&nbsp;2、用多表连接代替EXISTS子句。如例（3）<BR>&nbsp;3、少用DISTINCT，用EXISTS代替&nbsp;如例（4）&nbsp;<BR>&nbsp;4、使用UNION&nbsp;ALL、MINUS、INTERSECT提高性能&nbsp;<BR>&nbsp;5、使用ROWID提高检索速度。对SELECT得到的单行记录，需进行DELETE、UPDATE操作时，使用ROWID将会使效率大大提高。&nbsp;<BR>&nbsp;6、使用优化线索机制进行访问路径控制。&nbsp;<BR>&nbsp;7、使用cursor时，显示光标优于隐式光标&nbsp;</P>
<P>本规范示例：&nbsp;<BR>&nbsp;例一：&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;aka042&nbsp;--&nbsp;单位缴费划入个人帐户比例&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;prm_aaa043&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;ka01&nbsp;--医疗保险单位缴费划入个人帐户比例分段信息&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;akc021&nbsp;=&nbsp;rec_kc01.akc021&nbsp;--&nbsp;医疗人员类别&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;aka041&nbsp;&gt;=&nbsp;rec_kc01.akc023&nbsp;--&nbsp;年龄上限&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;aka040&nbsp;&lt;=&nbsp;rec_kc01.akc023&nbsp;--&nbsp;年龄下限&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;aae030&nbsp;&lt;=&nbsp;prm_date&nbsp;--&nbsp;开始时间&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;(&nbsp;aae031&nbsp;&gt;=&nbsp;prm_date&nbsp;OR&nbsp;aae031&nbsp;IS&nbsp;NULL&nbsp;);&nbsp;--&nbsp;终止时间&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;例二：&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;X&nbsp;SELECT&nbsp;......&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;emp&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;dept_no&nbsp;NOT&nbsp;IN&nbsp;(&nbsp;SELECT&nbsp;dept_no&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;dept&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;dept_cat='A');&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;O&nbsp;SELECT&nbsp;......&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;emp&nbsp;e&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;NOT&nbsp;EXISTS&nbsp;(&nbsp;SELECT&nbsp;'X'&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;dept&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;dept_no=e.dept_no&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;dept_cat='A');&nbsp;</P>
<P>&nbsp;例三：&nbsp;<BR>&nbsp;&nbsp;&nbsp;X&nbsp;SELECT&nbsp;......&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;emp&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;EXISTS&nbsp;(&nbsp;SELECT&nbsp;'X'&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;dept&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;dept_no=e.dept_no&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;dept_cat='A');&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;O&nbsp;SELECT&nbsp;......&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;emp&nbsp;e,dept&nbsp;d&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;e.dept_no=d.dept_no&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;AND&nbsp;dept_cat='A';&nbsp;<BR>&nbsp;&nbsp;<BR>&nbsp;例四：&nbsp;<BR>&nbsp;&nbsp;&nbsp;X&nbsp;SELECT&nbsp;DISTINCT&nbsp;d.dept_code,d.dept_name&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;dept&nbsp;d&nbsp;,emp&nbsp;e&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;e.dept_code=d.dept_code;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;O&nbsp;SELECT&nbsp;dept_code,dept_name&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;dept&nbsp;d&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;EXISTS&nbsp;(&nbsp;SELECT&nbsp;'X'&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;emp&nbsp;e&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;e.dept_code=d.dept_code);&nbsp;</P>
<P><BR>注释范例<BR>过程注释：<BR>过程都以sp_开头，注意过程名称要符合令名要求<BR>/**************************************************************************<BR>name:sp_Write_log<BR>parameter:p_textContext&nbsp;in&nbsp;varchar2&nbsp;参数描述<BR>create&nbsp;date:2003-04-1<BR>creater:chen&nbsp;jiping<BR>desc:过程总功能描述<BR>****************************************************************************/<BR>函数注释<BR>函数以f开头，令名符合令名标准<BR>/**************************************************************************<BR>name:f_Get_JobId<BR>parameter:p_Name&nbsp;in&nbsp;varchar2&nbsp;参数描述<BR>return&nbsp;number:返回值描述<BR>create&nbsp;date:2003-04-1<BR>creater:chen&nbsp;jiping<BR>desc:函数总功能描述<BR>****************************************************************************/</P>