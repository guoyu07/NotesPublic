<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>使用SQL&nbsp;SERVER&nbsp;2000的全文检索功能</B><BR><IMG 
src="http://www.pigtwo.com/forum/pic/url.gif" align=absMiddle border=0><A 
href="http://www.csdn.net/develop/read_article.asp?id=17137" 
target=_blank>http://www.csdn.net/develop/read_article.asp?id=17137</A><BR>使用SQL&nbsp;SERVER&nbsp;2000的全文检索功能
<P></P>
<P>步骤：</P>
<P>1、&nbsp;&nbsp;打开NorthWind数据库，右键Products表，选择“全文索引表”，“在表上定义全文索引”，为其创建全文目录。在“全文索引向导”中，选择你需要全文查询条件的列（可以是文本或图像），我们选择Productname和QuantityPerUnit列。然后下一步，输入一个新的目录proCatalog，点击下一步。在填充调度一项里，我们暂时不建立填充调度。接着“下一步”，全成全文索引向导。完成后，我们可以看到在“全文目录”里，多了一个全文目录proCatalog。右键proCatalog属性，可以看到其状态、表、调度情况。</P>
<P>&nbsp;</P>
<P>2、&nbsp;&nbsp;右键全文目录proCatalog，&nbsp;“启动完全填充”，系统会出现“全文目录填充成功启动”。</P>
<P>&nbsp;</P>
<P>3、&nbsp;&nbsp;这时，我们可以使用Transact-SQL进行全文检索了，我们使用CONTAINS、FREETEXT等谓词。如：</P>
<P>&nbsp;</P>
<P>检索ProductName中，即包含b又包含c的所有列</P>
<P>SELECT&nbsp;*</P>
<P>FROM&nbsp;Products</P>
<P>WHERE&nbsp;CONTAINS(ProductName,&nbsp;'"c*"&nbsp;and&nbsp;"b*"&nbsp;')</P>
<P>&nbsp;</P>
<P>检索ProductName中，即包含chai&nbsp;chang&nbsp;tofu之一的所有列</P>
<P>SELECT&nbsp;*</P>
<P>FROM&nbsp;Products</P>
<P>WHERE&nbsp;FREETEXT(ProductName,&nbsp;'chai&nbsp;chang&nbsp;tofu&nbsp;')</P>
<P>&nbsp;</P>
<P>我们还可以使用CONTAINSTABLE、FREETEXTTABLE等</P>
<P>&nbsp;</P>
<P>4、&nbsp;&nbsp;我们可以用.NET创建WEB或Form客户端，提供一个良好的全文检索界面，使自己的应用程序得到扩展</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>参考：<BR>全文查询有关的系统存储过程</P>
<P>（1）启动数据库的全文处理功能（sp_fulltext_datebase）；&nbsp;<BR>（2）建立全文目录（sp_fulltext_catalog）；&nbsp;<BR>（3）在全文目录中注册需要全文索引的表（sp_fulltext_table）；&nbsp;<BR>（4）指出表中需要全文检索的列名（sp_fulltext_column）&nbsp;<BR>（5）为表创建全文索引（sp_fulltext_table）；&nbsp;<BR>（6）填充全文索引（sp_fulltext_catalog）。</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>&nbsp;</P>
<P>全文查询支持</P>
<P>Microsoft?&nbsp;SQL&nbsp;Server?&nbsp;2000&nbsp;在接收带全文构造的&nbsp;Transact-SQL&nbsp;语句时，使用全文提供程序从&nbsp;Microsoft&nbsp;搜索服务检索所需信息。全文构造是&nbsp;CONTAINS&nbsp;或&nbsp;FREETEXT&nbsp;谓词，或者是&nbsp;CONTAINSTABLE&nbsp;或&nbsp;FREETEXTTABLE&nbsp;行集函数。如果不知道包含搜索条件的列，全文构造可以在全文索引中引用多列。该进程的流程如下图所示。</P>
<P></P>
<P><BR>这一进程涉及的步骤包括：&nbsp;</P>
<P>应用程序给&nbsp;SQL&nbsp;Server&nbsp;实例发送带全文构造的&nbsp;Transact-SQL&nbsp;语句。</P>
<P>SQL&nbsp;Server&nbsp;关系引擎通过查询系统表验证全文构造，确定全文索引是否覆盖列引用。关系引擎将每个&nbsp;SQL&nbsp;语句简化为一系列行集操作，并使用&nbsp;OLE&nbsp;DB&nbsp;将这些操作传递给基础组件，通常是存储引擎。关系引擎通过全文提供程序而不是存储引擎，将任何全文构造转换成对行集的请求。请求的行集是满足搜索条件和等级的键集，而这个等级表示每个键的数据满足搜索条件的程度。向全文提供程序发送的行集请求命令包括全文检索条件。</P>
<P>全文提供程序验证请求并将搜索条件更改为由Microsoft&nbsp;搜索服务的查询支持组件使用的形式。将请求发送到搜索服务。</P>
<P>查询支持组件使用搜索引擎组件从全文索引析取所请求的数据。然后以行集的形式将这些数据传递回全文提供程序。</P>
<P>全文提供程序将这个行集返回给关系引擎。</P>
<P>关系引擎将它从存储引擎和全文提供程序收到的所有行集进行组合，以生成发送回客户端的最终结果集。&nbsp;</P>
<P>&nbsp;</P>
<P>全文目录和索引</P>
<P>Microsoft?&nbsp;SQL&nbsp;Server?&nbsp;2000&nbsp;全文索引为在字符串数据中进行复杂的词搜索提供有效支持。全文索引存储关于重要词和这些词在特定列中的位置的信息。全文查询利用这些信息，可快速搜索包含具体某个词或一组词的行。</P>
<P>全文索引包含在全文目录中。每个数据库可以包含一个或多个全文目录。一个目录不能属于多个数据库，而每个目录可以包含一个或多个表的全文索引。一个表只能有一个全文索引，因此每个有全文索引的表只属于一个全文目录。</P>
<P>全文目录和索引不存储在它们所属的数据库中。目录和索引由&nbsp;Microsoft&nbsp;搜索服务分开管理。</P>
<P>全文索引必须在基表上定义，而不能在视图、系统表或临时表上定义。&nbsp;全文索引的定义包括：&nbsp;</P>
<P>能唯一标识表中各行的列（主键或候选键），而且不允许&nbsp;NULL&nbsp;值。</P>
<P>索引所覆盖的一个或多个字符串列。&nbsp;</P>
<P>全文索引由键值填充。每个键的项提供与该键相关联的重要词（干扰词或终止词除外）、它们所在的列和它们在列中的位置等有关信息。</P>
<P>格式化文本字符串（如&nbsp;Microsoft?&nbsp;Word?&nbsp;文档文件或&nbsp;HTML&nbsp;文件）不能存储在字符串或&nbsp;Unicode&nbsp;列中，因为这些文件中的许多字节包含不构成有效字符的数据结构。数据库应用程序可能仍需要访问这些数据并对其应用全文检索。因为&nbsp;image&nbsp;列并不要求每一字节都构成一个有效字符，所以许多站点将这类数据存储在&nbsp;image&nbsp;列中。SQL&nbsp;Server&nbsp;2000&nbsp;引入了对存储在&nbsp;image&nbsp;列中的这些类型的数据执行全文检索的能力。SQL&nbsp;Server&nbsp;2000&nbsp;提供筛选，可从&nbsp;Microsoft&nbsp;Office?&nbsp;文件（.doc、.xls&nbsp;和&nbsp;.ppt&nbsp;文件）、文本文件（.txt&nbsp;文件）及&nbsp;HTML&nbsp;文件（.htm&nbsp;文件）中析取文本化数据。设计表时除包括保存数据的&nbsp;image&nbsp;列外，还需包括绑定列来保存存储在&nbsp;image&nbsp;列中的数据格式的文件扩展名。可以创建引用&nbsp;image&nbsp;列和绑定列的全文索引，以便在存储于&nbsp;image&nbsp;列中的文本化信息上启用全文检索。SQL&nbsp;Server&nbsp;2000&nbsp;全文检索引擎使用绑定列中的文件扩展名信息，选择从列中析取文本化数据的合适的筛选。</P>
<P>全文索引是用于执行两个&nbsp;Transact-SQL&nbsp;谓词的组件，以便根据全文检索条件对行进行测试：&nbsp;</P>
<P>CONTAINS</P>
<P>FREETEXT&nbsp;</P>
<P>Transact-SQL&nbsp;还包含两个返回符合全文检索条件的行集的函数：&nbsp;</P>
<P>CONTAINSTABLE</P>
<P>FREETEXTTABLE&nbsp;</P>
<P>SQL&nbsp;Server&nbsp;在内部将搜索条件发送给&nbsp;Microsoft&nbsp;搜索服务。Microsoft&nbsp;搜索服务查找所有符合全文检索条件的键并将它们返回给&nbsp;SQL&nbsp;Server。SQL&nbsp;Server&nbsp;随后使用键的列表来确定表中要处理的行。</P>
<P>全文索引</P>
<P>对&nbsp;Microsoft?&nbsp;SQL&nbsp;Server?&nbsp;2000&nbsp;数据的全文支持涉及两个功能：对字符数据发出查询的能力和创建及维护基础索引以简化这些查询的能力。</P>
<P>全文索引在许多地方与普通的&nbsp;SQL&nbsp;索引不同。</P>
<P>普通&nbsp;SQL&nbsp;索引<BR>&nbsp;全文索引<BR>&nbsp;<BR>存储时受定义它们所在的数据库的控制。<BR>&nbsp;存储在文件系统中，但通过数据库管理。<BR>&nbsp;<BR>每个表允许有若干个普通索引。<BR>&nbsp;每个表只允许有一个全文索引。<BR>&nbsp;<BR>当对作为其基础的数据进行插入、更新或删除时，它们自动更新。<BR>&nbsp;将数据添加到全文索引称为填充，全文索引可通过调度或特定请求来请求，也可以在添加新数据时自动发生。<BR>&nbsp;<BR>不分组。<BR>&nbsp;在同一个数据库内分组为一个或多个全文目录。<BR>&nbsp;<BR>使用&nbsp;SQL&nbsp;Server&nbsp;企业管理器、向导或&nbsp;Transact-SQL&nbsp;语句创建和除去。<BR>&nbsp;使用&nbsp;SQL&nbsp;Server&nbsp;企业管理器、向导或存储过程创建、管理和除去。<BR>&nbsp;</P>
<P><BR>&nbsp;</P>
<P>这些差异使大量管理任务变得不可缺少。全文管理是在几个层次上实施的：&nbsp;</P>
<P>服务器&nbsp;</P>
<P>可以对服务器范围的某些属性（如&nbsp;resource_usage）加以设置，以便增加或减少全文服务所使用的系统资源数量。</P>
<P><BR>说明&nbsp;&nbsp;全文引擎作为名为&nbsp;Microsoft&nbsp;搜索的服务在&nbsp;Microsoft&nbsp;Windows&nbsp;NT?&nbsp;Server&nbsp;和&nbsp;Microsoft&nbsp;Windows?&nbsp;2000&nbsp;Server&nbsp;上运行。对于&nbsp;Microsoft&nbsp;SQL&nbsp;Server&nbsp;个人版，Microsoft&nbsp;搜索服务不可用。尽管这意味着&nbsp;Microsoft&nbsp;搜索服务既未安装在&nbsp;Microsoft&nbsp;Windows&nbsp;95/98&nbsp;上，也未安装在&nbsp;Windows&nbsp;NT&nbsp;工作站或&nbsp;Windows&nbsp;2000&nbsp;Professional&nbsp;客户端上，但这些客户端在连接到&nbsp;SQL&nbsp;Server&nbsp;标准版安装或企业版实例时可以使用这项服务。</P>
<P>数据库&nbsp;</P>
<P>必须启用数据库才能使用全文服务。可以在已启用的数据库中创建和除去一个或多个全文目录的元数据。</P>
<P>全文目录&nbsp;</P>
<P>全文目录包含数据库中的全文索引。每个目录可以用于数据库内的一个或多个表的索引需求。该目录中的索引是使用这里介绍的管理功能来填充的。（全文目录必须驻留在与&nbsp;SQL&nbsp;Server&nbsp;实例相关联的本地硬盘驱动器上。不支持可移动的驱动器、软盘和网络驱动器）。在每个服务器上最多可创建&nbsp;256&nbsp;个全文目录。</P>
<P><BR>说明&nbsp;&nbsp;Windows&nbsp;NT&nbsp;故障转移群集环境完全支持全文索引。有关更多信息，请参见在故障转移群集中运行全文查询。</P>
<P>表&nbsp;</P>
<P>首先，必须为全文支持启用表。然后，为与该表相关联的全文索引创建元数据（如表名及其全文目录）。表启用后，可以用为全文支持而启用的列中的数据填充它。如果表的全文定义被更改（例如，添加一个也将为全文检索而索引的新列），则必须重新填充相关的全文目录以使全文索引与新的全文定义同步。</P>
<P>列&nbsp;</P>
<P>可以从非活动的注册表中添加或除去支持全文查询的列。</P>
<P>在所有这些级别上，可使用工具检索元数据和状态信息。</P>
<P>和常规&nbsp;SQL&nbsp;索引一样，当在相关表中修改数据时，可自动更新全文索引。或者，也可以适当的间隔手工重新填充全文索引。这种重写可能既耗时又大量占用资源，因此，在数据库活动较少时，这通常是在后台运行的异步进程。</P>
<P>应将具有相同更新特性的表（如更改少的与更改多的，或在一天的特定时段内频繁更改的表）组合在一起，并分配给相同的全文目录。通过以此方法设置全文目录填充调度，使得全文索引和表保持同步，且在数据库活动较多时不对数据库服务器的资源使用产生负面影响。</P>
<P>为全文目录中的表安排全文索引的位置是非常重要的。在为全文目录指定表时，应该注意下列基本原则：&nbsp;</P>
<P>始终选择可用于全文唯一键的最小唯一索引。（4&nbsp;个字节且基于整数的索引是最佳的。）这将显著减少文件系统中&nbsp;Microsoft&nbsp;搜索服务所需要的资源。如果主键很大（超过&nbsp;100&nbsp;字节），可以考虑选择表中其它唯一索引（或创建另一个唯一索引）作为全文唯一键。否则，如果全文唯一键的大小达到允许的上限（450&nbsp;字节），全文填充将无法继续进行。</P>
<P>如果进行索引的表有成千上万行，请将该表指定给其自己的全文目录。</P>
<P>应该考虑对其进行全文索引的表中发生的更改数以及表的行数。如果要更改的总行数，加上上次全文填充期间表中出现的行数达到成千上万行，请将该表指定给其自己的全文目录。&nbsp;</P>
<P>请参见</P>
<P>sp_fulltext_table</P>
<P>CONTAINS</P>
<P>一个谓词，用于搜索包含基于字符的数据类型的列，该列与单个词和短语，以及与另一个词一定范围之内的近似词精确或模糊（不太精确的）匹配或者加权匹配。CONTAINS&nbsp;可以搜索：&nbsp;</P>
<P>词或短语。</P>
<P>词或短语的前缀。</P>
<P>另一个词附近的词。</P>
<P>由另一个词的词尾变化生成的词（例如，词&nbsp;drive&nbsp;是&nbsp;drives、drove、driving&nbsp;和&nbsp;driven&nbsp;词尾变化的词干）。</P>
<P>比另一个词具有更高加权的词。&nbsp;</P>
<P>语法<BR>CONTAINS<BR>&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;{&nbsp;column&nbsp;|&nbsp;*&nbsp;}&nbsp;,&nbsp;'&lt;&nbsp;contains_search_condition&nbsp;&gt;'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)&nbsp;</P>
<P>&nbsp;</P>
<P>FREETEXT</P>
<P>是个谓词，用于搜索含有基于字符的数据类型的列，其中的值符合在搜索条件中所指定文本的含义，但不符合表达方式。使用&nbsp;FREETEXT&nbsp;时，全文查询引擎内部将&nbsp;freetext_string&nbsp;拆分为若干个搜索词，并赋予每个词以不同的加权，然后查找匹配。</P>
<P>语法</P>
<P>FREETEXT&nbsp;(&nbsp;{&nbsp;column&nbsp;|&nbsp;*&nbsp;}&nbsp;,&nbsp;'freetext_string'&nbsp;)</P>
<P>&nbsp;</P>
<P>CONTAINSTABLE&nbsp;和&nbsp;FREETEXTTABLE&nbsp;函数用来指定返回每行的相对排名的全文查询。这两个函数与全文谓词&nbsp;CONTAINS&nbsp;和&nbsp;FREETEXT&nbsp;很相似，但是用法不同。</P>
<P>(此文部分资料来自MSDN)</P>
<P>Author:李洪根</P>
<P>E-MAIL:lihonggen0@163.com&nbsp;&nbsp;<BR></P></FONT>