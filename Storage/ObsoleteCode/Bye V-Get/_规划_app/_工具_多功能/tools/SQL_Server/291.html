<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>vsysShowPermissions</B><BR>vsysShowPermissions.sql
<P></P>
<P></P>
<P><BR>This&nbsp;code&nbsp;presents&nbsp;you&nbsp;with&nbsp;a&nbsp;nice&nbsp;list&nbsp;of&nbsp;object&nbsp;permissions&nbsp;for&nbsp;every&nbsp;object&nbsp;in&nbsp;a&nbsp;database.&nbsp;</P>
<P>It&nbsp;seems&nbsp;to&nbsp;work&nbsp;fine&nbsp;under&nbsp;SQL&nbsp;7.0,&nbsp;but&nbsp;I&nbsp;haven't&nbsp;yet&nbsp;researched&nbsp;those&nbsp;system&nbsp;tables&nbsp;for&nbsp;any&nbsp;differences&nbsp;as&nbsp;I'm&nbsp;about&nbsp;3:1&nbsp;6.5&nbsp;vs&nbsp;7.0.&nbsp;</P>
<P>Author:&nbsp;Wayne&nbsp;West&nbsp;</P>
<P></P>
<P>/*&nbsp;Microsoft&nbsp;SQL&nbsp;Server&nbsp;-&nbsp;Scripting&nbsp;&nbsp;&nbsp;*/<BR>/*&nbsp;Server:&nbsp;SQLSERVER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<BR>/*&nbsp;Database:&nbsp;TADS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<BR>/*&nbsp;Creation&nbsp;Date&nbsp;8/29/00&nbsp;10:11:42&nbsp;AM&nbsp;&nbsp;&nbsp;&nbsp;*/</P>
<P>/******&nbsp;Object:&nbsp;&nbsp;View&nbsp;dbo.vsysShowPermissions&nbsp;&nbsp;&nbsp;&nbsp;Script&nbsp;Date:&nbsp;8/29/00&nbsp;10:11:42&nbsp;AM&nbsp;******/<BR>if&nbsp;exists&nbsp;(select&nbsp;*&nbsp;from&nbsp;sysobjects&nbsp;where&nbsp;id&nbsp;=&nbsp;object_id('dbo.vsysShowPermissions')&nbsp;and&nbsp;sysstat&nbsp;&amp;&nbsp;0xf&nbsp;=&nbsp;2)<BR>&nbsp;drop&nbsp;view&nbsp;dbo.vsysShowPermissions<BR>GO</P>
<P>/******&nbsp;Object:&nbsp;&nbsp;View&nbsp;dbo.vsysShowPermissions&nbsp;&nbsp;&nbsp;&nbsp;Script&nbsp;Date:&nbsp;8/29/00&nbsp;10:11:42&nbsp;AM&nbsp;******/<BR>Create&nbsp;view&nbsp;vsysShowPermissions<BR>as<BR>select&nbsp;ObjName&nbsp;=&nbsp;convert(char(30),&nbsp;o.name),<BR>&nbsp;&nbsp;&nbsp;ObjType&nbsp;=&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CASE&nbsp;o.type<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;"C"&nbsp;&nbsp;then&nbsp;"Constraint"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;"D"&nbsp;&nbsp;then&nbsp;"Default"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;"F"&nbsp;&nbsp;then&nbsp;"Foreign&nbsp;Key"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;"K"&nbsp;&nbsp;then&nbsp;"Primary&nbsp;Key"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;"L"&nbsp;&nbsp;then&nbsp;"Log"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;"P"&nbsp;&nbsp;then&nbsp;"Procedure"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;"R"&nbsp;&nbsp;then&nbsp;"Rule"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;"RF"&nbsp;then&nbsp;"Replication&nbsp;SP"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;"S"&nbsp;&nbsp;then&nbsp;"SYSTEM&nbsp;TABLE"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;"TR"&nbsp;then&nbsp;"Trigger"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;"U"&nbsp;&nbsp;then&nbsp;"Table"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;"V"&nbsp;&nbsp;then&nbsp;"View"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;"X"&nbsp;&nbsp;then&nbsp;"Extended&nbsp;SP"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE&nbsp;"*BAD&nbsp;OBJECT&nbsp;TYPE"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END,<BR>&nbsp;&nbsp;&nbsp;UserName&nbsp;=&nbsp;convert(char(20),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;p.id&nbsp;is&nbsp;null&nbsp;then&nbsp;"&nbsp;(no&nbsp;users)"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;u.uid&nbsp;=&nbsp;u.gid&nbsp;then&nbsp;lower(u.name)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;upper(u.name)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end),<BR>&nbsp;&nbsp;&nbsp;Permission&nbsp;=&nbsp;convert(char(20),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(CASE&nbsp;p.action<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;26&nbsp;&nbsp;then&nbsp;"References"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;193&nbsp;then&nbsp;"Select"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;195&nbsp;then&nbsp;"Insert"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;196&nbsp;then&nbsp;"Delete"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;197&nbsp;then&nbsp;"Update"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;198&nbsp;then&nbsp;"Create&nbsp;Table"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;203&nbsp;then&nbsp;"Create&nbsp;Database"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;207&nbsp;then&nbsp;"Create&nbsp;View"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;222&nbsp;then&nbsp;"Create&nbsp;Procedure"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;224&nbsp;then&nbsp;"Execute"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;228&nbsp;then&nbsp;"Dump&nbsp;Database"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;233&nbsp;then&nbsp;"Create&nbsp;Default"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;235&nbsp;then&nbsp;"Dump&nbsp;Transaction"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;236&nbsp;then&nbsp;"Create&nbsp;Rule"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE&nbsp;"&nbsp;(no&nbsp;permissions)"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END<BR>&nbsp;&nbsp;&nbsp;+<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CASE&nbsp;p.protecttype<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;205&nbsp;then&nbsp;"/Grant"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;206&nbsp;then&nbsp;"/REVOKE"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE&nbsp;""<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END))<BR>--&nbsp;&nbsp;&nbsp;,&nbsp;p.id,&nbsp;p.uid,&nbsp;p.protecttype,&nbsp;p.action<BR>from&nbsp;sysobjects&nbsp;o<BR>&nbsp;&nbsp;&nbsp;left&nbsp;join&nbsp;sysprotects&nbsp;p&nbsp;on&nbsp;o.id&nbsp;=&nbsp;p.id<BR>&nbsp;&nbsp;&nbsp;left&nbsp;join&nbsp;sysusers&nbsp;u&nbsp;on&nbsp;p.uid&nbsp;=&nbsp;u.uid</P>
<P>GO</P></FONT>