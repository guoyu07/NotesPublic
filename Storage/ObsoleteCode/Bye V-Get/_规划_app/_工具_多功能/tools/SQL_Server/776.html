<meta http-equiv="content-type" content="text/html; charset=gb2312">&nbsp;<FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>Copy&nbsp;one&nbsp;procedure&nbsp;from&nbsp;one&nbsp;database&nbsp;to&nbsp;another</B><BR>Copy&nbsp;one&nbsp;procedure&nbsp;from&nbsp;one&nbsp;database&nbsp;to&nbsp;another<BR>Script&nbsp;Rating&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Total&nbsp;number&nbsp;of&nbsp;votes&nbsp;[4]&nbsp;<BR>By:&nbsp;simonsabin&nbsp;<BR>The&nbsp;procedure&nbsp;copies&nbsp;one&nbsp;stored&nbsp;procedure&nbsp;from&nbsp;one&nbsp;database&nbsp;to&nbsp;another&nbsp;one&nbsp;
<P></P>
<P>USE&nbsp;master<BR>GO<BR>IF&nbsp;EXISTS&nbsp;(SELECT&nbsp;1&nbsp;FROM&nbsp;dbo.sysobjects&nbsp;WHERE&nbsp;name&nbsp;=&nbsp;'sp_CopyStoredprocedure')<BR>&nbsp;&nbsp;DROP&nbsp;PROCEDURE&nbsp;sp_CopyStoredprocedure<BR>GO<BR>CREATE&nbsp;PROCEDURE&nbsp;dbo.sp_CopyStoredprocedure&nbsp;<BR>&nbsp;&nbsp;(<BR>&nbsp;&nbsp;&nbsp;@procedure&nbsp;sysname<BR>&nbsp;&nbsp;,@sourceDb&nbsp;&nbsp;sysname<BR>&nbsp;&nbsp;,@targetdb&nbsp;&nbsp;sysname<BR>&nbsp;&nbsp;)<BR>AS<BR>/*******************************************************************************</P>
<P>&nbsp;&nbsp;Written&nbsp;By&nbsp;&nbsp;:&nbsp;Simon&nbsp;Sabin<BR>&nbsp;&nbsp;Date&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;25&nbsp;October&nbsp;2002<BR>&nbsp;&nbsp;Description&nbsp;:&nbsp;Copies&nbsp;a&nbsp;stored&nbsp;procedure&nbsp;from&nbsp;one&nbsp;database&nbsp;to&nbsp;another<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<BR>&nbsp;&nbsp;History<BR>&nbsp;&nbsp;Date&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Change<BR>&nbsp;&nbsp;------------------------------------------------------------------------------<BR>&nbsp;&nbsp;25/10/2002&nbsp;Created<BR>*******************************************************************************/</P>
<P>DECLARE&nbsp;@lines&nbsp;int<BR>DECLARE&nbsp;@line&nbsp;int<BR>DECLARE&nbsp;@vline&nbsp;varchar(4)<BR>DECLARE&nbsp;@objectid&nbsp;varchar(10)</P>
<P>DECLARE&nbsp;@DECLARE&nbsp;varchar(8000)<BR>DECLARE&nbsp;@SELECT&nbsp;&nbsp;varchar(8000)<BR>DECLARE&nbsp;@EXECUTE&nbsp;varchar(8000)<BR>DECLARE&nbsp;@PRINT&nbsp;&nbsp;&nbsp;varchar(8000)<BR>DECLARE&nbsp;@SQL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nvarchar(4000)</P>
<P>SET&nbsp;@SQL&nbsp;=&nbsp;'USE&nbsp;'&nbsp;+&nbsp;@sourcedb&nbsp;+&nbsp;'<BR>SELECT&nbsp;@objectid&nbsp;=&nbsp;id,&nbsp;@lines&nbsp;=&nbsp;count(*)&nbsp;<BR>&nbsp;&nbsp;FROM&nbsp;'&nbsp;+&nbsp;@sourcedb&nbsp;+&nbsp;'.dbo.syscomments<BR>&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;object_id(@procedure)<BR>&nbsp;GROUP&nbsp;BY&nbsp;id'</P>
<P>EXEC&nbsp;sp_executesql&nbsp;@SQL,&nbsp;N'@objectid&nbsp;int&nbsp;OUTPUT,&nbsp;@lines&nbsp;int&nbsp;OUTPUT,&nbsp;@procedure&nbsp;sysname',&nbsp;@objectid&nbsp;OUTPUT,&nbsp;@lines&nbsp;OUTPUT,&nbsp;@procedure<BR>SELECT&nbsp;@objectid&nbsp;,&nbsp;@lines&nbsp;,&nbsp;@procedure,&nbsp;@SQL</P>
<P>SET&nbsp;@DECLARE&nbsp;=&nbsp;''<BR>SET&nbsp;@SELECT&nbsp;&nbsp;=&nbsp;''<BR>SET&nbsp;@EXECUTE&nbsp;=&nbsp;''<BR>SET&nbsp;@PRINT&nbsp;&nbsp;&nbsp;=&nbsp;''</P>
<P>SET&nbsp;@line&nbsp;=&nbsp;0<BR>WHILE&nbsp;@line&nbsp;&lt;=&nbsp;@lines<BR>&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;@vline&nbsp;=&nbsp;@line<BR>&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;@DECLARE&nbsp;=&nbsp;@DECLARE&nbsp;+&nbsp;char(10)&nbsp;+&nbsp;'DECLARE&nbsp;@line'&nbsp;+&nbsp;@vline&nbsp;+&nbsp;'&nbsp;nvarchar(4000)'<BR>&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;@SELECT&nbsp;&nbsp;=&nbsp;@SELECT&nbsp;&nbsp;+&nbsp;char(10)&nbsp;+&nbsp;'SELECT&nbsp;&nbsp;@line'&nbsp;+&nbsp;@vline&nbsp;+&nbsp;'&nbsp;=&nbsp;text&nbsp;FROM&nbsp;'&nbsp;+&nbsp;@sourcedb&nbsp;+&nbsp;'.dbo.syscomments&nbsp;WHERE&nbsp;colid&nbsp;=&nbsp;'&nbsp;+&nbsp;@vline&nbsp;+&nbsp;'&nbsp;AND&nbsp;id&nbsp;=&nbsp;'&nbsp;+&nbsp;@objectid&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;@EXECUTE&nbsp;=&nbsp;@EXECUTE&nbsp;+&nbsp;'+&nbsp;@line'&nbsp;+&nbsp;@vline&nbsp;<BR>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;@PRINT&nbsp;&nbsp;&nbsp;=&nbsp;@PRINT&nbsp;&nbsp;&nbsp;+&nbsp;char(10)&nbsp;+&nbsp;'PRINT&nbsp;@line'&nbsp;+&nbsp;@vline&nbsp;<BR>&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;@line&nbsp;=&nbsp;@line&nbsp;+&nbsp;1&nbsp;&nbsp;<BR>&nbsp;&nbsp;END</P>
<P>SET&nbsp;@DECLARE&nbsp;=&nbsp;@DECLARE&nbsp;+&nbsp;CHAR(10)<BR>SET&nbsp;@SELECT&nbsp;&nbsp;=&nbsp;@SELECT&nbsp;&nbsp;+&nbsp;CHAR(10)<BR>SET&nbsp;@EXECUTE&nbsp;=&nbsp;'USE&nbsp;'&nbsp;+&nbsp;@targetDb&nbsp;+&nbsp;char(10)&nbsp;+&nbsp;'EXECUTE&nbsp;('''''&nbsp;+&nbsp;@EXECUTE&nbsp;+&nbsp;')'&nbsp;</P>
<P>SET&nbsp;@SQL&nbsp;=&nbsp;'IF&nbsp;EXISTS&nbsp;(SELECT&nbsp;1&nbsp;FROM&nbsp;'&nbsp;+&nbsp;@targetDB&nbsp;+&nbsp;'.dbo.sysobjects&nbsp;WHERE&nbsp;name&nbsp;=&nbsp;@procedure&nbsp;)<BR>&nbsp;&nbsp;DROP&nbsp;PROCEDURE&nbsp;'&nbsp;+&nbsp;@procedure<BR>exec&nbsp;sp_executesql&nbsp;@SQL,&nbsp;N'@procedure&nbsp;sysname&nbsp;',&nbsp;@procedure</P>
<P>PRINT&nbsp;@DECLARE&nbsp;<BR>PRINT&nbsp;@SELECT&nbsp;<BR>PRINT&nbsp;@EXECUTE<BR>PRINT&nbsp;@PRINT<BR>EXECUTE&nbsp;(@DECLARE&nbsp;+&nbsp;@SELECT&nbsp;+&nbsp;@EXECUTE&nbsp;+&nbsp;@PRINT)</P>
<P>GO</P></FONT>