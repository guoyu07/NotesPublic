<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>ChangeAllObjOwner</B><BR>Version:&nbsp;SQL&nbsp;Server&nbsp;7.0/2000<BR>Created&nbsp;by:&nbsp;Alexander&nbsp;Chigrik
<P></P>
<P>This&nbsp;stored&nbsp;procedure&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;run&nbsp;through&nbsp;all&nbsp;of&nbsp;a&nbsp;specific<BR>database's&nbsp;objects&nbsp;owned&nbsp;by&nbsp;the&nbsp;'oldowner'&nbsp;and&nbsp;change&nbsp;the&nbsp;old<BR>owner&nbsp;with&nbsp;the&nbsp;new&nbsp;one.<BR>You&nbsp;should&nbsp;pass&nbsp;the&nbsp;old&nbsp;owner&nbsp;name&nbsp;and&nbsp;the&nbsp;new&nbsp;owner&nbsp;name,<BR>as&nbsp;in&nbsp;the&nbsp;example&nbsp;below:</P>
<P>EXEC&nbsp;ChangeAllObjOwner&nbsp;@oldowner&nbsp;=&nbsp;'John',&nbsp;@newowner&nbsp;=&nbsp;'Alex'</P>
<P>/*<BR>Version:&nbsp;SQL&nbsp;Server&nbsp;7.0/2000<BR>Created&nbsp;by:&nbsp;Alexander&nbsp;Chigrik<BR><IMG 
src="http://www.pigtwo.com/forum/pic/url.gif" align=absMiddle border=0><A href="http://www.MSSQLCity.com/" 
target=_blank>http://www.MSSQLCity.com/</A>&nbsp;-&nbsp;all&nbsp;about&nbsp;MS&nbsp;SQL<BR>(SQL&nbsp;Server&nbsp;Articles,&nbsp;FAQ,&nbsp;Scripts,&nbsp;Tips&nbsp;and&nbsp;Test&nbsp;Exams).</P>
<P>This&nbsp;stored&nbsp;procedure&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;run&nbsp;through&nbsp;all&nbsp;of&nbsp;a&nbsp;specific&nbsp;<BR>database's&nbsp;objects&nbsp;owned&nbsp;by&nbsp;the&nbsp;'oldowner'&nbsp;and&nbsp;change&nbsp;the&nbsp;old<BR>owner&nbsp;with&nbsp;the&nbsp;new&nbsp;one.<BR>You&nbsp;should&nbsp;pass&nbsp;the&nbsp;old&nbsp;owner&nbsp;name&nbsp;and&nbsp;the&nbsp;new&nbsp;owner&nbsp;name,&nbsp;<BR>as&nbsp;in&nbsp;the&nbsp;example&nbsp;below:</P>
<P>EXEC&nbsp;ChangeAllObjOwner&nbsp;@oldowner&nbsp;=&nbsp;'John',&nbsp;@newowner&nbsp;=&nbsp;'Alex'<BR>*/</P>
<P>IF&nbsp;OBJECT_ID('ChangeAllObjOwner')&nbsp;IS&nbsp;NOT&nbsp;NULL&nbsp;DROP&nbsp;PROC&nbsp;ChangeAllObjOwner<BR>GO</P>
<P>CREATE&nbsp;PROCEDURE&nbsp;ChangeAllObjOwner&nbsp;(<BR>&nbsp;&nbsp;@oldowner&nbsp;sysname,<BR>&nbsp;&nbsp;@newowner&nbsp;sysname<BR>)<BR>AS<BR>DECLARE&nbsp;@objname&nbsp;sysname<BR>SET&nbsp;NOCOUNT&nbsp;ON</P>
<P>--check&nbsp;that&nbsp;the&nbsp;@oldowner&nbsp;exists&nbsp;in&nbsp;the&nbsp;database<BR>IF&nbsp;USER_ID(@oldowner)&nbsp;IS&nbsp;NULL<BR>&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;RAISERROR&nbsp;('The&nbsp;@oldowner&nbsp;passed&nbsp;does&nbsp;not&nbsp;exist&nbsp;in&nbsp;the&nbsp;database',&nbsp;16,&nbsp;1)<BR>&nbsp;&nbsp;&nbsp;&nbsp;RETURN<BR>&nbsp;&nbsp;END<BR>--check&nbsp;that&nbsp;the&nbsp;@newowner&nbsp;exists&nbsp;in&nbsp;the&nbsp;database<BR>IF&nbsp;USER_ID(@newowner)&nbsp;IS&nbsp;NULL<BR>&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;RAISERROR&nbsp;('The&nbsp;@newowner&nbsp;passed&nbsp;does&nbsp;not&nbsp;exist&nbsp;in&nbsp;the&nbsp;database',&nbsp;16,&nbsp;1)<BR>&nbsp;&nbsp;&nbsp;&nbsp;RETURN<BR>&nbsp;&nbsp;END</P>
<P>DECLARE&nbsp;owner_cursor&nbsp;CURSOR&nbsp;FOR&nbsp;<BR>&nbsp;&nbsp;SELECT&nbsp;name&nbsp;FROM&nbsp;sysobjects&nbsp;WHERE&nbsp;uid&nbsp;=&nbsp;USER_ID(@oldowner)</P>
<P>OPEN&nbsp;owner_cursor<BR>FETCH&nbsp;NEXT&nbsp;FROM&nbsp;owner_cursor&nbsp;INTO&nbsp;@objname<BR>WHILE&nbsp;(@@fetch_status&nbsp;&lt;&gt;&nbsp;-1)<BR>BEGIN<BR>&nbsp;&nbsp;SET&nbsp;@objname&nbsp;=&nbsp;@oldowner&nbsp;+&nbsp;'.'&nbsp;+&nbsp;@objname<BR>&nbsp;&nbsp;EXEC&nbsp;sp_changeobjectowner&nbsp;@objname,&nbsp;@newowner<BR>&nbsp;&nbsp;FETCH&nbsp;NEXT&nbsp;FROM&nbsp;owner_cursor&nbsp;INTO&nbsp;@objname<BR>END</P>
<P>CLOSE&nbsp;owner_cursor<BR>DEALLOCATE&nbsp;owner_cursor<BR>GO</P></FONT>