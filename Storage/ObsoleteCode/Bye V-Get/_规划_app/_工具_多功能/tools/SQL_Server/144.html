<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>MS&nbsp;SQL&nbsp;SERVER&nbsp;图像或大文本的输入输出</B><BR>主题：MS&nbsp;SQL&nbsp;SERVER&nbsp;图像或大文本的输入输出&nbsp;<BR>发信人:&nbsp;tidycc()<BR>整理人:&nbsp;tidycc(2001-02-11&nbsp;22:05:07),&nbsp;站内信件&nbsp;&nbsp;<BR>在MS&nbsp;SQL&nbsp;SERVER&nbsp;安装目录下有个可执行文件叫&nbsp;TEXTCOPY.EXE&nbsp;<BR>可对&nbsp;MS&nbsp;SQL&nbsp;SERVER&nbsp;中的文本或图像数据进行输入输出.&nbsp;<BR>不过你可以在MS-DOS方式下执行textcopy&nbsp;/?&nbsp;得到它的描述。&nbsp;<BR>下面是这个工具的描述:&nbsp;<BR>Copies&nbsp;a&nbsp;single&nbsp;text&nbsp;or&nbsp;image&nbsp;value&nbsp;into&nbsp;or&nbsp;out&nbsp;of&nbsp;SQL&nbsp;Server.&nbsp;The&nbsp;val<BR>ue&nbsp;<BR>is&nbsp;a&nbsp;specified&nbsp;text&nbsp;or&nbsp;image&nbsp;'column'&nbsp;of&nbsp;a&nbsp;single&nbsp;row&nbsp;(specified&nbsp;by&nbsp;th<BR>e&nbsp;<BR>"where&nbsp;clause")&nbsp;of&nbsp;the&nbsp;specified&nbsp;'table'.&nbsp;
<P></P>
<P>If&nbsp;the&nbsp;direction&nbsp;is&nbsp;IN&nbsp;(/I)&nbsp;then&nbsp;the&nbsp;data&nbsp;from&nbsp;the&nbsp;specified&nbsp;'file'&nbsp;is</P>
<P>copied&nbsp;into&nbsp;SQL&nbsp;Server,&nbsp;replacing&nbsp;the&nbsp;existing&nbsp;text&nbsp;or&nbsp;image&nbsp;value.&nbsp;If<BR>the&nbsp;<BR>direction&nbsp;is&nbsp;OUT&nbsp;(/O)&nbsp;then&nbsp;the&nbsp;text&nbsp;or&nbsp;image&nbsp;value&nbsp;is&nbsp;copied&nbsp;from&nbsp;<BR>SQL&nbsp;Server&nbsp;into&nbsp;the&nbsp;specified&nbsp;'file',&nbsp;replacing&nbsp;any&nbsp;existing&nbsp;file.&nbsp;</P>
<P>TEXTCOPY&nbsp;[/S&nbsp;][sqlserver]]&nbsp;[/U&nbsp;[login]]&nbsp;[/P&nbsp;][password]]&nbsp;<BR>&nbsp;&nbsp;[/D&nbsp;][database]]&nbsp;[/T&nbsp;table]&nbsp;[/C&nbsp;column]&nbsp;[/W"where&nbsp;clause"]&nbsp;<BR>&nbsp;&nbsp;[/F&nbsp;file]&nbsp;[{/I&nbsp;|&nbsp;/O}]&nbsp;[/K&nbsp;chunksize]&nbsp;[/Z]&nbsp;[/?]&nbsp;</P>
<P>&nbsp;&nbsp;/S&nbsp;sqlserver&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;SQL&nbsp;Server&nbsp;to&nbsp;connect&nbsp;to.&nbsp;If&nbsp;'sqlserver'&nbsp;is&nbsp;n<BR>ot&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specified,&nbsp;the&nbsp;local&nbsp;SQL&nbsp;Server&nbsp;is&nbsp;used.&nbsp;<BR>&nbsp;&nbsp;/U&nbsp;login&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;login&nbsp;to&nbsp;connect&nbsp;with.&nbsp;If&nbsp;'login'&nbsp;is&nbsp;not&nbsp;spec<BR>ified,&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;trusted&nbsp;connection&nbsp;will&nbsp;be&nbsp;used.&nbsp;<BR>&nbsp;&nbsp;/P&nbsp;password&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;password&nbsp;for&nbsp;'login'.&nbsp;If&nbsp;'password'&nbsp;is&nbsp;not&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specified,&nbsp;a&nbsp;NULL&nbsp;password&nbsp;will&nbsp;be&nbsp;used.&nbsp;<BR>&nbsp;&nbsp;/D&nbsp;database&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;database&nbsp;that&nbsp;contains&nbsp;the&nbsp;table&nbsp;with&nbsp;the&nbsp;tex<BR>t&nbsp;or&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image&nbsp;data.&nbsp;If&nbsp;'database'&nbsp;is&nbsp;not&nbsp;specified,&nbsp;the&nbsp;d<BR>efault&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;database&nbsp;of&nbsp;'login'&nbsp;is&nbsp;used.&nbsp;<BR>&nbsp;&nbsp;/T&nbsp;table&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;table&nbsp;that&nbsp;contains&nbsp;the&nbsp;text&nbsp;or&nbsp;image&nbsp;value.&nbsp;</P>
<P>&nbsp;&nbsp;/C&nbsp;column&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;text&nbsp;or&nbsp;image&nbsp;column&nbsp;of&nbsp;'table'.&nbsp;<BR>&nbsp;&nbsp;/W&nbsp;"where&nbsp;clause"&nbsp;&nbsp;A&nbsp;complete&nbsp;where&nbsp;clause&nbsp;(including&nbsp;the&nbsp;WHERE&nbsp;keyw<BR>ord)&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;specifies&nbsp;a&nbsp;single&nbsp;row&nbsp;of&nbsp;'table'.&nbsp;<BR>&nbsp;&nbsp;/F&nbsp;file&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;file&nbsp;name.&nbsp;<BR>&nbsp;&nbsp;/I&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Copy&nbsp;text&nbsp;or&nbsp;image&nbsp;value&nbsp;into&nbsp;SQL&nbsp;Server&nbsp;from&nbsp;'fi<BR>le'.&nbsp;<BR>&nbsp;&nbsp;/O&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Copy&nbsp;text&nbsp;or&nbsp;image&nbsp;value&nbsp;out&nbsp;of&nbsp;SQL&nbsp;Server&nbsp;into&nbsp;'<BR>file'.&nbsp;<BR>&nbsp;&nbsp;/K&nbsp;chunksize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Size&nbsp;of&nbsp;the&nbsp;data&nbsp;transfer&nbsp;buffer&nbsp;in&nbsp;bytes.&nbsp;Minimu<BR>m&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;is&nbsp;1024&nbsp;bytes,&nbsp;default&nbsp;value&nbsp;is&nbsp;4096&nbsp;bytes.</P>
<P>&nbsp;&nbsp;/Z&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Display&nbsp;debug&nbsp;information&nbsp;while&nbsp;running.&nbsp;<BR>&nbsp;&nbsp;/?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Display&nbsp;this&nbsp;usage&nbsp;information&nbsp;and&nbsp;exit.&nbsp;</P>
<P>You&nbsp;will&nbsp;be&nbsp;prompted&nbsp;for&nbsp;any&nbsp;required&nbsp;options&nbsp;you&nbsp;did&nbsp;not&nbsp;specify.&nbsp;</P>
<P>为此,&nbsp;可写一个存储过程,调用这个命令&nbsp;<BR>CREATE&nbsp;PROCEDURE&nbsp;sp_textcopy&nbsp;(&nbsp;<BR>&nbsp;&nbsp;@srvname&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;varchar&nbsp;(30),&nbsp;<BR>&nbsp;&nbsp;@login&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;varchar&nbsp;(30),&nbsp;<BR>&nbsp;&nbsp;@password&nbsp;&nbsp;&nbsp;&nbsp;varchar&nbsp;(30),&nbsp;<BR>&nbsp;&nbsp;@dbname&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;varchar&nbsp;(30),&nbsp;<BR>&nbsp;&nbsp;@tbname&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;varchar&nbsp;(30),&nbsp;<BR>&nbsp;&nbsp;@colname&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;varchar&nbsp;(30),&nbsp;<BR>&nbsp;&nbsp;@filename&nbsp;&nbsp;&nbsp;&nbsp;varchar&nbsp;(30),&nbsp;<BR>&nbsp;&nbsp;@whereclause&nbsp;varchar&nbsp;(40),&nbsp;<BR>&nbsp;&nbsp;@direction&nbsp;&nbsp;&nbsp;char(1))&nbsp;<BR>AS&nbsp;<BR>DECLARE&nbsp;@exec_str&nbsp;varchar&nbsp;(255)&nbsp;<BR>SELECT&nbsp;@exec_str&nbsp;=&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'textcopy&nbsp;/S&nbsp;'&nbsp;+&nbsp;@srvname&nbsp;+&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'&nbsp;/U&nbsp;'&nbsp;+&nbsp;@login&nbsp;+&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'&nbsp;/P&nbsp;'&nbsp;+&nbsp;@password&nbsp;+&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'&nbsp;/D&nbsp;'&nbsp;+&nbsp;@dbname&nbsp;+&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'&nbsp;/T&nbsp;'&nbsp;+&nbsp;@tbname&nbsp;+&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'&nbsp;/C&nbsp;'&nbsp;+&nbsp;@colname&nbsp;+&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'&nbsp;/W&nbsp;"'&nbsp;+&nbsp;@whereclause&nbsp;+&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'"&nbsp;/F&nbsp;'&nbsp;+&nbsp;@filename&nbsp;+&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'&nbsp;/'&nbsp;+&nbsp;@direction&nbsp;<BR>EXEC&nbsp;master..xp_cmdshell&nbsp;@exec_str&nbsp;</P>
<P>下面是一个拷贝图像到SQL&nbsp;Server的pubs数据库的例子,&nbsp;表名pub_info,&nbsp;字段名<BR>logo，图像文件名picture.bmp，保存到pub_id='0736'记录&nbsp;sp_textcopy&nbsp;@srvn<BR>ame&nbsp;=&nbsp;'ServerName',&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@login&nbsp;=&nbsp;'Login',&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@password&nbsp;=&nbsp;'Password',&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@dbname&nbsp;=&nbsp;'pubs',&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@tbname&nbsp;=&nbsp;'pub_info',&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@colname&nbsp;=&nbsp;'logo',&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@filename&nbsp;=&nbsp;'c:\picture.bmp',&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@whereclause&nbsp;=&nbsp;"&nbsp;WHERE&nbsp;pub_id='0736'&nbsp;",&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@direction&nbsp;=&nbsp;'I'&nbsp;<BR></P></FONT>