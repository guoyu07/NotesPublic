<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>Removing&nbsp;Duplicate&nbsp;Rows</B><BR>Introduction
<P></P>
<P>"How&nbsp;do&nbsp;I&nbsp;remove&nbsp;duplicate&nbsp;rows&nbsp;from&nbsp;a&nbsp;table"&nbsp;is&nbsp;a&nbsp;common&nbsp;question&nbsp;in&nbsp;the&nbsp;newsgroups,&nbsp;and&nbsp;here&nbsp;we&nbsp;will&nbsp;look&nbsp;at&nbsp;a&nbsp;few&nbsp;different&nbsp;techniques&nbsp;for&nbsp;achieving&nbsp;this.</P>
<P>Databases&nbsp;can&nbsp;easily&nbsp;be&nbsp;designed&nbsp;to&nbsp;disallow&nbsp;duplicates&nbsp;(which&nbsp;I&nbsp;will&nbsp;discuss&nbsp;at&nbsp;the&nbsp;bottom&nbsp;of&nbsp;the&nbsp;article)&nbsp;but&nbsp;the&nbsp;issue&nbsp;can&nbsp;still&nbsp;arise.&nbsp;For&nbsp;example,&nbsp;duplicate&nbsp;data&nbsp;might&nbsp;arrive&nbsp;at&nbsp;your&nbsp;database&nbsp;via&nbsp;an&nbsp;interface&nbsp;to&nbsp;another&nbsp;system.</P>
<P>The&nbsp;code&nbsp;examples&nbsp;in&nbsp;this&nbsp;article&nbsp;were&nbsp;all&nbsp;developed&nbsp;on&nbsp;SQL&nbsp;2000,&nbsp;but&nbsp;should&nbsp;work&nbsp;fine&nbsp;in&nbsp;versions&nbsp;6.5&nbsp;and&nbsp;7.</P>
<P>The&nbsp;"Distinct"&nbsp;technique</P>
<P>This&nbsp;is&nbsp;the&nbsp;easiest&nbsp;way&nbsp;of&nbsp;de-duplicating&nbsp;a&nbsp;table,&nbsp;and&nbsp;is&nbsp;at&nbsp;it’s&nbsp;best&nbsp;with&nbsp;fairly&nbsp;small&nbsp;rowsets,&nbsp;and&nbsp;where&nbsp;all&nbsp;the&nbsp;columns&nbsp;in&nbsp;a&nbsp;table&nbsp;are&nbsp;duplicates.&nbsp;We&nbsp;simply&nbsp;run&nbsp;a&nbsp;SELECT&nbsp;DISTINCT&nbsp;on&nbsp;the&nbsp;offending&nbsp;table,&nbsp;storing&nbsp;the&nbsp;results&nbsp;in&nbsp;a&nbsp;temporary&nbsp;table,&nbsp;then&nbsp;delete&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;permanent&nbsp;table&nbsp;and&nbsp;re-populate&nbsp;it&nbsp;from&nbsp;the&nbsp;temporary&nbsp;one.</P>
<P>The&nbsp;downside&nbsp;of&nbsp;this&nbsp;is&nbsp;that&nbsp;you&nbsp;need&nbsp;enough&nbsp;free&nbsp;data&nbsp;space&nbsp;in&nbsp;your&nbsp;database&nbsp;(or&nbsp;in&nbsp;tempdb)&nbsp;to&nbsp;store&nbsp;the&nbsp;entire&nbsp;table&nbsp;again,&nbsp;plus&nbsp;plenty&nbsp;of&nbsp;log&nbsp;space&nbsp;when&nbsp;you&nbsp;are&nbsp;de-duplicating&nbsp;large&nbsp;tables.&nbsp;This&nbsp;simple&nbsp;example&nbsp;loads&nbsp;a&nbsp;table&nbsp;with&nbsp;duplicate&nbsp;data&nbsp;then&nbsp;removes&nbsp;the&nbsp;duplicates:</P>
<P>create&nbsp;table&nbsp;marxBrothers&nbsp;(<BR>&nbsp;&nbsp;&nbsp;&nbsp;Number&nbsp;int,<BR>&nbsp;&nbsp;&nbsp;&nbsp;Name&nbsp;varchar(32)<BR>)<BR>go<BR>insert&nbsp;marxBrothers<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;1,&nbsp;'Groucho&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;2,&nbsp;'Harpo&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;3,&nbsp;'Chico&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;1,&nbsp;'Groucho&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;2,&nbsp;'Harpo&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;3,&nbsp;'Chico&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;6,&nbsp;'Zeppo&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;7,&nbsp;'Gummo&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;6,&nbsp;'Zeppo&nbsp;Marx'</P>
<P>begin&nbsp;tran&nbsp;deduplicate<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;DISTINCT&nbsp;*<BR>&nbsp;&nbsp;&nbsp;&nbsp;into&nbsp;#temp<BR>&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;marxBrothers</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;truncate&nbsp;table&nbsp;marxBrothers</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;insert&nbsp;marxBrothers<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;*<BR>&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;#temp</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;*&nbsp;from&nbsp;marxBrothers</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;drop&nbsp;table&nbsp;#temp<BR>commit&nbsp;tran&nbsp;deduplicate</P>
<P>drop&nbsp;table&nbsp;marxBrothers</P>
<P><BR>Using&nbsp;derived&nbsp;tables</P>
<P>For&nbsp;tables&nbsp;where&nbsp;duplication&nbsp;is&nbsp;defined&nbsp;by&nbsp;a&nbsp;subset&nbsp;of&nbsp;the&nbsp;columns&nbsp;in&nbsp;the&nbsp;table,&nbsp;you&nbsp;can&nbsp;use&nbsp;one&nbsp;of&nbsp;the&nbsp;other&nbsp;columns&nbsp;in&nbsp;the&nbsp;table&nbsp;to&nbsp;identify&nbsp;which&nbsp;rows&nbsp;to&nbsp;keep&nbsp;and&nbsp;which&nbsp;to&nbsp;delete.&nbsp;Here&nbsp;is&nbsp;a&nbsp;simple&nbsp;example&nbsp;?it&nbsp;is&nbsp;similar&nbsp;to&nbsp;the&nbsp;previous&nbsp;one,&nbsp;but&nbsp;note&nbsp;that&nbsp;only&nbsp;the&nbsp;names&nbsp;are&nbsp;duplicated,&nbsp;because&nbsp;the&nbsp;"ident"&nbsp;column&nbsp;has&nbsp;been&nbsp;defined&nbsp;as&nbsp;an&nbsp;Identity&nbsp;column.&nbsp;Here&nbsp;we&nbsp;only&nbsp;want&nbsp;to&nbsp;keep&nbsp;one&nbsp;instance&nbsp;of&nbsp;each&nbsp;name,&nbsp;regardless&nbsp;of&nbsp;the&nbsp;value&nbsp;in&nbsp;the&nbsp;Ident&nbsp;column.&nbsp;In&nbsp;the&nbsp;example&nbsp;I&nbsp;have&nbsp;arbitrarily&nbsp;decided&nbsp;to&nbsp;keep&nbsp;the&nbsp;name&nbsp;with&nbsp;the&nbsp;lowest&nbsp;Ident&nbsp;value</P>
<P>create&nbsp;table&nbsp;marxBrothers&nbsp;(<BR>&nbsp;&nbsp;&nbsp;&nbsp;ident&nbsp;int&nbsp;IDENTITY,<BR>&nbsp;&nbsp;&nbsp;&nbsp;Name&nbsp;varchar(32)<BR>)<BR>go<BR>insert&nbsp;marxBrothers&nbsp;(Name)<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Groucho&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Harpo&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Chico&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Groucho&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Harpo&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Chico&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Zeppo&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Gummo&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Zeppo&nbsp;Marx'</P>
<P>select&nbsp;*&nbsp;from&nbsp;marxBrothers</P>
<P>delete&nbsp;marxBrothers<BR>from&nbsp;marxBrothers,<BR>&nbsp;&nbsp;&nbsp;&nbsp;(<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;min(ident)&nbsp;as&nbsp;minIdent,&nbsp;name<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;marxBrothers&nbsp;m<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;group&nbsp;by&nbsp;name<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;having&nbsp;count(1)&nbsp;&gt;&nbsp;1<BR>&nbsp;&nbsp;&nbsp;&nbsp;)&nbsp;as&nbsp;derived<BR>where&nbsp;marxBrothers.name&nbsp;=&nbsp;derived.name<BR>and&nbsp;ident&nbsp;&gt;&nbsp;minIdent</P>
<P>select&nbsp;*&nbsp;from&nbsp;marxBrothers</P>
<P>drop&nbsp;table&nbsp;marxBrothers</P>
<P>The&nbsp;inner&nbsp;query&nbsp;selects&nbsp;all&nbsp;the&nbsp;names&nbsp;in&nbsp;the&nbsp;table&nbsp;that&nbsp;are&nbsp;duplicated,&nbsp;and&nbsp;the&nbsp;minimum&nbsp;value&nbsp;of&nbsp;the&nbsp;Ident&nbsp;column&nbsp;for&nbsp;each&nbsp;name.&nbsp;These&nbsp;results&nbsp;are&nbsp;compared&nbsp;against&nbsp;the&nbsp;main&nbsp;table&nbsp;in&nbsp;order&nbsp;to&nbsp;select&nbsp;the&nbsp;records&nbsp;for&nbsp;deletion</P>
<P>With&nbsp;this&nbsp;technique&nbsp;you&nbsp;may&nbsp;be&nbsp;able&nbsp;to&nbsp;get&nbsp;away&nbsp;with&nbsp;having&nbsp;much&nbsp;less&nbsp;free&nbsp;room&nbsp;than&nbsp;the&nbsp;earlier&nbsp;technique,&nbsp;but&nbsp;this&nbsp;depends&nbsp;on&nbsp;the&nbsp;ratio&nbsp;of&nbsp;duplicated&nbsp;to&nbsp;unique&nbsp;records&nbsp;?the&nbsp;more&nbsp;records&nbsp;are&nbsp;duplicated,&nbsp;the&nbsp;more&nbsp;space&nbsp;SQL&nbsp;Server&nbsp;needs&nbsp;to&nbsp;temporarily&nbsp;store,&nbsp;and&nbsp;work&nbsp;with,&nbsp;the&nbsp;results&nbsp;that&nbsp;makeup&nbsp;the&nbsp;derived&nbsp;table.&nbsp;The&nbsp;derived&nbsp;table&nbsp;technique&nbsp;is&nbsp;the&nbsp;one&nbsp;I&nbsp;usually&nbsp;try&nbsp;first.</P>
<P>Using&nbsp;correlated&nbsp;subqueries</P>
<P>This&nbsp;example&nbsp;uses&nbsp;a&nbsp;correlated&nbsp;sub-query&nbsp;to&nbsp;achieve&nbsp;de-duplication</P>
<P>create&nbsp;table&nbsp;marxBrothers&nbsp;(<BR>&nbsp;&nbsp;&nbsp;&nbsp;ident&nbsp;int&nbsp;IDENTITY,<BR>&nbsp;&nbsp;&nbsp;&nbsp;Name&nbsp;varchar(32)<BR>)<BR>go<BR>insert&nbsp;marxBrothers&nbsp;(Name)<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Groucho&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Harpo&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Chico&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Groucho&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Harpo&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Chico&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Groucho&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Harpo&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Chico&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Groucho&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Harpo&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Chico&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Zeppo&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Gummo&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Zeppo&nbsp;Marx'</P>
<P>select&nbsp;*&nbsp;from&nbsp;marxBrothers</P>
<P>delete&nbsp;marxBrothers<BR>where&nbsp;ident&nbsp;&gt;&nbsp;(<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;min(ident)<BR>&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;marxBrothers&nbsp;m<BR>&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;m.name&nbsp;=&nbsp;marxBrothers.name<BR>)</P>
<P>select&nbsp;*&nbsp;from&nbsp;marxBrothers</P>
<P>drop&nbsp;table&nbsp;marxBrothers</P>
<P>Correlated&nbsp;sub-queries&nbsp;can&nbsp;be&nbsp;pretty&nbsp;slow&nbsp;and&nbsp;inefficient&nbsp;to&nbsp;run&nbsp;against&nbsp;large&nbsp;tables.</P>
<P>De-duplicating&nbsp;using&nbsp;dynamic&nbsp;SQL</P>
<P>This&nbsp;technique&nbsp;uses&nbsp;a&nbsp;cursor&nbsp;and&nbsp;the&nbsp;"SET&nbsp;ROWCOUNT"&nbsp;feature&nbsp;to&nbsp;work&nbsp;through&nbsp;the&nbsp;table&nbsp;one&nbsp;name&nbsp;at&nbsp;a&nbsp;time,&nbsp;deleting&nbsp;all&nbsp;but&nbsp;one&nbsp;of&nbsp;the&nbsp;rows&nbsp;for&nbsp;each&nbsp;name.&nbsp;Cursors&nbsp;and&nbsp;Dynamic&nbsp;SQL&nbsp;both&nbsp;have&nbsp;their&nbsp;place,&nbsp;but&nbsp;I&nbsp;generally&nbsp;try&nbsp;to&nbsp;avoid&nbsp;using&nbsp;them&nbsp;for&nbsp;reasons&nbsp;of&nbsp;efficiency,&nbsp;As&nbsp;this&nbsp;example&nbsp;uses&nbsp;both&nbsp;a&nbsp;cursor&nbsp;and&nbsp;dynamic&nbsp;SQL,&nbsp;it&nbsp;can&nbsp;bet&nbsp;pretty&nbsp;inefficient&nbsp;with&nbsp;large&nbsp;numbers&nbsp;of&nbsp;duplicated&nbsp;rows,&nbsp;and&nbsp;I&nbsp;would&nbsp;prefer&nbsp;to&nbsp;use&nbsp;one&nbsp;of&nbsp;the&nbsp;previous&nbsp;techniques.&nbsp;However,&nbsp;the&nbsp;technique&nbsp;does&nbsp;work,&nbsp;so&nbsp;I&nbsp;think&nbsp;it&nbsp;is&nbsp;still&nbsp;worth&nbsp;a&nbsp;mention.&nbsp;</P>
<P>create&nbsp;table&nbsp;marxBrothers&nbsp;(<BR>ident&nbsp;int&nbsp;IDENTITY,<BR>Name&nbsp;varchar(32)<BR>)<BR>insert&nbsp;marxBrothers&nbsp;(Name)<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Groucho&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Groucho&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Groucho&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Groucho&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Harpo&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Chico&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Chico&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Chico&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Groucho&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Harpo&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Chico&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Zeppo&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Gummo&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Zeppo&nbsp;Marx'&nbsp;UNION&nbsp;ALL<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;'Zeppo&nbsp;Marx'<BR>go</P>
<P>declare&nbsp;@sql&nbsp;varchar(255),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@name&nbsp;varchar(32),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@count&nbsp;int</P>
<P>select&nbsp;*&nbsp;from&nbsp;marxBrothers</P>
<P>declare&nbsp;CI&nbsp;insensitive&nbsp;cursor&nbsp;for<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;name,&nbsp;count(1)&nbsp;?1&nbsp;from&nbsp;marxBrothers&nbsp;m<BR>&nbsp;&nbsp;&nbsp;&nbsp;group&nbsp;by&nbsp;name<BR>&nbsp;&nbsp;&nbsp;&nbsp;having&nbsp;count(1)&nbsp;&gt;&nbsp;1</P>
<P>open&nbsp;CI<BR>fetch&nbsp;next&nbsp;from&nbsp;CI&nbsp;into&nbsp;@name,&nbsp;@count</P>
<P>while&nbsp;@@fetch_status&nbsp;=&nbsp;0<BR>begin<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;@sql&nbsp;=<BR>&nbsp;&nbsp;&nbsp;&nbsp;'set&nbsp;rowcount&nbsp;'&nbsp;+&nbsp;convert(varchar(9),&nbsp;@count)&nbsp;+&nbsp;'<BR>&nbsp;&nbsp;&nbsp;&nbsp;delete&nbsp;marxBrothers&nbsp;where&nbsp;name&nbsp;=&nbsp;"'&nbsp;+&nbsp;@name&nbsp;+&nbsp;'"'</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;exec&nbsp;(@sql)</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;fetch&nbsp;next&nbsp;from&nbsp;CI&nbsp;into&nbsp;@name,&nbsp;@count</P>
<P>end--&nbsp;while&nbsp;fetch</P>
<P>close&nbsp;CI<BR>deallocate&nbsp;CI</P>
<P>select&nbsp;*&nbsp;from&nbsp;marxBrothers</P>
<P>go<BR>drop&nbsp;table&nbsp;marxBrothers</P>
<P>Preventing&nbsp;duplication</P>
<P>Prevention&nbsp;is,&nbsp;after&nbsp;all,&nbsp;better&nbsp;than&nbsp;cure,&nbsp;so&nbsp;It&nbsp;would&nbsp;be&nbsp;pointless&nbsp;discussing&nbsp;de-duplicating&nbsp;a&nbsp;table&nbsp;without&nbsp;mentioning&nbsp;how&nbsp;to&nbsp;prevent&nbsp;duplicate&nbsp;rows&nbsp;appearing&nbsp;again&nbsp;afterwards.&nbsp;There&nbsp;are&nbsp;three&nbsp;main&nbsp;declarative&nbsp;methods&nbsp;for&nbsp;doing&nbsp;this&nbsp;in&nbsp;SQL:</P>
<P>The&nbsp;Primary&nbsp;Key&nbsp;constraint</P>
<P>This&nbsp;is&nbsp;implemented&nbsp;as&nbsp;an&nbsp;index&nbsp;in&nbsp;SQL&nbsp;Server,&nbsp;and&nbsp;so&nbsp;it&nbsp;can&nbsp;also&nbsp;help&nbsp;speed&nbsp;up&nbsp;select&nbsp;and&nbsp;join&nbsp;operations&nbsp;from&nbsp;the&nbsp;table.&nbsp;One&nbsp;or&nbsp;more&nbsp;columns&nbsp;may&nbsp;make&nbsp;up&nbsp;a&nbsp;primary&nbsp;key,&nbsp;and&nbsp;SQL&nbsp;Server&nbsp;will&nbsp;automatically&nbsp;ensure&nbsp;that&nbsp;duplicates&nbsp;do&nbsp;not&nbsp;exist&nbsp;in&nbsp;a&nbsp;table’s&nbsp;primary&nbsp;key.&nbsp;An&nbsp;error&nbsp;will&nbsp;be&nbsp;returned&nbsp;if&nbsp;you&nbsp;try&nbsp;to&nbsp;insert&nbsp;duplicates.</P>
<P>create&nbsp;table&nbsp;marxBrothers&nbsp;(<BR>&nbsp;&nbsp;&nbsp;&nbsp;ident&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;IDENTITY,<BR>&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;varchar(32),<BR>&nbsp;&nbsp;&nbsp;&nbsp;constraint&nbsp;&nbsp;&nbsp;&nbsp;PK_marxBrothers&nbsp;PRIMARY&nbsp;KEY&nbsp;(name)<BR>)<BR>go</P>
<P>The&nbsp;Unique&nbsp;constraint</P>
<P>This&nbsp;is&nbsp;also&nbsp;Implemented&nbsp;as&nbsp;an&nbsp;index&nbsp;in&nbsp;SQL&nbsp;Server.&nbsp;The&nbsp;main&nbsp;difference&nbsp;between&nbsp;a&nbsp;primary&nbsp;key&nbsp;and&nbsp;a&nbsp;unique&nbsp;constraint&nbsp;is&nbsp;that&nbsp;the&nbsp;Primary&nbsp;Key&nbsp;can&nbsp;never&nbsp;contain&nbsp;a&nbsp;NULL&nbsp;value.</P>
<P>create&nbsp;table&nbsp;marxBrothers&nbsp;(<BR>&nbsp;&nbsp;&nbsp;&nbsp;ident&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;IDENTITY,<BR>&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;varchar(32),<BR>&nbsp;&nbsp;&nbsp;&nbsp;constraint&nbsp;&nbsp;&nbsp;&nbsp;U_marxBrothers&nbsp;UNIQUE&nbsp;(name)<BR>)<BR>go</P>
<P>The&nbsp;IGNORE_DUP_KEY&nbsp;option</P>
<P>This&nbsp;is&nbsp;an&nbsp;option&nbsp;on&nbsp;the&nbsp;create&nbsp;index&nbsp;command,&nbsp;which&nbsp;will&nbsp;cause&nbsp;SQL&nbsp;Server&nbsp;to&nbsp;discard&nbsp;rows&nbsp;where&nbsp;a&nbsp;duplicate&nbsp;of&nbsp;the&nbsp;columns&nbsp;in&nbsp;the&nbsp;specified&nbsp;index&nbsp;already&nbsp;exists.&nbsp;Use&nbsp;this&nbsp;option&nbsp;with&nbsp;care&nbsp;?you&nbsp;have&nbsp;to&nbsp;be&nbsp;certain&nbsp;that&nbsp;you&nbsp;do&nbsp;really&nbsp;need&nbsp;to&nbsp;do&nbsp;this.&nbsp;Also&nbsp;remember&nbsp;that&nbsp;the&nbsp;results&nbsp;of&nbsp;using&nbsp;this&nbsp;option&nbsp;can&nbsp;easily&nbsp;be&nbsp;misinterpreted&nbsp;as&nbsp;an&nbsp;error&nbsp;by&nbsp;end&nbsp;users.</P>
<P>create&nbsp;table&nbsp;marxBrothers&nbsp;(<BR>&nbsp;&nbsp;&nbsp;&nbsp;ident&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;IDENTITY,<BR>&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;varchar(32),<BR>)<BR>go<BR>create&nbsp;unique&nbsp;index&nbsp;UI_marxBrothers&nbsp;on&nbsp;marxBrothers&nbsp;(name)&nbsp;with&nbsp;ignore_dup_key</P>
<P>&nbsp;</P>
<P>About&nbsp;the&nbsp;author<BR>Neil&nbsp;Boyle&nbsp;is&nbsp;an&nbsp;independant&nbsp;SQL&nbsp;Server&nbsp;consultant&nbsp;working&nbsp;out&nbsp;of&nbsp;London,&nbsp;England.&nbsp;Neil's&nbsp;free&nbsp;SQL&nbsp;Server&nbsp;guide&nbsp;is&nbsp;available&nbsp;on-line&nbsp;at&nbsp;<IMG 
src="http://www.pigtwo.com/forum/pic/url.gif" align=absMiddle border=0><A 
href="http://www.impetus-sql.co.uk" 
target=_blank>http://www.impetus-sql.co.uk</A><BR></P></FONT>