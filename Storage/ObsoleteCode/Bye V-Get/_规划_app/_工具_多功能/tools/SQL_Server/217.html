<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>Sending&nbsp;Email&nbsp;&nbsp;in&nbsp;Procedure</B><BR>Sending&nbsp;Email&nbsp;in&nbsp;Your&nbsp;Own&nbsp;Store&nbsp;Procedure
<P></P>
<P></P>
<P><BR>&gt;&gt;Script&nbsp;Language&nbsp;and&nbsp;Platform:&nbsp;SQL&nbsp;Server&nbsp;2000<BR>This&nbsp;SQL&nbsp;code&nbsp;can&nbsp;be&nbsp;ran&nbsp;from&nbsp;the&nbsp;SQL&nbsp;Editor&nbsp;or&nbsp;included&nbsp;in&nbsp;a&nbsp;stored&nbsp;procedure&nbsp;which&nbsp;can&nbsp;run&nbsp;as&nbsp;a&nbsp;job&nbsp;in&nbsp;SQL&nbsp;Server&nbsp;2000&nbsp;to&nbsp;send&nbsp;automated&nbsp;email&nbsp;when&nbsp;a&nbsp;certain&nbsp;event&nbsp;occurs.&nbsp;(Management&nbsp;|&nbsp;SQL&nbsp;Server&nbsp;Agent&nbsp;|&nbsp;jobs&nbsp;)&nbsp;You&nbsp;need&nbsp;to&nbsp;have&nbsp;SMTP&nbsp;running&nbsp;on&nbsp;the&nbsp;Server.&nbsp;</P>
<P>Author:&nbsp;Mario&nbsp;Levesque&nbsp;</P>
<P></P>
<P>DECLARE&nbsp;@SenderAddress&nbsp;varchar(100)<BR>DECLARE&nbsp;@RecipientAddress&nbsp;varchar(100)<BR>DECLARE&nbsp;@Subject&nbsp;varchar(200)<BR>DECLARE&nbsp;@Body&nbsp;varchar(8000)<BR>DECLARE&nbsp;@oMail&nbsp;int&nbsp;--Object&nbsp;reference<BR>DECLARE&nbsp;@resultcode&nbsp;int</P>
<P>SET&nbsp;@SenderAddress&nbsp;=&nbsp;'someone@someisp.com'<BR>SET&nbsp;@RecipientAddress=&nbsp;'someone@someisp.net'<BR>SELECT&nbsp;@Subject&nbsp;=&nbsp;'subject&nbsp;of&nbsp;email&nbsp;for&nbsp;today&nbsp;'&nbsp;+&nbsp;CAST(getdate()&nbsp;AS&nbsp;varchar(12))<BR>SET&nbsp;&nbsp;@Body&nbsp;=&nbsp;'This&nbsp;is&nbsp;the&nbsp;body&nbsp;of&nbsp;my&nbsp;email'</P>
<P>EXEC&nbsp;@resultcode&nbsp;=&nbsp;sp_OACreate&nbsp;'CDONTS.NewMail',&nbsp;@oMail&nbsp;OUT<BR>IF&nbsp;@resultcode&nbsp;=&nbsp;0<BR>BEGIN<BR>&nbsp;&nbsp;&nbsp;EXEC&nbsp;@resultcode&nbsp;=&nbsp;sp_OASetProperty&nbsp;@oMail,&nbsp;'BodyFormat',&nbsp;0<BR>&nbsp;&nbsp;&nbsp;EXEC&nbsp;@resultcode&nbsp;=&nbsp;sp_OASetProperty&nbsp;@oMail,&nbsp;'MailFormat',&nbsp;0<BR>&nbsp;&nbsp;&nbsp;EXEC&nbsp;@resultcode&nbsp;=&nbsp;sp_OASetProperty&nbsp;@oMail,&nbsp;'Importance',&nbsp;1<BR>&nbsp;&nbsp;&nbsp;EXEC&nbsp;@resultcode&nbsp;=&nbsp;sp_OASetProperty&nbsp;@oMail,&nbsp;'From',<BR>@SenderAddress<BR>&nbsp;&nbsp;&nbsp;EXEC&nbsp;@resultcode&nbsp;=&nbsp;sp_OASetProperty&nbsp;@oMail,&nbsp;'To',<BR>@RecipientAddress<BR>&nbsp;&nbsp;&nbsp;EXEC&nbsp;@resultcode&nbsp;=&nbsp;sp_OASetProperty&nbsp;@oMail,&nbsp;'Subject',<BR>@Subject<BR>&nbsp;&nbsp;&nbsp;EXEC&nbsp;@resultcode&nbsp;=&nbsp;sp_OASetProperty&nbsp;@oMail,&nbsp;'Body',&nbsp;@Body<BR>&nbsp;&nbsp;&nbsp;EXEC&nbsp;@resultcode&nbsp;=&nbsp;sp_OAMethod&nbsp;@oMail,&nbsp;'Send',&nbsp;NULL<BR>&nbsp;&nbsp;&nbsp;EXEC&nbsp;sp_OADestroy&nbsp;@oMail<BR>END</P></FONT>