<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>Word&nbsp;Wrapping&nbsp;with&nbsp;t-sql</B><BR>Word&nbsp;wrapping&nbsp;with&nbsp;T-SQL<BR>Andrew&nbsp;Novick<BR>15&nbsp;Dec&nbsp;2002<BR>Rating:&nbsp;-4.00-&nbsp;(out&nbsp;of&nbsp;5)
<P></P>
<P>Word&nbsp;wrapping&nbsp;isn't&nbsp;the&nbsp;kind&nbsp;of&nbsp;task&nbsp;that&nbsp;is&nbsp;done&nbsp;in&nbsp;T-SQL&nbsp;very&nbsp;often.&nbsp;That's&nbsp;a&nbsp;good&nbsp;thing.&nbsp;The&nbsp;SQL&nbsp;Server&nbsp;engine&nbsp;isn't&nbsp;really&nbsp;the&nbsp;right&nbsp;location&nbsp;for&nbsp;formatting&nbsp;functions&nbsp;like&nbsp;wrapping.&nbsp;However,&nbsp;there&nbsp;are&nbsp;times&nbsp;when&nbsp;there&nbsp;isn't&nbsp;a&nbsp;suitable&nbsp;front&nbsp;end&nbsp;that&nbsp;can&nbsp;perform&nbsp;the&nbsp;word&nbsp;wrapping&nbsp;task&nbsp;and&nbsp;it&nbsp;has&nbsp;to&nbsp;be&nbsp;done&nbsp;by&nbsp;the&nbsp;database.&nbsp;For&nbsp;example,&nbsp;when&nbsp;you're&nbsp;generating&nbsp;reports&nbsp;for&nbsp;DBAs&nbsp;that&nbsp;are&nbsp;only&nbsp;run&nbsp;from&nbsp;SQL&nbsp;Query&nbsp;Analyzer.</P>
<P>Here&nbsp;is&nbsp;a&nbsp;UDF,&nbsp;called&nbsp;udf_TxtN_Wrap,&nbsp;that&nbsp;wraps&nbsp;a&nbsp;nvarchar&nbsp;string&nbsp;at&nbsp;a&nbsp;given&nbsp;line&nbsp;length.&nbsp;The&nbsp;list&nbsp;of&nbsp;word&nbsp;separators&nbsp;and&nbsp;the&nbsp;line&nbsp;terminator&nbsp;are&nbsp;parameters&nbsp;to&nbsp;the&nbsp;function.&nbsp;Here's&nbsp;the&nbsp;CREATE&nbsp;FUNCTION&nbsp;script:</P>
<P>CREATE&nbsp;&nbsp;FUNCTION&nbsp;dbo.udf_TxtN_Wrap&nbsp;(</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@TxtN2Wrap&nbsp;nvarchar(4000)&nbsp;--&nbsp;Input&nbsp;text&nbsp;to&nbsp;be&nbsp;wrapped<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;@nMaxLineLen&nbsp;int&nbsp;--&nbsp;#&nbsp;Characters&nbsp;allowed&nbsp;on&nbsp;a&nbsp;line.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;@Separators&nbsp;nvarchar(255)&nbsp;=&nbsp;'&nbsp;'&nbsp;--&nbsp;List&nbsp;of&nbsp;characters&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;that&nbsp;separate&nbsp;words&nbsp;@TxtN2Wrap.&nbsp;&nbsp;Space&nbsp;is&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;assumed&nbsp;to&nbsp;be&nbsp;a&nbsp;separator,&nbsp;even&nbsp;if&nbsp;it's&nbsp;not<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;included&nbsp;in&nbsp;this&nbsp;parameter.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;@LineTerminator&nbsp;nvarchar(255)&nbsp;--&nbsp;Char&nbsp;used&nbsp;to&nbsp;start&nbsp;a<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;new&nbsp;line.&nbsp;&nbsp;If&nbsp;NULL,&nbsp;NCHAR(10)&nbsp;is&nbsp;used.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;RETURNS&nbsp;nvarchar(4000)&nbsp;--&nbsp;The&nbsp;result&nbsp;string&nbsp;wrapped.<BR>/*<BR>*&nbsp;This&nbsp;function&nbsp;word&nbsp;wraps&nbsp;a&nbsp;nvarchar&nbsp;string&nbsp;at&nbsp;a&nbsp;given<BR>*&nbsp;length.&nbsp;There&nbsp;can&nbsp;be&nbsp;several&nbsp;word&nbsp;separating&nbsp;characters.<BR>*&nbsp;Space&nbsp;is&nbsp;always&nbsp;added&nbsp;as&nbsp;a&nbsp;separator.<BR>*<BR>*&nbsp;Attribution:&nbsp;loosely&nbsp;based&nbsp;on&nbsp;a&nbsp;wrapping&nbsp;function&nbsp;in&nbsp;<BR>*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VBScript&nbsp;from&nbsp;ASP101.com<BR>*<BR>*&nbsp;Common&nbsp;Usage:<BR>select&nbsp;dbo.udf_TxtN_Wrap&nbsp;(REPLICATE&nbsp;('12345&nbsp;',&nbsp;200)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;58,&nbsp;N'&nbsp;',&nbsp;NULL)&nbsp;as&nbsp;[Wrapped&nbsp;Text]<BR>select&nbsp;dbo.udf_TxtN_Wrap&nbsp;('123457890',&nbsp;4,&nbsp;N'&nbsp;',&nbsp;NULL)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;as&nbsp;[Wrapped&nbsp;at&nbsp;4&nbsp;with&nbsp;World&nbsp;longer&nbsp;than&nbsp;line]<BR>*&nbsp;?&nbsp;Copyright&nbsp;2002&nbsp;Andrew&nbsp;Novick&nbsp;<IMG 
src="http://www.pigtwo.com/forum/pic/url.gif" align=absMiddle border=0><A 
href="http://www.NovickSoftware.com" 
target=_blank>http://www.NovickSoftware.com</A><BR>*&nbsp;You&nbsp;may&nbsp;use&nbsp;this&nbsp;function&nbsp;in&nbsp;any&nbsp;of&nbsp;your&nbsp;SQL&nbsp;Server&nbsp;databases<BR>*&nbsp;including&nbsp;databases&nbsp;that&nbsp;you&nbsp;sell,&nbsp;so&nbsp;long&nbsp;as&nbsp;they&nbsp;contain&nbsp;<BR>*&nbsp;other&nbsp;unrelated&nbsp;database&nbsp;objects.&nbsp;You&nbsp;may&nbsp;not&nbsp;publish&nbsp;this&nbsp;<BR>*&nbsp;UDF&nbsp;either&nbsp;in&nbsp;print&nbsp;or&nbsp;electronically.<BR>****************************************************************/</P>
<P>AS&nbsp;BEGIN</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@sOutput&nbsp;nvarchar(4000)&nbsp;--&nbsp;working&nbsp;var&nbsp;for&nbsp;the&nbsp;result<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@nInputLen&nbsp;int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Length&nbsp;of&nbsp;input<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@nCurPos&nbsp;int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Current&nbsp;Position<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@nCurLineStart&nbsp;int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;current&nbsp;line&nbsp;starts<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@nPosOfLastSeparator&nbsp;int&nbsp;--&nbsp;Last&nbsp;Separator&nbsp;seen</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Save&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;input<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;@nInputLen&nbsp;=&nbsp;Len(@TxtN2Wrap)</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Start&nbsp;both&nbsp;character&nbsp;pointers&nbsp;at&nbsp;the&nbsp;beginning<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@nCurPos&nbsp;=&nbsp;1<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;@nCurLineStart&nbsp;=&nbsp;1<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;@nPosOfLastSeparator&nbsp;=&nbsp;0&nbsp;&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@sOutput&nbsp;=&nbsp;''&nbsp;--&nbsp;empty&nbsp;string,&nbsp;not&nbsp;null</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Check&nbsp;the&nbsp;parameters&nbsp;form&nbsp;some&nbsp;of&nbsp;our&nbsp;requirements<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;@LineTerminator&nbsp;is&nbsp;NULL&nbsp;SET&nbsp;@LineTerminator&nbsp;=&nbsp;NCHAR(10)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Cannot&nbsp;use&nbsp;this&nbsp;expression&nbsp;as&nbsp;a&nbsp;Default</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;CHARINDEX&nbsp;(N'&nbsp;',&nbsp;@Separators)&nbsp;=&nbsp;0&nbsp;&nbsp;--&nbsp;Space&nbsp;is&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;@Separators&nbsp;=&nbsp;N'&nbsp;'&nbsp;+&nbsp;@Separators&nbsp;--&nbsp;Required</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Loop&nbsp;through&nbsp;all&nbsp;characters&nbsp;of&nbsp;the&nbsp;input<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHILE&nbsp;@nCurPos&nbsp;&lt;&nbsp;@nInputLen&nbsp;BEGIN<BR>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Make&nbsp;note&nbsp;of&nbsp;the&nbsp;last&nbsp;separator&nbsp;for&nbsp;use&nbsp;later.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;CHARINDEX(SUBSTRING(@TxtN2Wrap,&nbsp;@nCurPos,&nbsp;1)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;@Separators,&nbsp;1)&nbsp;&gt;&nbsp;0&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;@nPosOfLastSeparator&nbsp;=&nbsp;@nCurPos<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End&nbsp;--&nbsp;If</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Once&nbsp;we&nbsp;have&nbsp;enough&nbsp;for&nbsp;a&nbsp;line,&nbsp;go&nbsp;back&nbsp;to<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;the&nbsp;last&nbsp;separator&nbsp;we&nbsp;saw&nbsp;and&nbsp;end&nbsp;the&nbsp;line&nbsp;there.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;@nCurPos&nbsp;&gt;=&nbsp;@nCurLineStart&nbsp;+&nbsp;@nMaxLineLen&nbsp;-&nbsp;1&nbsp;BEGIN</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;@nPosOfLastSeparator&nbsp;=&nbsp;0&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Cases&nbsp;where&nbsp;a&nbsp;word&nbsp;is&nbsp;longer&nbsp;than&nbsp;the&nbsp;line&nbsp;length</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Append&nbsp;the&nbsp;new&nbsp;to&nbsp;the&nbsp;result<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set&nbsp;@sOutput&nbsp;=&nbsp;@sOutput&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;SUBSTRING(@TxtN2Wrap,&nbsp;@nCurLineStart,&nbsp;@nMaxLineLen)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;@LineTerminator<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;@nCurLineStart&nbsp;=&nbsp;@nCurLineStart&nbsp;+&nbsp;@nMaxLineLen<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Append&nbsp;this&nbsp;new&nbsp;line&nbsp;to&nbsp;the&nbsp;result<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;@sOutput&nbsp;=&nbsp;@sOutput&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;RTRIM(LTRIM(<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SUBSTRING(@TxtN2Wrap<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;@nCurLineStart<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;@nPosOfLastSeparator&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;@nCurLineStart&nbsp;+&nbsp;1)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;@LineTerminator</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Reset&nbsp;the&nbsp;next&nbsp;line's&nbsp;starting&nbsp;point&nbsp;to&nbsp;the<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;point&nbsp;used&nbsp;for&nbsp;the&nbsp;last&nbsp;one's&nbsp;end&nbsp;+&nbsp;1.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@nCurLineStart&nbsp;=&nbsp;@nPosOfLastSeparator&nbsp;+&nbsp;1<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;@nPosOfLastSeparator&nbsp;=&nbsp;0&nbsp;--&nbsp;Don't&nbsp;have&nbsp;one&nbsp;now.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Remove&nbsp;any&nbsp;leading&nbsp;separators&nbsp;from&nbsp;the&nbsp;new&nbsp;line.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;While&nbsp;CHARINDEX(SUBSTRING(@TxtN2Wrap<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;@nCurLineStart,&nbsp;1)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;@Separators,&nbsp;1)&nbsp;&gt;&nbsp;0&nbsp;BEGIN&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@nCurLineStart&nbsp;=&nbsp;@nCurLineStart&nbsp;+&nbsp;1<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;@nCurPos&nbsp;=&nbsp;@nCurLineStart&nbsp;+&nbsp;1&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;--&nbsp;While<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;--&nbsp;IF</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Increment&nbsp;our&nbsp;current&nbsp;position.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;@nCurPos&nbsp;=&nbsp;@nCurPos&nbsp;+&nbsp;1<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;--&nbsp;While</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;If&nbsp;the&nbsp;loop&nbsp;ends&nbsp;before&nbsp;we&nbsp;add&nbsp;all&nbsp;the&nbsp;text,&nbsp;add&nbsp;it&nbsp;now.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;@sOutput&nbsp;=&nbsp;@sOutput&nbsp;+&nbsp;RTRIM(LTrim(SUBSTRING(@TxtN2Wrap<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;@nCurLineStart<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;@nInputLen&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;@nCurLineStart+1)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;@sOutput<BR>End&nbsp;--&nbsp;Function</P>
<P>GRANT&nbsp;EXECUTE&nbsp;&nbsp;ON&nbsp;[dbo].[udf_TxtN_Wrap]&nbsp;&nbsp;TO&nbsp;[Public]<BR>GO</P>
<P>Before&nbsp;you&nbsp;run&nbsp;udf_TxtN_Wrap,&nbsp;you&nbsp;should&nbsp;be&nbsp;aware&nbsp;of&nbsp;an&nbsp;few&nbsp;important&nbsp;features&nbsp;of&nbsp;the&nbsp;SQL&nbsp;Query&nbsp;Analyzer&nbsp;(QA).&nbsp;QA&nbsp;limits&nbsp;the&nbsp;length&nbsp;of&nbsp;every&nbsp;output&nbsp;column&nbsp;to&nbsp;a&nbsp;length&nbsp;set&nbsp;in&nbsp;one&nbsp;of&nbsp;its&nbsp;options.&nbsp;Use&nbsp;the&nbsp;menu&nbsp;Tools-&gt;Options&nbsp;and&nbsp;set&nbsp;the&nbsp;"Maximum&nbsp;characters&nbsp;per&nbsp;column:"&nbsp;field&nbsp;to&nbsp;8192.&nbsp;That's&nbsp;the&nbsp;largest's&nbsp;number&nbsp;it&nbsp;will&nbsp;allow.&nbsp;Also,&nbsp;wrapped&nbsp;text&nbsp;doesn't&nbsp;show&nbsp;up&nbsp;if&nbsp;you&nbsp;send&nbsp;your&nbsp;results&nbsp;to&nbsp;grid.&nbsp;It's&nbsp;only&nbsp;works&nbsp;when&nbsp;the&nbsp;results&nbsp;go&nbsp;to&nbsp;"text"&nbsp;or&nbsp;to&nbsp;a&nbsp;file.&nbsp;Use&nbsp;the&nbsp;menu&nbsp;Query-&gt;Results&nbsp;in&nbsp;Text&nbsp;to&nbsp;set&nbsp;textual&nbsp;output.</P>
<P>Now&nbsp;that&nbsp;you've&nbsp;created&nbsp;the&nbsp;function&nbsp;and&nbsp;set&nbsp;the&nbsp;size&nbsp;of&nbsp;an&nbsp;output&nbsp;column,&nbsp;let's&nbsp;test&nbsp;it&nbsp;out:</P>
<P>select&nbsp;dbo.udf_TxtN_Wrap&nbsp;(REPLICATE(N'123456789&nbsp;',&nbsp;20)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;60,&nbsp;N'&nbsp;',&nbsp;NULL)&nbsp;as&nbsp;[Wrapped&nbsp;Nubmers&nbsp;at&nbsp;60]<BR>GO</P>
<P>Here&nbsp;are&nbsp;the&nbsp;results:</P>
<P>Wrapped&nbsp;Nubmers&nbsp;at&nbsp;60&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>----------------------------------------------------------------<BR>123456789&nbsp;123456789&nbsp;123456789&nbsp;123456789&nbsp;123456789&nbsp;123456789&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>123456789&nbsp;123456789&nbsp;123456789&nbsp;123456789&nbsp;123456789&nbsp;123456789&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>123456789&nbsp;123456789&nbsp;123456789&nbsp;123456789&nbsp;123456789&nbsp;123456789&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>123456789&nbsp;123456789&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</P>
<P>Of&nbsp;course,&nbsp;you'll&nbsp;usually&nbsp;be&nbsp;using&nbsp;it&nbsp;on&nbsp;some&nbsp;type&nbsp;of&nbsp;string&nbsp;column&nbsp;and&nbsp;not&nbsp;on&nbsp;a&nbsp;bunch&nbsp;of&nbsp;numbers,&nbsp;but&nbsp;you&nbsp;get&nbsp;the&nbsp;idea.&nbsp;udf_TxtN_Wrap&nbsp;comes&nbsp;in&nbsp;handy&nbsp;when&nbsp;you&nbsp;have&nbsp;no&nbsp;choice&nbsp;but&nbsp;to&nbsp;wrap&nbsp;text&nbsp;in&nbsp;Query&nbsp;Analyzer.</P>
<P><BR>About&nbsp;the&nbsp;Author</P>
<P>Andrew&nbsp;Novick&nbsp;is&nbsp;a&nbsp;22-year&nbsp;industry&nbsp;veteran&nbsp;and&nbsp;principal&nbsp;of&nbsp;the&nbsp;New&nbsp;England&nbsp;based&nbsp;consulting&nbsp;company,&nbsp;Novick&nbsp;Software.&nbsp;He&nbsp;has&nbsp;recently&nbsp;co-authored&nbsp;SQL&nbsp;Server&nbsp;2000&nbsp;XML&nbsp;Distilled,&nbsp;which&nbsp;was&nbsp;published&nbsp;by&nbsp;Curlingstone&nbsp;in&nbsp;October&nbsp;2002.&nbsp;As&nbsp;a&nbsp;long&nbsp;time&nbsp;project&nbsp;manager,&nbsp;consultant,&nbsp;and&nbsp;programmer&nbsp;Andy&nbsp;has&nbsp;designed&nbsp;and&nbsp;built&nbsp;applications&nbsp;for&nbsp;the&nbsp;financial&nbsp;services,&nbsp;retail,&nbsp;transportation,&nbsp;telecommunications,&nbsp;and&nbsp;real&nbsp;estate&nbsp;industries.&nbsp;He&nbsp;specializes&nbsp;in&nbsp;building&nbsp;systems&nbsp;using&nbsp;the&nbsp;Microsoft&nbsp;tools,&nbsp;usually&nbsp;SQL&nbsp;Server,&nbsp;Visual&nbsp;Basic,&nbsp;ASP,&nbsp;XML,&nbsp;and&nbsp;more&nbsp;recently&nbsp;.Net.&nbsp;<BR>&nbsp;<BR></P></FONT>