<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>GetTbColValues</B><BR>Version:&nbsp;SQL&nbsp;Server&nbsp;7.0/2000<BR>Created&nbsp;by:&nbsp;Alexander&nbsp;Chigrik
<P></P>
<P>This&nbsp;stored&nbsp;procedure&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;return&nbsp;all&nbsp;tables&nbsp;and&nbsp;table's<BR>columns,&nbsp;which&nbsp;contain&nbsp;the&nbsp;particular&nbsp;text&nbsp;value.&nbsp;The&nbsp;GetTbColvalues<BR>stored&nbsp;procedure&nbsp;will&nbsp;scan&nbsp;all&nbsp;tables&nbsp;in&nbsp;the&nbsp;current&nbsp;database&nbsp;to<BR>search&nbsp;the&nbsp;particular&nbsp;text&nbsp;value&nbsp;in&nbsp;the&nbsp;char,&nbsp;nchar,&nbsp;varchar,&nbsp;nvarchar,<BR>text,&nbsp;and&nbsp;ntext&nbsp;columns.&nbsp;You&nbsp;should&nbsp;pass&nbsp;the&nbsp;text&nbsp;value&nbsp;to&nbsp;search,&nbsp;as<BR>in&nbsp;the&nbsp;example&nbsp;below:</P>
<P>EXEC&nbsp;GetTbColvalues&nbsp;'John'</P>
<P><BR>/*<BR>Version:&nbsp;SQL&nbsp;Server&nbsp;7.0/2000<BR>Created&nbsp;by:&nbsp;Alexander&nbsp;Chigrik<BR><IMG 
src="http://www.pigtwo.com/forum/pic/url.gif" align=absMiddle border=0><A href="http://www.MSSQLCity.com/" 
target=_blank>http://www.MSSQLCity.com/</A>&nbsp;-&nbsp;all&nbsp;about&nbsp;MS&nbsp;SQL<BR>(SQL&nbsp;Server&nbsp;Articles,&nbsp;FAQ,&nbsp;Scripts,&nbsp;Tips&nbsp;and&nbsp;Test&nbsp;Exams).</P>
<P>This&nbsp;stored&nbsp;procedure&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;return&nbsp;all&nbsp;tables&nbsp;and&nbsp;table's<BR>columns,&nbsp;which&nbsp;contain&nbsp;the&nbsp;particular&nbsp;text&nbsp;value.&nbsp;The&nbsp;GetTbColvalues<BR>stored&nbsp;procedure&nbsp;will&nbsp;scan&nbsp;all&nbsp;tables&nbsp;in&nbsp;the&nbsp;current&nbsp;database&nbsp;to<BR>search&nbsp;the&nbsp;particular&nbsp;text&nbsp;value&nbsp;in&nbsp;the&nbsp;char,&nbsp;nchar,&nbsp;varchar,&nbsp;nvarchar,<BR>text&nbsp;and&nbsp;ntext&nbsp;columns.&nbsp;You&nbsp;should&nbsp;pass&nbsp;the&nbsp;text&nbsp;value&nbsp;to&nbsp;search,&nbsp;as<BR>in&nbsp;the&nbsp;example&nbsp;below:</P>
<P>EXEC&nbsp;GetTbColvalues&nbsp;'John'<BR>*/</P>
<P>IF&nbsp;OBJECT_ID('GetTbColvalues')&nbsp;IS&nbsp;NOT&nbsp;NULL&nbsp;DROP&nbsp;PROC&nbsp;GetTbColvalues<BR>GO</P>
<P>CREATE&nbsp;PROCEDURE&nbsp;GetTbColvalues&nbsp;(<BR>&nbsp;&nbsp;@txtvalue&nbsp;varchar(128)&nbsp;=&nbsp;null<BR>)<BR>AS<BR>DECLARE&nbsp;<BR>&nbsp;&nbsp;@execstr&nbsp;varchar(1000),<BR>&nbsp;&nbsp;@objectname&nbsp;sysname,<BR>&nbsp;&nbsp;@colname&nbsp;sysname</P>
<P>SET&nbsp;NOCOUNT&nbsp;ON<BR>IF&nbsp;@txtvalue&nbsp;IS&nbsp;NULL<BR>&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;RAISERROR&nbsp;('You&nbsp;must&nbsp;specify&nbsp;the&nbsp;value&nbsp;to&nbsp;search',&nbsp;16,&nbsp;1)<BR>&nbsp;&nbsp;&nbsp;&nbsp;RETURN<BR>&nbsp;&nbsp;END</P>
<P>DECLARE&nbsp;tb_fetch_cursor&nbsp;CURSOR&nbsp;FOR<BR>&nbsp;&nbsp;SELECT&nbsp;name&nbsp;FROM&nbsp;sysobjects&nbsp;WHERE&nbsp;type&nbsp;=&nbsp;'U'<BR>OPEN&nbsp;tb_fetch_cursor<BR>FETCH&nbsp;NEXT&nbsp;FROM&nbsp;tb_fetch_cursor&nbsp;INTO&nbsp;@objectname<BR>WHILE&nbsp;(@@fetch_status&nbsp;&lt;&gt;&nbsp;-1)<BR>&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;col_fetch_cursor&nbsp;CURSOR&nbsp;FOR<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;name&nbsp;FROM&nbsp;syscolumns&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;OBJECT_ID(@objectname)&nbsp;AND&nbsp;type&nbsp;IN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(SELECT&nbsp;type&nbsp;FROM&nbsp;systypes&nbsp;WHERE&nbsp;name&nbsp;=&nbsp;'char'&nbsp;OR&nbsp;name&nbsp;=&nbsp;'nchar'&nbsp;OR&nbsp;name&nbsp;=&nbsp;'varchar'&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OR&nbsp;name&nbsp;=&nbsp;'nvarchar'&nbsp;OR&nbsp;name&nbsp;=&nbsp;'text'&nbsp;OR&nbsp;name&nbsp;=&nbsp;'ntext')<BR>&nbsp;&nbsp;&nbsp;&nbsp;OPEN&nbsp;col_fetch_cursor&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;FETCH&nbsp;NEXT&nbsp;FROM&nbsp;col_fetch_cursor&nbsp;INTO&nbsp;@colname<BR>&nbsp;&nbsp;&nbsp;&nbsp;WHILE&nbsp;(@@fetch_status&nbsp;&lt;&gt;&nbsp;-1)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@execstr&nbsp;=&nbsp;'IF&nbsp;EXISTS&nbsp;(SELECT&nbsp;*&nbsp;FROM&nbsp;'&nbsp;+&nbsp;@objectname&nbsp;+&nbsp;'&nbsp;WHERE&nbsp;'&nbsp;+&nbsp;@colname&nbsp;+&nbsp;'&nbsp;like&nbsp;''%'&nbsp;+&nbsp;@txtvalue&nbsp;+&nbsp;'%'')&nbsp;BEGIN&nbsp;SELECT&nbsp;'''&nbsp;+&nbsp;@objectname&nbsp;+&nbsp;'''&nbsp;as&nbsp;tbname,&nbsp;'''&nbsp;+&nbsp;@colname&nbsp;+&nbsp;'''&nbsp;as&nbsp;colname&nbsp;PRINT&nbsp;''''&nbsp;END'<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXEC&nbsp;(@execstr)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FETCH&nbsp;NEXT&nbsp;FROM&nbsp;col_fetch_cursor&nbsp;INTO&nbsp;@colname<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END<BR>&nbsp;&nbsp;&nbsp;&nbsp;DEALLOCATE&nbsp;col_fetch_cursor<BR>&nbsp;&nbsp;&nbsp;&nbsp;FETCH&nbsp;NEXT&nbsp;FROM&nbsp;tb_fetch_cursor&nbsp;INTO&nbsp;@objectname<BR>&nbsp;&nbsp;END<BR>DEALLOCATE&nbsp;tb_fetch_cursor<BR>GO<BR></P></FONT>