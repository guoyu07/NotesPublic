<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>未公开的加密函数。(怡红公子)</B><BR>如果对MSSQL的用户信息有兴趣的，可能会发现master.dbo.sysxlogins里面存放着用户的口令，可是呢，password字段如果不是null就是一堆看不懂的binary，这个口令是怎么加密的呢？<BR>其实只要仔细看看master.dbo.sp_addlogin就知道了，MSSQL的sp都可以看到代码，真是不错。<BR>让我们来看看它是怎么做的，注意这一行select&nbsp;@passwd&nbsp;=&nbsp;pwdencrypt(@passwd)，这个时后@passwd就被加密了，让我们也来试一下<BR>DECLARE&nbsp;@ClearPWD&nbsp;varchar(255)&nbsp;<BR>DECLARE&nbsp;@EncryptedPWD&nbsp;varbinary(255)<BR>SELECT&nbsp;@ClearPWD&nbsp;=&nbsp;'test'<BR>SELECT&nbsp;@EncryptedPWD&nbsp;=&nbsp;CONVERT(varbinary(255),&nbsp;pwdencrypt(@ClearPWD))<BR>SELECT&nbsp;@EncryptedPWD<BR>看上去不错，确实被加密了，可是我怎么还原呢？
<P></P>
<P>呵呵，这就没戏了，口令加密都是单向的，用加密后的密文来比较就可以了。<BR>继续看看其它用户相关的sp，可以发现master.dbo.sp_password里面有口令比较的内容。<BR>pwdcompare(@old,&nbsp;password,&nbsp;(CASE&nbsp;WHEN&nbsp;xstatus&amp;2048&nbsp;=&nbsp;2048&nbsp;THEN&nbsp;1&nbsp;ELSE&nbsp;0&nbsp;END))<BR>不用去理会xstatus，这是一个状态掩码，一般我们用的时候就直接用0就可以了<BR>DECLARE&nbsp;@ClearPWD&nbsp;varchar(255)&nbsp;<BR>DECLARE&nbsp;@EncryptedPWD&nbsp;varbinary(255)<BR>SELECT&nbsp;@ClearPWD&nbsp;=&nbsp;'test'<BR>SELECT&nbsp;@EncryptedPWD&nbsp;=&nbsp;CONVERT(varbinary(255),&nbsp;pwdencrypt(@ClearPWD))<BR>SELECT&nbsp;pwdcompare(@ClearPWD,&nbsp;@EncryptedPWD,&nbsp;0)<BR>SELECT&nbsp;pwdcompare('ErrorPassword',&nbsp;@EncryptedPWD,&nbsp;0)<BR>这样我们就可以使用这两个函数来加密自己的密码了，怎么样，还不错吧？<BR></P></FONT>