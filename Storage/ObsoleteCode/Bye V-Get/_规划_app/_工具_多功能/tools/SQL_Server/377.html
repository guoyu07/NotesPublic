<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>Î´Í¸Â¶µÄ´æ´¢¹ý³Ì</B><BR>Introduction
<P></P>
<P>An&nbsp;extended&nbsp;stored&nbsp;procedure&nbsp;(xp)&nbsp;is&nbsp;a&nbsp;dynamic&nbsp;link&nbsp;library&nbsp;that&nbsp;runs<BR>directly&nbsp;in&nbsp;the&nbsp;address&nbsp;space&nbsp;of&nbsp;SQL&nbsp;Server&nbsp;and&nbsp;is&nbsp;programmed&nbsp;using<BR>the&nbsp;SQL&nbsp;Server&nbsp;Open&nbsp;Data&nbsp;Services&nbsp;API.&nbsp;You&nbsp;can&nbsp;run&nbsp;extended&nbsp;stored<BR>procedures&nbsp;from&nbsp;the&nbsp;Query&nbsp;Analyzer,&nbsp;for&nbsp;example,&nbsp;just&nbsp;as&nbsp;you&nbsp;would<BR>normal&nbsp;stored&nbsp;procedures.&nbsp;Extended&nbsp;stored&nbsp;procedures&nbsp;are&nbsp;used&nbsp;to&nbsp;extend<BR>the&nbsp;capabilities&nbsp;of&nbsp;SQL&nbsp;Server.&nbsp;You&nbsp;can&nbsp;take&nbsp;advantage&nbsp;of&nbsp;the&nbsp;many<BR>extended&nbsp;stored&nbsp;procedures&nbsp;that&nbsp;come&nbsp;with&nbsp;SQL&nbsp;Server,&nbsp;or&nbsp;you&nbsp;can<BR>write&nbsp;your&nbsp;own&nbsp;in&nbsp;a&nbsp;programming&nbsp;language&nbsp;such&nbsp;as&nbsp;C&nbsp;or&nbsp;C++.</P>
<P>In&nbsp;this&nbsp;article,&nbsp;I&nbsp;want&nbsp;to&nbsp;tell&nbsp;you&nbsp;about&nbsp;some&nbsp;useful&nbsp;undocumented<BR>extended&nbsp;stored&nbsp;procedures.&nbsp;These&nbsp;extended&nbsp;stored&nbsp;procedures&nbsp;work<BR>with&nbsp;SQL&nbsp;Server&nbsp;7.0,&nbsp;as&nbsp;well&nbsp;as&nbsp;with&nbsp;SQL&nbsp;Server&nbsp;2000.</P>
<P>sp_MSgetversion<BR>This&nbsp;extended&nbsp;stored&nbsp;procedure&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;get&nbsp;the&nbsp;current&nbsp;version<BR>of&nbsp;Microsoft&nbsp;SQL&nbsp;Server.<BR>To&nbsp;get&nbsp;the&nbsp;current&nbsp;SQL&nbsp;Server&nbsp;version,&nbsp;run</P>
<P>EXEC&nbsp;master..sp_MSgetversion<BR>&nbsp;</P>
<P>Note.&nbsp;A&nbsp;more&nbsp;common&nbsp;way&nbsp;to&nbsp;retrieve&nbsp;the&nbsp;current&nbsp;SQL&nbsp;Server&nbsp;version&nbsp;(this<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;way&nbsp;provides&nbsp;more&nbsp;information)&nbsp;is&nbsp;to&nbsp;use&nbsp;following&nbsp;SELECT&nbsp;statement:</P>
<P>select&nbsp;@@version<BR>&nbsp;</P>
<P>xp_dirtree<BR>This&nbsp;extended&nbsp;stored&nbsp;procedure&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;get&nbsp;a&nbsp;list&nbsp;of&nbsp;all&nbsp;the<BR>folders&nbsp;for&nbsp;the&nbsp;folder&nbsp;named&nbsp;in&nbsp;the&nbsp;xp.<BR>To&nbsp;get&nbsp;a&nbsp;list&nbsp;of&nbsp;all&nbsp;the&nbsp;folders&nbsp;in&nbsp;the&nbsp;C:\MSSQL7&nbsp;folder,&nbsp;run:</P>
<P>EXEC&nbsp;master..xp_dirtree&nbsp;'C:\MSSQL7'<BR>&nbsp;</P>
<P>xp_enum_oledb_providers<BR>This&nbsp;extended&nbsp;stored&nbsp;procedure&nbsp;is&nbsp;used&nbsp;to&nbsp;list&nbsp;of&nbsp;all&nbsp;the&nbsp;available&nbsp;OLE&nbsp;DB<BR>providers.&nbsp;It&nbsp;returns&nbsp;Provider&nbsp;Name,&nbsp;Parse&nbsp;Name&nbsp;and&nbsp;Provider&nbsp;Description.<BR>To&nbsp;get&nbsp;a&nbsp;list&nbsp;of&nbsp;all&nbsp;OLE&nbsp;DB&nbsp;providers&nbsp;for&nbsp;your&nbsp;SQL&nbsp;Server,&nbsp;run:</P>
<P>EXEC&nbsp;master..xp_enum_oledb_providers<BR>&nbsp;</P>
<P>xp_enumcodepages<BR>This&nbsp;extended&nbsp;stored&nbsp;procedure&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;list&nbsp;of&nbsp;all&nbsp;code&nbsp;pages,<BR>character&nbsp;sets&nbsp;and&nbsp;their&nbsp;description&nbsp;for&nbsp;your&nbsp;SQL&nbsp;Server.<BR>To&nbsp;see&nbsp;this,&nbsp;list,&nbsp;run:</P>
<P>EXEC&nbsp;master..xp_enumcodepages<BR>&nbsp;</P>
<P>xp_enumdsn<BR>This&nbsp;extended&nbsp;stored&nbsp;procedure&nbsp;returns&nbsp;a&nbsp;list&nbsp;of&nbsp;all&nbsp;System&nbsp;DSNs<BR>and&nbsp;their&nbsp;description.<BR>To&nbsp;get&nbsp;the&nbsp;list&nbsp;of&nbsp;System&nbsp;DSNs,&nbsp;run:</P>
<P>EXEC&nbsp;master..xp_enumdsn<BR>&nbsp;</P>
<P>xp_enumerrorlogs<BR>This&nbsp;extended&nbsp;stored&nbsp;procedure&nbsp;returns&nbsp;the&nbsp;list&nbsp;of&nbsp;all&nbsp;error&nbsp;logs<BR>with&nbsp;their&nbsp;last&nbsp;change&nbsp;date.<BR>To&nbsp;get&nbsp;the&nbsp;list&nbsp;of&nbsp;error&nbsp;logs,&nbsp;run:</P>
<P>EXEC&nbsp;master..xp_enumerrorlogs<BR>&nbsp;</P>
<P>xp_enumgroups<BR>This&nbsp;extended&nbsp;stored&nbsp;procedure&nbsp;returns&nbsp;the&nbsp;list&nbsp;of&nbsp;Windows&nbsp;NT&nbsp;groups<BR>and&nbsp;their&nbsp;description.<BR>To&nbsp;get&nbsp;the&nbsp;list&nbsp;of&nbsp;the&nbsp;Windows&nbsp;NT&nbsp;groups,&nbsp;run:</P>
<P>EXEC&nbsp;master..xp_enumgroups<BR>&nbsp;</P>
<P>xp_fileexist<BR>You&nbsp;can&nbsp;use&nbsp;this&nbsp;extended&nbsp;stored&nbsp;procedure&nbsp;to&nbsp;determine&nbsp;whether&nbsp;a<BR>particular&nbsp;file&nbsp;exists&nbsp;on&nbsp;the&nbsp;disk&nbsp;or&nbsp;not.</P>
<P>Syntax:</P>
<P>EXECUTE&nbsp;xp_fileexist&nbsp;filename&nbsp;[,&nbsp;file_exists&nbsp;INT&nbsp;OUTPUT]<BR>&nbsp;</P>
<P>For&nbsp;example,&nbsp;to&nbsp;check&nbsp;whether&nbsp;the&nbsp;file&nbsp;boot.ini&nbsp;exists&nbsp;on&nbsp;disk&nbsp;c:&nbsp;or&nbsp;not,&nbsp;run:</P>
<P>EXEC&nbsp;master..xp_fileexist&nbsp;'c:\boot.ini'<BR>&nbsp;</P>
<P>xp_fixeddrives<BR>This&nbsp;very&nbsp;useful&nbsp;extended&nbsp;stored&nbsp;procedure&nbsp;returns&nbsp;the&nbsp;list&nbsp;of&nbsp;all<BR>hard&nbsp;drives&nbsp;and&nbsp;the&nbsp;amount&nbsp;of&nbsp;free&nbsp;space&nbsp;in&nbsp;Mb&nbsp;for&nbsp;each&nbsp;hard&nbsp;drive.</P>
<P>To&nbsp;see&nbsp;the&nbsp;list&nbsp;of&nbsp;drives,&nbsp;run:</P>
<P>EXEC&nbsp;master..xp_fixeddrives<BR>&nbsp;</P>
<P>xp_getnetname<BR>This&nbsp;extended&nbsp;stored&nbsp;procedure&nbsp;returns&nbsp;the&nbsp;WINS&nbsp;name&nbsp;of&nbsp;the&nbsp;SQL&nbsp;Server<BR>that&nbsp;you're&nbsp;connected&nbsp;to.</P>
<P>To&nbsp;view&nbsp;the&nbsp;name,&nbsp;run:</P>
<P>EXEC&nbsp;master..xp_getnetname<BR>&nbsp;</P>
<P>xp_readerrorlog<BR>This&nbsp;extended&nbsp;stored&nbsp;procedure&nbsp;returns&nbsp;the&nbsp;content&nbsp;of&nbsp;the&nbsp;errorlog<BR>file.&nbsp;You&nbsp;can&nbsp;find&nbsp;the&nbsp;errorlog&nbsp;file&nbsp;in&nbsp;the&nbsp;C:\MSSQL7\Log&nbsp;directory,<BR>by&nbsp;default&nbsp;for&nbsp;SQL&nbsp;Server&nbsp;7.0.</P>
<P>To&nbsp;see&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;errorlog&nbsp;file,&nbsp;run:</P>
<P>EXEC&nbsp;master..xp_readerrorlog<BR>&nbsp;</P>
<P>xp_regdeletekey<BR>This&nbsp;extended&nbsp;stored&nbsp;procedure&nbsp;will&nbsp;delete&nbsp;an&nbsp;entire&nbsp;key&nbsp;from&nbsp;the&nbsp;registry.<BR>You&nbsp;should&nbsp;use&nbsp;it&nbsp;very&nbsp;carefully.</P>
<P>Syntax:</P>
<P>EXECUTE&nbsp;xp_regdeletekey&nbsp;[@rootkey=]'rootkey',<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[@key=]'key'&nbsp;<BR>&nbsp;</P>
<P>For&nbsp;example,&nbsp;to&nbsp;delete&nbsp;the&nbsp;key&nbsp;'SOFTWARE\Test'&nbsp;from&nbsp;'HKEY_LOCAL_MACHINE',&nbsp;run:</P>
<P>EXEC&nbsp;master..xp_regdeletekey<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@rootkey='HKEY_LOCAL_MACHINE',&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@key='SOFTWARE\Test'<BR>&nbsp;</P>
<P>xp_regdeletevalue<BR>This&nbsp;extended&nbsp;stored&nbsp;procedure&nbsp;will&nbsp;delete&nbsp;a&nbsp;particular&nbsp;value&nbsp;for<BR>a&nbsp;key&nbsp;in&nbsp;the&nbsp;registry.&nbsp;You&nbsp;should&nbsp;use&nbsp;it&nbsp;very&nbsp;carefully.</P>
<P>Syntax:</P>
<P>EXECUTE&nbsp;xp_regdeletevalue&nbsp;[@rootkey=]'rootkey',<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[@key=]'key',<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[@value_name=]'value_name'<BR>&nbsp;</P>
<P>For&nbsp;example,&nbsp;to&nbsp;delete&nbsp;the&nbsp;value&nbsp;'Testvalue'&nbsp;for&nbsp;the&nbsp;key&nbsp;'SOFTWARE\Test'<BR>from&nbsp;'HKEY_LOCAL_MACHINE',&nbsp;run:</P>
<P>EXEC&nbsp;master..xp_regdeletevalue<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@rootkey='HKEY_LOCAL_MACHINE',<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@key='SOFTWARE\Test',<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@value_name='Testvalue'<BR>&nbsp;</P>
<P>xp_regread<BR>This&nbsp;extended&nbsp;stored&nbsp;procedure&nbsp;is&nbsp;used&nbsp;to&nbsp;read&nbsp;from&nbsp;the&nbsp;registry.</P>
<P>Syntax:</P>
<P>EXECUTE&nbsp;xp_regread&nbsp;[@rootkey=]'rootkey',<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[@key=]'key'<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,&nbsp;[@value_name=]'value_name']<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,&nbsp;[@value=]@value&nbsp;OUTPUT]&nbsp;<BR>&nbsp;</P>
<P>For&nbsp;example,&nbsp;to&nbsp;read&nbsp;into&nbsp;the&nbsp;variable&nbsp;@test&nbsp;from&nbsp;the&nbsp;value&nbsp;'Testvalue'<BR>from&nbsp;the&nbsp;key&nbsp;'SOFTWARE\Test'&nbsp;from&nbsp;the&nbsp;'HKEY_LOCAL_MACHINE',&nbsp;run:</P>
<P>DECLARE&nbsp;@test&nbsp;varchar(20)<BR>EXEC&nbsp;master..xp_regread&nbsp;@rootkey='HKEY_LOCAL_MACHINE',<BR>&nbsp;&nbsp;@key='SOFTWARE\Test',<BR>&nbsp;&nbsp;@value_name='Testvalue',<BR>&nbsp;&nbsp;@value=@test&nbsp;OUTPUT<BR>SELECT&nbsp;@test<BR>&nbsp;</P>
<P>xp_regwrite<BR>This&nbsp;extended&nbsp;stored&nbsp;procedure&nbsp;is&nbsp;used&nbsp;to&nbsp;write&nbsp;to&nbsp;the&nbsp;registry.</P>
<P>Syntax:</P>
<P>EXECUTE&nbsp;xp_regwrite&nbsp;[@rootkey=]'rootkey',<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[@key=]'key',<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[@value_name=]'value_name',<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[@type=]'type',<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[@value=]'value'<BR>&nbsp;</P>
<P>For&nbsp;example,&nbsp;to&nbsp;write&nbsp;the&nbsp;variable&nbsp;'Test'&nbsp;to&nbsp;the&nbsp;'Testvalue'&nbsp;value,<BR>key&nbsp;'SOFTWARE\Test',&nbsp;'HKEY_LOCAL_MACHINE',&nbsp;run:</P>
<P>EXEC&nbsp;master..xp_regwrite<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@rootkey='HKEY_LOCAL_MACHINE',<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@key='SOFTWARE\Test',<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@value_name='Testvalue',<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@type='REG_SZ',<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@value='Test'<BR>&nbsp;</P>
<P>xp_subdirs<BR>This&nbsp;extended&nbsp;stored&nbsp;procedure&nbsp;is&nbsp;used&nbsp;to&nbsp;get&nbsp;the&nbsp;list&nbsp;of&nbsp;folders&nbsp;for&nbsp;the<BR>folder&nbsp;named&nbsp;in&nbsp;the&nbsp;xp.&nbsp;In&nbsp;comparison&nbsp;with&nbsp;xp_dirtree,&nbsp;xp_subdirs&nbsp;returns<BR>only&nbsp;those&nbsp;directories&nbsp;whose&nbsp;depth&nbsp;=&nbsp;1.</P>
<P>This&nbsp;is&nbsp;the&nbsp;example:</P>
<P>EXEC&nbsp;master..xp_subdirs&nbsp;'C:\MSSQL7'<BR>&nbsp;</P>
<P>Note.Keep&nbsp;in&nbsp;mind&nbsp;that&nbsp;these&nbsp;undocumented&nbsp;extended&nbsp;stored&nbsp;procedures&nbsp;are&nbsp;not<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;officially&nbsp;supported&nbsp;by&nbsp;Microsoft,&nbsp;and&nbsp;that&nbsp;they&nbsp;may&nbsp;not&nbsp;be&nbsp;found&nbsp;in&nbsp;the<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next&nbsp;version&nbsp;of&nbsp;SQL&nbsp;Server.</P>
<P><BR></P></FONT>