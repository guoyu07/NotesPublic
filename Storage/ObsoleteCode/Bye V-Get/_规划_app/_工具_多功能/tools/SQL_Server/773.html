<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>Load&nbsp;data&nbsp;from&nbsp;text&nbsp;file</B><BR>Load&nbsp;data&nbsp;from&nbsp;text&nbsp;file&nbsp;with&nbsp;variable&nbsp;columns<BR>Script&nbsp;Rating&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Total&nbsp;number&nbsp;of&nbsp;votes&nbsp;[6]&nbsp;<BR>By:&nbsp;Edgardo&nbsp;<BR>This&nbsp;script&nbsp;loads&nbsp;from&nbsp;a&nbsp;formatted&nbsp;text&nbsp;file&nbsp;(E.g.&nbsp;tab&nbsp;delimited)&nbsp;with&nbsp;variable&nbsp;number&nbsp;of&nbsp;columns&nbsp;using&nbsp;BULK&nbsp;INSERT.&nbsp;For&nbsp;instance,&nbsp;the&nbsp;file&nbsp;may&nbsp;have&nbsp;any&nbsp;number&nbsp;of?columns&nbsp;and&nbsp;next&nbsp;load&nbsp;(seconds&nbsp;later)&nbsp;the&nbsp;same&nbsp;file&nbsp;may&nbsp;have&nbsp;a&nbsp;different&nbsp;number&nbsp;of&nbsp;columns.&nbsp;
<P></P>
<P>This&nbsp;script&nbsp;reads&nbsp;the&nbsp;first&nbsp;line&nbsp;(column&nbsp;names)&nbsp;extracting&nbsp;the&nbsp;names&nbsp;and&nbsp;using&nbsp;them&nbsp;to&nbsp;create&nbsp;a&nbsp;table&nbsp;dynamically&nbsp;appending&nbsp;the&nbsp;time&nbsp;stamp&nbsp;string&nbsp;to&nbsp;the&nbsp;table&nbsp;name&nbsp;(to&nbsp;ensure&nbsp;uniqueness).&nbsp;After&nbsp;executing&nbsp;the&nbsp;CREATE&nbsp;TABLE&nbsp;directive,&nbsp;and&nbsp;creating&nbsp;a&nbsp;new&nbsp;table,&nbsp;it&nbsp;will&nbsp;execute&nbsp;the&nbsp;second&nbsp;BULK&nbsp;INSERT&nbsp;to&nbsp;load&nbsp;the&nbsp;data&nbsp;to&nbsp;the&nbsp;new&nbsp;table.</P>
<P>The&nbsp;table&nbsp;definition&nbsp;uses&nbsp;varchar(1000)&nbsp;for&nbsp;all&nbsp;the&nbsp;columns&nbsp;to&nbsp;make&nbsp;the&nbsp;load&nbsp;easier.&nbsp;I&nbsp;would&nbsp;suggest&nbsp;to&nbsp;perform&nbsp;data&nbsp;validation&nbsp;the&nbsp;load&nbsp;is&nbsp;complete.</P>
<P>create&nbsp;table&nbsp;##tbl&nbsp;(line&nbsp;varchar(1000))</P>
<P>bulk&nbsp;insert&nbsp;##tbl<BR>from&nbsp;'\\wsana157\c$\tbl.txt'<BR>with&nbsp;(FIRSTROW=1)</P>
<P>--select&nbsp;top&nbsp;1&nbsp;Replace(Line,&nbsp;char(9),&nbsp;',')&nbsp;from&nbsp;##tbl</P>
<P>declare&nbsp;@tempstr&nbsp;varchar(1000)<BR>declare&nbsp;@col&nbsp;varchar(1000)<BR>declare&nbsp;@createtbl&nbsp;varchar&nbsp;(1000)<BR>declare&nbsp;@loadtbl&nbsp;varchar&nbsp;(1000)<BR>declare&nbsp;@newtblname&nbsp;varchar(1000)</P>
<P>/*&nbsp;====================================================================</P>
<P>&nbsp;Generates&nbsp;a&nbsp;unique&nbsp;identifier&nbsp;for&nbsp;all&nbsp;the&nbsp;Event&nbsp;Log&nbsp;entries&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;====================================================================*/</P>
<P>declare&nbsp;@month&nbsp;char(2)<BR>declare&nbsp;@date&nbsp;char(2)<BR>declare&nbsp;@year&nbsp;char(4)<BR>declare&nbsp;@hour&nbsp;char(2)<BR>declare&nbsp;@min&nbsp;char(2)<BR>declare&nbsp;@sec&nbsp;char(2)<BR>declare&nbsp;@msec&nbsp;char(3)</P>
<P>set&nbsp;@month&nbsp;=&nbsp;DATEPART(m,&nbsp;getdate())<BR>if&nbsp;LEN(RTRIM(DATEPART(m,&nbsp;getdate())))&nbsp;=&nbsp;1<BR>&nbsp;set&nbsp;@month&nbsp;=&nbsp;'0'+RTRIM(DATEPART(m,&nbsp;getdate()))<BR>set&nbsp;@date&nbsp;=&nbsp;DATEPART(d,&nbsp;getdate())<BR>if&nbsp;LEN(RTRIM(DATEPART(d,&nbsp;getdate())))&nbsp;=&nbsp;1<BR>&nbsp;set&nbsp;@date&nbsp;=&nbsp;'0'+RTRIM(DATEPART(d,&nbsp;getdate()))<BR>set&nbsp;@year&nbsp;=&nbsp;DATEPART(yyyy,&nbsp;getdate())<BR>set&nbsp;@hour&nbsp;=&nbsp;DATEPART(hh,&nbsp;getdate())<BR>if&nbsp;LEN(RTRIM(DATEPART(hh,&nbsp;getdate())))&nbsp;&lt;&nbsp;2<BR>&nbsp;set&nbsp;@hour&nbsp;=&nbsp;'0'+RTRIM(DATEPART(hh,&nbsp;getdate()))<BR>set&nbsp;@min&nbsp;=&nbsp;DATEPART(mi,&nbsp;getdate())<BR>if&nbsp;LEN(RTRIM(DATEPART(mi,&nbsp;getdate())))&nbsp;&lt;&nbsp;2<BR>&nbsp;set&nbsp;@min&nbsp;=&nbsp;'0'+RTRIM(DATEPART(mi,&nbsp;getdate()))<BR>set&nbsp;@sec&nbsp;=&nbsp;DATEPART(ss,&nbsp;getdate())<BR>if&nbsp;LEN(RTRIM(DATEPART(ss,&nbsp;getdate())))&nbsp;&lt;&nbsp;2<BR>&nbsp;set&nbsp;@sec&nbsp;=&nbsp;'0'+RTRIM(DATEPART(ss,&nbsp;getdate()))<BR>set&nbsp;@msec&nbsp;=&nbsp;DATEPART(ms,&nbsp;getdate())<BR>if&nbsp;LEN(RTRIM(DATEPART(ms,&nbsp;getdate())))&nbsp;&lt;&nbsp;3<BR>begin<BR>&nbsp;if&nbsp;LEN(RTRIM(DATEPART(ms,&nbsp;getdate())))&nbsp;=&nbsp;2<BR>&nbsp;&nbsp;set&nbsp;@msec&nbsp;=&nbsp;'0'+RTRIM(DATEPART(ms,&nbsp;getdate()))<BR>&nbsp;if&nbsp;LEN(RTRIM(DATEPART(ms,&nbsp;getdate())))&nbsp;=&nbsp;1<BR>&nbsp;&nbsp;set&nbsp;@msec&nbsp;=&nbsp;'00'+RTRIM(DATEPART(ms,&nbsp;getdate()))<BR>end</P>
<P>set&nbsp;@col&nbsp;=&nbsp;''<BR>set&nbsp;@tempstr&nbsp;=&nbsp;(select&nbsp;top&nbsp;1&nbsp;RTRIM(Replace(Line,&nbsp;char(9),&nbsp;','))&nbsp;from&nbsp;##tbl)</P>
<P>while&nbsp;CHARINDEX(',',@tempstr)&nbsp;&gt;&nbsp;0<BR>begin<BR>&nbsp;set&nbsp;@col&nbsp;=&nbsp;@col+SUBSTRING(@tempstr,&nbsp;1,&nbsp;CHARINDEX(',',@tempstr)-1)+'&nbsp;varchar(1000),'<BR>&nbsp;set&nbsp;@tempstr&nbsp;=&nbsp;SUBSTRING(@tempstr,&nbsp;CHARINDEX(',',@tempstr)+1,&nbsp;len(@tempstr))&nbsp;<BR>end</P>
<P>set&nbsp;@col&nbsp;=&nbsp;@col+@tempstr+'&nbsp;varchar(1000))'</P>
<P>set&nbsp;@createtbl&nbsp;=&nbsp;'create&nbsp;table&nbsp;load_'+RTRIM(@month+@date+@year+@hour+@min+@sec)+'&nbsp;('+@col<BR>set&nbsp;@newtblname&nbsp;=&nbsp;'load_'+RTRIM(@month+@date+@year+@hour+@min+@sec)</P>
<P>--select&nbsp;@createtbl</P>
<P>drop&nbsp;table&nbsp;##tbl</P>
<P>exec&nbsp;(@createtbl)</P>
<P>--select&nbsp;@newtblname</P>
<P>set&nbsp;@loadtbl&nbsp;=&nbsp;'bulk&nbsp;insert&nbsp;'+@newtblname+'&nbsp;from&nbsp;'+char(39)+'\\wsana157\c$\tbl.txt'+char(39)+'&nbsp;with&nbsp;(FIRSTROW=2)'</P>
<P>--select&nbsp;@loadtbl</P>
<P>exec&nbsp;(@loadtbl)</P></FONT>