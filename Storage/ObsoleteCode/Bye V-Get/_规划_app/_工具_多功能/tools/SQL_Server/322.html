<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>正确配置和使用SQL&nbsp;mail(心歌)</B><BR>前段时间费了九牛二虎之力，终于搞掂了SQL&nbsp;mail的配置与使用。<BR>_Rambo要我整理出来有关的文档大家共享。<BR>我就把我配置SQL&nbsp;mail的过程描述一遍。
<P></P>
<P>我用SQL&nbsp;mail主要是要完成这样的功能：<BR>&gt;用户在网上注册后,系统将随机产生的密码发送到用户登记的Email<BR>&gt;用户在论坛的帖子有回复时将内容发送到用户的Email<BR>因为上述过程都是在存储过程中完成的，所以避免了前台程序对参数的<BR>传输处理，也不需要再用第三方的组件完成，感觉比较方便。</P>
<P>1.为了使用SQL&nbsp;mail,首先你的服务器上得有SMTP服务，我没有安装win2000&nbsp;server自带的SMTP，而是用imail6.04的SMTP,感觉比较稳定，功能也比较强。<BR>2.安装一个邮件系统,我安装了outLook&nbsp;2000，我发现在配置邮件profile时，如果<BR>不安装outLook而是用别的第三方程序，win2k中文server版在控制面板中就找不到“邮件”一项.<BR>3.安装完outlook后再刷新控制面板,就会找到“邮件”一项，双击进行邮件的配置，为配置文件起一个名字(假设为myProfile)，以便以后SQL&nbsp;mail使用，在该配置文件中设置各项属性。<BR>4.启动outlook(设置为用myProfile作为默认的配置文件),测试进行收发邮件，确认outlook工作正常。<BR>5.用当前的域帐户启动SQL&nbsp;server,在企业管理器的支持服务中，点击SQL&nbsp;mail的属性，可以看到在配置文件选择中，出现了刚才定义的myProfile配置文件(你也可以定义多个profile)，选择这个配置文件进行测试，SQL将返回成功开始和结束一个MAPI会话的信息，如果出现错误或是没有找到邮件配置文件，那一定是你启动SQL&nbsp;server用的帐号有问题<BR>6.现在你就可以在查询分析器中用XP_sendmail这个扩展存储过程发送SQL&nbsp;mail了，格式如下：<BR>&nbsp;&nbsp;&nbsp;&nbsp;xp_sendmail&nbsp;{[@recipients&nbsp;=]&nbsp;'recipients&nbsp;[;...n]'}&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@message&nbsp;=]&nbsp;'message']&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@query&nbsp;=]&nbsp;'query']&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@attachments&nbsp;=]&nbsp;attachments]&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@copy_recipients&nbsp;=]&nbsp;'copy_recipients&nbsp;[;...n]'<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@blind_copy_recipients&nbsp;=]&nbsp;'blind_copy_recipients&nbsp;[;...n]'<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@subject&nbsp;=]&nbsp;'subject']<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,[@type&nbsp;=]&nbsp;'type']&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@attach_results&nbsp;=]&nbsp;'attach_value']<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@no_output&nbsp;=]&nbsp;'output_value']&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@no_header&nbsp;=]&nbsp;'header_value']&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@width&nbsp;=]&nbsp;width]&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@separator&nbsp;=]&nbsp;'separator']&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@echo_error&nbsp;=]&nbsp;'echo_value']&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@set_user&nbsp;=]&nbsp;'user']&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@dbuse&nbsp;=]&nbsp;'database']</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;其中@recipients是必需的</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;参数说明：</P>
<P>参数&nbsp;说明&nbsp;<BR>@recipients&nbsp;收件人，中间用逗号分开&nbsp;<BR>@message&nbsp;要发送的信息&nbsp;<BR>@query&nbsp;确定执行并依附邮件的有效查询，除触发器中的插入表及删除表外，此查询能引用任何对象&nbsp;<BR>@attachments&nbsp;附件&nbsp;<BR>@copy_recipients&nbsp;抄送&nbsp;<BR>@blind_copy_recipients&nbsp;密送&nbsp;<BR>@subject&nbsp;标题&nbsp;<BR>@attach_results&nbsp;指定查询结果做为附件发送&nbsp;<BR>@no_header&nbsp;不发送查询结果的列名&nbsp;<BR>@set_user&nbsp;查询联接的用户名，默认为Guset&nbsp;<BR>@dbuse&nbsp;查询所用的数据库，默认为缺省数据库&nbsp;</P>
<P><BR>7.不过，如果是在web应用中使用SQL&nbsp;mail,还有一些问题要解决:首先，就是应用程序中连接数据库的帐号，我在网站程序中的数据库连接是使用UDL文件，帐号为DbGuest,这是一个普通帐户，所以还必须在master库的扩展存储过程找到XP_sendmail，并在其属性中增加DbGuest这个用户，并选择EXEC权限。<BR>好了，现在设置完毕，运行网站程序，测试用户注册，几乎没有什么延迟，我测试用的邮箱中就收到了这封SQL&nbsp;mail发出的Email:&nbsp;&nbsp;<BR>"谢谢你的注册，你的用户名是&nbsp;[心歌],密码是&nbsp;123456789,建议你首次登录后修改密码"</P>
<P>大功告成!看起来很简单的过程，却折腾了我一个星期!希望你能比我顺利.</P>
<P>不过，现在虽然能用SQLmail发送附件，附加数据库查询结果，但是我还没有发现有什么办法用SQLmail发送html格式的邮件，如果你知道，请一定告诉我哟!</P></FONT>