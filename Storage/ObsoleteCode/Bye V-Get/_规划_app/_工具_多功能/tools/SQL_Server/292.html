<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>Return&nbsp;Table&nbsp;Counts&nbsp;Quickly</B><BR>Return&nbsp;Table&nbsp;Counts&nbsp;Quickly
<P></P>
<P></P>
<P><BR>Returns&nbsp;rowcounts&nbsp;for&nbsp;all&nbsp;tables&nbsp;in&nbsp;the&nbsp;current&nbsp;database,&nbsp;or&nbsp;if&nbsp;@tablename&nbsp;is&nbsp;provided,&nbsp;for&nbsp;that&nbsp;table&nbsp;only.&nbsp;Note&nbsp;:&nbsp;this&nbsp;procedure&nbsp;makes&nbsp;use&nbsp;of&nbsp;sysindexes,&nbsp;so&nbsp;make&nbsp;sure&nbsp;all&nbsp;indexes&nbsp;are&nbsp;up-to-date&nbsp;</P>
<P>Author:&nbsp;Paul&nbsp;Silveira&nbsp;<BR>if&nbsp;exists&nbsp;(select&nbsp;*&nbsp;from&nbsp;sysobjects&nbsp;where&nbsp;id&nbsp;=&nbsp;object_id('dbo.ps_rowcount')&nbsp;and&nbsp;sysstat&nbsp;&amp;&nbsp;0xf&nbsp;=&nbsp;4)<BR>&nbsp;drop&nbsp;procedure&nbsp;dbo.ps_rowcount<BR>GO</P>
<P>create&nbsp;procedure&nbsp;ps_rowcount&nbsp;<BR>&nbsp;@NamesOrCount&nbsp;char(1)&nbsp;=&nbsp;NULL</P>
<P>as<BR>/**************************************************************************************************<BR>&nbsp;&nbsp;&nbsp;description:&nbsp;returns&nbsp;rowcounts&nbsp;for&nbsp;all&nbsp;tables&nbsp;in&nbsp;the&nbsp;current&nbsp;database,&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;if&nbsp;@tablename&nbsp;is&nbsp;provided,&nbsp;for&nbsp;that&nbsp;table&nbsp;only.</P>
<P>&nbsp;&nbsp;&nbsp;modified&nbsp;by:&nbsp;Paul&nbsp;Silveira&nbsp;&nbsp;psilveira@lojack.com&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp;caveat:&nbsp;this&nbsp;procedure&nbsp;makes&nbsp;use&nbsp;of&nbsp;sysindexes,&nbsp;<BR>&nbsp;&nbsp;so&nbsp;make&nbsp;sure&nbsp;all&nbsp;indexes&nbsp;are&nbsp;up-to-date</P>
<P>**************************************************************************************************/</P>
<P>declare&nbsp;@dbname&nbsp;varchar(32)</P>
<P>set&nbsp;nocount&nbsp;on&nbsp;</P>
<P>IF&nbsp;UPPER(@NamesOrCount)&nbsp;=&nbsp;'C'<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;SELECT&nbsp;&nbsp;&nbsp;o.name,&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i.rows<BR>&nbsp;&nbsp;&nbsp;FROM&nbsp;&nbsp;&nbsp;sysobjects&nbsp;o&nbsp;<BR>&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;&nbsp;sysindexes&nbsp;i&nbsp;<BR>&nbsp;&nbsp;&nbsp;ON&nbsp;&nbsp;&nbsp;(o.id&nbsp;=&nbsp;i.id)<BR>&nbsp;&nbsp;&nbsp;WHERE&nbsp;&nbsp;&nbsp;o.type&nbsp;=&nbsp;'u'<BR>&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;i.indid&nbsp;&lt;&nbsp;2<BR>&nbsp;&nbsp;&nbsp;ORDER&nbsp;BY&nbsp;&nbsp;i.rows&nbsp;desc,&nbsp;o.name<BR>&nbsp;&nbsp;END<BR>ELSE&nbsp;IF&nbsp;UPPER(@NamesOrCount)&nbsp;=&nbsp;'N'<BR>&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;SELECT&nbsp;&nbsp;&nbsp;o.name,&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i.rows<BR>&nbsp;&nbsp;&nbsp;FROM&nbsp;&nbsp;&nbsp;sysobjects&nbsp;o&nbsp;<BR>&nbsp;&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;&nbsp;sysindexes&nbsp;i&nbsp;<BR>&nbsp;&nbsp;&nbsp;ON&nbsp;&nbsp;&nbsp;(o.id&nbsp;=&nbsp;i.id)<BR>&nbsp;&nbsp;&nbsp;WHERE&nbsp;&nbsp;&nbsp;o.type&nbsp;=&nbsp;'u'<BR>&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;i.indid&nbsp;&lt;&nbsp;2<BR>&nbsp;&nbsp;&nbsp;ORDER&nbsp;BY&nbsp;&nbsp;o.name,&nbsp;i.rows<BR>&nbsp;&nbsp;END&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>ELSE<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PRINT&nbsp;"No&nbsp;parameter&nbsp;was&nbsp;entered...&nbsp;C&nbsp;or&nbsp;N&nbsp;&nbsp;"&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PRINT&nbsp;"Therefore&nbsp;the&nbsp;output&nbsp;will&nbsp;be&nbsp;the&nbsp;default,&nbsp;or&nbsp;Column&nbsp;Count"<BR>&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;&nbsp;o.name,&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;i.rows<BR>&nbsp;&nbsp;FROM&nbsp;&nbsp;&nbsp;sysobjects&nbsp;o&nbsp;<BR>&nbsp;&nbsp;INNER&nbsp;JOIN&nbsp;&nbsp;sysindexes&nbsp;i&nbsp;<BR>&nbsp;&nbsp;ON&nbsp;&nbsp;&nbsp;(o.id&nbsp;=&nbsp;i.id)<BR>&nbsp;&nbsp;WHERE&nbsp;&nbsp;&nbsp;o.type&nbsp;=&nbsp;'u'</P>
<P>&nbsp;&nbsp;AND&nbsp;&nbsp;i.indid&nbsp;&lt;&nbsp;2<BR>&nbsp;&nbsp;ORDER&nbsp;BY&nbsp;&nbsp;i.rows&nbsp;desc,&nbsp;o.name&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END<BR>GO</P></FONT>