<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>Finding&nbsp;the&nbsp;Nth&nbsp;Maximal&nbsp;Value</B><BR>Finding&nbsp;the&nbsp;Nth&nbsp;Maximal&nbsp;value<BR>By&nbsp;Eli&nbsp;Leiba
<P></P>
<P></P>
<P><BR>This&nbsp;procedure&nbsp;gets&nbsp;a&nbsp;tablename,&nbsp;column&nbsp;and&nbsp;an&nbsp;integer&nbsp;number&nbsp;N&nbsp;as&nbsp;parameters&nbsp;and&nbsp;finds&nbsp;the&nbsp;Nth&nbsp;maximum&nbsp;value&nbsp;of&nbsp;the&nbsp;column's&nbsp;value&nbsp;in&nbsp;a&nbsp;table.&nbsp;</P>
<P>For&nbsp;example:&nbsp;running&nbsp;it&nbsp;with&nbsp;'products',&nbsp;'UnitPrice'&nbsp;,&nbsp;13&nbsp;,&nbsp;@res&nbsp;</P>
<P>will&nbsp;get&nbsp;the&nbsp;13TH&nbsp;largest&nbsp;value&nbsp;of&nbsp;unitprice&nbsp;from&nbsp;products&nbsp;is&nbsp;no&nbsp;such&nbsp;N&nbsp;exist&nbsp;an&nbsp;error&nbsp;message&nbsp;is&nbsp;printed.&nbsp;</P>
<P><BR>Procedure&nbsp;code&nbsp;and&nbsp;usage&nbsp;is&nbsp;listed&nbsp;below:&nbsp;<BR>=====================================&nbsp;<BR>create&nbsp;proc&nbsp;max_nth_value&nbsp;(@tablename&nbsp;varchar(50),&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@column&nbsp;varchar(50),&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@n&nbsp;int,&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@res&nbsp;decimal&nbsp;(10,4)&nbsp;OUTPUT)&nbsp;<BR>AS&nbsp;<BR>set&nbsp;nocount&nbsp;on&nbsp;<BR>declare&nbsp;@sqlStatment&nbsp;varchar(200)&nbsp;<BR>set&nbsp;@sqlStatment&nbsp;=&nbsp;'select&nbsp;a.'&nbsp;+&nbsp;@column&nbsp;+&nbsp;'&nbsp;from&nbsp;'&nbsp;+&nbsp;@tableName&nbsp;+&nbsp;'&nbsp;a&nbsp;'&nbsp;+&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'where&nbsp;'&nbsp;+&nbsp;convert&nbsp;(varchar(10),@n)&nbsp;+&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'=(select&nbsp;count(distinct&nbsp;'&nbsp;+&nbsp;@column&nbsp;+&nbsp;')'&nbsp;+&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'&nbsp;from&nbsp;'&nbsp;+&nbsp;@tableName&nbsp;+&nbsp;'&nbsp;b&nbsp;'&nbsp;+&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'&nbsp;where&nbsp;'&nbsp;+&nbsp;'a.'+&nbsp;@column&nbsp;+&nbsp;'&nbsp;&lt;=&nbsp;'&nbsp;+&nbsp;'b.'&nbsp;+&nbsp;@column&nbsp;+&nbsp;')'&nbsp;<BR>create&nbsp;table&nbsp;#tres&nbsp;(x&nbsp;decimal&nbsp;(10,4))&nbsp;<BR>insert&nbsp;into&nbsp;#tres&nbsp;exec&nbsp;(@sqlStatment)&nbsp;<BR>if&nbsp;@@rowcount&nbsp;=&nbsp;0&nbsp;print&nbsp;'No&nbsp;value&nbsp;found!'&nbsp;else&nbsp;select&nbsp;@res&nbsp;=&nbsp;x&nbsp;from&nbsp;#tres&nbsp;<BR>set&nbsp;nocount&nbsp;off&nbsp;<BR>go&nbsp;</P>
<P><BR>--&nbsp;usage&nbsp;<BR>declare&nbsp;@res&nbsp;decimal&nbsp;(10,4)&nbsp;<BR>exec&nbsp;max_nth_value&nbsp;'products','unitprice',8,@res&nbsp;OUTPUT&nbsp;<BR>print&nbsp;@res&nbsp;</P></FONT>