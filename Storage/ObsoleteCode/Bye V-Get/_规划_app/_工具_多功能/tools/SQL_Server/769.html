<meta http-equiv="content-type" content="text/html; charset=gb2312">&nbsp;<FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>sp_ServerStatus</B><BR>sp_ServerStatus<BR>Script&nbsp;Rating&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Total&nbsp;number&nbsp;of&nbsp;votes&nbsp;[3]&nbsp;<BR>By:&nbsp;simonsabin&nbsp;<BR>Have&nbsp;you&nbsp;ever&nbsp;wanted&nbsp;to&nbsp;check&nbsp;that&nbsp;a&nbsp;server&nbsp;exists&nbsp;before&nbsp;using&nbsp;it.&nbsp;Here&nbsp;is&nbsp;a&nbsp;solution&nbsp;that&nbsp;use&nbsp;SQLDMO&nbsp;from&nbsp;within&nbsp;TSQL&nbsp;to&nbsp;get&nbsp;the&nbsp;status&nbsp;of&nbsp;a&nbsp;SQL&nbsp;Server&nbsp;service.&nbsp;It&nbsp;also&nbsp;works&nbsp;for&nbsp;2000&nbsp;instances.&nbsp;<BR>I&nbsp;have&nbsp;named&nbsp;it&nbsp;sp_ServerStatus&nbsp;for&nbsp;it&nbsp;to&nbsp;be&nbsp;based&nbsp;in&nbsp;master.
<P></P>
<P>This&nbsp;returns&nbsp;the&nbsp;status&nbsp;integer&nbsp;and&nbsp;a&nbsp;text&nbsp;description&nbsp;through&nbsp;OUTPUT&nbsp;properties&nbsp;of&nbsp;the&nbsp;SP.&nbsp;</P>
<P>Example</P>
<P>DECLARE&nbsp;@s&nbsp;int,&nbsp;@t&nbsp;varchar(100)<BR>exec&nbsp;sp_ServerStatus&nbsp;'MySQLServer\instance1',@s&nbsp;output,&nbsp;@t&nbsp;output<BR>select&nbsp;@s,&nbsp;@t&nbsp;</P>
<P>DROP&nbsp;PROCEDURE&nbsp;dbo.sp_ServerStatus<BR>go<BR>CREATE&nbsp;PROCEDURE&nbsp;dbo.sp_ServerStatus<BR>/*******************************************************************************</P>
<P>&nbsp;&nbsp;Written&nbsp;By&nbsp;&nbsp;:&nbsp;Simon&nbsp;Sabin<BR>&nbsp;&nbsp;Date&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;14&nbsp;November&nbsp;2002<BR>&nbsp;&nbsp;Description&nbsp;:&nbsp;Returns&nbsp;the&nbsp;status&nbsp;of&nbsp;a&nbsp;SQL&nbsp;Server&nbsp;service</P>
<P>&nbsp;&nbsp;History<BR>&nbsp;&nbsp;Date&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Change<BR>&nbsp;&nbsp;------------------------------------------------------------------------------<BR>&nbsp;&nbsp;14/11/2002&nbsp;Created</P>
<P>*******************************************************************************/<BR>(<BR>&nbsp;&nbsp;@servername&nbsp;sysname<BR>&nbsp;,@status&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;OUTPUT<BR>&nbsp;,@statusText&nbsp;varchar(20)&nbsp;OUTPUT<BR>)<BR>AS<BR>SET&nbsp;XACT_ABORT&nbsp;ON</P>
<P>&nbsp;&nbsp;declare&nbsp;@hr&nbsp;int&nbsp;,&nbsp;@object&nbsp;int<BR>&nbsp;&nbsp;exec&nbsp;@hr&nbsp;=&nbsp;sp_OACreate&nbsp;'sqldmo.sqlserver',&nbsp;@object&nbsp;OUTPUT&nbsp;<BR>&nbsp;&nbsp;IF&nbsp;@hr&lt;&gt;&nbsp;0&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;RAISERROR&nbsp;('Cannot&nbsp;create&nbsp;sqldmo.sqlserver&nbsp;object',15,1)<BR>&nbsp;&nbsp;<BR>&nbsp;&nbsp;exec&nbsp;@hr&nbsp;=&nbsp;sp_OASetProperty&nbsp;&nbsp;@object,&nbsp;'Name',&nbsp;@servername<BR>&nbsp;&nbsp;<BR>&nbsp;&nbsp;exec&nbsp;@hr&nbsp;=&nbsp;sp_OAGetProperty&nbsp;&nbsp;@object,&nbsp;'Status',&nbsp;@status&nbsp;OUTPUT</P>
<P>&nbsp;&nbsp;SET&nbsp;@statusText&nbsp;=&nbsp;CASE&nbsp;@HR&nbsp;WHEN&nbsp;-2147221499&nbsp;THEN&nbsp;'Access&nbsp;Denied'<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;-2147219782&nbsp;THEN&nbsp;'Server&nbsp;does&nbsp;not&nbsp;exist'<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;0&nbsp;THEN&nbsp;CASE&nbsp;@status&nbsp;WHEN&nbsp;0&nbsp;THEN&nbsp;'Unknown'<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;5&nbsp;THEN&nbsp;'Stopping'<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;3&nbsp;THEN&nbsp;'Stopped'<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;4&nbsp;THEN&nbsp;'Starting'<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;1&nbsp;THEN&nbsp;'Running'<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;7&nbsp;THEN&nbsp;'Pausing'<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;2&nbsp;THEN&nbsp;'Paused'<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;6&nbsp;THEN&nbsp;'Continuing'&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE&nbsp;'Unknown'&nbsp;END<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE&nbsp;'Unknown&nbsp;error&nbsp;occurred'&nbsp;END<BR>&nbsp;&nbsp;EXEC&nbsp;sp_OADestroy&nbsp;@object<BR>GO</P></FONT>