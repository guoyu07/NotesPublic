<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>OLE&nbsp;Automation&nbsp;Stored&nbsp;Procedures</B><BR>OLE&nbsp;Automation&nbsp;Stored&nbsp;Procedures<BR>SQL&nbsp;Server&nbsp;supports&nbsp;seven&nbsp;OLE&nbsp;Automation&nbsp;Stored&nbsp;Procedures:&nbsp;
<P></P>
<P><BR>sp_OACreate&nbsp;<BR>sp_OADestroy&nbsp;<BR>sp_OAGetProperty&nbsp;<BR>sp_OASetProperty&nbsp;<BR>sp_OAMethod&nbsp;<BR>sp_OAGetErrorInfo&nbsp;<BR>sp_OAStop&nbsp;<BR>You&nbsp;can&nbsp;find&nbsp;the&nbsp;description&nbsp;of&nbsp;these&nbsp;stored&nbsp;procedures&nbsp;below.&nbsp;</P>
<P></P>
<P><BR>sp_OACreate<BR>First&nbsp;of&nbsp;all,&nbsp;you&nbsp;should&nbsp;call&nbsp;sp_OACreate&nbsp;stored&nbsp;procedure&nbsp;to&nbsp;create&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;OLE&nbsp;object.&nbsp;You&nbsp;should&nbsp;pass&nbsp;two&nbsp;parameters&nbsp;into&nbsp;sp_OACreate&nbsp;stored&nbsp;procedure:&nbsp;program&nbsp;ID&nbsp;or&nbsp;class&nbsp;ID&nbsp;and&nbsp;variable.&nbsp;The&nbsp;variable&nbsp;will&nbsp;be&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;OLE&nbsp;object&nbsp;for&nbsp;the&nbsp;further&nbsp;using&nbsp;by&nbsp;other&nbsp;sp_OA&nbsp;stored&nbsp;procedures.&nbsp;<BR>This&nbsp;is&nbsp;the&nbsp;example&nbsp;(for&nbsp;SQL&nbsp;Server&nbsp;7.0):&nbsp;</P>
<P>DECLARE&nbsp;@object&nbsp;int<BR>DECLARE&nbsp;@hr&nbsp;int</P>
<P>--&nbsp;Create&nbsp;an&nbsp;object&nbsp;that&nbsp;points&nbsp;to&nbsp;the&nbsp;SQL&nbsp;Server<BR>EXEC&nbsp;@hr&nbsp;=&nbsp;sp_OACreate&nbsp;'SQLDMO.SQLServer',&nbsp;@object&nbsp;OUT<BR>IF&nbsp;@hr&nbsp;&lt;&gt;&nbsp;0<BR>BEGIN<BR>&nbsp;&nbsp;EXEC&nbsp;sp_displayoaerrorinfo&nbsp;@object,&nbsp;@hr<BR>&nbsp;&nbsp;RETURN<BR>END</P>
<P>&nbsp;</P>
<P><BR>NOTE:&nbsp;If&nbsp;you&nbsp;use&nbsp;SQL&nbsp;Server&nbsp;6.5,&nbsp;you&nbsp;must&nbsp;write&nbsp;'SQLOLE.SQLServer'&nbsp;instead&nbsp;'SQLDMO.SQLServer'.&nbsp;</P>
<P>See&nbsp;this&nbsp;link&nbsp;for&nbsp;more&nbsp;information&nbsp;<BR>"sp_OACreate&nbsp;(T-SQL)":&nbsp;<IMG 
src="http://www.pigtwo.com/forum/pic/url.gif" align=absMiddle border=0><A 
href="http://msdn.microsoft.com/library/psdk/sql/sp_oa-oz.htm" 
target=_blank>http://msdn.microsoft.com/library/psdk/sql/sp_oa-oz.htm</A>&nbsp;</P>
<P></P>
<P><BR>sp_OADestroy<BR>This&nbsp;stored&nbsp;procedure&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;destroy&nbsp;a&nbsp;created&nbsp;OLE&nbsp;object.&nbsp;If&nbsp;you&nbsp;don't&nbsp;call&nbsp;sp_OADestroy,&nbsp;the&nbsp;created&nbsp;OLE&nbsp;object&nbsp;will&nbsp;be&nbsp;destroyed&nbsp;automatically&nbsp;when&nbsp;the&nbsp;batch&nbsp;completes&nbsp;execution.&nbsp;<BR>This&nbsp;is&nbsp;the&nbsp;example:&nbsp;</P>
<P>--&nbsp;Destroy&nbsp;the&nbsp;previously&nbsp;created&nbsp;SQL&nbsp;Server&nbsp;object<BR>EXEC&nbsp;@hr&nbsp;=&nbsp;sp_OADestroy&nbsp;@object<BR>IF&nbsp;@hr&nbsp;&lt;&gt;&nbsp;0<BR>BEGIN<BR>&nbsp;&nbsp;EXEC&nbsp;sp_displayoaerrorinfo&nbsp;@object,&nbsp;@hr<BR>&nbsp;&nbsp;RETURN<BR>END</P>
<P>&nbsp;</P>
<P><BR>See&nbsp;this&nbsp;link&nbsp;for&nbsp;more&nbsp;information&nbsp;<BR>"sp_OADestroy&nbsp;(T-SQL)":&nbsp;<IMG 
src="http://www.pigtwo.com/forum/pic/url.gif" align=absMiddle border=0><A 
href="http://msdn.microsoft.com/library/psdk/sql/sp_oa-oz_1.htm" 
target=_blank>http://msdn.microsoft.com/library/psdk/sql/sp_oa-oz_1.htm</A>&nbsp;</P>
<P></P>
<P><BR>sp_OAGetProperty<BR>You&nbsp;can&nbsp;use&nbsp;sp_OAGetProperty&nbsp;stored&nbsp;procedure&nbsp;to&nbsp;get&nbsp;a&nbsp;property&nbsp;value&nbsp;of&nbsp;an&nbsp;OLE&nbsp;object.&nbsp;<BR>See&nbsp;this&nbsp;link&nbsp;for&nbsp;more&nbsp;information&nbsp;<BR>"sp_OAGetProperty&nbsp;(T-SQL)":&nbsp;<IMG 
src="http://www.pigtwo.com/forum/pic/url.gif" align=absMiddle border=0><A 
href="http://msdn.microsoft.com/library/psdk/sql/sp_oa-oz_3.htm" 
target=_blank>http://msdn.microsoft.com/library/psdk/sql/sp_oa-oz_3.htm</A>&nbsp;</P>
<P></P>
<P><BR>sp_OASetProperty<BR>You&nbsp;can&nbsp;use&nbsp;sp_OASetProperty&nbsp;stored&nbsp;procedure&nbsp;to&nbsp;set&nbsp;a&nbsp;property&nbsp;of&nbsp;an&nbsp;OLE&nbsp;object&nbsp;to&nbsp;a&nbsp;new&nbsp;value.&nbsp;<BR>See&nbsp;this&nbsp;link&nbsp;for&nbsp;more&nbsp;information&nbsp;<BR>"sp_OASetProperty&nbsp;(T-SQL)":&nbsp;<IMG 
src="http://www.pigtwo.com/forum/pic/url.gif" align=absMiddle border=0><A 
href="http://msdn.microsoft.com/library/psdk/sql/sp_oa-oz_5.htm" 
target=_blank>http://msdn.microsoft.com/library/psdk/sql/sp_oa-oz_5.htm</A>&nbsp;</P>
<P></P>
<P><BR>sp_OAMethod<BR>You&nbsp;can&nbsp;use&nbsp;sp_OAMethod&nbsp;stored&nbsp;procedure&nbsp;to&nbsp;call&nbsp;a&nbsp;method&nbsp;of&nbsp;an&nbsp;OLE&nbsp;object.&nbsp;<BR>This&nbsp;example&nbsp;calls&nbsp;the&nbsp;VerifyConnection&nbsp;method&nbsp;of&nbsp;the&nbsp;previously&nbsp;created&nbsp;SQL&nbsp;Server&nbsp;object:&nbsp;</P>
<P>--&nbsp;Verify&nbsp;the&nbsp;connection<BR>EXEC&nbsp;@hr&nbsp;=&nbsp;sp_OAMethod&nbsp;@object,&nbsp;'VerifyConnection',&nbsp;@return&nbsp;OUT<BR>IF&nbsp;@hr&nbsp;&lt;&gt;&nbsp;0<BR>BEGIN<BR>&nbsp;&nbsp;EXEC&nbsp;sp_displayoaerrorinfo&nbsp;@object,&nbsp;@hr<BR>&nbsp;&nbsp;RETURN<BR>END</P>
<P>&nbsp;</P>
<P><BR>See&nbsp;this&nbsp;link&nbsp;for&nbsp;more&nbsp;information&nbsp;<BR>"sp_OAMethod&nbsp;(T-SQL)":&nbsp;<IMG 
src="http://www.pigtwo.com/forum/pic/url.gif" align=absMiddle border=0><A 
href="http://msdn.microsoft.com/library/psdk/sql/sp_oa-oz_4.htm" 
target=_blank>http://msdn.microsoft.com/library/psdk/sql/sp_oa-oz_4.htm</A>&nbsp;</P>
<P></P>
<P><BR>sp_OAGetErrorInfo<BR>This&nbsp;stored&nbsp;procedure&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;display&nbsp;OLE&nbsp;Automation&nbsp;error&nbsp;information,&nbsp;when&nbsp;error&nbsp;occurs,&nbsp;as&nbsp;sp_displayoaerrorinfo&nbsp;stored&nbsp;procedure.&nbsp;<BR>However,&nbsp;easier&nbsp;to&nbsp;use&nbsp;sp_displayoaerrorinfo&nbsp;stored&nbsp;procedure&nbsp;instead&nbsp;of&nbsp;sp_OAGetErrorInfo,&nbsp;because&nbsp;sp_displayoaerrorinfo&nbsp;is&nbsp;a&nbsp;wrapped&nbsp;stored&nbsp;procedure&nbsp;for&nbsp;sp_OAGetErrorInfo.&nbsp;</P>
<P>See&nbsp;this&nbsp;link&nbsp;for&nbsp;more&nbsp;information&nbsp;<BR>"sp_OAGetErrorInfo&nbsp;(T-SQL)":&nbsp;<IMG 
src="http://www.pigtwo.com/forum/pic/url.gif" align=absMiddle border=0><A 
href="http://msdn.microsoft.com/library/psdk/sql/sp_oa-oz_2.htm" 
target=_blank>http://msdn.microsoft.com/library/psdk/sql/sp_oa-oz_2.htm</A>&nbsp;</P>
<P></P>
<P><BR>sp_OAStop<BR>This&nbsp;stored&nbsp;procedure&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;stop&nbsp;the&nbsp;OLE&nbsp;Automation&nbsp;Stored&nbsp;Procedures&nbsp;execution&nbsp;environment.&nbsp;<BR>The&nbsp;execution&nbsp;environment&nbsp;will&nbsp;automatically&nbsp;restart&nbsp;the&nbsp;next&nbsp;time&nbsp;you&nbsp;call&nbsp;sp_OACreate&nbsp;stored&nbsp;procedure.&nbsp;</P>
<P>See&nbsp;this&nbsp;link&nbsp;for&nbsp;more&nbsp;information&nbsp;<BR>"sp_OAStop&nbsp;(T-SQL)":&nbsp;<IMG 
src="http://www.pigtwo.com/forum/pic/url.gif" align=absMiddle border=0><A 
href="http://msdn.microsoft.com/library/psdk/sql/sp_oa-oz_6.htm" 
target=_blank>http://msdn.microsoft.com/library/psdk/sql/sp_oa-oz_6.htm</A>&nbsp;</P>
<P></P>
<P><BR>Example:&nbsp;generate&nbsp;script<BR>This&nbsp;script&nbsp;will&nbsp;generate&nbsp;script&nbsp;for&nbsp;all&nbsp;tables&nbsp;and&nbsp;all&nbsp;dependent&nbsp;objects&nbsp;for&nbsp;the&nbsp;given&nbsp;database.&nbsp;<BR>You&nbsp;can&nbsp;pass&nbsp;the&nbsp;server&nbsp;name,&nbsp;user&nbsp;name,&nbsp;user&nbsp;password,&nbsp;database&nbsp;name&nbsp;and&nbsp;file&nbsp;name&nbsp;into&nbsp;sp_GenerateScript&nbsp;stored&nbsp;procedure,&nbsp;as&nbsp;in&nbsp;the&nbsp;example&nbsp;below:&nbsp;</P>
<P><BR>EXEC&nbsp;sp_GenerateScript&nbsp;@server&nbsp;=&nbsp;'Server_Name',<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@uname&nbsp;=&nbsp;'User_Name',<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@pwd&nbsp;=&nbsp;'Password',<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@dbname&nbsp;=&nbsp;'Database_Name',<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@filename&nbsp;=&nbsp;'c:\File_Name.sql'</P>
<P>You&nbsp;can&nbsp;specify&nbsp;different&nbsp;number&nbsp;of&nbsp;parameters&nbsp;(from&nbsp;zero&nbsp;to&nbsp;five&nbsp;parameters).&nbsp;</P>
<P>If&nbsp;you&nbsp;not&nbsp;specify&nbsp;server&nbsp;name,&nbsp;then&nbsp;the&nbsp;current&nbsp;server&nbsp;will&nbsp;be&nbsp;used;&nbsp;<BR>If&nbsp;you&nbsp;not&nbsp;specify&nbsp;database&nbsp;name,&nbsp;then&nbsp;the&nbsp;current&nbsp;database&nbsp;will&nbsp;be&nbsp;used;&nbsp;<BR>If&nbsp;you&nbsp;use&nbsp;Windows&nbsp;NT&nbsp;Authentication&nbsp;mode,&nbsp;then&nbsp;you&nbsp;should&nbsp;not&nbsp;specify&nbsp;username&nbsp;and&nbsp;password;&nbsp;<BR>If&nbsp;you&nbsp;not&nbsp;specify&nbsp;user&nbsp;name,&nbsp;but&nbsp;specify&nbsp;password,&nbsp;then&nbsp;the&nbsp;current&nbsp;user&nbsp;name&nbsp;will&nbsp;be&nbsp;used;&nbsp;<BR>If&nbsp;you&nbsp;not&nbsp;specify&nbsp;password,&nbsp;then&nbsp;password&nbsp;will&nbsp;not&nbsp;be&nbsp;used&nbsp;(for&nbsp;example:&nbsp;username&nbsp;=&nbsp;'sa'&nbsp;and&nbsp;empty&nbsp;password,&nbsp;you&nbsp;can&nbsp;pass&nbsp;only&nbsp;username&nbsp;in&nbsp;this&nbsp;case);&nbsp;<BR>If&nbsp;you&nbsp;not&nbsp;specify&nbsp;file&nbsp;name,&nbsp;then&nbsp;script&nbsp;will&nbsp;be&nbsp;placed&nbsp;into&nbsp;file&nbsp;script.sql&nbsp;on&nbsp;the&nbsp;drive&nbsp;'c:'.&nbsp;<BR>This&nbsp;stored&nbsp;procedure&nbsp;can&nbsp;be&nbsp;used&nbsp;for&nbsp;learning&nbsp;some&nbsp;general&nbsp;SQL&nbsp;Server&nbsp;features&nbsp;(how&nbsp;to&nbsp;work&nbsp;with&nbsp;OLE&nbsp;objects&nbsp;from&nbsp;the&nbsp;SQL&nbsp;Server,&nbsp;how&nbsp;to&nbsp;use&nbsp;some&nbsp;system&nbsp;functions,&nbsp;how&nbsp;to&nbsp;work&nbsp;with&nbsp;cursors&nbsp;and&nbsp;so&nbsp;on).&nbsp;</P>
<P>if&nbsp;object_id('sp_GenerateScript')&nbsp;is&nbsp;not&nbsp;null&nbsp;drop&nbsp;proc&nbsp;sp_GenerateScript<BR>GO</P>
<P>CREATE&nbsp;PROC&nbsp;sp_GenerateScript&nbsp;(<BR>&nbsp;&nbsp;@server&nbsp;varchar(30)&nbsp;=&nbsp;null,<BR>&nbsp;&nbsp;@uname&nbsp;varchar(30)&nbsp;=&nbsp;null,<BR>&nbsp;&nbsp;@pwd&nbsp;varchar(30)&nbsp;=&nbsp;null,<BR>&nbsp;&nbsp;@dbname&nbsp;varchar(30)&nbsp;=&nbsp;null,<BR>&nbsp;&nbsp;@filename&nbsp;varchar(200)&nbsp;=&nbsp;'c:\script.sql'<BR>)<BR>AS</P>
<P>DECLARE&nbsp;@object&nbsp;int<BR>DECLARE&nbsp;@hr&nbsp;int<BR>DECLARE&nbsp;@return&nbsp;varchar(200)<BR>DECLARE&nbsp;@exec_str&nbsp;varchar(200)<BR>DECLARE&nbsp;@tbname&nbsp;varchar(30)</P>
<P>SET&nbsp;NOCOUNT&nbsp;ON</P>
<P>--&nbsp;Set&nbsp;the&nbsp;server&nbsp;to&nbsp;the&nbsp;local&nbsp;server<BR>IF&nbsp;@server&nbsp;is&nbsp;NULL<BR>&nbsp;&nbsp;SELECT&nbsp;@server&nbsp;=&nbsp;@@servername</P>
<P>--&nbsp;Set&nbsp;the&nbsp;database&nbsp;to&nbsp;the&nbsp;current&nbsp;database<BR>IF&nbsp;@dbname&nbsp;is&nbsp;NULL<BR>&nbsp;&nbsp;SELECT&nbsp;@dbname&nbsp;=&nbsp;db_name()</P>
<P>--&nbsp;Create&nbsp;an&nbsp;object&nbsp;that&nbsp;points&nbsp;to&nbsp;the&nbsp;SQL&nbsp;Server<BR>EXEC&nbsp;@hr&nbsp;=&nbsp;sp_OACreate&nbsp;'SQLDMO.SQLServer',&nbsp;@object&nbsp;OUT<BR>IF&nbsp;@hr&nbsp;&lt;&gt;&nbsp;0<BR>BEGIN<BR>&nbsp;&nbsp;EXEC&nbsp;sp_displayoaerrorinfo&nbsp;@object,&nbsp;@hr<BR>&nbsp;&nbsp;RETURN<BR>END</P>
<P>--&nbsp;Connect&nbsp;to&nbsp;the&nbsp;SQL&nbsp;Server<BR>IF&nbsp;(@uname&nbsp;is&nbsp;NULL)&nbsp;AND&nbsp;(@pwd&nbsp;is&nbsp;NULL)<BR>&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Windows&nbsp;NT&nbsp;Authentication&nbsp;mode&nbsp;is&nbsp;used<BR>&nbsp;&nbsp;&nbsp;&nbsp;EXEC&nbsp;@hr&nbsp;=&nbsp;sp_OAMethod&nbsp;@object,&nbsp;'Connect',&nbsp;NULL,&nbsp;&nbsp;@server<BR>&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;@hr&nbsp;&lt;&gt;&nbsp;0<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXEC&nbsp;sp_displayoaerrorinfo&nbsp;@object,&nbsp;@hr<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END<BR>&nbsp;&nbsp;END<BR>ELSE<BR>IF&nbsp;(@uname&nbsp;is&nbsp;NULL)<BR>&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Set&nbsp;the&nbsp;username&nbsp;to&nbsp;the&nbsp;current&nbsp;user&nbsp;name<BR>&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@uname&nbsp;=&nbsp;SYSTEM_USER<BR>&nbsp;&nbsp;&nbsp;&nbsp;EXEC&nbsp;@hr&nbsp;=&nbsp;sp_OAMethod&nbsp;@object,'Connect',NULL,@server,@uname,@pwd<BR>&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;@hr&nbsp;&lt;&gt;&nbsp;0<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXEC&nbsp;sp_displayoaerrorinfo&nbsp;@object,&nbsp;@hr<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END<BR>&nbsp;&nbsp;END<BR>ELSE<BR>IF&nbsp;(@pwd&nbsp;is&nbsp;NULL)<BR>&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;EXEC&nbsp;@hr&nbsp;=&nbsp;sp_OAMethod&nbsp;@object,&nbsp;'Connect',&nbsp;NULL,&nbsp;&nbsp;@server,&nbsp;@uname<BR>&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;@hr&nbsp;&lt;&gt;&nbsp;0<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXEC&nbsp;sp_displayoaerrorinfo&nbsp;@object,&nbsp;@hr<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END<BR>&nbsp;&nbsp;END<BR>ELSE<BR>&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;EXEC&nbsp;@hr&nbsp;=&nbsp;sp_OAMethod&nbsp;@object,'Connect',NULL,@server,@uname,@pwd<BR>&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;@hr&nbsp;&lt;&gt;&nbsp;0<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXEC&nbsp;sp_displayoaerrorinfo&nbsp;@object,&nbsp;@hr<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END<BR>&nbsp;&nbsp;END</P>
<P>--&nbsp;Verify&nbsp;the&nbsp;connection<BR>EXEC&nbsp;@hr&nbsp;=&nbsp;sp_OAMethod&nbsp;@object,&nbsp;'VerifyConnection',&nbsp;@return&nbsp;OUT<BR>IF&nbsp;@hr&nbsp;&lt;&gt;&nbsp;0<BR>BEGIN<BR>&nbsp;&nbsp;EXEC&nbsp;sp_displayoaerrorinfo&nbsp;@object,&nbsp;@hr<BR>&nbsp;&nbsp;RETURN<BR>END</P>
<P>SET&nbsp;@exec_str&nbsp;=&nbsp;"DECLARE&nbsp;script_cursor&nbsp;CURSOR&nbsp;FOR&nbsp;SELECT&nbsp;name&nbsp;FROM&nbsp;"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;@dbname&nbsp;+&nbsp;"..sysobjects&nbsp;WHERE&nbsp;type&nbsp;=&nbsp;'U'&nbsp;ORDER&nbsp;BY&nbsp;Name"<BR>EXEC&nbsp;(@exec_str)</P>
<P>OPEN&nbsp;script_cursor<BR>FETCH&nbsp;NEXT&nbsp;FROM&nbsp;script_cursor&nbsp;INTO&nbsp;@tbname<BR>WHILE&nbsp;(@@fetch_status&nbsp;&lt;&gt;&nbsp;-1)<BR>BEGIN<BR>&nbsp;&nbsp;SET&nbsp;@exec_str&nbsp;=&nbsp;'Databases("'+&nbsp;@dbname&nbsp;+'").Tables("'<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;RTRIM(UPPER(@tbname))+'").Script(74077,"'<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;@filename&nbsp;+'")'<BR>&nbsp;&nbsp;EXEC&nbsp;@hr&nbsp;=&nbsp;sp_OAMethod&nbsp;@object,&nbsp;@exec_str,&nbsp;@return&nbsp;OUT<BR>&nbsp;&nbsp;IF&nbsp;@hr&nbsp;&lt;&gt;&nbsp;0<BR>&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXEC&nbsp;sp_displayoaerrorinfo&nbsp;@object,&nbsp;@hr<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN<BR>&nbsp;&nbsp;&nbsp;&nbsp;END<BR>&nbsp;&nbsp;FETCH&nbsp;NEXT&nbsp;FROM&nbsp;script_cursor&nbsp;INTO&nbsp;@tbname<BR>END<BR>CLOSE&nbsp;script_cursor<BR>DEALLOCATE&nbsp;script_cursor</P>
<P>--&nbsp;Destroy&nbsp;the&nbsp;object<BR>EXEC&nbsp;@hr&nbsp;=&nbsp;sp_OADestroy&nbsp;@object<BR>IF&nbsp;@hr&nbsp;&lt;&gt;&nbsp;0<BR>BEGIN<BR>&nbsp;&nbsp;EXEC&nbsp;sp_displayoaerrorinfo&nbsp;@object,&nbsp;@hr<BR>&nbsp;&nbsp;RETURN<BR>END<BR>GO</P></FONT>