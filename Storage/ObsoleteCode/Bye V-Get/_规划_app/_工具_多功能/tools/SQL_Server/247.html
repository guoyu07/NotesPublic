<meta http-equiv="content-type" content="text/html; charset=gb2312">&nbsp;<FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>交叉制表--产生列头列表(7)</B><BR>下面代码部分将创建列头列表和行头列表.代码首先定义两个临时表<BR>create&nbsp;table&nbsp;#colnames(colname&nbsp;varchar(255)&nbsp;null,colnumber&nbsp;int&nbsp;null)<BR>create&nbsp;table#rownames(rowname&nbsp;varchar(255)&nbsp;null)<BR>根据源表的数据为所请求列创建一个insert语句.这个代码需要处理一些细节;日期分组,将非字符型数据转换为char型及根据原始数据类型进行分类.第一项用于处理为请求的参数建立一个合适的日期分组,第二项用于使数据可以用作交叉表中的一个列名称.最后一项在下面所列举的情况下使很必要的;数字型转换为字符型数据;<B>当把这些数字作为字符进行分类时,顺序使用字典顺序(1,10,2,3,4,,,9)但用户期望的是正确的数字顺序</B><BR>--&nbsp;insert&nbsp;distinct&nbsp;column&nbsp;data&nbsp;into&nbsp;#colnames<BR>select&nbsp;@chvexec=''insert&nbsp;#colnames&nbsp;select&nbsp;col1,col2&nbsp;from&nbsp;''<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+''(select&nbsp;distinct&nbsp;col1=''+<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;@inttemp&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;3&nbsp;then&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;when&nbsp;@inygrouping&nbsp;in(1,3)&nbsp;then&nbsp;''datetime(''+<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;@inygrouping&nbsp;when&nbsp;1&nbsp;then&nbsp;''weekday''<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;3&nbsp;then&nbsp;''month''<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end+'',''+rtrim(@chrcolhead)+'')''<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;&nbsp;case&nbsp;@inygrouping<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;2&nbsp;then&nbsp;''''''week''<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;4&nbsp;then&nbsp;''''''quarter''<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;5&nbsp;then&nbsp;''''''year''<BR>&nbsp;&nbsp;&nbsp;&nbsp;end+''-"+''+''+''datename(''+<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;@inygrouping<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;2&nbsp;then&nbsp;''week''<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;4&nbsp;then&nbsp;&nbsp;''quarter''<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;5&nbsp;then&nbsp;''year''<BR>&nbsp;&nbsp;&nbsp;&nbsp;end+'',''+rtrim(@chrcolhead)+'')''<BR>&nbsp;&nbsp;end<BR>&nbsp;&nbsp;&nbsp;else&nbsp;case&nbsp;@intcoltype&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;1&nbsp;then&nbsp;convert(varchar(255),,''+rtrim(@chrcolhead)+'')''<BR>&nbsp;&nbsp;else&nbsp;rtrim(@chrcolhead)<BR>&nbsp;&nbsp;end<BR>&nbsp;end+,col2=''+case&nbsp;@inttemp<BR>&nbsp;&nbsp;when&nbsp;3&nbsp;then&nbsp;''datepart(''+<BR>&nbsp;&nbsp;case&nbsp;@inygrouping&nbsp;<BR>&nbsp;&nbsp;&nbsp;when&nbsp;1&nbsp;then&nbsp;''weekday''<BR>&nbsp;&nbsp;&nbsp;when&nbsp;2&nbsp;then&nbsp;''week''<BR>&nbsp;&nbsp;&nbsp;when&nbsp;3&nbsp;then&nbsp;''month''<BR>&nbsp;&nbsp;&nbsp;when&nbsp;4&nbsp;then&nbsp;''quarter''&nbsp;<BR>&nbsp;&nbsp;&nbsp;when&nbsp;5&nbsp;then&nbsp;''year''<BR>&nbsp;&nbsp;&nbsp;end+'',''+rtrim(@chrcolhead)+'')''<BR>&nbsp;&nbsp;&nbsp;else&nbsp;''0''<BR>&nbsp;&nbsp;end+'',col3=''+<BR>&nbsp;&nbsp;&nbsp;case&nbsp;@inttemp<BR>&nbsp;&nbsp;when&nbsp;3&nbsp;then&nbsp;''datepart(''+<BR>&nbsp;&nbsp;&nbsp;case&nbsp;@inygrouping<BR>&nbsp;&nbsp;&nbsp;when&nbsp;1&nbsp;then&nbsp;''weekday''<BR>&nbsp;&nbsp;&nbsp;when&nbsp;3&nbsp;then&nbsp;''month''<BR>&nbsp;&nbsp;&nbsp;when&nbsp;2&nbsp;then&nbsp;''week''<BR>&nbsp;&nbsp;&nbsp;when&nbsp;4&nbsp;then&nbsp;''quarter''<BR>&nbsp;&nbsp;&nbsp;when&nbsp;5&nbsp;then&nbsp;''year''<BR>&nbsp;&nbsp;end+'',''+rtrim(@chrcolhead)+'')''<BR>&nbsp;&nbsp;else&nbsp;rtrim(@chrcolhead)<BR>end&nbsp;+''from&nbsp;''+rtrim(@chrsource)+'')&nbsp;xyz&nbsp;order&nbsp;by&nbsp;col3''<BR>&nbsp;&nbsp;exec(@chvexec)<BR>在insert语句内部创建select语句包含三列(其中两列实际上被插入).为了进行存档,可使用导出表来创建一个三列的结果集;其中只选择两列进行插入.如果该列的列头数据类型是日期型,则将转换为datename,作为特殊的分组类型.如果datename函数返回一个数值类型数据,则数据分组的名称并添加一个下划线作为该数字的前缀(例如quarter_4)</FONT>