<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>行转列的例子</B><BR><IMG 
src="http://www.pigtwo.com/forum/pic/url.gif" align=absMiddle border=0><A 
href="http://www.delphibbs.com/delphibbs/dispq.asp?lid=1472876" 
target=_blank>http://www.delphibbs.com/delphibbs/dispq.asp?lid=1472876</A><BR>表结构如下XX，YY，mData.表名就定为TableA&nbsp;吧。XX,YY同时为关键字。<BR>有如下的数据<BR>XX&nbsp;&nbsp;&nbsp;YY&nbsp;&nbsp;&nbsp;&nbsp;mData<BR>1&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1<BR>1&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2<BR>1&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3<BR>1.5&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.5<BR>1.5&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.5<BR>2&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3<BR>2&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4<BR>2&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;36
<P></P>
<P>我要把上面的数据按XX坐标排列后，形成字符串，如果该坐标YY为空值，则用--代替。<BR>上面的结果就是<BR>XX&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;1.5&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;<BR>YY1&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;1.5&nbsp;&nbsp;&nbsp;&nbsp;3<BR>YY2&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;2.5&nbsp;&nbsp;&nbsp;&nbsp;4<BR>YY3&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;36</P>
<P>注：上面的YY1，YY2，YY3一定是整数，但XX不一定。（YY1表示YY=1时，YY2表示YY=2）<BR>我建的表中的字段都是varchar(10)，运行通过，不知合不合用<BR>if&nbsp;exists(select&nbsp;*&nbsp;from&nbsp;sysobjects&nbsp;where&nbsp;type='P'&nbsp;and&nbsp;name='RowToCol')<BR>&nbsp;&nbsp;drop&nbsp;procedure&nbsp;RowToCol<BR>go<BR>create&nbsp;procedure&nbsp;RowToCol&nbsp;as<BR>begin<BR>&nbsp;&nbsp;declare&nbsp;@create&nbsp;varchar(4000)<BR>&nbsp;&nbsp;declare&nbsp;@ins&nbsp;varchar(1000)<BR>&nbsp;select&nbsp;@create='create&nbsp;table&nbsp;#temp&nbsp;(columnXX&nbsp;varchar(10)',@ins='insert&nbsp;into&nbsp;#temp&nbsp;values(''XX'''<BR>&nbsp;&nbsp;declare&nbsp;@XX&nbsp;varchar(10)<BR>&nbsp;&nbsp;declare&nbsp;xx_cursor&nbsp;cursor&nbsp;for&nbsp;select&nbsp;distinct&nbsp;XX&nbsp;from&nbsp;TableA&nbsp;order&nbsp;by&nbsp;XX<BR>&nbsp;&nbsp;open&nbsp;xx_cursor<BR>&nbsp;fetch&nbsp;next&nbsp;from&nbsp;xx_cursor&nbsp;into&nbsp;@XX<BR>&nbsp;while&nbsp;@@fetch_status&nbsp;=&nbsp;0<BR>&nbsp;&nbsp;begin<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;@create=@create+',[column'+@XX+']&nbsp;varchar(10)&nbsp;default(''--'')',@ins=@ins+','+@XX<BR>&nbsp;&nbsp;fetch&nbsp;next&nbsp;from&nbsp;xx_cursor&nbsp;into&nbsp;@XX&nbsp;&nbsp;<BR>&nbsp;end<BR>&nbsp;&nbsp;close&nbsp;xx_cursor<BR>&nbsp;deallocate&nbsp;&nbsp;xx_cursor<BR>&nbsp;&nbsp;select&nbsp;@create=@create+')',@ins=@ins+')'</P>
<P>&nbsp;&nbsp;declare&nbsp;@YY&nbsp;varchar(10),@DATA&nbsp;varchar(10)&nbsp;&nbsp;<BR>&nbsp;&nbsp;declare&nbsp;@OldYY&nbsp;varchar(10),@values&nbsp;varchar(1000)<BR>&nbsp;&nbsp;declare&nbsp;yy_cursor&nbsp;cursor&nbsp;for&nbsp;&nbsp;select&nbsp;YY,XX,mData&nbsp;from&nbsp;TableA&nbsp;order&nbsp;by&nbsp;YY<BR>&nbsp;&nbsp;open&nbsp;yy_cursor<BR>&nbsp;fetch&nbsp;next&nbsp;from&nbsp;yy_cursor&nbsp;into&nbsp;@YY,@XX,@DATA<BR>&nbsp;while&nbsp;@@fetch_status&nbsp;=&nbsp;0<BR>&nbsp;&nbsp;begin<BR>&nbsp;&nbsp;if&nbsp;@oldYY=@YY<BR>&nbsp;&nbsp;&nbsp;select&nbsp;@ins=@ins+',[column'+@XX+']',&nbsp;@values=@values+','+@DATA<BR>&nbsp;&nbsp;&nbsp;&nbsp;else<BR>&nbsp;&nbsp;&nbsp;&nbsp;begin<BR>&nbsp;&nbsp;&nbsp;if&nbsp;@oldYY&nbsp;is&nbsp;not&nbsp;null<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;@ins=@ins+')'+@values+')'+char(13)+'insert&nbsp;into&nbsp;#temp(columnXX,[column'+@XX+']',@values='&nbsp;values(''YY'+@YY+''','+@DATA<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;@ins=@ins+char(13)+'insert&nbsp;into&nbsp;#temp(columnXX,[column'+@XX+']',@values='&nbsp;values(''YY'+@YY+''','+@DATA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;end<BR>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;@oldYY=@YY&nbsp;&nbsp;<BR>&nbsp;&nbsp;fetch&nbsp;next&nbsp;from&nbsp;yy_cursor&nbsp;into&nbsp;@YY,@XX,@DATA<BR>&nbsp;end<BR>&nbsp;&nbsp;close&nbsp;yy_cursor&nbsp;<BR>&nbsp;deallocate&nbsp;&nbsp;yy_cursor&nbsp;<BR>&nbsp;&nbsp;select&nbsp;@ins=@ins+')'+@values+')'<BR>&nbsp;&nbsp;print&nbsp;@create<BR>&nbsp;&nbsp;print&nbsp;@ins<BR>&nbsp;&nbsp;exec(@create+@ins+'select&nbsp;*&nbsp;from&nbsp;#temp')</P></FONT>