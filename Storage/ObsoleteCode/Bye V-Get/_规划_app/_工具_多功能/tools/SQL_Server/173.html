<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>获取排队顺序－5－T－SQL系列</B><BR>方法五：利用游标
<P></P>
<P>SELECT语句（集合操作）可能需要相关子查询或自联结来解决，这样就需要多次访问数据。这类问题特别适合采用一种方法来解决，因为采用游标法时，只需扫描一次数据。对于一些时序操作，游标法比单个SELECT语句效率高。（但利用游标不如利用临时表速度快）。<BR>&nbsp;处理“多行同位”的三个原则：<BR>1、&nbsp;对“多行同位”指定重复的等级值，并且下一个不重复的等级值递增1。<BR>2、&nbsp;各行（包括“多行同位”）的等级值都唯一。<BR>3、&nbsp;指定重复的等级值，但是下一个不重复的等级值由它在等级中的实际位置决定，而非简单地递增1。</P>
<P><BR>方法五A：利用游标（对“多行同位”应用“规则1”）</P>
<P>DECLARE&nbsp;@rank&nbsp;int,@title_id&nbsp;char(6),@price&nbsp;int,<BR>&nbsp;&nbsp;@title_name&nbsp;varchar(30),@last_rank&nbsp;int,<BR>&nbsp;&nbsp;@last_prace&nbsp;money,@counter&nbsp;int<BR>SELECT&nbsp;@rank=1,@last_rank=1,@last_prace=0,@counter=1<BR>DECLARE&nbsp;rank_cursor&nbsp;CURSOR&nbsp;FOR&nbsp;<BR>&nbsp;&nbsp;SELECT&nbsp;title_id,price,title_name<BR>&nbsp;&nbsp;FROM&nbsp;title&nbsp;WHERE&nbsp;price&nbsp;IS&nbsp;NOT&nbsp;NULL<BR>&nbsp;&nbsp;ORDER&nbsp;BY&nbsp;price&nbsp;DESC<BR>OPEN&nbsp;rank_cursor<BR>FETCH&nbsp;NEXT&nbsp;FROM&nbsp;rank_cursor&nbsp;INTO&nbsp;@title_id,@price,@title_name<BR>WHILE&nbsp;(@@FETCH_STATUS&lt;&gt;-1)<BR>BEGIN<BR>&nbsp;&nbsp;IF&nbsp;(@counter=1)&nbsp;&nbsp;--For&nbsp;first&nbsp;row,just&nbsp;display&nbsp;values&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--and&nbsp;set&nbsp;last&nbsp;values<BR>&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;rank=@rank,title_id=@title_id,<BR>&nbsp;price=@price,title_name=@title_name<BR>&nbsp;&nbsp;&nbsp;&nbsp;END<BR>&nbsp;&nbsp;ELSE<BR>&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--If&nbsp;current&nbsp;PRICE&nbsp;the&nbsp;same&nbsp;as&nbsp;last,assign&nbsp;the&nbsp;same&nbsp;rank<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(@price=@last_prace)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;rank=@last_rank,title_id=@title_id,<BR>&nbsp;&nbsp;&nbsp;price=@price,title_name=@title_name<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE&nbsp;&nbsp;--Otherwise,increment&nbsp;the&nbsp;rank<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;SELECT&nbsp;rank=@last_rank+1,title_id=@title_id,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;price=@price,title_name=@title_name<BR>&nbsp;&nbsp;&nbsp;SELECT&nbsp;@rank=@last_rank+1<BR>&nbsp;END<BR>&nbsp;&nbsp;&nbsp;&nbsp;END<BR>--Set&nbsp;values&nbsp;to&nbsp;current&nbsp;row<BR>SELECT&nbsp;@counter=@counter+1,@last_rank=@rank,<BR>&nbsp;&nbsp;@last_prace=@price<BR>FETCH&nbsp;NEXT&nbsp;FROM&nbsp;rank_cursor&nbsp;INTO&nbsp;@title_id,@price,@title_name<BR>END</P>
<P>CLOSE&nbsp;rank_cursor<BR>DEALLOCATE&nbsp;rank_cursor</P>
<P>结果：<BR>rank&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;title_id&nbsp;price&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;title_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>-----------&nbsp;--------&nbsp;-----------&nbsp;------------------------------&nbsp;<BR>1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt005&nbsp;&nbsp;&nbsp;&nbsp;80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_5<BR>2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt013&nbsp;&nbsp;&nbsp;&nbsp;70&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_13<BR>3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt012&nbsp;&nbsp;&nbsp;&nbsp;65&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_12<BR>4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt010&nbsp;&nbsp;&nbsp;&nbsp;55&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_10<BR>5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt002&nbsp;&nbsp;&nbsp;&nbsp;50&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_2&nbsp;&nbsp;<BR>5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt004&nbsp;&nbsp;&nbsp;&nbsp;50&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_4&nbsp;&nbsp;<BR>5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt008&nbsp;&nbsp;&nbsp;&nbsp;50&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_8<BR>5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt014&nbsp;&nbsp;&nbsp;&nbsp;50&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_14<BR>6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt001&nbsp;&nbsp;&nbsp;&nbsp;40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_1&nbsp;&nbsp;&nbsp;&nbsp;<BR>7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt006&nbsp;&nbsp;&nbsp;&nbsp;39&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_6<BR>8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt007&nbsp;&nbsp;&nbsp;&nbsp;38&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_7<BR>9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt009&nbsp;&nbsp;&nbsp;&nbsp;35&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_9<BR>10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt011&nbsp;&nbsp;&nbsp;&nbsp;33&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_11<BR>11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt016&nbsp;&nbsp;&nbsp;&nbsp;30&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_16<BR>12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt015&nbsp;&nbsp;&nbsp;&nbsp;25&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_15<BR>13&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt003&nbsp;&nbsp;&nbsp;&nbsp;20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_3&nbsp;&nbsp;</P>
<P><BR>方法五B：利用游标（对“多行同位”应用“规则2”）</P>
<P>DECLARE&nbsp;@rank&nbsp;int,@title_id&nbsp;char(6),@price&nbsp;int,<BR>&nbsp;&nbsp;@title_name&nbsp;varchar(30)<BR>SELECT&nbsp;@rank=1<BR>DECLARE&nbsp;rank_cursor&nbsp;CURSOR&nbsp;FOR&nbsp;<BR>&nbsp;&nbsp;SELECT&nbsp;title_id,price,title_name<BR>&nbsp;&nbsp;FROM&nbsp;title&nbsp;WHERE&nbsp;price&nbsp;IS&nbsp;NOT&nbsp;NULL<BR>&nbsp;&nbsp;ORDER&nbsp;BY&nbsp;price&nbsp;DESC<BR>OPEN&nbsp;rank_cursor<BR>FETCH&nbsp;NEXT&nbsp;FROM&nbsp;rank_cursor&nbsp;INTO&nbsp;@title_id,@price,@title_name<BR>WHILE&nbsp;(@@FETCH_STATUS&lt;&gt;-1)<BR>BEGIN<BR>&nbsp;&nbsp;SELECT&nbsp;rank=@rank,title_id=@title_id,<BR>&nbsp;price=@price,title_name=@title_name<BR>&nbsp;&nbsp;SELECT&nbsp;@rank=@rank+1<BR>FETCH&nbsp;NEXT&nbsp;FROM&nbsp;rank_cursor&nbsp;INTO&nbsp;@title_id,@price,@title_name<BR>END</P>
<P>CLOSE&nbsp;rank_cursor<BR>DEALLOCATE&nbsp;rank_cursor</P>
<P><BR>结果：<BR>rank&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;title_id&nbsp;price&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;title_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>-----------&nbsp;--------&nbsp;-----------&nbsp;------------------------------&nbsp;<BR>1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt005&nbsp;&nbsp;&nbsp;&nbsp;80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_5<BR>2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt013&nbsp;&nbsp;&nbsp;&nbsp;70&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_13<BR>3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt012&nbsp;&nbsp;&nbsp;&nbsp;65&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_12<BR>4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt010&nbsp;&nbsp;&nbsp;&nbsp;55&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_10<BR>5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt002&nbsp;&nbsp;&nbsp;&nbsp;50&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_2&nbsp;&nbsp;<BR>6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt004&nbsp;&nbsp;&nbsp;&nbsp;50&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_4&nbsp;&nbsp;<BR>7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt008&nbsp;&nbsp;&nbsp;&nbsp;50&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_8<BR>8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt014&nbsp;&nbsp;&nbsp;&nbsp;50&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_14<BR>9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt001&nbsp;&nbsp;&nbsp;&nbsp;40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_1&nbsp;&nbsp;&nbsp;&nbsp;<BR>10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt006&nbsp;&nbsp;&nbsp;&nbsp;39&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_6<BR>11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt007&nbsp;&nbsp;&nbsp;&nbsp;38&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_7<BR>12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt009&nbsp;&nbsp;&nbsp;&nbsp;35&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_9<BR>13&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt011&nbsp;&nbsp;&nbsp;&nbsp;33&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_11<BR>14&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt016&nbsp;&nbsp;&nbsp;&nbsp;30&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_16<BR>15&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt015&nbsp;&nbsp;&nbsp;&nbsp;25&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_15<BR>16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt003&nbsp;&nbsp;&nbsp;&nbsp;20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_3&nbsp;&nbsp;</P>
<P>方法五C：利用游标（对“多行同位”应用“规则3”）</P>
<P>DECLARE&nbsp;@rank&nbsp;int,@title_id&nbsp;char(6),@price&nbsp;int,<BR>&nbsp;&nbsp;@title_name&nbsp;varchar(30),@last_rank&nbsp;int,<BR>&nbsp;&nbsp;@last_prace&nbsp;money,@counter&nbsp;int<BR>SELECT&nbsp;@rank=1,@last_rank=1,@last_prace=0,@counter=1<BR>DECLARE&nbsp;rank_cursor&nbsp;CURSOR&nbsp;FOR&nbsp;<BR>&nbsp;&nbsp;SELECT&nbsp;title_id,price,title_name<BR>&nbsp;&nbsp;FROM&nbsp;title&nbsp;WHERE&nbsp;price&nbsp;IS&nbsp;NOT&nbsp;NULL<BR>&nbsp;&nbsp;ORDER&nbsp;BY&nbsp;price&nbsp;DESC<BR>OPEN&nbsp;rank_cursor<BR>FETCH&nbsp;NEXT&nbsp;FROM&nbsp;rank_cursor&nbsp;INTO&nbsp;@title_id,@price,@title_name<BR>WHILE&nbsp;(@@FETCH_STATUS&lt;&gt;-1)<BR>BEGIN<BR>&nbsp;&nbsp;IF&nbsp;(@counter=1)&nbsp;&nbsp;--For&nbsp;first&nbsp;row,just&nbsp;display&nbsp;values&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--and&nbsp;set&nbsp;last&nbsp;values<BR>&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;rank=@rank,title_id=@title_id,<BR>&nbsp;price=@price,title_name=@title_name<BR>&nbsp;&nbsp;&nbsp;&nbsp;END<BR>&nbsp;&nbsp;ELSE<BR>&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--If&nbsp;current&nbsp;PRICE&nbsp;the&nbsp;same&nbsp;as&nbsp;last,assign&nbsp;the&nbsp;same&nbsp;rank<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(@price=@last_prace)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;rank=@last_rank,title_id=@title_id,<BR>&nbsp;&nbsp;&nbsp;price=@price,title_name=@title_name<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE&nbsp;&nbsp;--Otherwise,set&nbsp;the&nbsp;rank&nbsp;to&nbsp;the&nbsp;overrall<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--counter&nbsp;of&nbsp;how&nbsp;many&nbsp;rows&nbsp;have&nbsp;been&nbsp;visited<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;SELECT&nbsp;@rank=@counter<BR>&nbsp;&nbsp;&nbsp;SELECT&nbsp;rank=@rank,title_id=@title_id,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;price=@price,title_name=@title_name<BR>&nbsp;END<BR>&nbsp;&nbsp;&nbsp;&nbsp;END<BR>--Set&nbsp;values&nbsp;to&nbsp;current&nbsp;row<BR>SELECT&nbsp;@counter=@counter+1,@last_rank=@rank,<BR>&nbsp;&nbsp;@last_prace=@price<BR>FETCH&nbsp;NEXT&nbsp;FROM&nbsp;rank_cursor&nbsp;INTO&nbsp;@title_id,@price,@title_name<BR>END</P>
<P>CLOSE&nbsp;rank_cursor<BR>DEALLOCATE&nbsp;rank_cursor</P>
<P>结果：<BR>rank&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;title_id&nbsp;price&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;title_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>-----------&nbsp;--------&nbsp;-----------&nbsp;------------------------------&nbsp;<BR>1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt005&nbsp;&nbsp;&nbsp;&nbsp;80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_5<BR>2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt013&nbsp;&nbsp;&nbsp;&nbsp;70&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_13<BR>3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt012&nbsp;&nbsp;&nbsp;&nbsp;65&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_12<BR>4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt010&nbsp;&nbsp;&nbsp;&nbsp;55&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_10<BR>5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt002&nbsp;&nbsp;&nbsp;&nbsp;50&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_2&nbsp;&nbsp;<BR>5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt004&nbsp;&nbsp;&nbsp;&nbsp;50&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_4&nbsp;&nbsp;<BR>5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt008&nbsp;&nbsp;&nbsp;&nbsp;50&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_8<BR>5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt014&nbsp;&nbsp;&nbsp;&nbsp;50&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_14<BR>9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt001&nbsp;&nbsp;&nbsp;&nbsp;40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_1&nbsp;&nbsp;&nbsp;&nbsp;<BR>10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt006&nbsp;&nbsp;&nbsp;&nbsp;39&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_6<BR>11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt007&nbsp;&nbsp;&nbsp;&nbsp;38&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_7<BR>12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt009&nbsp;&nbsp;&nbsp;&nbsp;35&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_9<BR>13&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt011&nbsp;&nbsp;&nbsp;&nbsp;33&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_11<BR>14&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt016&nbsp;&nbsp;&nbsp;&nbsp;30&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_16<BR>15&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt015&nbsp;&nbsp;&nbsp;&nbsp;25&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_15<BR>16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt003&nbsp;&nbsp;&nbsp;&nbsp;20&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_3&nbsp;&nbsp;</P>
<P><BR>由于游标法进行多个&nbsp;FETCH&nbsp;操作，所以它产生多个结果集。对于慢速网络会大幅降低性能。若临时表能满足对“多行同位”的处理要求，那么最好采用临时表，它只返回一个结果集。</P>
<P></P>
<P><BR></P></FONT>