<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>acess&nbsp;技巧集（ysai)</B><BR><IMG 
src="http://www.pigtwo.com/forum/pic/url.gif" align=absMiddle border=0><A 
href="http://www.delphibbs.com/delphibbs/dispq.asp?lid=1601151" 
target=_blank>http://www.delphibbs.com/delphibbs/dispq.asp?lid=1601151</A><BR>ACCESS技巧集<BR>作者:ysai<BR>转载请保持文章完整并标明出处
<P></P>
<P>1.DELPHI中操作ACCESS数据库(建立.mdb文件,压缩数据库)<BR>以下代码在WIN2K,D6,MDAC2.6下测试通过,<BR>编译好的程序在WIN98第二版无ACCESS环境下运行成功.<BR>//声明连接字符串<BR>Const<BR>&nbsp;&nbsp;SConnectionString&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'Provider=Microsoft.Jet.OLEDB.4.0;Data&nbsp;Source=%s;'<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+'Jet&nbsp;OLEDB:Database&nbsp;Password=%s;';</P>
<P>//=============================================================================<BR>//&nbsp;Procedure:&nbsp;GetTempPathFileName<BR>//&nbsp;Author&nbsp;&nbsp;&nbsp;:&nbsp;ysai<BR>//&nbsp;Date&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;2003-01-27<BR>//&nbsp;Arguments:&nbsp;(None)<BR>//&nbsp;Result&nbsp;&nbsp;&nbsp;:&nbsp;string<BR>//=============================================================================<BR>function&nbsp;GetTempPathFileName():string;<BR>//取得临时文件名<BR>var<BR>&nbsp;&nbsp;SPath,Sfile:array&nbsp;[0..254]&nbsp;of&nbsp;char;<BR>begin<BR>&nbsp;&nbsp;GetTempPath(254,SPath);<BR>&nbsp;&nbsp;GetTempFileName(SPath,'~SM',0,SFile);<BR>&nbsp;&nbsp;result:=SFile;<BR>&nbsp;&nbsp;DeleteFile(result);<BR>end;</P>
<P>//=============================================================================<BR>//&nbsp;Procedure:&nbsp;CreateAccessFile<BR>//&nbsp;Author&nbsp;&nbsp;&nbsp;:&nbsp;ysai<BR>//&nbsp;Date&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;2003-01-27<BR>//&nbsp;Arguments:&nbsp;FileName:String;PassWord:string=''<BR>//&nbsp;Result&nbsp;&nbsp;&nbsp;:&nbsp;boolean<BR>//=============================================================================<BR>function&nbsp;CreateAccessFile(FileName:String;PassWord:string=''):boolean;<BR>//建立Access文件，如果文件存在则失败<BR>var<BR>&nbsp;&nbsp;STempFileName:string;<BR>&nbsp;&nbsp;vCatalog:OleVariant;<BR>begin<BR>&nbsp;&nbsp;STempFileName:=GetTempPathFileName;<BR>&nbsp;&nbsp;try<BR>&nbsp;&nbsp;&nbsp;&nbsp;vCatalog:=CreateOleObject('ADOX.Catalog');<BR>&nbsp;&nbsp;&nbsp;&nbsp;vCatalog.Create(format(SConnectionString,[STempFileName,PassWord]));<BR>&nbsp;&nbsp;&nbsp;&nbsp;result:=CopyFile(PChar(STempFileName),PChar(FileName),True);<BR>&nbsp;&nbsp;&nbsp;&nbsp;DeleteFile(STempFileName);<BR>&nbsp;&nbsp;except<BR>&nbsp;&nbsp;&nbsp;&nbsp;result:=false;<BR>&nbsp;&nbsp;end;<BR>end;</P>
<P>//=============================================================================<BR>//&nbsp;Procedure:&nbsp;CompactDatabase<BR>//&nbsp;Author&nbsp;&nbsp;&nbsp;:&nbsp;ysai<BR>//&nbsp;Date&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;2003-01-27<BR>//&nbsp;Arguments:&nbsp;AFileName,APassWord:string<BR>//&nbsp;Result&nbsp;&nbsp;&nbsp;:&nbsp;boolean<BR>//=============================================================================<BR>function&nbsp;CompactDatabase(AFileName,APassWord:string):boolean;<BR>//压缩与修复数据库,覆盖源文件<BR>var<BR>&nbsp;&nbsp;STempFileName:string;<BR>&nbsp;&nbsp;vJE:OleVariant;<BR>begin<BR>&nbsp;&nbsp;STempFileName:=GetTempPathFileName;<BR>&nbsp;&nbsp;try<BR>&nbsp;&nbsp;&nbsp;&nbsp;vJE:=CreateOleObject('JRO.JetEngine');<BR>&nbsp;&nbsp;&nbsp;&nbsp;vJE.CompactDatabase(format(SConnectionString,[AFileName,APassWord]),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;format(SConnectionString,[STempFileName,APassWord]));<BR>&nbsp;&nbsp;&nbsp;&nbsp;result:=CopyFile(PChar(STempFileName),PChar(AFileName),false);<BR>&nbsp;&nbsp;&nbsp;&nbsp;DeleteFile(STempFileName);<BR>&nbsp;&nbsp;except<BR>&nbsp;&nbsp;&nbsp;&nbsp;result:=false;<BR>&nbsp;&nbsp;end;<BR>end;</P>
<P>2.ACCESS中使用SQL语句应注意的地方及几点技巧<BR>以下SQL语句在ACCESS&nbsp;XP的查询中测试通过<BR>建表:<BR>&nbsp;&nbsp;&nbsp;&nbsp;Create&nbsp;Table&nbsp;Tab1&nbsp;(<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ID&nbsp;Counter,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Name&nbsp;string,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Age&nbsp;integer,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[Date]&nbsp;DateTime);<BR>技巧:<BR>&nbsp;&nbsp;&nbsp;&nbsp;自增字段用&nbsp;Counter&nbsp;声明.<BR>&nbsp;&nbsp;&nbsp;&nbsp;字段名为关键字的字段用方括号[]括起来,数字作为字段名也可行.</P>
<P>建立索引:<BR>&nbsp;&nbsp;&nbsp;&nbsp;下面的语句在Tab1的Date列上建立可重复索引<BR>&nbsp;&nbsp;&nbsp;&nbsp;Create&nbsp;Index&nbsp;iDate&nbsp;ON&nbsp;Tab1&nbsp;([Date]);<BR>&nbsp;&nbsp;&nbsp;&nbsp;完成后ACCESS中字段Date索引属性显示为&nbsp;-&nbsp;有(有重复).<BR>&nbsp;&nbsp;&nbsp;&nbsp;下面的语句在Tab1的Name列上建立不可重复索引<BR>&nbsp;&nbsp;&nbsp;&nbsp;Create&nbsp;Unique&nbsp;Index&nbsp;iName&nbsp;ON&nbsp;Tab1&nbsp;(Name);<BR>&nbsp;&nbsp;&nbsp;&nbsp;完成后ACCESS中字段Name索引属性显示为&nbsp;-&nbsp;有(无重复).<BR>&nbsp;&nbsp;&nbsp;&nbsp;下面的语句删除刚才建立的两个索引<BR>&nbsp;&nbsp;&nbsp;&nbsp;Drop&nbsp;Index&nbsp;iDate&nbsp;ON&nbsp;Tab1;<BR>&nbsp;&nbsp;&nbsp;&nbsp;Drop&nbsp;Index&nbsp;iName&nbsp;ON&nbsp;Tab1;</P>
<P>ACCESS与SQLSERVER中的UPDATE语句对比:<BR>&nbsp;&nbsp;&nbsp;&nbsp;SQLSERVER中更新多表的UPDATE语句:<BR>&nbsp;&nbsp;&nbsp;&nbsp;UPDATE&nbsp;Tab1<BR>&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;a.Name&nbsp;=&nbsp;b.Name<BR>&nbsp;&nbsp;&nbsp;&nbsp;FROM&nbsp;Tab1&nbsp;a,Tab2&nbsp;b<BR>&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;a.ID&nbsp;=&nbsp;b.ID;<BR>&nbsp;&nbsp;&nbsp;&nbsp;同样功能的SQL语句在ACCESS中应该是<BR>&nbsp;&nbsp;&nbsp;&nbsp;UPDATE&nbsp;Tab1&nbsp;a,Tab2&nbsp;b<BR>&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;a.Name&nbsp;=&nbsp;b.Name<BR>&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;a.ID&nbsp;=&nbsp;b.ID;<BR>即:ACCESS中的UPDATE语句没有FROM子句,所有引用的表都列在UPDATE关键字后.<BR>上例中如果Tab2可以不是一个表,而是一个查询,例:<BR>&nbsp;&nbsp;&nbsp;&nbsp;UPDATE&nbsp;Tab1&nbsp;a,(Select&nbsp;ID,Name&nbsp;From&nbsp;Tab2)&nbsp;b<BR>&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;a.Name&nbsp;=&nbsp;b.Name<BR>&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;a.ID&nbsp;=&nbsp;b.ID;</P>
<P>访问多个不同的ACCESS数据库-在SQL中使用In子句:<BR>&nbsp;&nbsp;&nbsp;&nbsp;Select&nbsp;a.*,b.*&nbsp;From&nbsp;Tab1&nbsp;a,Tab2&nbsp;b&nbsp;In&nbsp;'db2.mdb'&nbsp;Where&nbsp;a.ID=b.ID;<BR>&nbsp;&nbsp;&nbsp;&nbsp;上面的SQL语句查询出当前数据库中Tab1和db2.mdb(当前文件夹中)中Tab2以ID为关联的所有记录.<BR>缺点-外部数据库不能带密码.</P>
<P>在ACCESS中访问其它ODBC数据源<BR>下例在ACCESS中查询SQLSERVER中的数据<BR>&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;Tab1&nbsp;IN&nbsp;[ODBC]<BR>&nbsp;&nbsp;&nbsp;&nbsp;[ODBC;Driver=SQL&nbsp;Server;UID=sa;PWD=;Server=127.0.0.1;DataBase=Demo;]<BR>外部数据源连接属性的完整参数是:<BR>&nbsp;&nbsp;&nbsp;&nbsp;[ODBC;DRIVER=driver;SERVER=server;DATABASE=database;UID=user;PWD=password;]<BR>其中的DRIVER=driver可以在注册表中的<BR>&nbsp;&nbsp;&nbsp;&nbsp;HKEY_LOCAL_MACHINE\SOFTWARE\ODBC\ODBCINST.INI\<BR>中找到</P>
<P>ACCESS支持子查询</P>
<P>ACCESS支持外连接,但不包括完整外部联接,如支持<BR>&nbsp;&nbsp;&nbsp;&nbsp;LEFT&nbsp;JOIN&nbsp;或&nbsp;RIGHT&nbsp;JOIN<BR>但不支持<BR>&nbsp;&nbsp;&nbsp;&nbsp;FULL&nbsp;OUTER&nbsp;JOIN&nbsp;或&nbsp;FULL&nbsp;JOIN</P>
<P>ACCESS中的日期查询<BR>注意:ACCESS中的日期时间分隔符是#而不是引号<BR>&nbsp;&nbsp;&nbsp;&nbsp;Select&nbsp;*&nbsp;From&nbsp;Tab1&nbsp;Where&nbsp;[Date]&gt;#2002-1-1#;<BR>在DELPHI中我这样用<BR>&nbsp;&nbsp;&nbsp;&nbsp;SQL.Add(Format(<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'Select&nbsp;*&nbsp;From&nbsp;Tab1&nbsp;Where&nbsp;[Date]&gt;#%s#;',<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[DateToStr(Date)]));</P>
<P>ACCESS中的字符串可以用双引号分隔,但SQLSERVER不认,所以为了迁移方便和兼容,<BR>建议用单引号作为字符串分隔符</P></FONT>