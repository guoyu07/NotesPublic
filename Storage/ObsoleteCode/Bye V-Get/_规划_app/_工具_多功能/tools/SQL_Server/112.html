<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>编程细节</B><BR>1、触发器<BR>&nbsp;&nbsp;2、游标<BR>&nbsp;&nbsp;3、函数&nbsp;<BR>&nbsp;&nbsp;4、存储过程<BR>&nbsp;&nbsp;5、事务
<P></P>
<P>－－－－－－－－－－－－－－－－－－－－－<BR>作者：懒虫&nbsp;#&nbsp;SapphireStudio&nbsp;.&nbsp;<BR>欢迎访问我们的站点<IMG 
src="http://www.pigtwo.com/forum/pic/url.gif" align=absMiddle border=0><A href="http://www.chair3.com" 
target=_blank>www.chair3.com</A><BR>欢迎转载。<BR>－－－－－－－－－－－－－－－－－－－－</P>
<P>这里只打算讲解四部分了，也就最简单、最常用的四部分。</P>
<P>&nbsp;&nbsp;1、触发器。</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;定义：&nbsp;何为触发器？在SQL&nbsp;Server里面也就是对某一个表的一定的操作，触发某种条件，从而执行的一段程序。触发器是一个特殊的存储过程。<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;常见的触发器有三种：分别应用于Insert&nbsp;,&nbsp;Update&nbsp;,&nbsp;Delete&nbsp;事件。(SQL&nbsp;Server&nbsp;2000定义了新的触发器，这里不提）</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;我为什么要使用触发器？比如，这么两个表：</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Create&nbsp;Table&nbsp;Student(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--学生表<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StudentID&nbsp;int&nbsp;primary&nbsp;key,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--学号<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;....<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Create&nbsp;Table&nbsp;BorrowRecord(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--学生借书记录表<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BorrowRecord&nbsp;&nbsp;int&nbsp;identity(1,1),&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--流水号&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StudentID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--学号<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BorrowDate&nbsp;&nbsp;&nbsp;&nbsp;datetime,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--借出时间<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ReturnDAte&nbsp;&nbsp;&nbsp;&nbsp;Datetime,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--归还时间<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;用到的功能有:<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.如果我更改了学生的学号,我希望他的借书记录仍然与这个学生相关(也就是同时更改借书记录表的学号);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.如果该学生已经毕业，我希望删除他的学号的同时，也删除它的借书记录。<BR>&nbsp;&nbsp;&nbsp;&nbsp;等等。</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;这时候可以用到触发器。对于1，创建一个Update触发器：</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;Create&nbsp;Trigger&nbsp;truStudent<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;On&nbsp;Student<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;Update<BR>&nbsp;&nbsp;&nbsp;&nbsp;-------------------------------------------------------<BR>&nbsp;&nbsp;&nbsp;&nbsp;--Name:truStudent<BR>&nbsp;&nbsp;&nbsp;&nbsp;--func:更新BorrowRecord&nbsp;的StudentID，与Student同步。<BR>&nbsp;&nbsp;&nbsp;&nbsp;--Use&nbsp;:None<BR>&nbsp;&nbsp;&nbsp;&nbsp;--User:System<BR>&nbsp;&nbsp;&nbsp;&nbsp;--Author:&nbsp;&nbsp;懒虫&nbsp;#&nbsp;SapphireStudio&nbsp;(www.chair3.com)<BR>&nbsp;&nbsp;&nbsp;&nbsp;--Date&nbsp;&nbsp;:&nbsp;&nbsp;2003-4-16<BR>&nbsp;&nbsp;&nbsp;&nbsp;--Memo&nbsp;&nbsp;:&nbsp;&nbsp;临时写写的，给大家作个Sample。没有调试阿。<BR>&nbsp;&nbsp;&nbsp;&nbsp;-------------------------------------------------------<BR>&nbsp;&nbsp;&nbsp;&nbsp;As<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;Update(StudentID)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;begin</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Update&nbsp;BorrowRecord&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set&nbsp;br.StudentID=i.StudentID<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;From&nbsp;BorrowRecord&nbsp;br&nbsp;,&nbsp;Deleted&nbsp;&nbsp;d&nbsp;,Inserted&nbsp;i&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Where&nbsp;br.StudentID=d.StudentID</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;理解触发器里面的两个临时的表：Deleted&nbsp;,&nbsp;Inserted&nbsp;。注意Deleted&nbsp;与Inserted分别表示触发事件的表“旧的一条记录”和“新的一条记录”。<BR>&nbsp;&nbsp;&nbsp;&nbsp;一个Update&nbsp;的过程可以看作为：生成新的记录到Inserted表，复制旧的记录到Deleted表，然后删除Student记录并写入新纪录。</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;对于2，创建一个Delete触发器<BR>&nbsp;&nbsp;&nbsp;&nbsp;Create&nbsp;trigger&nbsp;trdStudent<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;On&nbsp;Student<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;Delete<BR>&nbsp;&nbsp;&nbsp;&nbsp;-------------------------------------------------------<BR>&nbsp;&nbsp;&nbsp;&nbsp;--Name:trdStudent<BR>&nbsp;&nbsp;&nbsp;&nbsp;--func:同时删除&nbsp;BorrowRecord&nbsp;的数据<BR>&nbsp;&nbsp;&nbsp;&nbsp;--Use&nbsp;:None<BR>&nbsp;&nbsp;&nbsp;&nbsp;--User:System<BR>&nbsp;&nbsp;&nbsp;&nbsp;--Author:&nbsp;&nbsp;懒虫&nbsp;#&nbsp;SapphireStudio&nbsp;(www.chair3.com)<BR>&nbsp;&nbsp;&nbsp;&nbsp;--Date&nbsp;&nbsp;:&nbsp;&nbsp;2003-4-16<BR>&nbsp;&nbsp;&nbsp;&nbsp;--Memo&nbsp;&nbsp;:&nbsp;&nbsp;临时写写的，给大家作个Sample。没有调试阿。<BR>&nbsp;&nbsp;&nbsp;&nbsp;-------------------------------------------------------<BR>&nbsp;&nbsp;&nbsp;&nbsp;As<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Delete&nbsp;BorrowRecord&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;From&nbsp;BorrowRecord&nbsp;br&nbsp;,&nbsp;Delted&nbsp;d<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Where&nbsp;br.StudentID=d.StudentID</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;从这两个例子我们可以看到了触发器的关键：A.2个临时的表；B.触发机制。<BR>&nbsp;&nbsp;&nbsp;&nbsp;这里我们只讲解最简单的触发器。复杂的容后说明。<BR>&nbsp;&nbsp;&nbsp;&nbsp;事实上，我不鼓励使用触发器。触发器的初始设计思想，已经被“级联”所替代。</P>
<P><BR>&nbsp;&nbsp;2.游标<BR>&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;在SQL&nbsp;2000之前，游标可谓是SQL&nbsp;Server心中的痛：&nbsp;老牛般的速度（CPU），河马般的胃口（内存）。可你却不能不用他。<BR>&nbsp;&nbsp;&nbsp;&nbsp;什么叫游标呢？说白了就是像高级语言一样，是存放数据集，并逐条访问的一种机制。<BR>&nbsp;&nbsp;&nbsp;&nbsp;比如在Delphi里面，要实现类似于这样的功能：（呵呵，不好意思，我只会Delphi，所以只能举一个Delphi的例子）<BR>&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;//这是一段Delphi的源代码<BR>&nbsp;&nbsp;&nbsp;&nbsp;adoDataSet1.Close;<BR>&nbsp;&nbsp;&nbsp;&nbsp;adoDataSet1.CommandText:='&nbsp;Select&nbsp;*&nbsp;From&nbsp;Student&nbsp;order&nbsp;by&nbsp;StudentID&nbsp;';<BR>&nbsp;&nbsp;&nbsp;&nbsp;adoDataSet1.Open;<BR>&nbsp;&nbsp;&nbsp;&nbsp;While&nbsp;Not&nbsp;adoDAtaSet1.Eof&nbsp;Do<BR>&nbsp;&nbsp;&nbsp;&nbsp;Begin<BR>&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;YourVar:=adoDAtaSet1.FieldByName('StudentID').AsInteger;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DoSomeThing();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;....&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;adoDataSet1.Next;<BR>&nbsp;&nbsp;&nbsp;&nbsp;End<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;在SQL&nbsp;Server&nbsp;并没有很好的数据逐条访问机制，如果有，那就是游标。</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;还是举例子：</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;对于表</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Create&nbsp;Table&nbsp;BorrowRecord(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--学生借书记录表<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BorrowRecord&nbsp;&nbsp;int&nbsp;identity(1,1),&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--流水号&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StudentID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--学号<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StudentFeeID&nbsp;&nbsp;int&nbsp;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--费用结算号&nbsp;&nbsp;&nbsp;（外键）<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BorrowDate&nbsp;&nbsp;&nbsp;&nbsp;datetime,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--借出时间<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ReturnDAte&nbsp;&nbsp;&nbsp;&nbsp;Datetime,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--归还时间<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fee&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Money&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--借书费用&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Create&nbsp;Table&nbsp;StudentFee(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--学生费用结算表<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StudentFeeID&nbsp;&nbsp;int&nbsp;&nbsp;primarykey&nbsp;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--费用结算号&nbsp;&nbsp;&nbsp;（主键）<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StudentID&nbsp;int&nbsp;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--学号<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BorrowBookAllFee&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Money,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--所有借书总费用&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;两者关系为多对一的关系，关联字段为StudentFeeID</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;由于某种原因StudentFee表的数据遭到了破坏，我想StudentFee循环一遍将“所有借书总费用”重算&nbsp;。</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;-----------------------------------------------------------------------<BR>&nbsp;&nbsp;&nbsp;&nbsp;-------------------------------------------------------<BR>&nbsp;&nbsp;&nbsp;&nbsp;--Name:一部分代码<BR>&nbsp;&nbsp;&nbsp;&nbsp;--func:更新学生借书总费用<BR>&nbsp;&nbsp;&nbsp;&nbsp;--Use&nbsp;:<BR>&nbsp;&nbsp;&nbsp;&nbsp;--User:<BR>&nbsp;&nbsp;&nbsp;&nbsp;--Author:&nbsp;&nbsp;懒虫&nbsp;#&nbsp;SapphireStudio&nbsp;(www.chair3.com)<BR>&nbsp;&nbsp;&nbsp;&nbsp;--Date&nbsp;&nbsp;:&nbsp;&nbsp;2003-4-16<BR>&nbsp;&nbsp;&nbsp;&nbsp;--Memo&nbsp;&nbsp;:&nbsp;&nbsp;临时写写的，给大家作个Sample。没有调试阿。<BR>&nbsp;&nbsp;&nbsp;&nbsp;-------------------------------------------------------</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--声明一个游标<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Declare&nbsp;curStudentFee&nbsp;Cursor<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Select&nbsp;StudentFeeID&nbsp;From&nbsp;StudentFee&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--声明两个费用变量<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Declare&nbsp;@mBorrowBookAllFee&nbsp;Money&nbsp;&nbsp;--总费用<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Declare&nbsp;@iStudentFeeID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Int&nbsp;&nbsp;&nbsp;&nbsp;--借书结算号</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--初始化&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set&nbsp;@mBorrowBookAllFee=0<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set&nbsp;@iStudentFeeID=0</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--打开游标<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Open&nbsp;curStudentFee&nbsp;&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--循环并提取记录<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fetch&nbsp;Next&nbsp;From&nbsp;curStudentFee&nbsp;Into&nbsp;@iStudentFeeID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;While&nbsp;(&nbsp;@@Fetch_Status=0&nbsp;)&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;begin</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--从借书记录中计算某一学生的借书总记录的总费用<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Select&nbsp;@mBorrowBookAllFee=Sum(BorrowBookAllFee)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;From&nbsp;BorrowRecord&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Where&nbsp;StudentFeeID=@iStudentFeeID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--更新到汇总表。<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Update&nbsp;StudentFee&nbsp;Set&nbsp;BorrowBookAllFee=@mBorrowBookAllFee<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Where&nbsp;StudentFeeID=@iStudnetFeeID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fetch&nbsp;Next&nbsp;From&nbsp;curStudentFee&nbsp;Into&nbsp;@mFee<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--关闭游标&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Close&nbsp;curStudentFee</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--释放游标<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Deallocate&nbsp;curStudentFee&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;-----------------------------------------------------------------------<BR>&nbsp;&nbsp;&nbsp;&nbsp;关注游标的要点：1、声明、打开、关闭、释放&nbsp;；&nbsp;2、@@Fetch_Status&nbsp;游标提取状态标志，0表示正确</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;这里，我也要提到，我不鼓励使用游标。更多的情况下，在SQL&nbsp;2000&nbsp;里面&nbsp;，函数已经能够实现绝大部分游标的功能。<BR>&nbsp;&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;好累，好不容易算是将1、2点讲完，算是上部分把。后面的几点等会再说了……：（：（。</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;大家给点鼓励？</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;懒虫&nbsp;#&nbsp;SapphireStudio&nbsp;，精彩世界，尽在&nbsp;3腿网&nbsp;（&nbsp;<IMG 
src="http://www.pigtwo.com/forum/pic/url.gif" align=absMiddle border=0><A href="http://www.chair3.com" 
target=_blank>www.chair3.com</A>&nbsp;）。<BR></P></FONT>