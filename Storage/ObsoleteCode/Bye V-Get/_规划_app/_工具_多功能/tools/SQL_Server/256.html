<meta http-equiv="content-type" content="text/html; charset=gb2312">&nbsp;<FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>SQL语句实现横排？</B><BR>有一个表：&nbsp;&nbsp;<BR>BH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GZLB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JE&nbsp;&nbsp;<BR>----------------------&nbsp;&nbsp;<BR>001&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;100&nbsp;&nbsp;<BR>001&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;150&nbsp;&nbsp;<BR>001&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;110&nbsp;&nbsp;<BR>002&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;99&nbsp;&nbsp;<BR>002&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;180&nbsp;&nbsp;<BR>002&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;150&nbsp;&nbsp;<BR>003&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;160&nbsp;&nbsp;<BR>003&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;170&nbsp;&nbsp;<BR>003&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;130&nbsp;&nbsp;<BR>用SQL语句如何将上面的表变成下面横向的排列方式呢。&nbsp;&nbsp;<BR>BH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C&nbsp;&nbsp;<BR>-------------------&nbsp;&nbsp;<BR>001&nbsp;&nbsp;&nbsp;&nbsp;100&nbsp;&nbsp;&nbsp;&nbsp;150&nbsp;&nbsp;110&nbsp;&nbsp;<BR>002&nbsp;&nbsp;&nbsp;&nbsp;99&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;180&nbsp;&nbsp;150&nbsp;&nbsp;<BR>003&nbsp;&nbsp;&nbsp;&nbsp;160&nbsp;&nbsp;&nbsp;&nbsp;170&nbsp;&nbsp;130&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>（GZLB&nbsp;&nbsp;里面的字段是动态的，不是只有A,B,C&nbsp;&nbsp;可能还有A,B,C,D,E...）&nbsp;&nbsp;<BR>&nbsp;<BR>---------------------------------------------------------------&nbsp;&nbsp;<BR>&nbsp;<BR>if&nbsp;&nbsp;exists(select&nbsp;&nbsp;name&nbsp;&nbsp;from&nbsp;&nbsp;sysobjects&nbsp;&nbsp;where&nbsp;&nbsp;name='tblA'&nbsp;&nbsp;and&nbsp;&nbsp;xtype='U')&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drop&nbsp;&nbsp;table&nbsp;&nbsp;tblA&nbsp;&nbsp;<BR>&nbsp;<BR>create&nbsp;&nbsp;table&nbsp;&nbsp;tblA(&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;BH&nbsp;&nbsp;char(3)&nbsp;&nbsp;not&nbsp;&nbsp;null,&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;GZLB&nbsp;&nbsp;varchar(3)&nbsp;&nbsp;not&nbsp;&nbsp;null,&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;JE&nbsp;&nbsp;int&nbsp;&nbsp;not&nbsp;&nbsp;null&nbsp;&nbsp;<BR>)&nbsp;&nbsp;<BR>go&nbsp;&nbsp;<BR>&nbsp;<BR>insert&nbsp;&nbsp;tblA&nbsp;&nbsp;values('001',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'A',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;100)&nbsp;&nbsp;<BR>insert&nbsp;&nbsp;tblA&nbsp;&nbsp;values('001',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'B',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;150)&nbsp;&nbsp;<BR>insert&nbsp;&nbsp;tblA&nbsp;&nbsp;values('001',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'C',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;110)&nbsp;&nbsp;<BR>insert&nbsp;&nbsp;tblA&nbsp;&nbsp;values('002',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'A',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;99)&nbsp;&nbsp;<BR>insert&nbsp;&nbsp;tblA&nbsp;&nbsp;values('002',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'B',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;180)&nbsp;&nbsp;<BR>insert&nbsp;&nbsp;tblA&nbsp;&nbsp;values('002',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'C',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;150)&nbsp;&nbsp;<BR>insert&nbsp;&nbsp;tblA&nbsp;&nbsp;values('003',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'A',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;160)&nbsp;&nbsp;<BR>insert&nbsp;&nbsp;tblA&nbsp;&nbsp;values('003',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'B',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;170)&nbsp;&nbsp;<BR>insert&nbsp;&nbsp;tblA&nbsp;&nbsp;values('003',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'C',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;130)&nbsp;&nbsp;<BR>&nbsp;<BR>&nbsp;&nbsp;&nbsp;declare&nbsp;&nbsp;@sql&nbsp;&nbsp;varchar(600)&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;set&nbsp;&nbsp;@sql&nbsp;&nbsp;=&nbsp;&nbsp;'select'&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;select&nbsp;&nbsp;distinct&nbsp;&nbsp;GZLB&nbsp;&nbsp;as&nbsp;&nbsp;'GZLB'&nbsp;&nbsp;into&nbsp;&nbsp;tmp&nbsp;&nbsp;from&nbsp;&nbsp;tblA&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;select&nbsp;&nbsp;@sql&nbsp;&nbsp;=&nbsp;&nbsp;@sql&nbsp;&nbsp;+'&nbsp;&nbsp;max(case&nbsp;&nbsp;GZLB&nbsp;&nbsp;when&nbsp;&nbsp;'''+&nbsp;&nbsp;GZLB&nbsp;&nbsp;+'''&nbsp;&nbsp;then&nbsp;&nbsp;JE&nbsp;&nbsp;else&nbsp;&nbsp;null&nbsp;&nbsp;end)&nbsp;&nbsp;as&nbsp;&nbsp;'''+&nbsp;&nbsp;GZLB&nbsp;&nbsp;+''','&nbsp;&nbsp;from&nbsp;&nbsp;tmp&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;set&nbsp;&nbsp;@sql&nbsp;&nbsp;=&nbsp;&nbsp;substring(@sql,&nbsp;&nbsp;1,&nbsp;&nbsp;len(@sql)-1)&nbsp;&nbsp;+'&nbsp;&nbsp;from&nbsp;&nbsp;tblA&nbsp;&nbsp;group&nbsp;&nbsp;by&nbsp;&nbsp;BH'&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;exec(@sql)&nbsp;&nbsp;<BR>---------------------------------------------------------------&nbsp;&nbsp;<BR>&nbsp;<BR>用游标&nbsp;&nbsp;<BR>declare&nbsp;&nbsp;@sqlstr&nbsp;&nbsp;varchar(2000)&nbsp;&nbsp;<BR>declare&nbsp;&nbsp;@gzlb&nbsp;&nbsp;<BR>select&nbsp;&nbsp;sqlstr='select&nbsp;&nbsp;bh'&nbsp;&nbsp;<BR>declare&nbsp;&nbsp;cgzlb&nbsp;&nbsp;cursor&nbsp;&nbsp;for&nbsp;&nbsp;select&nbsp;&nbsp;gzlb&nbsp;&nbsp;from&nbsp;&nbsp;table&nbsp;&nbsp;<BR>create&nbsp;&nbsp;table&nbsp;&nbsp;#a&nbsp;&nbsp;<BR>(bh&nbsp;&nbsp;char(3))&nbsp;&nbsp;<BR>open&nbsp;&nbsp;cgzlb&nbsp;&nbsp;<BR>fetch&nbsp;&nbsp;next&nbsp;&nbsp;from&nbsp;&nbsp;cgzlb&nbsp;&nbsp;into&nbsp;&nbsp;@gzlb&nbsp;&nbsp;<BR>while&nbsp;&nbsp;(fetch_status&lt;&gt;-1)&nbsp;&nbsp;<BR>begin&nbsp;&nbsp;<BR>exec('alter&nbsp;&nbsp;table&nbsp;&nbsp;#a&nbsp;&nbsp;add&nbsp;&nbsp;'+@gzlb&nbsp;&nbsp;+'&nbsp;&nbsp;char(1)')&nbsp;&nbsp;<BR>exec('insert&nbsp;&nbsp;into&nbsp;&nbsp;#a&nbsp;&nbsp;(bh,'+@gzlb+'&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;&nbsp;bh,je&nbsp;&nbsp;from&nbsp;&nbsp;table&nbsp;&nbsp;where&nbsp;&nbsp;gzlb='''+@gzlb+'''')&nbsp;&nbsp;<BR>select&nbsp;&nbsp;@sqlstr=@sqlstr+',sum(isnull('+@gzlb+'))'&nbsp;&nbsp;<BR>&nbsp;<BR>&nbsp;<BR>fetch&nbsp;&nbsp;next&nbsp;&nbsp;from&nbsp;&nbsp;cgzlb&nbsp;&nbsp;into&nbsp;&nbsp;@gzlb&nbsp;&nbsp;<BR>end&nbsp;&nbsp;&nbsp;&nbsp;<BR>close&nbsp;&nbsp;cgzlb&nbsp;&nbsp;<BR>deallocate&nbsp;&nbsp;cgzlb&nbsp;&nbsp;<BR>select&nbsp;&nbsp;@sqlstr=@sqlstr+'&nbsp;&nbsp;from&nbsp;&nbsp;#a&nbsp;&nbsp;group&nbsp;&nbsp;by&nbsp;&nbsp;bh&nbsp;&nbsp;order&nbsp;&nbsp;by&nbsp;&nbsp;bh&nbsp;&nbsp;<BR>execute(@sqlstr)&nbsp;&nbsp;<BR>&nbsp;<BR>---------------------------------------------------------------&nbsp;&nbsp;<BR>&nbsp;<BR>declare&nbsp;&nbsp;@sql&nbsp;&nbsp;varchar(6000)&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;set&nbsp;&nbsp;@sql&nbsp;&nbsp;=&nbsp;&nbsp;'select&nbsp;&nbsp;'&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;select&nbsp;&nbsp;@sql&nbsp;&nbsp;=&nbsp;&nbsp;@sql&nbsp;&nbsp;+'&nbsp;&nbsp;sum(case&nbsp;&nbsp;GZLB&nbsp;&nbsp;when&nbsp;&nbsp;'''+&nbsp;&nbsp;GZLB&nbsp;&nbsp;+'''&nbsp;&nbsp;then&nbsp;&nbsp;JE&nbsp;&nbsp;else&nbsp;&nbsp;null&nbsp;&nbsp;end)&nbsp;&nbsp;['+&nbsp;&nbsp;GZLB&nbsp;&nbsp;+'],'&nbsp;&nbsp;from&nbsp;&nbsp;(select&nbsp;&nbsp;distinct&nbsp;&nbsp;GZLB&nbsp;&nbsp;as&nbsp;&nbsp;GZLB&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;&nbsp;tblA)&nbsp;&nbsp;tmp&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;set&nbsp;&nbsp;@sql&nbsp;&nbsp;=&nbsp;&nbsp;substring(@sql,&nbsp;&nbsp;1,&nbsp;&nbsp;len(@sql)-1)&nbsp;&nbsp;+'&nbsp;&nbsp;from&nbsp;&nbsp;tblA&nbsp;&nbsp;group&nbsp;&nbsp;by&nbsp;&nbsp;BH'&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;exec(@sql)&nbsp;&nbsp;<BR></FONT>