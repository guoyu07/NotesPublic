<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>ExportToWord</B><BR>Version:&nbsp;SQL&nbsp;Server&nbsp;7.0/2000<BR>Created&nbsp;by:&nbsp;Alexander&nbsp;Chigrik<BR><IMG 
src="http://www.pigtwo.com/forum/pic/url.gif" align=absMiddle border=0><A href="http://www.MSSQLCity.com/" 
target=_blank>http://www.MSSQLCity.com/</A>&nbsp;-&nbsp;all&nbsp;about&nbsp;MS&nbsp;SQL<BR>(SQL&nbsp;Server&nbsp;Articles,&nbsp;FAQ,&nbsp;Scripts,&nbsp;Tips&nbsp;and&nbsp;Test&nbsp;Exams).
<P></P>
<P>This&nbsp;stored&nbsp;procedure&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;export&nbsp;the&nbsp;text&nbsp;string&nbsp;into<BR>Microsoft&nbsp;Word.&nbsp;You&nbsp;can&nbsp;pass&nbsp;the&nbsp;text&nbsp;string&nbsp;and&nbsp;the&nbsp;file&nbsp;name<BR>(if&nbsp;the&nbsp;file&nbsp;name&nbsp;was&nbsp;not&nbsp;specified,&nbsp;the&nbsp;c:\ImportToWord.doc<BR>will&nbsp;be&nbsp;used)&nbsp;into&nbsp;this&nbsp;stored&nbsp;procedure,&nbsp;as&nbsp;in&nbsp;the&nbsp;example&nbsp;below:</P>
<P>EXEC&nbsp;ExportToWord&nbsp;@Text&nbsp;=&nbsp;'Test&nbsp;example',<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@filename&nbsp;=&nbsp;'c:\ImportToWord.doc'</P>
<P><BR>This&nbsp;stored&nbsp;procedure&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;export&nbsp;the&nbsp;text&nbsp;string&nbsp;into&nbsp;<BR>Microsoft&nbsp;Word.&nbsp;You&nbsp;can&nbsp;pass&nbsp;the&nbsp;text&nbsp;string&nbsp;and&nbsp;the&nbsp;file&nbsp;name&nbsp;<BR>(if&nbsp;the&nbsp;file&nbsp;name&nbsp;was&nbsp;not&nbsp;specified,&nbsp;the&nbsp;c:\ImportToWord.doc&nbsp;<BR>will&nbsp;be&nbsp;used)&nbsp;into&nbsp;this&nbsp;stored&nbsp;procedure,&nbsp;as&nbsp;in&nbsp;the&nbsp;example&nbsp;below:</P>
<P>EXEC&nbsp;ExportToWord&nbsp;@Text&nbsp;=&nbsp;'Test&nbsp;example',<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@filename&nbsp;=&nbsp;'c:\ImportToWord.doc'<BR>*/</P>
<P>IF&nbsp;OBJECT_ID('ExportToWord')&nbsp;IS&nbsp;NOT&nbsp;NULL&nbsp;DROP&nbsp;PROC&nbsp;ExportToWord<BR>GO</P>
<P>CREATE&nbsp;PROCEDURE&nbsp;ExportToWord&nbsp;(<BR>&nbsp;&nbsp;@Text&nbsp;varchar(200)&nbsp;=&nbsp;null,<BR>&nbsp;&nbsp;@filename&nbsp;varchar(200)&nbsp;=&nbsp;'c:\ImportToWord.doc'<BR>)<BR>AS<BR>DECLARE&nbsp;@object&nbsp;int,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Range&nbsp;int,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Documents&nbsp;int,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Document&nbsp;int,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@hr&nbsp;int,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@result_str&nbsp;varchar(255)</P>
<P>IF&nbsp;@Text&nbsp;IS&nbsp;NULL&nbsp;<BR>&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;PRINT&nbsp;'You&nbsp;should&nbsp;write&nbsp;text'<BR>&nbsp;&nbsp;&nbsp;&nbsp;RETURN<BR>&nbsp;&nbsp;END</P>
<P>SET&nbsp;NOCOUNT&nbsp;ON</P>
<P>EXEC&nbsp;@hr&nbsp;=&nbsp;sp_OACreate&nbsp;'Word.Application',&nbsp;@object&nbsp;OUT<BR>IF&nbsp;@hr&nbsp;&lt;&gt;&nbsp;0<BR>BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;PRINT&nbsp;'error&nbsp;create&nbsp;Word.Application'<BR>&nbsp;&nbsp;&nbsp;&nbsp;RETURN<BR>END</P>
<P>EXEC&nbsp;@hr&nbsp;=&nbsp;sp_OAGetProperty&nbsp;@object,&nbsp;'Documents',&nbsp;@Documents&nbsp;OUT<BR>IF&nbsp;@hr&nbsp;&lt;&gt;&nbsp;0<BR>BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;PRINT&nbsp;'error&nbsp;create&nbsp;Documents'<BR>&nbsp;&nbsp;&nbsp;&nbsp;RETURN<BR>END</P>
<P>EXEC&nbsp;@hr&nbsp;=&nbsp;sp_OAMethod&nbsp;@Documents,&nbsp;'Add',&nbsp;@Document&nbsp;OUT<BR>IF&nbsp;@hr&nbsp;&lt;&gt;&nbsp;0<BR>BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;PRINT&nbsp;'error&nbsp;with&nbsp;method&nbsp;Add'<BR>&nbsp;&nbsp;&nbsp;&nbsp;RETURN<BR>END</P>
<P>EXEC&nbsp;@hr&nbsp;=&nbsp;sp_OAGetProperty&nbsp;@Document,&nbsp;'Range',&nbsp;@Range&nbsp;OUT<BR>IF&nbsp;@hr&nbsp;&lt;&gt;&nbsp;0<BR>BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;PRINT&nbsp;'error&nbsp;create&nbsp;Range'<BR>&nbsp;&nbsp;&nbsp;&nbsp;RETURN<BR>END</P>
<P>EXEC&nbsp;@hr&nbsp;=&nbsp;sp_OASetProperty&nbsp;@Range,&nbsp;'Text',&nbsp;@Text<BR>IF&nbsp;@hr&nbsp;&lt;&gt;&nbsp;0<BR>BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;PRINT&nbsp;'error&nbsp;set&nbsp;Text'<BR>&nbsp;&nbsp;&nbsp;&nbsp;RETURN<BR>END</P>
<P>SELECT&nbsp;@result_str&nbsp;=&nbsp;'SaveAs("'&nbsp;+&nbsp;@filename&nbsp;+&nbsp;'")'<BR>EXEC&nbsp;@hr&nbsp;=&nbsp;sp_OAMethod&nbsp;@Document,&nbsp;@result_str<BR>IF&nbsp;@hr&nbsp;&lt;&gt;&nbsp;0<BR>BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;PRINT&nbsp;'error&nbsp;with&nbsp;method&nbsp;SaveAs'<BR>&nbsp;&nbsp;&nbsp;&nbsp;RETURN<BR>END</P>
<P>EXEC&nbsp;@hr&nbsp;=&nbsp;sp_OAMethod&nbsp;@Documents,&nbsp;'Close'<BR>IF&nbsp;@hr&nbsp;&lt;&gt;&nbsp;0<BR>BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;PRINT&nbsp;'error&nbsp;with&nbsp;method&nbsp;Close'<BR>&nbsp;&nbsp;&nbsp;&nbsp;RETURN<BR>END</P>
<P>EXEC&nbsp;@hr&nbsp;=&nbsp;sp_OADestroy&nbsp;@object<BR>IF&nbsp;@hr&nbsp;&lt;&gt;&nbsp;0<BR>BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;PRINT&nbsp;'error&nbsp;destroy&nbsp;Word.Application'<BR>&nbsp;&nbsp;&nbsp;&nbsp;RETURN<BR>END<BR>GO<BR></P></FONT>