<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>Loop&nbsp;without&nbsp;using&nbsp;a&nbsp;cursor</B><BR>Loop&nbsp;through&nbsp;records&nbsp;without&nbsp;using&nbsp;a&nbsp;cursor<BR>Script&nbsp;Rating&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Total&nbsp;number&nbsp;of&nbsp;votes&nbsp;[74]&nbsp;<BR>By:&nbsp;David.Poole&nbsp;<BR>I&nbsp;sometimes&nbsp;have&nbsp;to&nbsp;loop&nbsp;through&nbsp;records&nbsp;in&nbsp;a&nbsp;database&nbsp;and&nbsp;perform&nbsp;a&nbsp;specific&nbsp;action&nbsp;on&nbsp;the&nbsp;value&nbsp;that&nbsp;is&nbsp;returned.&nbsp;For&nbsp;example,&nbsp;In&nbsp;the&nbsp;script&nbsp;below&nbsp;I&nbsp;loop&nbsp;through&nbsp;the&nbsp;user&nbsp;tables&nbsp;in&nbsp;sysobjects&nbsp;and&nbsp;simply&nbsp;print&nbsp;them&nbsp;out.&nbsp;This&nbsp;technique&nbsp;is&nbsp;useful&nbsp;when&nbsp;dropping&nbsp;all&nbsp;indices/triggers&nbsp;on&nbsp;a&nbsp;particular&nbsp;table,&nbsp;or&nbsp;adding&nbsp;WITH&nbsp;ENCRYPTION&nbsp;to&nbsp;stored&nbsp;procedures&nbsp;on&nbsp;a&nbsp;live&nbsp;server.&nbsp;Another&nbsp;use&nbsp;is&nbsp;on&nbsp;development&nbsp;servers&nbsp;where&nbsp;the&nbsp;table&nbsp;structure&nbsp;changes&nbsp;and&nbsp;you&nbsp;want&nbsp;to&nbsp;recompile&nbsp;all&nbsp;stored&nbsp;procedures&nbsp;and&nbsp;refresh&nbsp;all&nbsp;views.&nbsp;
<P></P>
<P>DECLARE&nbsp;@objName&nbsp;VARCHAR(50)<BR>SET&nbsp;@objName&nbsp;=&nbsp;''</P>
<P>WHILE&nbsp;@objName&nbsp;IS&nbsp;NOT&nbsp;NULL<BR>&nbsp;BEGIN<BR>&nbsp;&nbsp;SELECT&nbsp;@objName&nbsp;=&nbsp;MIN(&nbsp;Name&nbsp;)<BR>&nbsp;&nbsp;FROM&nbsp;SysObjects<BR>&nbsp;&nbsp;WHERE&nbsp;Type='U'&nbsp;AND<BR>&nbsp;&nbsp;&nbsp;Name&nbsp;&gt;&nbsp;@objName</P>
<P>&nbsp;&nbsp;IF&nbsp;@objName&nbsp;IS&nbsp;NOT&nbsp;NULL<BR>&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Insert&nbsp;code&nbsp;to&nbsp;do&nbsp;stuff&nbsp;here.<BR>&nbsp;&nbsp;&nbsp;&nbsp;PRINT&nbsp;&nbsp;@objName&nbsp;<BR>&nbsp;&nbsp;&nbsp;END<BR>&nbsp;END</P>
<P><BR>*&nbsp;*&nbsp;*<BR>Example&nbsp;to&nbsp;recompile&nbsp;all&nbsp;stored&nbsp;procs&nbsp;and&nbsp;refresh&nbsp;all&nbsp;views.</P>
<P>DECLARE&nbsp;@objName&nbsp;VARCHAR(50)<BR>SET&nbsp;@objName&nbsp;=&nbsp;''</P>
<P>WHILE&nbsp;@objName&nbsp;IS&nbsp;NOT&nbsp;NULL<BR>&nbsp;BEGIN<BR>&nbsp;&nbsp;SELECT&nbsp;@objName&nbsp;=&nbsp;MIN(&nbsp;Name&nbsp;)<BR>&nbsp;&nbsp;FROM&nbsp;SysObjects<BR>&nbsp;&nbsp;WHERE&nbsp;Type='V'&nbsp;AND<BR>&nbsp;&nbsp;&nbsp;Name&nbsp;&gt;&nbsp;@objName</P>
<P>&nbsp;&nbsp;IF&nbsp;@objName&nbsp;IS&nbsp;NOT&nbsp;NULL<BR>&nbsp;&nbsp;&nbsp;&nbsp;exec&nbsp;sp_refreshview&nbsp;@objName&nbsp;&nbsp;END<BR>SET&nbsp;@objName&nbsp;=&nbsp;''</P>
<P>WHILE&nbsp;@objName&nbsp;IS&nbsp;NOT&nbsp;NULL<BR>&nbsp;BEGIN<BR>&nbsp;&nbsp;SELECT&nbsp;@objName&nbsp;=&nbsp;MIN(&nbsp;Name&nbsp;)<BR>&nbsp;&nbsp;FROM&nbsp;SysObjects<BR>&nbsp;&nbsp;WHERE&nbsp;Type='U'&nbsp;AND<BR>&nbsp;&nbsp;&nbsp;Name&nbsp;&gt;&nbsp;@objName</P>
<P>&nbsp;&nbsp;IF&nbsp;@objName&nbsp;IS&nbsp;NOT&nbsp;NULL<BR>&nbsp;&nbsp;&nbsp;&nbsp;exec&nbsp;sp_recompile&nbsp;@objName&nbsp;&nbsp;END</P></FONT>