<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>some&nbsp;useful&nbsp;udf&nbsp;for&nbsp;sqlserver2000</B><BR>Introduction<BR>SQL&nbsp;Server&nbsp;2000&nbsp;supports&nbsp;User-Defined&nbsp;Functions&nbsp;(UDFs)&nbsp;-&nbsp;one&nbsp;or&nbsp;more<BR>Transact-SQL&nbsp;statements&nbsp;that&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;encapsulate&nbsp;code&nbsp;for&nbsp;reuse.<BR>User-defined&nbsp;functions&nbsp;cannot&nbsp;make&nbsp;a&nbsp;permanent&nbsp;changes&nbsp;to&nbsp;the&nbsp;data&nbsp;or<BR>modify&nbsp;database&nbsp;tables.&nbsp;UDF&nbsp;can&nbsp;change&nbsp;only&nbsp;local&nbsp;objects&nbsp;for&nbsp;this&nbsp;UDF,<BR>such&nbsp;as&nbsp;local&nbsp;cursors&nbsp;or&nbsp;variables.
<P></P>
<P>There&nbsp;are&nbsp;three&nbsp;types&nbsp;of&nbsp;UDF&nbsp;in&nbsp;SQL&nbsp;Server&nbsp;2000:</P>
<P>Scalar&nbsp;functions<BR>Inline&nbsp;table-valued&nbsp;functions<BR>Multistatement&nbsp;table-valued&nbsp;functions</P>
<P>Scalar&nbsp;functions&nbsp;return&nbsp;a&nbsp;single&nbsp;data&nbsp;value&nbsp;(not&nbsp;a&nbsp;table)<BR>with&nbsp;RETURNS&nbsp;clause.&nbsp;Scalar&nbsp;functions&nbsp;can&nbsp;use&nbsp;all&nbsp;scalar<BR>data&nbsp;types,&nbsp;with&nbsp;exception&nbsp;of&nbsp;timestamp&nbsp;and&nbsp;user-defined&nbsp;data&nbsp;types.</P>
<P>Inline&nbsp;table-valued&nbsp;functions&nbsp;return&nbsp;the&nbsp;result&nbsp;set&nbsp;of&nbsp;a&nbsp;single<BR>SELECT&nbsp;statement.</P>
<P>Multistatement&nbsp;table-valued&nbsp;functions&nbsp;return&nbsp;a&nbsp;table,&nbsp;which&nbsp;was<BR>built&nbsp;with&nbsp;many&nbsp;TRANSACT-SQL&nbsp;statements.</P>
<P>User-defined&nbsp;functions&nbsp;can&nbsp;be&nbsp;invoked&nbsp;from&nbsp;a&nbsp;query&nbsp;like&nbsp;built-in<BR>functions&nbsp;such&nbsp;as&nbsp;OBJECT_ID,&nbsp;LEN,&nbsp;DATEDIFF,&nbsp;or&nbsp;can&nbsp;be&nbsp;executed<BR>through&nbsp;an&nbsp;EXECUTE&nbsp;statement&nbsp;like&nbsp;stored&nbsp;procedures.</P>
<P>UDF&nbsp;examples</P>
<P>Database&nbsp;creation&nbsp;date<BR>This&nbsp;UDF&nbsp;will&nbsp;return&nbsp;the&nbsp;creation&nbsp;date&nbsp;for&nbsp;a&nbsp;given&nbsp;database&nbsp;(you&nbsp;should<BR>specify&nbsp;database&nbsp;name&nbsp;as&nbsp;parameter&nbsp;for&nbsp;this&nbsp;UDF):</P>
<P>CREATE&nbsp;FUNCTION&nbsp;dbo.DBCreationDate<BR>&nbsp;&nbsp;(&nbsp;@dbname&nbsp;sysname&nbsp;)<BR>RETURNS&nbsp;datetime<BR>AS<BR>BEGIN<BR>&nbsp;&nbsp;DECLARE&nbsp;@crdate&nbsp;datetime<BR>&nbsp;&nbsp;SELECT&nbsp;@crdate&nbsp;=&nbsp;crdate&nbsp;FROM&nbsp;master.dbo.sysdatabases<BR>&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;name&nbsp;=&nbsp;@dbname<BR>&nbsp;&nbsp;RETURN&nbsp;(&nbsp;@crdate&nbsp;)<BR>END<BR>GO<BR>&nbsp;</P>
<P>This&nbsp;is&nbsp;the&nbsp;example&nbsp;for&nbsp;use:</P>
<P>SELECT&nbsp;dbo.DBCreationDate('pubs')<BR>GO<BR>&nbsp;</P>
<P>Date&nbsp;the&nbsp;object&nbsp;was&nbsp;created<BR>This&nbsp;UDF&nbsp;will&nbsp;return&nbsp;the&nbsp;creation&nbsp;date&nbsp;for&nbsp;a&nbsp;given&nbsp;object&nbsp;in&nbsp;the<BR>current&nbsp;database:</P>
<P>CREATE&nbsp;FUNCTION&nbsp;dbo.ObjCreationDate<BR>&nbsp;&nbsp;(&nbsp;@objname&nbsp;sysname)<BR>RETURNS&nbsp;datetime<BR>AS<BR>BEGIN<BR>&nbsp;&nbsp;DECLARE&nbsp;@crdate&nbsp;datetime<BR>&nbsp;&nbsp;SELECT&nbsp;@crdate&nbsp;=&nbsp;crdate&nbsp;FROM&nbsp;sysobjects&nbsp;WHERE&nbsp;name&nbsp;=&nbsp;@objname<BR>&nbsp;&nbsp;RETURN&nbsp;(&nbsp;@crdate&nbsp;)<BR>END<BR>GO<BR>&nbsp;</P>
<P>This&nbsp;is&nbsp;the&nbsp;example&nbsp;for&nbsp;use:</P>
<P>SELECT&nbsp;dbo.ObjCreationDate('authors')<BR>GO<BR>&nbsp;</P>
<P>Get&nbsp;date&nbsp;part&nbsp;of&nbsp;datetime&nbsp;value<BR>This&nbsp;UDF&nbsp;will&nbsp;return&nbsp;the&nbsp;date&nbsp;part&nbsp;of&nbsp;datetime&nbsp;value:</P>
<P>CREATE&nbsp;FUNCTION&nbsp;dbo.DatePart<BR>&nbsp;&nbsp;(&nbsp;@fDate&nbsp;datetime&nbsp;)<BR>RETURNS&nbsp;varchar(10)<BR>AS<BR>BEGIN<BR>&nbsp;&nbsp;RETURN&nbsp;(&nbsp;CONVERT(varchar(10),@fDate,101)&nbsp;)<BR>END<BR>GO<BR>&nbsp;</P>
<P>This&nbsp;is&nbsp;the&nbsp;example&nbsp;for&nbsp;use:</P>
<P>SELECT&nbsp;dbo.DatePart('11/11/2000&nbsp;11:15AM')<BR>GO<BR>&nbsp;</P>
<P>Get&nbsp;time&nbsp;part&nbsp;of&nbsp;datetime&nbsp;value<BR>This&nbsp;UDF&nbsp;will&nbsp;return&nbsp;the&nbsp;time&nbsp;part&nbsp;of&nbsp;datetime&nbsp;value:</P>
<P>CREATE&nbsp;FUNCTION&nbsp;dbo.TimePart<BR>&nbsp;&nbsp;(&nbsp;@fDate&nbsp;datetime&nbsp;)<BR>RETURNS&nbsp;varchar(10)<BR>AS<BR>BEGIN<BR>&nbsp;&nbsp;RETURN&nbsp;(&nbsp;CONVERT(varchar(7),right(@fDate,7),101)&nbsp;)<BR>END<BR>GO<BR>&nbsp;</P>
<P>This&nbsp;is&nbsp;the&nbsp;example&nbsp;for&nbsp;use:</P>
<P>SELECT&nbsp;dbo.TimePart('11/11/2000&nbsp;11:15AM')<BR>GO<BR>&nbsp;</P>
<P>Get&nbsp;the&nbsp;number&nbsp;of&nbsp;working&nbsp;days&nbsp;between&nbsp;two&nbsp;dates<BR>This&nbsp;UDF&nbsp;will&nbsp;return&nbsp;the&nbsp;number&nbsp;of&nbsp;working&nbsp;days&nbsp;between&nbsp;two&nbsp;dates<BR>(not&nbsp;including&nbsp;these&nbsp;dates):</P>
<P>CREATE&nbsp;FUNCTION&nbsp;dbo.GetWorkingDays<BR>&nbsp;&nbsp;(&nbsp;@StartDate&nbsp;datetime,<BR>&nbsp;&nbsp;&nbsp;&nbsp;@EndDate&nbsp;datetime&nbsp;)<BR>RETURNS&nbsp;INT<BR>AS<BR>BEGIN<BR>&nbsp;&nbsp;DECLARE&nbsp;@WorkDays&nbsp;int,&nbsp;@FirstPart&nbsp;int<BR>&nbsp;&nbsp;DECLARE&nbsp;@FirstNum&nbsp;int,&nbsp;@TotalDays&nbsp;int&nbsp;<BR>&nbsp;&nbsp;DECLARE&nbsp;@LastNum&nbsp;int,&nbsp;@LastPart&nbsp;int<BR>&nbsp;&nbsp;IF&nbsp;(DATEDIFF(day,&nbsp;@StartDate,&nbsp;@EndDate)&nbsp;&lt;&nbsp;2)<BR>&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;(&nbsp;0&nbsp;)<BR>&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;<BR>&nbsp;&nbsp;SELECT&nbsp;<BR>&nbsp;&nbsp;&nbsp;@TotalDays&nbsp;=&nbsp;DATEDIFF(day,&nbsp;@StartDate,&nbsp;@EndDate)&nbsp;-&nbsp;1,<BR>&nbsp;&nbsp;&nbsp;@FirstPart&nbsp;=&nbsp;CASE&nbsp;DATENAME(weekday,&nbsp;@StartDate)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'Sunday'&nbsp;THEN&nbsp;6<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'Monday'&nbsp;THEN&nbsp;5<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'Tuesday'&nbsp;THEN&nbsp;4<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'Wednesday'&nbsp;THEN&nbsp;3<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'Thursday'&nbsp;THEN&nbsp;2<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'Friday'&nbsp;THEN&nbsp;1<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'Saturday'&nbsp;THEN&nbsp;0<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END,<BR>&nbsp;&nbsp;&nbsp;@FirstNum&nbsp;=&nbsp;CASE&nbsp;DATENAME(weekday,&nbsp;@StartDate)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'Sunday'&nbsp;THEN&nbsp;5<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'Monday'&nbsp;THEN&nbsp;4<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'Tuesday'&nbsp;THEN&nbsp;3<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'Wednesday'&nbsp;THEN&nbsp;2<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'Thursday'&nbsp;THEN&nbsp;1<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'Friday'&nbsp;THEN&nbsp;0<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'Saturday'&nbsp;THEN&nbsp;0<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END<BR>&nbsp;&nbsp;IF&nbsp;(@TotalDays&nbsp;&lt;&nbsp;@FirstPart)&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@WorkDays&nbsp;=&nbsp;@TotalDays<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END<BR>&nbsp;&nbsp;ELSE<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@WorkDays&nbsp;=&nbsp;(@TotalDays&nbsp;-&nbsp;@FirstPart)&nbsp;/&nbsp;7<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@LastPart&nbsp;=&nbsp;(@TotalDays&nbsp;-&nbsp;@FirstPart)&nbsp;%&nbsp;7<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@LastNum&nbsp;=&nbsp;CASE&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;(@LastPart&nbsp;&lt;&nbsp;7)&nbsp;AND&nbsp;(@LastPart&nbsp;&gt;&nbsp;0)&nbsp;THEN&nbsp;@LastPart&nbsp;-&nbsp;1<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE&nbsp;0<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@WorkDays&nbsp;=&nbsp;@WorkDays&nbsp;*&nbsp;5&nbsp;+&nbsp;@FirstNum&nbsp;+&nbsp;@LastNum<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END<BR>&nbsp;&nbsp;RETURN&nbsp;(&nbsp;@WorkDays&nbsp;)<BR>END<BR>GO<BR>&nbsp;</P>
<P>This&nbsp;is&nbsp;the&nbsp;example&nbsp;for&nbsp;use:</P>
<P>SELECT&nbsp;dbo.GetWorkingDays&nbsp;('11/13/2000',&nbsp;'12/27/2000')<BR>GO<BR></P></FONT>