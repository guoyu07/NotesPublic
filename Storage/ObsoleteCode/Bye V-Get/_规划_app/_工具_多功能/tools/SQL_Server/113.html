<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>用触发器实现用户登录记录下登录信息(sysprocesses)</B><BR>如果你非要用触发器，不妨看看select&nbsp;*&nbsp;from&nbsp;sysprocesses的内容。可以给sysprocesses表加个触发器来完成你的要求。如果你用7.0，可以看看Microsoft提供的sp_who的过程！如下：<BR>create&nbsp;procedure&nbsp;sp_who&nbsp;&nbsp;---&nbsp;1995/11/28&nbsp;15:48<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@loginame&nbsp;sysname&nbsp;=&nbsp;NULL&nbsp;--or&nbsp;'active'<BR>as
<P></P>
<P>declare&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@spidlow&nbsp;&nbsp;&nbsp;&nbsp;int,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@spidhigh&nbsp;&nbsp;&nbsp;&nbsp;int,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@spid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@sid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;varbinary(85)</P>
<P>select&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@spidlow&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,@spidhigh&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;32767</P>
<P><BR>if&nbsp;(&nbsp;&nbsp;&nbsp;&nbsp;@loginame&nbsp;is&nbsp;not&nbsp;NULL<BR>&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;&nbsp;upper(@loginame)&nbsp;=&nbsp;'ACTIVE'<BR>&nbsp;&nbsp;&nbsp;)<BR>&nbsp;&nbsp;&nbsp;&nbsp;begin</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;spid&nbsp;,status<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,loginame=rtrim(loginame)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,hostname&nbsp;,blk=convert(char(5),blocked)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,dbname=&nbsp;db_name(dbid),cmd<BR>&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;&nbsp;master.dbo.sysprocesses<BR>&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;spid&nbsp;&gt;=&nbsp;@spidlow&nbsp;and&nbsp;spid&nbsp;&lt;=&nbsp;@spidhigh&nbsp;AND<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;upper(cmd)&nbsp;&lt;&gt;&nbsp;'AWAITING&nbsp;COMMAND'</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(0)<BR>&nbsp;&nbsp;&nbsp;&nbsp;end</P>
<P>if&nbsp;(@loginame&nbsp;is&nbsp;not&nbsp;NULL<BR>&nbsp;&nbsp;&nbsp;AND&nbsp;&nbsp;&nbsp;&nbsp;upper(@loginame)&nbsp;&lt;&gt;&nbsp;'ACTIVE'<BR>&nbsp;&nbsp;&nbsp;)<BR>begin<BR>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(@loginame&nbsp;like&nbsp;'[0-9]%')&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;is&nbsp;a&nbsp;spid.<BR>&nbsp;&nbsp;&nbsp;&nbsp;begin<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;@spid&nbsp;=&nbsp;convert(int,&nbsp;@loginame)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;spid,&nbsp;status,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loginame=rtrim(loginame),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hostname,blk&nbsp;=&nbsp;convert(char(5),blocked),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dbname=db_name(dbid),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;&nbsp;master.dbo.sysprocesses<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;spid&nbsp;=&nbsp;@spid<BR>&nbsp;&nbsp;&nbsp;&nbsp;end<BR>&nbsp;&nbsp;&nbsp;&nbsp;else<BR>&nbsp;&nbsp;&nbsp;&nbsp;begin<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;@sid&nbsp;=&nbsp;suser_sid(@loginame)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(@sid&nbsp;is&nbsp;null)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;begin<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raiserror(15007,-1,-1,@loginame)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(1)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;spid,&nbsp;status,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loginame=rtrim(loginame),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hostname&nbsp;,blk=convert(char(5),blocked),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dbname=db_name(dbid),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;&nbsp;master.dbo.sysprocesses<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;sid&nbsp;=&nbsp;@sid<BR>&nbsp;&nbsp;&nbsp;&nbsp;end<BR>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(0)<BR>end</P>
<P><BR>/*&nbsp;loginame&nbsp;arg&nbsp;is&nbsp;null&nbsp;*/<BR>select&nbsp;spid,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;status,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loginame=rtrim(loginame),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hostname,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;blk=convert(char(5),blocked),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dbname=db_name(dbid),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd<BR>from&nbsp;&nbsp;master.dbo.sysprocesses<BR>where&nbsp;spid&nbsp;&gt;=&nbsp;@spidlow&nbsp;and&nbsp;spid&nbsp;&lt;=&nbsp;@spidhigh</P>
<P><BR>return&nbsp;(0)&nbsp;--&nbsp;sp_who</P></FONT>