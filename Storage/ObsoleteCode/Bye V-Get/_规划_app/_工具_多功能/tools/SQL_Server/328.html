<meta http-equiv="content-type" content="text/html; charset=gb2312"><IMG src="http://www.pigtwo.com/forum/pic/url.gif" align=absMiddle border=0><A href="http://www.integer.org" 
target=_blank>http://www.integer.org</A>
<P></P>
<P>Copyright&nbsp;(C)&nbsp;2003&nbsp;Cameron&nbsp;Michelis&nbsp;copying&nbsp;and&nbsp;redistribution&nbsp;of&nbsp;this&nbsp;file&nbsp;is&nbsp;permitted&nbsp;provided&nbsp;<BR>this&nbsp;notice&nbsp;and&nbsp;the&nbsp;above&nbsp;comments&nbsp;are&nbsp;preserved.<BR>*/</P>
<P>Set&nbsp;quoted_identifier&nbsp;off<BR>use&nbsp;master<BR>DECLARE&nbsp;@fillfactor&nbsp;varchar(2)<BR>DECLARE&nbsp;@tablename&nbsp;varchar(30)<BR>DECLARE&nbsp;@tablename_header&nbsp;varchar(75)<BR>DECLARE&nbsp;@dataname&nbsp;varchar(30)<BR>DECLARE&nbsp;@dataname_header&nbsp;varchar(75)<BR>DECLARE&nbsp;datanames_cursor&nbsp;CURSOR&nbsp;FOR&nbsp;SELECT&nbsp;name&nbsp;FROM&nbsp;sysdatabases<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;name&nbsp;not&nbsp;in&nbsp;('master',&nbsp;'pubs',&nbsp;'tempdb',&nbsp;'model',&nbsp;'northwind')<BR>/*&nbsp;Variable&nbsp;Initialization&nbsp;*/<BR>&nbsp;select&nbsp;@fillfactor&nbsp;=&nbsp;"0"&nbsp;--&nbsp;Set&nbsp;Fill&nbsp;factor&nbsp;here<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Note&nbsp;"0"&nbsp;will&nbsp;use&nbsp;original&nbsp;fillfactor.<BR>/*&nbsp;End&nbsp;Variable&nbsp;Initialization&nbsp;*/<BR>OPEN&nbsp;datanames_cursor</P>
<P>&nbsp;&nbsp;FETCH&nbsp;NEXT&nbsp;FROM&nbsp;datanames_cursor&nbsp;INTO&nbsp;@dataname</P>
<P>&nbsp;&nbsp;WHILE&nbsp;(@@fetch_status&nbsp;&lt;&gt;&nbsp;-1)<BR>&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(@@fetch_status&nbsp;=&nbsp;-2)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;FETCH&nbsp;NEXT&nbsp;FROM&nbsp;datanames_cursor&nbsp;INTO&nbsp;@dataname<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTINUE<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END<BR>&nbsp;SELECT&nbsp;@dataname_header&nbsp;=&nbsp;"Database&nbsp;"&nbsp;+&nbsp;RTRIM(UPPER(@dataname))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PRINT&nbsp;"&nbsp;"<BR>&nbsp;PRINT&nbsp;@dataname_header<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PRINT&nbsp;"&nbsp;"<BR>&nbsp;EXEC&nbsp;("USE&nbsp;"&nbsp;+&nbsp;@dataname&nbsp;+&nbsp;"&nbsp;DECLARE&nbsp;tnames_cursor&nbsp;CURSOR&nbsp;FOR&nbsp;SELECT&nbsp;name&nbsp;from&nbsp;sysobjects&nbsp;where&nbsp;type&nbsp;=&nbsp;'U'")<BR>&nbsp;Select&nbsp;@dataname_header&nbsp;=&nbsp;RTRIM(UPPER(@dataname))<BR>&nbsp;Exec&nbsp;("Use&nbsp;"&nbsp;+&nbsp;@dataname)&nbsp;<BR>&nbsp;OPEN&nbsp;tnames_cursor<BR>&nbsp;&nbsp;FETCH&nbsp;NEXT&nbsp;FROM&nbsp;tnames_cursor&nbsp;INTO&nbsp;@tablename<BR>&nbsp;&nbsp;WHILE&nbsp;(@@fetch_status&nbsp;&lt;&gt;&nbsp;-1)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;(@@fetch_status&nbsp;=&nbsp;-2)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FETCH&nbsp;NEXT&nbsp;FROM&nbsp;tnames_cursor&nbsp;INTO&nbsp;@tablename<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONTINUE<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@tablename_header&nbsp;=&nbsp;"&nbsp;&nbsp;Updating&nbsp;"&nbsp;+&nbsp;RTRIM(UPPER(@tablename))<BR>&nbsp;&nbsp;&nbsp;&nbsp;PRINT&nbsp;""<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PRINT&nbsp;@tablename_header<BR>&nbsp;&nbsp;&nbsp;&nbsp;EXEC&nbsp;("USE&nbsp;"&nbsp;+&nbsp;@dataname&nbsp;+&nbsp;"&nbsp;DBCC&nbsp;DBREINDEX&nbsp;("&nbsp;+&nbsp;@tablename&nbsp;+&nbsp;","&nbsp;+&nbsp;"''"&nbsp;+&nbsp;","&nbsp;+&nbsp;@fillfactor&nbsp;+&nbsp;")")<BR>&nbsp;&nbsp;&nbsp;&nbsp;EXEC&nbsp;("USE&nbsp;"&nbsp;+&nbsp;@dataname&nbsp;+&nbsp;"&nbsp;UPDATE&nbsp;STATISTICS&nbsp;"&nbsp;+&nbsp;@tablename)<BR>&nbsp;&nbsp;&nbsp;&nbsp;FETCH&nbsp;NEXT&nbsp;FROM&nbsp;tnames_cursor&nbsp;INTO&nbsp;@tablename<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END<BR>&nbsp;DEALLOCATE&nbsp;tnames_cursor<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FETCH&nbsp;NEXT&nbsp;FROM&nbsp;datanames_cursor&nbsp;INTO&nbsp;@dataname<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END<BR>DEALLOCATE&nbsp;datanames_cursor<BR>PRINT&nbsp;""<BR>PRINT&nbsp;"&nbsp;"<BR>PRINT&nbsp;"Indexing&nbsp;complete&nbsp;for&nbsp;All&nbsp;User&nbsp;Databases"</P>