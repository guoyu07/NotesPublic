<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>Nightly&nbsp;Failed&nbsp;Jobs&nbsp;Report</B><BR>Do&nbsp;you&nbsp;get&nbsp;tired&nbsp;of&nbsp;reviewing&nbsp;each&nbsp;SQL&nbsp;Agent&nbsp;notifications&nbsp;nightly&nbsp;to&nbsp;determine&nbsp;which&nbsp;&nbsp;SQL&nbsp;Agent&nbsp;jobs&nbsp;failed?&nbsp;Is&nbsp;there&nbsp;a&nbsp;significant&nbsp;number&nbsp;of&nbsp;SQL&nbsp;Agent&nbsp;job&nbsp;notifications&nbsp;that&nbsp;it&nbsp;takes&nbsp;a&nbsp;while&nbsp;to&nbsp;review&nbsp;each?&nbsp;&nbsp;Here&nbsp;is&nbsp;an&nbsp;alternative&nbsp;that&nbsp;allows&nbsp;you&nbsp;to&nbsp;have&nbsp;a&nbsp;single&nbsp;email&nbsp;report&nbsp;of&nbsp;all&nbsp;job&nbsp;failures.
<P></P>
<P>&nbsp;</P>
<P>Why&nbsp;We&nbsp;Created&nbsp;A&nbsp;&nbsp;Single&nbsp;Job&nbsp;Failure&nbsp;Report<BR>Over&nbsp;the&nbsp;past&nbsp;few&nbsp;years&nbsp;we&nbsp;have&nbsp;implemented&nbsp;a&nbsp;number&nbsp;of&nbsp;SQL&nbsp;Agent&nbsp;jobs&nbsp;in&nbsp;SQL&nbsp;Server.&nbsp;&nbsp;Each&nbsp;job&nbsp;uses&nbsp;the&nbsp;SQL&nbsp;Agent&nbsp;notification&nbsp;process&nbsp;to&nbsp;communicate&nbsp;success&nbsp;or&nbsp;failures&nbsp;to&nbsp;the&nbsp;DBA¡¯s.&nbsp;&nbsp;&nbsp;This&nbsp;communication&nbsp;is&nbsp;all&nbsp;done&nbsp;via&nbsp;email.&nbsp;&nbsp;Due&nbsp;to&nbsp;the&nbsp;number&nbsp;of&nbsp;jobs&nbsp;we&nbsp;have,&nbsp;we&nbsp;get&nbsp;lots&nbsp;of&nbsp;&nbsp;emails&nbsp;reporting&nbsp;the&nbsp;successes&nbsp;and&nbsp;failures&nbsp;of&nbsp;our&nbsp;nightly&nbsp;jobs.&nbsp;&nbsp;Every&nbsp;morning&nbsp;the&nbsp;time&nbsp;to&nbsp;review&nbsp;each&nbsp;of&nbsp;the&nbsp;email&nbsp;notifications&nbsp;to&nbsp;determine&nbsp;success&nbsp;or&nbsp;failure&nbsp;of&nbsp;each&nbsp;SQL&nbsp;Agent&nbsp;jobs&nbsp;was&nbsp;time&nbsp;consuming.&nbsp;&nbsp;Also&nbsp;it&nbsp;was&nbsp;easy&nbsp;to&nbsp;get&nbsp;in&nbsp;a&nbsp;habit&nbsp;of&nbsp;quickly&nbsp;deleting&nbsp;the&nbsp;emails&nbsp;without&nbsp;really&nbsp;noticing&nbsp;whether&nbsp;the&nbsp;jobs&nbsp;succeeded&nbsp;or&nbsp;failed.&nbsp;&nbsp;For&nbsp;this&nbsp;reason&nbsp;we&nbsp;decide&nbsp;to&nbsp;create&nbsp;a&nbsp;process&nbsp;to&nbsp;produce&nbsp;a&nbsp;single&nbsp;job&nbsp;failure&nbsp;report.</P>
<P>&nbsp;</P>
<P>What&nbsp;We&nbsp;Did<BR>We&nbsp;decide&nbsp;since&nbsp;the&nbsp;job/step&nbsp;failure&nbsp;information&nbsp;was&nbsp;stored&nbsp;in&nbsp;the&nbsp;MSDB&nbsp;database&nbsp;that&nbsp;we&nbsp;would&nbsp;write&nbsp;a&nbsp;stored&nbsp;procedure&nbsp;called&nbsp;¡°usp_failed_jobs_report&nbsp;(see&nbsp;¡°Listing&nbsp;of&nbsp;SP¡±&nbsp;below)&nbsp;to&nbsp;produce&nbsp;a&nbsp;single&nbsp;report.&nbsp;&nbsp;&nbsp;This&nbsp;stored&nbsp;procedure&nbsp;performs&nbsp;some&nbsp;simple&nbsp;SQL&nbsp;to&nbsp;gather&nbsp;information&nbsp;from&nbsp;the&nbsp;sysjobhistory&nbsp;and&nbsp;sysjobs&nbsp;tables,&nbsp;formats&nbsp;the&nbsp;data&nbsp;into&nbsp;a&nbsp;report,&nbsp;and&nbsp;then&nbsp;emails&nbsp;the&nbsp;report&nbsp;to&nbsp;the&nbsp;our&nbsp;DBAs.&nbsp;&nbsp;</P>
<P>&nbsp;</P>
<P>This&nbsp;SP&nbsp;code&nbsp;is&nbsp;run&nbsp;every&nbsp;morning&nbsp;Monday&nbsp;-&nbsp;Friday&nbsp;at&nbsp;6&nbsp;am&nbsp;via&nbsp;a&nbsp;SQL&nbsp;Agent&nbsp;job.&nbsp;&nbsp;The&nbsp;SP&nbsp;determines&nbsp;which&nbsp;jobs&nbsp;and&nbsp;job&nbsp;steps&nbsp;have&nbsp;failed&nbsp;since&nbsp;the&nbsp;last&nbsp;scheduled&nbsp;running&nbsp;of&nbsp;this&nbsp;SP.&nbsp;For&nbsp;each&nbsp;failed&nbsp;jobs/job&nbsp;step&nbsp;this&nbsp;SP&nbsp;produces&nbsp;a&nbsp;single&nbsp;line&nbsp;in&nbsp;the&nbsp;report.&nbsp;&nbsp;The&nbsp;line&nbsp;in&nbsp;the&nbsp;report&nbsp;shows&nbsp;&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;job&nbsp;&nbsp;and&nbsp;step&nbsp;that&nbsp;failed,&nbsp;plus&nbsp;the&nbsp;date&nbsp;and&nbsp;time&nbsp;of&nbsp;the&nbsp;failure.&nbsp;&nbsp;</P>
<P>&nbsp;</P>
<P>Example&nbsp;of&nbsp;Report<BR>Here&nbsp;is&nbsp;an&nbsp;example&nbsp;on&nbsp;the&nbsp;a&nbsp;report&nbsp;produced&nbsp;by&nbsp;this&nbsp;SP.&nbsp;&nbsp;</P>
<P>The&nbsp;following&nbsp;jobs/steps&nbsp;failed&nbsp;since&nbsp;Aug&nbsp;23&nbsp;2002&nbsp;&nbsp;6:00AM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</P>
<P>job&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;step_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;failed&nbsp;datetime&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</P>
<P>-------------------------------------------&nbsp;---------------------------------&nbsp;-------------------&nbsp;&nbsp;&nbsp;&nbsp;</P>
<P>ADRN1303&nbsp;TRIGGER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TRIGGER&nbsp;FILE&nbsp;EXIST&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Aug&nbsp;25&nbsp;2002&nbsp;12:15AM&nbsp;&nbsp;&nbsp;&nbsp;</P>
<P>LOAD&nbsp;EMPLOYEE&nbsp;TABLE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOAD&nbsp;TABLE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Aug&nbsp;25&nbsp;2002&nbsp;12:58AM</P>
<P>LOAS&nbsp;EMPLOYEE&nbsp;TABLE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Job&nbsp;outcome)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Aug&nbsp;25&nbsp;2002&nbsp;12:58AM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</P>
<P>ADDS&nbsp;load&nbsp;for&nbsp;PROD1&nbsp;New&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FTP&nbsp;VALIDATION&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Aug&nbsp;25&nbsp;2002&nbsp;&nbsp;2:16AM&nbsp;&nbsp;&nbsp;&nbsp;</P>
<P>ADDS&nbsp;load&nbsp;for&nbsp;PROD1&nbsp;New&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FTP&nbsp;VALIDATION&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Aug&nbsp;25&nbsp;2002&nbsp;&nbsp;2:16AM&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;</P>
<P>This&nbsp;report&nbsp;shows&nbsp;that&nbsp;¡°ADRN1303&nbsp;TRIGGER¡±&nbsp;job&nbsp;had&nbsp;a&nbsp;step&nbsp;failure,&nbsp;¡°LOAD&nbsp;EMPLOYEE&nbsp;TABLE¡±&nbsp;had&nbsp;a&nbsp;step&nbsp;and&nbsp;job&nbsp;failure&nbsp;(the&nbsp;¡°(job&nbsp;outcome)¡±&nbsp;step_name&nbsp;indicates&nbsp;a&nbsp;job&nbsp;failure),&nbsp;and&nbsp;¡°ADDS&nbsp;load&nbsp;for&nbsp;PROD1&nbsp;New¡±&nbsp;had&nbsp;two&nbsp;different&nbsp;step&nbsp;failures.</P>
<P>&nbsp;</P>
<P>Conclusion<BR>&nbsp;</P>
<P>By&nbsp;having&nbsp;a&nbsp;single&nbsp;report,&nbsp;the&nbsp;DBA's&nbsp;in&nbsp;our&nbsp;shop&nbsp;can&nbsp;now&nbsp;review&nbsp;a&nbsp;single&nbsp;email&nbsp;to&nbsp;determine&nbsp;which&nbsp;jobs&nbsp;have&nbsp;failed&nbsp;since&nbsp;the&nbsp;last&nbsp;business&nbsp;day.&nbsp;&nbsp;Having&nbsp;this&nbsp;single&nbsp;report&nbsp;allows&nbsp;a&nbsp;quick&nbsp;method&nbsp;for&nbsp;the&nbsp;DBA¡¯s&nbsp;to&nbsp;identify&nbsp;all&nbsp;the&nbsp;jobs&nbsp;and&nbsp;step&nbsp;failures&nbsp;for&nbsp;the&nbsp;past&nbsp;day.&nbsp;&nbsp;&nbsp;By&nbsp;reviewing&nbsp;a&nbsp;single&nbsp;report&nbsp;the&nbsp;DBA¡¯s&nbsp;don¡¯t&nbsp;have&nbsp;to&nbsp;review&nbsp;each&nbsp;individual&nbsp;SQL&nbsp;Agent&nbsp;notification&nbsp;email&nbsp;to&nbsp;determine&nbsp;which&nbsp;jobs&nbsp;failed.</P>
<P>&nbsp;</P>
<P>Listing&nbsp;of&nbsp;SP<BR>CREATE&nbsp;procedure&nbsp;usp_failed_jobs_report&nbsp;as</P>
<P>--&nbsp;Written&nbsp;by:&nbsp;Greg&nbsp;Larsen</P>
<P>--&nbsp;Company:&nbsp;Department&nbsp;of&nbsp;Health,&nbsp;Washington&nbsp;State</P>
<P>--&nbsp;Date:&nbsp;January&nbsp;3,&nbsp;2002</P>
<P>--&nbsp;Description:&nbsp;&nbsp;This&nbsp;SQL&nbsp;Code&nbsp;reports&nbsp;job/step&nbsp;failures&nbsp;based&nbsp;on&nbsp;a&nbsp;data&nbsp;and&nbsp;time&nbsp;range.&nbsp;&nbsp;The</P>
<P>--&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;report&nbsp;built&nbsp;is&nbsp;emailed&nbsp;to&nbsp;the&nbsp;DBA&nbsp;distribution&nbsp;list.</P>
<P>--</P>
<P>--&nbsp;Modified&nbsp;04/12/2002&nbsp;-&nbsp;Greg&nbsp;Larsen&nbsp;-&nbsp;Modified&nbsp;to&nbsp;support&nbsp;Long&nbsp;running&nbsp;jobs&nbsp;that&nbsp;cross&nbsp;reporting&nbsp;</P>
<P>--&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;periods</P>
<P>declare&nbsp;@RPT_BEGIN_DATE&nbsp;datetime</P>
<P>declare&nbsp;@NUMBER_OF_DAYS&nbsp;int</P>
<P>--&nbsp;Set&nbsp;the&nbsp;number&nbsp;of&nbsp;days&nbsp;to&nbsp;go&nbsp;back&nbsp;to&nbsp;calculate&nbsp;the&nbsp;report&nbsp;begin&nbsp;date</P>
<P>set&nbsp;@NUMBER_OF_DAYS&nbsp;=&nbsp;-1</P>
<P>--&nbsp;If&nbsp;the&nbsp;current&nbsp;date&nbsp;is&nbsp;Monday,&nbsp;then&nbsp;have&nbsp;the&nbsp;report&nbsp;start&nbsp;on&nbsp;Friday.</P>
<P>if&nbsp;datepart(dw,getdate())&nbsp;=&nbsp;2</P>
<P>&nbsp;&nbsp;set&nbsp;@NUMBER_OF_DAYS&nbsp;=&nbsp;-3</P>
<P>--&nbsp;Get&nbsp;the&nbsp;report&nbsp;begin&nbsp;date&nbsp;and&nbsp;time</P>
<P>set&nbsp;@RPT_BEGIN_DATE&nbsp;=&nbsp;dateadd(day,@NUMBER_OF_DAYS,getdate())&nbsp;</P>
<P>--&nbsp;Get&nbsp;todays&nbsp;date&nbsp;in&nbsp;YYMMDD&nbsp;format</P>
<P>--&nbsp;Create&nbsp;temporary&nbsp;table&nbsp;to&nbsp;hold&nbsp;report</P>
<P>create&nbsp;table&nbsp;##temp_text&nbsp;(</P>
<P>email_text&nbsp;char(100))</P>
<P>--&nbsp;Generate&nbsp;report&nbsp;heading&nbsp;and&nbsp;column&nbsp;headers</P>
<P>insert&nbsp;into&nbsp;##temp_text&nbsp;values('The&nbsp;following&nbsp;jobs/steps&nbsp;failed&nbsp;since&nbsp;'&nbsp;+&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cast(@RPT_BEGIN_DATE&nbsp;as&nbsp;char(20))&nbsp;)</P>
<P>insert&nbsp;into&nbsp;##temp_text&nbsp;values&nbsp;('job&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;step_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;failed&nbsp;datetime&nbsp;&nbsp;&nbsp;&nbsp;')</P>
<P>insert&nbsp;into&nbsp;##temp_text&nbsp;values&nbsp;('-------------------------------------------&nbsp;---------------------------------&nbsp;-------------------')</P>
<P>--&nbsp;Generate&nbsp;report&nbsp;detail&nbsp;for&nbsp;failed&nbsp;jobs/steps</P>
<P>insert&nbsp;into&nbsp;##temp_text&nbsp;(email_text)</P>
<P>&nbsp;select&nbsp;substring(j.name,1,43)+&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;substring('&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;',</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;len(j.name),43)&nbsp;+&nbsp;substring(jh.step_name,1,33)&nbsp;+&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;substring('&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;',</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;len(jh.step_name),33)&nbsp;+&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Calculate&nbsp;fail&nbsp;datetime</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Add&nbsp;Run&nbsp;Duration&nbsp;Seconds</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cast(dateadd(ss,</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cast(substring(cast(run_duration&nbsp;+&nbsp;1000000&nbsp;as&nbsp;char(7)),6,2)&nbsp;as&nbsp;int),</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Add&nbsp;Run&nbsp;Duration&nbsp;Minutes&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dateadd(mi,</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cast(substring(cast(run_duration&nbsp;+&nbsp;1000000&nbsp;as&nbsp;char(7)),4,2)&nbsp;as&nbsp;int),</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Add&nbsp;Run&nbsp;Duration&nbsp;Hours</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dateadd(hh,</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cast(substring(cast(run_duration&nbsp;+&nbsp;1000000&nbsp;as&nbsp;char(7)),2,2)&nbsp;as&nbsp;int),</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Add&nbsp;Start&nbsp;Time&nbsp;Seconds</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dateadd(ss,</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cast(substring(cast(run_time&nbsp;+&nbsp;1000000&nbsp;as&nbsp;char(7)),6,2)&nbsp;as&nbsp;int),</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Add&nbsp;Start&nbsp;Time&nbsp;Minutes&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dateadd(mi,</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cast(substring(cast(run_time&nbsp;+&nbsp;1000000&nbsp;as&nbsp;char(7)),4,2)&nbsp;as&nbsp;int),</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Add&nbsp;Start&nbsp;Time&nbsp;Hours</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dateadd(hh,</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cast(substring(cast(run_time&nbsp;+&nbsp;1000000&nbsp;as&nbsp;char(7)),2,2)&nbsp;as&nbsp;int),</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;convert(datetime,cast&nbsp;(run_date&nbsp;as&nbsp;char(8))))</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)))))&nbsp;as&nbsp;char(19))</P>
<P>&nbsp;&nbsp;&nbsp;from&nbsp;msdb..sysjobhistory&nbsp;jh&nbsp;join&nbsp;msdb..sysjobs&nbsp;j&nbsp;on&nbsp;jh.job_id=j.job_id</P>
<P>&nbsp;&nbsp;&nbsp;where&nbsp;&nbsp;&nbsp;(getdate()&nbsp;&gt;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Calculate&nbsp;fail&nbsp;datetime</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Add&nbsp;Run&nbsp;Duration&nbsp;Seconds</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dateadd(ss,</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cast(substring(cast(run_duration&nbsp;+&nbsp;1000000&nbsp;as&nbsp;char(7)),6,2)&nbsp;as&nbsp;int),</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Add&nbsp;Run&nbsp;Duration&nbsp;Minutes&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dateadd(mi,</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cast(substring(cast(run_duration&nbsp;+&nbsp;1000000&nbsp;as&nbsp;char(7)),4,2)&nbsp;as&nbsp;int),</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Add&nbsp;Run&nbsp;Duration&nbsp;Hours</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dateadd(hh,</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cast(substring(cast(run_duration&nbsp;+&nbsp;1000000&nbsp;as&nbsp;char(7)),2,2)&nbsp;as&nbsp;int),</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Add&nbsp;Start&nbsp;Time&nbsp;Seconds</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dateadd(ss,</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cast(substring(cast(run_time&nbsp;+&nbsp;1000000&nbsp;as&nbsp;char(7)),6,2)&nbsp;as&nbsp;int),</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Add&nbsp;Start&nbsp;Time&nbsp;Minutes&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dateadd(mi,</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cast(substring(cast(run_time&nbsp;+&nbsp;1000000&nbsp;as&nbsp;char(7)),4,2)&nbsp;as&nbsp;int),</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Add&nbsp;Start&nbsp;Time&nbsp;Hours</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dateadd(hh,</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cast(substring(cast(run_time&nbsp;+&nbsp;1000000&nbsp;as&nbsp;char(7)),2,2)&nbsp;as&nbsp;int),</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;convert(datetime,cast&nbsp;(run_date&nbsp;as&nbsp;char(8))))</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))))))&nbsp;</P>
<P>and&nbsp;&nbsp;(@RPT_BEGIN_DATE&nbsp;&lt;&nbsp;--&nbsp;Calculate&nbsp;fail&nbsp;datetime</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Add&nbsp;Run&nbsp;Duration&nbsp;Seconds</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dateadd(ss,</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cast(substring(cast(run_duration&nbsp;+&nbsp;1000000&nbsp;as&nbsp;char(7)),6,2)&nbsp;as&nbsp;int),</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Add&nbsp;Run&nbsp;Duration&nbsp;Minutes&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dateadd(mi,</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cast(substring(cast(run_duration&nbsp;+&nbsp;1000000&nbsp;as&nbsp;char(7)),4,2)&nbsp;as&nbsp;int),</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Add&nbsp;Run&nbsp;Duration&nbsp;Hours</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dateadd(hh,</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cast(substring(cast(run_duration&nbsp;+&nbsp;1000000&nbsp;as&nbsp;char(7)),2,2)&nbsp;as&nbsp;int),</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Add&nbsp;Start&nbsp;Time&nbsp;Seconds</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dateadd(ss,</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cast(substring(cast(run_time&nbsp;+&nbsp;1000000&nbsp;as&nbsp;char(7)),6,2)&nbsp;as&nbsp;int),</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Add&nbsp;Start&nbsp;Time&nbsp;Minutes&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dateadd(mi,</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cast(substring(cast(run_time&nbsp;+&nbsp;1000000&nbsp;as&nbsp;char(7)),4,2)&nbsp;as&nbsp;int),</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Add&nbsp;Start&nbsp;Time&nbsp;Hours</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dateadd(hh,</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cast(substring(cast(run_time&nbsp;+&nbsp;1000000&nbsp;as&nbsp;char(7)),2,2)&nbsp;as&nbsp;int),</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;convert(datetime,cast&nbsp;(run_date&nbsp;as&nbsp;char(8))))</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))))))&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;jh.run_status&nbsp;=&nbsp;0</P>
<P>--&nbsp;Email&nbsp;report&nbsp;to&nbsp;DBA&nbsp;distribution&nbsp;list</P>
<P>exec&nbsp;master.dbo.xp_sendmail&nbsp;@recipients='DIRM.DBA@doh.wa.gov',</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@subject='Check&nbsp;for&nbsp;Failed&nbsp;Jobs&nbsp;-&nbsp;Contains&nbsp;jobs/steps&nbsp;that&nbsp;have&nbsp;failed.',&nbsp;</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@query='select&nbsp;*&nbsp;from&nbsp;##temp_text'&nbsp;,&nbsp;@no_header='true',&nbsp;@width=150</P>
<P>--&nbsp;Drop&nbsp;temporary&nbsp;table</P>
<P>drop&nbsp;table&nbsp;##temp_text</P>
<P>&nbsp;</P>
<P>GO</P>
<P>SET&nbsp;QUOTED_IDENTIFIER&nbsp;OFF&nbsp;</P>
<P>GO</P>
<P>SET&nbsp;ANSI_NULLS&nbsp;ON&nbsp;</P>
<P>GO</P>
<P>&nbsp;<BR></P></FONT>