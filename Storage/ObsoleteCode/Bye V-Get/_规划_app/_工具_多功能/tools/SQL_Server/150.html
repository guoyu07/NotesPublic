<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>SELECT&nbsp;TOP&nbsp;N&nbsp;问题(1)(fang99)</B><BR>Hi,&nbsp;everyone:<BR>&nbsp;&nbsp;&nbsp;&nbsp;本贴讨论SELECT&nbsp;TOP&nbsp;N问题.<BR>&nbsp;&nbsp;&nbsp;&nbsp;现在正在一家计算机公司兼职,开发ASP应用.&nbsp;在最近的一个商业项目里有这样一个需求:用户在查询时,只需要按照某(些)列排序后TOP&nbsp;20的纪录.&nbsp;SQL&nbsp;SERVER&nbsp;7很好地支持了TOP&nbsp;N&nbsp;操作,但考虑到系统移植问题,&nbsp;我又考虑在其他几个主流DBMSs中如何实现.&nbsp;鉴于只有DB2&nbsp;UDB&nbsp;7,ORACLE&nbsp;8i,SQL&nbsp;SERVER&nbsp;7,本贴仅讨论这三个DBMS.<BR>&nbsp;&nbsp;&nbsp;&nbsp;简单地说,TOP&nbsp;N问题就是:在SELECT中,仅选择按照某(些)列排序后TOP&nbsp;N的纪录.&nbsp;考虑到等值问题,又可以分为两种:&nbsp;一是仅仅返回N条纪录(M&nbsp;1),&nbsp;二是还包括所有于第N条等值的纪录(M&nbsp;2).&nbsp;当然最内层的子查询也可以有其他的子句,&nbsp;或者TOP&nbsp;N也可以应用在没有ORDER&nbsp;BY的情况下,这样更简单.
<P></P>
<P>1.&nbsp;SQL&nbsp;SERVER&nbsp;7:&nbsp;用&nbsp;TOP&nbsp;N&nbsp;(WITH&nbsp;TIES)<BR>M1:&nbsp;<BR>SELECT&nbsp;TOP&nbsp;N&nbsp;*&nbsp;FROM&nbsp;MYTABLE&nbsp;ORDER&nbsp;BY&nbsp;ORD_COL;</P>
<P>M2:&nbsp;<BR>SELECT&nbsp;TOP&nbsp;N&nbsp;&nbsp;WITH&nbsp;TIES&nbsp;*&nbsp;FROM&nbsp;MYTABLE&nbsp;ORDER&nbsp;BY&nbsp;ORD_COL;<BR>注:&nbsp;SQL&nbsp;SERVER&nbsp;7提供了PERCENT&nbsp;N&nbsp;WITH&nbsp;TIES,&nbsp;ACCESS&nbsp;中提供了TOP&nbsp;N,但含义是M&nbsp;2.</P>
<P>2.&nbsp;ORACLE&nbsp;8i:&nbsp;用&nbsp;ROWNUM&lt;=N<BR>M1:<BR>SELECT&nbsp;*&nbsp;FROM&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;MYTABLE&nbsp;ORDER&nbsp;BY&nbsp;ORD_COL&nbsp;DESC)&nbsp;<BR>WHERE&nbsp;ROWNUM&lt;=N<BR>M2:<BR>SELECT&nbsp;*&nbsp;FROM&nbsp;MYTABLE&nbsp;WHERE&nbsp;ORD_COL&gt;=<BR>&nbsp;&nbsp;&nbsp;(SELECT&nbsp;MIN(ORD_COL)&nbsp;FROM&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;MYTABLE&nbsp;ORDER&nbsp;BY&nbsp;ORD_COL&nbsp;DESC)&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;ROWNUM&lt;=N)<BR>ORDER&nbsp;BY&nbsp;ORD_COL&nbsp;DESC<BR>注意以下两种错误用法:<BR>WRONG&nbsp;1:<BR>SELECT&nbsp;*&nbsp;FROM&nbsp;MYTABLE<BR>WHERE&nbsp;&nbsp;ROWID&lt;=N<BR>ORDER&nbsp;BY&nbsp;ORD_COL&nbsp;DESC;</P>
<P>WRONG&nbsp;2:(因为WHERE&nbsp;ROWNUM&lt;=N&nbsp;在ORDER&nbsp;BY&nbsp;前执行)<BR>SELECT&nbsp;*&nbsp;FROM&nbsp;MYTABLE<BR>WHERE&nbsp;&nbsp;ROWNUM&lt;=N&nbsp;<BR>ORDER&nbsp;BY&nbsp;ORD_COL&nbsp;DESC;</P>
<P>3:&nbsp;DB2<BR>用FETCH&nbsp;FIRST&nbsp;N&nbsp;ROWS&nbsp;ONLY&nbsp;<BR>M1:&nbsp;<BR>SELECT&nbsp;*&nbsp;FROM&nbsp;MYTABLE<BR>ORDER&nbsp;BY&nbsp;ORD_COL&nbsp;DESC<BR>FETCH&nbsp;FIRST&nbsp;N&nbsp;ROWS&nbsp;ONLY<BR>M2:<BR>没有找到,因为DB2不允许在FROM中嵌套有ORDER&nbsp;BY子句的子查询.</P>
<P>还不清楚ORACLE的M&nbsp;2有没有更好的办法,以及其他的DBMS如何实现TOP&nbsp;N操作,请其他朋友补充.<BR>----------------------------------------------------------------------------------<BR>各语句已经测试过,&nbsp;EXAMPLE:<BR>create&nbsp;table&nbsp;mytable(mykey&nbsp;int,&nbsp;ord_col&nbsp;int);<BR>insert&nbsp;into&nbsp;mytable&nbsp;values(1,&nbsp;100);<BR>insert&nbsp;into&nbsp;mytable&nbsp;values(2,&nbsp;100);<BR>insert&nbsp;into&nbsp;mytable&nbsp;values(3,&nbsp;99);<BR>insert&nbsp;into&nbsp;mytable&nbsp;values(4,&nbsp;101);<BR>insert&nbsp;into&nbsp;mytable&nbsp;values(5,&nbsp;101);</P>
<P>fang&nbsp;&nbsp;6/23/2000&nbsp;<BR></P></FONT>