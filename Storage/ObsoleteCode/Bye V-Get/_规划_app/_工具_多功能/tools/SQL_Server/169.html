<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>获取排队顺序－1－T－SQL系列</B><BR>引言，基础：
<P></P>
<P>TOP&nbsp;字句允许指定&nbsp;&nbsp;WITH&nbsp;TIES。（多行同位）</P>
<P>SELECT&nbsp;TOP&nbsp;5&nbsp;WITH&nbsp;TIES&nbsp;title_id,price,title_name<BR>FROM&nbsp;title<BR>ORDER&nbsp;BY&nbsp;price&nbsp;DESC</P>
<P>结果：</P>
<P>title_id&nbsp;price&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;title_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>--------&nbsp;---------------------&nbsp;------------------------------&nbsp;<BR>Tt005&nbsp;&nbsp;&nbsp;&nbsp;80.0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_5<BR>Tt013&nbsp;&nbsp;&nbsp;&nbsp;70.0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_13<BR>Tt012&nbsp;&nbsp;&nbsp;&nbsp;65.0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_12<BR>Tt010&nbsp;&nbsp;&nbsp;&nbsp;55.0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_10<BR>Tt002&nbsp;&nbsp;&nbsp;&nbsp;50.0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_2&nbsp;&nbsp;<BR>Tt004&nbsp;&nbsp;&nbsp;&nbsp;50.0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_4&nbsp;&nbsp;<BR>Tt008&nbsp;&nbsp;&nbsp;&nbsp;50.0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_8<BR>Tt014&nbsp;&nbsp;&nbsp;&nbsp;50.0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_14</P>
<P>(8&nbsp;row(s)&nbsp;affected)</P>
<P><BR>方法一：标准的&nbsp;SQL&nbsp;方法：利用视图<BR>&nbsp;对于大表来说，性能将显著降低，因为对每一行都要扫描一次该表。</P>
<P>CREATE&nbsp;VIEW&nbsp;ranked_sales(rank,title_id,price,title_name)<BR>AS<BR>SELECT<BR>(SELECT&nbsp;COUNT(DISTINCT&nbsp;T2.price)&nbsp;FROM&nbsp;title&nbsp;AS&nbsp;T2<BR>&nbsp;&nbsp;WHERE&nbsp;T2.price&gt;=T1.price)&nbsp;AS&nbsp;rank,<BR>title_id,<BR>price,<BR>title_name<BR>FROM&nbsp;title&nbsp;AS&nbsp;T1&nbsp;WHERE&nbsp;price&nbsp;IS&nbsp;NOT&nbsp;NULL<BR>GO</P>
<P>SELECT&nbsp;*&nbsp;FROM&nbsp;ranked_sales&nbsp;WHERE&nbsp;rank&lt;=10&nbsp;ORDER&nbsp;BY&nbsp;rank<BR>GO</P>
<P>结果：<BR>rank&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;title_id&nbsp;price&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;title_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>-----------&nbsp;--------&nbsp;---------------------&nbsp;------------------------------&nbsp;<BR>1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt005&nbsp;&nbsp;&nbsp;&nbsp;80.0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_5<BR>2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt013&nbsp;&nbsp;&nbsp;&nbsp;70.0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_13<BR>3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt012&nbsp;&nbsp;&nbsp;&nbsp;65.0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_12<BR>4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt010&nbsp;&nbsp;&nbsp;&nbsp;55.0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_10<BR>5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt002&nbsp;&nbsp;&nbsp;&nbsp;50.0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_2&nbsp;&nbsp;<BR>5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt004&nbsp;&nbsp;&nbsp;&nbsp;50.0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_4&nbsp;&nbsp;<BR>5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt008&nbsp;&nbsp;&nbsp;&nbsp;50.0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_8<BR>5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt014&nbsp;&nbsp;&nbsp;&nbsp;50.0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_14<BR>6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt001&nbsp;&nbsp;&nbsp;&nbsp;40.0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_1&nbsp;&nbsp;&nbsp;&nbsp;<BR>7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt006&nbsp;&nbsp;&nbsp;&nbsp;39.0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_6<BR>8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt007&nbsp;&nbsp;&nbsp;&nbsp;38.0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_7<BR>9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt009&nbsp;&nbsp;&nbsp;&nbsp;35.0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_9<BR>10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tt011&nbsp;&nbsp;&nbsp;&nbsp;33.0000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title_Name_11</P>
<P>(13&nbsp;row(s)&nbsp;affected)</P>
<P></P>
<P><BR></P></FONT>