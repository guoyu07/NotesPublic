<meta http-equiv="content-type" content="text/html; charset=gb2312">&nbsp;<FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>MD5算法的T-SQL实现(2)(_rambo)</B><BR>IF&nbsp;EXISTS(SELECT&nbsp;*&nbsp;FROM&nbsp;dbo.sysobjects&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;OBJECT_ID(N'[dbo].[MD5_ConvertToWordArray]')&nbsp;AND&nbsp;xtype&nbsp;IN(N'FN',&nbsp;N'IF',&nbsp;N'TF'))<BR>&nbsp;&nbsp;&nbsp;&nbsp;DROP&nbsp;FUNCTION&nbsp;[dbo].[MD5_ConvertToWordArray]<BR>GO<BR>/*****************************************************************************<BR>*&nbsp;Name:&nbsp;MD5_ConvertToWordArray<BR>*&nbsp;Description:&nbsp;MD5_ConvertToWordArray<BR>*****************************************************************************/<BR>CREATE&nbsp;FUNCTION&nbsp;dbo.MD5_ConvertToWordArray(<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@sOrigMess&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VARCHAR(8000)&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;''<BR>)<BR>RETURNS&nbsp;@tWordArray&nbsp;TABLE([ID]&nbsp;INT&nbsp;IDENTITY(0,1),[Word]&nbsp;INT)<BR>WITH&nbsp;ENCRYPTION<BR>AS<BR>BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;@sOrigMess&nbsp;IS&nbsp;NULL<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;@sOrigMess&nbsp;=&nbsp;''
<P></P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@iLenOfMess&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INT&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@iWordArrayLen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INT<BR>&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@iPosOfWord&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INT&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@iPosOfMess&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INT<BR>&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@iCountOfWord&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INT</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;@iLenOfMess&nbsp;=&nbsp;LEN(@sOrigMess)<BR>&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;@iWordArrayLen&nbsp;=&nbsp;((@iLenOfMess&nbsp;+&nbsp;8)/64&nbsp;+&nbsp;1)&nbsp;*&nbsp;16<BR>&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;@iCountOfWord&nbsp;=&nbsp;0<BR>&nbsp;&nbsp;&nbsp;&nbsp;WHILE(@iCountOfWord&lt;@iWordArrayLen)<BR>&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INSERT&nbsp;INTO&nbsp;@tWordArray([Word])&nbsp;valueS(0)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;@iCountOfWord&nbsp;=&nbsp;@iCountOfWord&nbsp;+&nbsp;1<BR>&nbsp;&nbsp;&nbsp;&nbsp;END</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@iPosOfMess&nbsp;=&nbsp;0,&nbsp;@iPosOfWord&nbsp;=&nbsp;0,&nbsp;@iCountOfWord&nbsp;=&nbsp;0<BR>&nbsp;&nbsp;&nbsp;&nbsp;WHILE(@iPosOfMess&nbsp;&lt;&nbsp;@iLenOfMess)<BR>&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@iCountOfWord&nbsp;=&nbsp;@iPosOfMess&nbsp;/&nbsp;4,&nbsp;@iPosOfWord&nbsp;=&nbsp;@iPosOfMess&nbsp;%&nbsp;4<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UPDATE&nbsp;@tWordArray<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;[Word]&nbsp;=&nbsp;[Word]&nbsp;|&nbsp;dbo.MD5_LShift(UNICODE(SUBSTRING(@sOrigMess,@iPosOfMess+1,1)),@iPosOfWord*8)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iCountOfWord<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;@iPosOfMess&nbsp;=&nbsp;@iPosOfMess&nbsp;+&nbsp;1<BR>&nbsp;&nbsp;&nbsp;&nbsp;END<BR>&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@iCountOfWord&nbsp;=&nbsp;@iPosOfMess&nbsp;/&nbsp;4,&nbsp;@iPosOfWord&nbsp;=&nbsp;@iPosOfMess&nbsp;%&nbsp;4<BR>&nbsp;&nbsp;&nbsp;&nbsp;UPDATE&nbsp;@tWordArray<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;[Word]&nbsp;=&nbsp;[Word]&nbsp;|&nbsp;dbo.MD5_LShift(0x80,@iPosOfWord*8)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iCountOfWord</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;UPDATE&nbsp;@tWordArray<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;[Word]&nbsp;=&nbsp;[Word]&nbsp;|&nbsp;dbo.MD5_LShift(@iLenOfMess,3)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayLen&nbsp;-&nbsp;2<BR>&nbsp;&nbsp;&nbsp;&nbsp;UPDATE&nbsp;@tWordArray<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;[Word]&nbsp;=&nbsp;[Word]&nbsp;|&nbsp;dbo.MD5_RShift(@iLenOfMess,29)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayLen&nbsp;-&nbsp;1<BR>&nbsp;&nbsp;&nbsp;&nbsp;RETURN<BR>END<BR>GO</P>
<P>IF&nbsp;EXISTS(SELECT&nbsp;*&nbsp;FROM&nbsp;dbo.sysobjects&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;OBJECT_ID(N'[dbo].[MD5_WordToHex]')&nbsp;AND&nbsp;xtype&nbsp;IN(N'FN',&nbsp;N'IF',&nbsp;N'TF'))<BR>&nbsp;&nbsp;&nbsp;&nbsp;DROP&nbsp;FUNCTION&nbsp;[dbo].[MD5_WordToHex]<BR>GO<BR>/*****************************************************************************<BR>*&nbsp;Name:&nbsp;MD5_WordToHex<BR>*&nbsp;Description:&nbsp;MD5_WordToHex<BR>*****************************************************************************/<BR>CREATE&nbsp;FUNCTION&nbsp;dbo.MD5_WordToHex(<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ivalue&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INT<BR>)<BR>RETURNS&nbsp;CHAR(8)<BR>WITH&nbsp;ENCRYPTION<BR>AS<BR>BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@sRes&nbsp;&nbsp;&nbsp;&nbsp;VARCHAR(8)<BR>&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@iTmp&nbsp;&nbsp;&nbsp;&nbsp;INT<BR>&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@iCount&nbsp;TINYINT</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@sRes&nbsp;=&nbsp;'',&nbsp;@iCount&nbsp;=&nbsp;0<BR>&nbsp;&nbsp;&nbsp;&nbsp;WHILE(@iCount&lt;4)<BR>&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;@iTmp&nbsp;=&nbsp;dbo.MD5_RShift(@ivalue,@iCount*8)&nbsp;&amp;&nbsp;0x000000FF<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;@sRes&nbsp;=&nbsp;@sRes&nbsp;+&nbsp;CASE&nbsp;@iTmp&nbsp;/&nbsp;16&nbsp;WHEN&nbsp;0&nbsp;&nbsp;THEN&nbsp;'0'<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;1&nbsp;&nbsp;THEN&nbsp;'1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;2&nbsp;&nbsp;then&nbsp;'2'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;3&nbsp;&nbsp;THEN&nbsp;'3'<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;4&nbsp;&nbsp;THEN&nbsp;'4'&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;5&nbsp;&nbsp;THEN&nbsp;'5'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;6&nbsp;&nbsp;THEN&nbsp;'6'<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;7&nbsp;&nbsp;THEN&nbsp;'7'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;8&nbsp;&nbsp;THEN&nbsp;'8'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;9&nbsp;&nbsp;THEN&nbsp;'9'<BR>&nbsp;&nbsp;WHEN&nbsp;10&nbsp;THEN&nbsp;'A'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;11&nbsp;THEN&nbsp;'B'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;12&nbsp;THEN&nbsp;'C'<BR>&nbsp;WHEN&nbsp;13&nbsp;THEN&nbsp;'D'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;14&nbsp;THEN&nbsp;'E'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;15&nbsp;THEN&nbsp;'F'<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE&nbsp;''&nbsp;END<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;CASE&nbsp;@iTmp&nbsp;%&nbsp;16&nbsp;WHEN&nbsp;0&nbsp;THEN&nbsp;'0'<BR>&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;1&nbsp;&nbsp;THEN&nbsp;'1'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;2&nbsp;&nbsp;THEN&nbsp;'2'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;3&nbsp;&nbsp;THEN&nbsp;'3'<BR>&nbsp;&nbsp;&nbsp;WHEN&nbsp;4&nbsp;&nbsp;THEN&nbsp;'4'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;5&nbsp;&nbsp;THEN&nbsp;'5'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;6&nbsp;&nbsp;THEN&nbsp;'6'<BR>&nbsp;&nbsp;&nbsp;WHEN&nbsp;7&nbsp;&nbsp;THEN&nbsp;'7'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;8&nbsp;&nbsp;THEN&nbsp;'8'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;9&nbsp;&nbsp;THEN&nbsp;'9'<BR>&nbsp;&nbsp;&nbsp;WHEN&nbsp;10&nbsp;THEN&nbsp;'A'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;11&nbsp;THEN&nbsp;'B'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;12&nbsp;THEN&nbsp;'C'<BR>&nbsp;WHEN&nbsp;13&nbsp;THEN&nbsp;'D'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;14&nbsp;THEN&nbsp;'E'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;15&nbsp;THEN&nbsp;'F'<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE&nbsp;''&nbsp;END<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;@iCount&nbsp;=&nbsp;@iCount&nbsp;+&nbsp;1<BR>&nbsp;&nbsp;&nbsp;&nbsp;END<BR>&nbsp;&nbsp;&nbsp;&nbsp;RETURN(@sRes)<BR>END<BR>GO</P>
<P>IF&nbsp;EXISTS(SELECT&nbsp;*&nbsp;FROM&nbsp;dbo.sysobjects&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;OBJECT_ID(N'[dbo].[MD5]')&nbsp;AND&nbsp;xtype&nbsp;IN(N'FN',&nbsp;N'IF',&nbsp;N'TF'))<BR>&nbsp;&nbsp;&nbsp;&nbsp;DROP&nbsp;FUNCTION&nbsp;[dbo].[MD5]<BR>GO<BR>/*****************************************************************************<BR>*&nbsp;Name:&nbsp;MD5<BR>*&nbsp;Description:&nbsp;MD5<BR>*****************************************************************************/<BR>CREATE&nbsp;FUNCTION&nbsp;dbo.MD5(<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@sOrigMess&nbsp;&nbsp;&nbsp;&nbsp;NVARCHAR(4000)<BR>)<BR>RETURNS&nbsp;CHAR(32)<BR>WITH&nbsp;ENCRYPTION<BR>AS<BR>BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;--====================================<BR>&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@S11&nbsp;TINYINT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@S12&nbsp;TINYINT<BR>&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@S13&nbsp;TINYINT&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@S14&nbsp;TINYINT<BR>&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@S21&nbsp;TINYINT&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@S22&nbsp;TINYINT<BR>&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@S23&nbsp;TINYINT&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@S24&nbsp;TINYINT<BR>&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@S31&nbsp;TINYINT&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@S32&nbsp;TINYINT<BR>&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@S33&nbsp;TINYINT&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@S34&nbsp;TINYINT<BR>&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@S41&nbsp;TINYINT&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@S42&nbsp;TINYINT<BR>&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@S43&nbsp;TINYINT&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@S44&nbsp;TINYINT</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@S11&nbsp;=&nbsp;7,&nbsp;@S12&nbsp;=&nbsp;12,&nbsp;@S13&nbsp;=&nbsp;17,&nbsp;@S14&nbsp;=&nbsp;22<BR>&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@S21&nbsp;=&nbsp;5,&nbsp;@S22&nbsp;=&nbsp;9,&nbsp;@S23&nbsp;=&nbsp;14,&nbsp;@S24&nbsp;=&nbsp;20<BR>&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@S31&nbsp;=&nbsp;4,&nbsp;@S32&nbsp;=&nbsp;11,&nbsp;@S33&nbsp;=&nbsp;16,&nbsp;@S34&nbsp;=&nbsp;23<BR>&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@S41&nbsp;=&nbsp;6,&nbsp;@S42&nbsp;=&nbsp;10,&nbsp;@S43&nbsp;=&nbsp;15,&nbsp;@S44&nbsp;=&nbsp;21<BR>&nbsp;&nbsp;&nbsp;&nbsp;--====================================<BR>&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@a&nbsp;INT&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@b&nbsp;INT<BR>&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@c&nbsp;INT&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@d&nbsp;INT<BR>&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@AA&nbsp;&nbsp;&nbsp;&nbsp;INT&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@BB&nbsp;&nbsp;&nbsp;&nbsp;INT<BR>&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@CC&nbsp;&nbsp;&nbsp;&nbsp;INT&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@DD&nbsp;&nbsp;&nbsp;&nbsp;INT</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;&nbsp;&nbsp;@a&nbsp;=&nbsp;0x67452301<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,@b&nbsp;=&nbsp;0xEFCDAB89<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,@c&nbsp;=&nbsp;0x98BADCFE<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,@d&nbsp;=&nbsp;0x10325476<BR>&nbsp;&nbsp;&nbsp;&nbsp;--====================================<BR>&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@sRes&nbsp;&nbsp;&nbsp;&nbsp;VARCHAR(32)<BR>&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;@sRes&nbsp;=&nbsp;''<BR>&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@iWordArrayLen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INT<BR>&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@iWordArrayCount&nbsp;&nbsp;&nbsp;&nbsp;INT</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;DECLARE&nbsp;@tTmp&nbsp;TABLE([ID]&nbsp;INT,&nbsp;[Word]&nbsp;INT)<BR>&nbsp;&nbsp;&nbsp;&nbsp;INSERT&nbsp;INTO&nbsp;@tTmp&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;dbo.MD5_ConvertToWordArray(@sOrigMess)<BR>&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@iWordArrayCount=0,&nbsp;@iWordArrayLen&nbsp;=&nbsp;COUNT(*)&nbsp;FROM&nbsp;@tTmp</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;WHILE(@iWordArrayCount&nbsp;&lt;&nbsp;@iWordArrayLen)<BR>&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@AA&nbsp;=&nbsp;@a,&nbsp;@BB&nbsp;=&nbsp;@b,&nbsp;@CC&nbsp;=&nbsp;@c,&nbsp;@DD&nbsp;=&nbsp;@d</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@a&nbsp;=&nbsp;dbo.MD5_FF(@a,&nbsp;@b,&nbsp;@c,&nbsp;@d,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;0),&nbsp;@S11,&nbsp;0xD76AA478)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@d&nbsp;=&nbsp;dbo.MD5_FF(@d,&nbsp;@a,&nbsp;@b,&nbsp;@c,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;1),&nbsp;@S12,&nbsp;0xE8C7B756)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@c&nbsp;=&nbsp;dbo.MD5_FF(@c,&nbsp;@d,&nbsp;@a,&nbsp;@b,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;2),&nbsp;@S13,&nbsp;0x242070DB)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@b&nbsp;=&nbsp;dbo.MD5_FF(@b,&nbsp;@c,&nbsp;@d,&nbsp;@a,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;3),&nbsp;@S14,&nbsp;0xC1BDCEEE)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@a&nbsp;=&nbsp;dbo.MD5_FF(@a,&nbsp;@b,&nbsp;@c,&nbsp;@d,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;4),&nbsp;@S11,&nbsp;0xF57C0FAF)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@d&nbsp;=&nbsp;dbo.MD5_FF(@d,&nbsp;@a,&nbsp;@b,&nbsp;@c,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;5),&nbsp;@S12,&nbsp;0x4787C62A)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@c&nbsp;=&nbsp;dbo.MD5_FF(@c,&nbsp;@d,&nbsp;@a,&nbsp;@b,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;6),&nbsp;@S13,&nbsp;0xA8304613)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@b&nbsp;=&nbsp;dbo.MD5_FF(@b,&nbsp;@c,&nbsp;@d,&nbsp;@a,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;7),&nbsp;@S14,&nbsp;0xFD469501)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@a&nbsp;=&nbsp;dbo.MD5_FF(@a,&nbsp;@b,&nbsp;@c,&nbsp;@d,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;8),&nbsp;@S11,&nbsp;0x698098D8)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@d&nbsp;=&nbsp;dbo.MD5_FF(@d,&nbsp;@a,&nbsp;@b,&nbsp;@c,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;9),&nbsp;@S12,&nbsp;0x8B44F7AF)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@c&nbsp;=&nbsp;dbo.MD5_FF(@c,&nbsp;@d,&nbsp;@a,&nbsp;@b,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;10),&nbsp;@S13,&nbsp;0xFFFF5BB1)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@b&nbsp;=&nbsp;dbo.MD5_FF(@b,&nbsp;@c,&nbsp;@d,&nbsp;@a,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;11),&nbsp;@S14,&nbsp;0x895CD7BE)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@a&nbsp;=&nbsp;dbo.MD5_FF(@a,&nbsp;@b,&nbsp;@c,&nbsp;@d,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;12),&nbsp;@S11,&nbsp;0x6B901122)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@d&nbsp;=&nbsp;dbo.MD5_FF(@d,&nbsp;@a,&nbsp;@b,&nbsp;@c,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;13),&nbsp;@S12,&nbsp;0xFD987193)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@c&nbsp;=&nbsp;dbo.MD5_FF(@c,&nbsp;@d,&nbsp;@a,&nbsp;@b,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;14),&nbsp;@S13,&nbsp;0xA679438E)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@b&nbsp;=&nbsp;dbo.MD5_FF(@b,&nbsp;@c,&nbsp;@d,&nbsp;@a,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;15),&nbsp;@S14,&nbsp;0x49B40821)</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@a&nbsp;=&nbsp;dbo.MD5_GG(@a,&nbsp;@b,&nbsp;@c,&nbsp;@d,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;1),&nbsp;@S21,&nbsp;0xF61E2562)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@d&nbsp;=&nbsp;dbo.MD5_GG(@d,&nbsp;@a,&nbsp;@b,&nbsp;@c,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;6),&nbsp;@S22,&nbsp;0xC040B340)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@c&nbsp;=&nbsp;dbo.MD5_GG(@c,&nbsp;@d,&nbsp;@a,&nbsp;@b,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;11),&nbsp;@S23,&nbsp;0x265E5A51)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@b&nbsp;=&nbsp;dbo.MD5_GG(@b,&nbsp;@c,&nbsp;@d,&nbsp;@a,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;0),&nbsp;@S24,&nbsp;0xE9B6C7AA)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@a&nbsp;=&nbsp;dbo.MD5_GG(@a,&nbsp;@b,&nbsp;@c,&nbsp;@d,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;5),&nbsp;@S21,&nbsp;0xD62F105D)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@d&nbsp;=&nbsp;dbo.MD5_GG(@d,&nbsp;@a,&nbsp;@b,&nbsp;@c,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;10),&nbsp;@S22,&nbsp;0x2441453)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@c&nbsp;=&nbsp;dbo.MD5_GG(@c,&nbsp;@d,&nbsp;@a,&nbsp;@b,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;15),&nbsp;@S23,&nbsp;0xD8A1E681)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@b&nbsp;=&nbsp;dbo.MD5_GG(@b,&nbsp;@c,&nbsp;@d,&nbsp;@a,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;4),&nbsp;@S24,&nbsp;0xE7D3FBC8)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@a&nbsp;=&nbsp;dbo.MD5_GG(@a,&nbsp;@b,&nbsp;@c,&nbsp;@d,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;9),&nbsp;@S21,&nbsp;0x21E1CDE6)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@d&nbsp;=&nbsp;dbo.MD5_GG(@d,&nbsp;@a,&nbsp;@b,&nbsp;@c,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;14),&nbsp;@S22,&nbsp;0xC33707D6)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@c&nbsp;=&nbsp;dbo.MD5_GG(@c,&nbsp;@d,&nbsp;@a,&nbsp;@b,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;3),&nbsp;@S23,&nbsp;0xF4D50D87)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@b&nbsp;=&nbsp;dbo.MD5_GG(@b,&nbsp;@c,&nbsp;@d,&nbsp;@a,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;8),&nbsp;@S24,&nbsp;0x455A14ED)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@a&nbsp;=&nbsp;dbo.MD5_GG(@a,&nbsp;@b,&nbsp;@c,&nbsp;@d,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;13),&nbsp;@S21,&nbsp;0xA9E3E905)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@d&nbsp;=&nbsp;dbo.MD5_GG(@d,&nbsp;@a,&nbsp;@b,&nbsp;@c,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;2),&nbsp;@S22,&nbsp;0xFCEFA3F8)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@c&nbsp;=&nbsp;dbo.MD5_GG(@c,&nbsp;@d,&nbsp;@a,&nbsp;@b,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;7),&nbsp;@S23,&nbsp;0x676F02D9)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@b&nbsp;=&nbsp;dbo.MD5_GG(@b,&nbsp;@c,&nbsp;@d,&nbsp;@a,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;12),&nbsp;@S24,&nbsp;0x8D2A4C8A)</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@a&nbsp;=&nbsp;dbo.MD5_HH(@a,&nbsp;@b,&nbsp;@c,&nbsp;@d,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;5),&nbsp;@S31,&nbsp;0xFFFA3942)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@d&nbsp;=&nbsp;dbo.MD5_HH(@d,&nbsp;@a,&nbsp;@b,&nbsp;@c,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;8),&nbsp;@S32,&nbsp;0x8771F681)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@c&nbsp;=&nbsp;dbo.MD5_HH(@c,&nbsp;@d,&nbsp;@a,&nbsp;@b,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;11),&nbsp;@S33,&nbsp;0x6D9D6122)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@b&nbsp;=&nbsp;dbo.MD5_HH(@b,&nbsp;@c,&nbsp;@d,&nbsp;@a,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;14),&nbsp;@S34,&nbsp;0xFDE5380C)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@a&nbsp;=&nbsp;dbo.MD5_HH(@a,&nbsp;@b,&nbsp;@c,&nbsp;@d,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;1),&nbsp;@S31,&nbsp;0xA4BEEA44)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@d&nbsp;=&nbsp;dbo.MD5_HH(@d,&nbsp;@a,&nbsp;@b,&nbsp;@c,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;4),&nbsp;@S32,&nbsp;0x4BDECFA9)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@c&nbsp;=&nbsp;dbo.MD5_HH(@c,&nbsp;@d,&nbsp;@a,&nbsp;@b,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;7),&nbsp;@S33,&nbsp;0xF6BB4B60)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@b&nbsp;=&nbsp;dbo.MD5_HH(@b,&nbsp;@c,&nbsp;@d,&nbsp;@a,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;10),&nbsp;@S34,&nbsp;0xBEBFBC70)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@a&nbsp;=&nbsp;dbo.MD5_HH(@a,&nbsp;@b,&nbsp;@c,&nbsp;@d,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;13),&nbsp;@S31,&nbsp;0x289B7EC6)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@d&nbsp;=&nbsp;dbo.MD5_HH(@d,&nbsp;@a,&nbsp;@b,&nbsp;@c,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;0),&nbsp;@S32,&nbsp;0xEAA127FA)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@c&nbsp;=&nbsp;dbo.MD5_HH(@c,&nbsp;@d,&nbsp;@a,&nbsp;@b,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;3),&nbsp;@S33,&nbsp;0xD4EF3085)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@b&nbsp;=&nbsp;dbo.MD5_HH(@b,&nbsp;@c,&nbsp;@d,&nbsp;@a,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;6),&nbsp;@S34,&nbsp;0x4881D05)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@a&nbsp;=&nbsp;dbo.MD5_HH(@a,&nbsp;@b,&nbsp;@c,&nbsp;@d,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;9),&nbsp;@S31,&nbsp;0xD9D4D039)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@d&nbsp;=&nbsp;dbo.MD5_HH(@d,&nbsp;@a,&nbsp;@b,&nbsp;@c,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;12),&nbsp;@S32,&nbsp;0xE6DB99E5)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@c&nbsp;=&nbsp;dbo.MD5_HH(@c,&nbsp;@d,&nbsp;@a,&nbsp;@b,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;15),&nbsp;@S33,&nbsp;0x1FA27CF8)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@b&nbsp;=&nbsp;dbo.MD5_HH(@b,&nbsp;@c,&nbsp;@d,&nbsp;@a,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;2),&nbsp;@S34,&nbsp;0xC4AC5665)</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@a&nbsp;=&nbsp;dbo.MD5_II(@a,&nbsp;@b,&nbsp;@c,&nbsp;@d,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;0),&nbsp;@S41,&nbsp;0xF4292244)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@d&nbsp;=&nbsp;dbo.MD5_II(@d,&nbsp;@a,&nbsp;@b,&nbsp;@c,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;7),&nbsp;@S42,&nbsp;0x432AFF97)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@c&nbsp;=&nbsp;dbo.MD5_II(@c,&nbsp;@d,&nbsp;@a,&nbsp;@b,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;14),&nbsp;@S43,&nbsp;0xAB9423A7)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@b&nbsp;=&nbsp;dbo.MD5_II(@b,&nbsp;@c,&nbsp;@d,&nbsp;@a,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;5),&nbsp;@S44,&nbsp;0xFC93A039)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@a&nbsp;=&nbsp;dbo.MD5_II(@a,&nbsp;@b,&nbsp;@c,&nbsp;@d,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;12),&nbsp;@S41,&nbsp;0x655B59C3)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@d&nbsp;=&nbsp;dbo.MD5_II(@d,&nbsp;@a,&nbsp;@b,&nbsp;@c,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;3),&nbsp;@S42,&nbsp;0x8F0CCC92)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@c&nbsp;=&nbsp;dbo.MD5_II(@c,&nbsp;@d,&nbsp;@a,&nbsp;@b,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;10),&nbsp;@S43,&nbsp;0xFFEFF47D)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@b&nbsp;=&nbsp;dbo.MD5_II(@b,&nbsp;@c,&nbsp;@d,&nbsp;@a,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;1),&nbsp;@S44,&nbsp;0x85845DD1)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@a&nbsp;=&nbsp;dbo.MD5_II(@a,&nbsp;@b,&nbsp;@c,&nbsp;@d,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;8),&nbsp;@S41,&nbsp;0x6FA87E4F)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@d&nbsp;=&nbsp;dbo.MD5_II(@d,&nbsp;@a,&nbsp;@b,&nbsp;@c,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;15),&nbsp;@S42,&nbsp;0xFE2CE6E0)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@c&nbsp;=&nbsp;dbo.MD5_II(@c,&nbsp;@d,&nbsp;@a,&nbsp;@b,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;6),&nbsp;@S43,&nbsp;0xA3014314)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@b&nbsp;=&nbsp;dbo.MD5_II(@b,&nbsp;@c,&nbsp;@d,&nbsp;@a,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;13),&nbsp;@S44,&nbsp;0x4E0811A1)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@a&nbsp;=&nbsp;dbo.MD5_II(@a,&nbsp;@b,&nbsp;@c,&nbsp;@d,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;4),&nbsp;@S41,&nbsp;0xF7537E82)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@d&nbsp;=&nbsp;dbo.MD5_II(@d,&nbsp;@a,&nbsp;@b,&nbsp;@c,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;11),&nbsp;@S42,&nbsp;0xBD3AF235)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@c&nbsp;=&nbsp;dbo.MD5_II(@c,&nbsp;@d,&nbsp;@a,&nbsp;@b,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;2),&nbsp;@S43,&nbsp;0x2AD7D2BB)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECT&nbsp;@b&nbsp;=&nbsp;dbo.MD5_II(@b,&nbsp;@c,&nbsp;@d,&nbsp;@a,&nbsp;(SELECT&nbsp;[Word]&nbsp;FROM&nbsp;@tTmp&nbsp;WHERE&nbsp;[ID]&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;9),&nbsp;@S44,&nbsp;0xEB86D391)</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;@a&nbsp;=&nbsp;dbo.MD5_AddUnsigned(@a,&nbsp;@AA)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;@b&nbsp;=&nbsp;dbo.MD5_AddUnsigned(@b,&nbsp;@BB)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;@c&nbsp;=&nbsp;dbo.MD5_AddUnsigned(@c,&nbsp;@CC)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;@d&nbsp;=&nbsp;dbo.MD5_AddUnsigned(@d,&nbsp;@DD)</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;@iWordArrayCount&nbsp;=&nbsp;@iWordArrayCount&nbsp;+&nbsp;16<BR>&nbsp;&nbsp;&nbsp;&nbsp;END</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;@sRes&nbsp;=&nbsp;dbo.MD5_WordToHex(@a)&nbsp;+&nbsp;dbo.MD5_WordToHex(@b)&nbsp;+&nbsp;dbo.MD5_WordToHex(@c)&nbsp;+&nbsp;dbo.MD5_WordToHex(@d)<BR>&nbsp;&nbsp;&nbsp;&nbsp;SET&nbsp;@sRes&nbsp;=&nbsp;LOWER(@sRes)<BR>&nbsp;&nbsp;&nbsp;&nbsp;RETURN(@sRes)<BR>END<BR>GO</P>
<P>--Test<BR>set&nbsp;nocount&nbsp;on<BR>select&nbsp;dbo.MD5('')&nbsp;as&nbsp;'MD5('''')'<BR>union<BR>select&nbsp;'d41d8cd98f00b204e9800998ecf8427e'</P>
<P>select&nbsp;dbo.MD5('a')&nbsp;as&nbsp;'MD5(''a'')'<BR>union<BR>select&nbsp;'0cc175b9c0f1b6a831c399e269772661'</P>
<P>select&nbsp;dbo.MD5('abc')&nbsp;as&nbsp;'MD5(''abc'')'<BR>union<BR>select&nbsp;'900150983cd24fb0d6963f7d28e17f72'</P>
<P>select&nbsp;dbo.MD5('message&nbsp;digest')&nbsp;as&nbsp;'MD5(''message&nbsp;digest'')'<BR>union<BR>select&nbsp;'f96b697d7cb7938d525a2f31aaf161d0'</P>
<P>select&nbsp;dbo.MD5('abcdefghijklmnopqrstuvwxyz')&nbsp;as&nbsp;'MD5(''abcdefghijklmnopqrstuvwxyz'')'<BR>union<BR>select&nbsp;'c3fcd3d76192e4007dfb496cca67e13b'</P>
<P>select&nbsp;dbo.MD5('ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789')&nbsp;as&nbsp;'MD5(''ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'')'<BR>union<BR>select&nbsp;'d174ab98d277d9f5a5611c2c9f419d9f'</P>
<P>select&nbsp;dbo.MD5('12345678901234567890123456789012345678901234567890123456789012345678901234567890')&nbsp;as&nbsp;'MD5(''12345678901234567890123456789012345678901234567890123456789012345678901234567890'')'<BR>union<BR>select&nbsp;'57edf4a22be3c955ac49da2e2107b67a'</P>
<P>select&nbsp;dbo.MD5('我')&nbsp;as&nbsp;'MD5(''我'')'<BR>union<BR>select&nbsp;'a31d0f25367ebe046897f8a939ca4a9f'</P></FONT>