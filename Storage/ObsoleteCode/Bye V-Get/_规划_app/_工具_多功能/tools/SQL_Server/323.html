<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>使用SQL&nbsp;Mail收发和自动处理邮件</B><BR>SQL&nbsp;SERVER提供了通过EXCHANGE或OUTLOOK收发邮件的扩展存储过程，下面将这几个过程简单的介绍一下。
<P></P>
<P>一、启动SQL&nbsp;Mail</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;xp_startmail&nbsp;@user,@password<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@user和@password都是可选的</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;也可打开Enterprise&nbsp;Manager中的Support&nbsp;Services，在SQL&nbsp;Mail上单击右键打开右键菜单，然后按Start来启动</P>
<P>二、停止SQL&nbsp;Mail</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;xp_stopmail</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;也可用上述方法中的菜单里的Stop来停止</P>
<P>三、发送邮件</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;xp_sendmail&nbsp;{[@recipients&nbsp;=]&nbsp;'recipients&nbsp;[;...n]'}&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@message&nbsp;=]&nbsp;'message']&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@query&nbsp;=]&nbsp;'query']&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@attachments&nbsp;=]&nbsp;attachments]&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@copy_recipients&nbsp;=]&nbsp;'copy_recipients&nbsp;[;...n]'<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@blind_copy_recipients&nbsp;=]&nbsp;'blind_copy_recipients&nbsp;[;...n]'<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@subject&nbsp;=]&nbsp;'subject']<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,[@type&nbsp;=]&nbsp;'type']&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@attach_results&nbsp;=]&nbsp;'attach_value']<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@no_output&nbsp;=]&nbsp;'output_value']&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@no_header&nbsp;=]&nbsp;'header_value']&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@width&nbsp;=]&nbsp;width]&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@separator&nbsp;=]&nbsp;'separator']&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@echo_error&nbsp;=]&nbsp;'echo_value']&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@set_user&nbsp;=]&nbsp;'user']&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@dbuse&nbsp;=]&nbsp;'database']</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;其中@recipients是必需的</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;参数说明：</P>
<P>参数&nbsp;说明&nbsp;<BR>@recipients&nbsp;收件人，中间用逗号分开&nbsp;<BR>@message&nbsp;要发送的信息&nbsp;<BR>@query&nbsp;确定执行并依附邮件的有效查询，除触发器中的插入表及删除表外，此查询能引用任何对象&nbsp;<BR>@attachments&nbsp;附件&nbsp;<BR>@copy_recipients&nbsp;抄送&nbsp;<BR>@blind_copy_recipients&nbsp;密送&nbsp;<BR>@subject&nbsp;标题&nbsp;<BR>@attach_results&nbsp;指定查询结果做为附件发送&nbsp;<BR>@no_header&nbsp;不发送查询结果的列名&nbsp;<BR>@set_user&nbsp;查询联接的用户名，默认为Guset&nbsp;<BR>@dbuse&nbsp;查询所用的数据库，默认为缺省数据库&nbsp;</P>
<P>四、阅读邮件收件箱中的邮件</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;xp_readmail&nbsp;[][@msg_id&nbsp;=]&nbsp;'message_number']&nbsp;[,&nbsp;][@type&nbsp;=]&nbsp;'type'&nbsp;[OUTPUT]]&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,[@peek&nbsp;=]&nbsp;'peek']<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@suppress_attach&nbsp;=]&nbsp;'suppress_attach']<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@originator&nbsp;=]&nbsp;'sender'&nbsp;OUTPUT]<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@subject&nbsp;=]&nbsp;'subject'&nbsp;OUTPUT]<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@message&nbsp;=]&nbsp;'message'&nbsp;OUTPUT]<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@recipients&nbsp;=]&nbsp;'recipients&nbsp;[;...n]'&nbsp;OUTPUT]<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@cc_list&nbsp;=]&nbsp;'copy_recipients&nbsp;[;...n]'&nbsp;OUTPUT]<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@bcc_list&nbsp;=]&nbsp;'blind_copy_recipients&nbsp;[;...n]'&nbsp;OUTPUT]<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@date_received&nbsp;=]&nbsp;'date'&nbsp;OUTPUT]<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@unread&nbsp;=]&nbsp;'unread_value'&nbsp;OUTPUT]<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@attachments&nbsp;=]&nbsp;'attachments&nbsp;[;...n]'&nbsp;OUTPUT])<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@skip_bytes&nbsp;=]&nbsp;bytes_to_skip&nbsp;OUTPUT]<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@msg_length&nbsp;=]&nbsp;length_in_bytes&nbsp;OUTPUT]<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@originator_address&nbsp;=]&nbsp;'sender_address'&nbsp;OUTPUT]]</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;参数说明：</P>
<P>参数&nbsp;说明&nbsp;<BR>@originator&nbsp;发件人&nbsp;<BR>@subject&nbsp;主题&nbsp;<BR>@message&nbsp;信息&nbsp;<BR>@recipients&nbsp;收件人&nbsp;<BR>@skip_tytes&nbsp;读取邮件信息时跳过的字节数，用于顺序获取邮件信息段。&nbsp;<BR>@msg_length&nbsp;确定所有信息的长度，通常与@skip_bytes一起处理长信息&nbsp;</P>
<P>五、顺序处理下一个邮件</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;xp_findnextmsg&nbsp;[][@msg_id&nbsp;=]&nbsp;'message_number'&nbsp;[OUTPUT]]&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,[@type&nbsp;=]&nbsp;type]&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@unread_only&nbsp;=]&nbsp;'unread_value'])</P>
<P>六、删除邮件</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;xp_deletemail&nbsp;{'message_number'}</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;如果不指定邮件编号则删除收件箱中的所有邮件</P>
<P>七、自动处理邮件</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;sp_processmail&nbsp;[][@subject&nbsp;=]&nbsp;'subject']<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@filetype&nbsp;=]&nbsp;'filetype']<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@separator&nbsp;=]&nbsp;'separator']<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@set_user&nbsp;=]&nbsp;'user']<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[,][@dbuse&nbsp;=]&nbsp;'dbname']</P></FONT>