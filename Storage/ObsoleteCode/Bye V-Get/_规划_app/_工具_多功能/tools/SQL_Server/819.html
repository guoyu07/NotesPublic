<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>数据库文件名称改动</B><BR>原先文件名&nbsp;SysDB.MDF、SysDB_Log.LDF&nbsp;现在突然变成&nbsp;SysDB_MDB.MDF、SysDB_Log.LDF&nbsp;把SysDB_MDB.MDF改名成原来的名字附加也不行。怎么办啊，那里有2年的系统数据啊！！！&nbsp;&nbsp;<BR>主要解答者:&nbsp;pengdali&nbsp;提交人:&nbsp;ylc001&nbsp;<BR>感谢:&nbsp;pengdali、nboys&nbsp;<BR>审核者:&nbsp;tjan&nbsp;论坛对应贴子:&nbsp;查看&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;:&nbsp;&nbsp;
<P></P>
<P>---------------------------------------------------------------&nbsp;&nbsp;<BR>&nbsp;<BR>新建一同名数据库（文件名，文件组都和原来的一样），然后停止数据库服务，用原来文件替换新建的数&nbsp;&nbsp;<BR>&nbsp;<BR>据库文件，启动数据库，该数据库被设未suspect&nbsp;&nbsp;<BR>&nbsp;<BR>然后把数据库改成紧急模式：&nbsp;&nbsp;<BR>sp_configure&nbsp;&nbsp;'allow',&nbsp;&nbsp;1&nbsp;&nbsp;<BR>reconfigure&nbsp;&nbsp;with&nbsp;&nbsp;override&nbsp;&nbsp;<BR>update&nbsp;&nbsp;sysdatabases&nbsp;&nbsp;set&nbsp;&nbsp;status&nbsp;&nbsp;=&nbsp;&nbsp;32768&nbsp;&nbsp;where&nbsp;&nbsp;name&nbsp;&nbsp;=&nbsp;&nbsp;'数据库名'&nbsp;&nbsp;<BR>&nbsp;<BR>把LDF文件改名，再执行&nbsp;&nbsp;<BR>DBCC&nbsp;&nbsp;REBUILD_LOG&nbsp;&nbsp;('数据库名',&nbsp;&nbsp;'E:\fdzz\database\fdzz1204_Log.LDF'&nbsp;&nbsp;)&nbsp;&nbsp;<BR>&nbsp;<BR>恢复数据库紧急模式&nbsp;&nbsp;<BR>update&nbsp;&nbsp;sysdatabases&nbsp;&nbsp;set&nbsp;&nbsp;status&nbsp;&nbsp;=&nbsp;&nbsp;0&nbsp;&nbsp;where&nbsp;&nbsp;name&nbsp;&nbsp;=&nbsp;&nbsp;'数据库名'&nbsp;&nbsp;<BR>执行&nbsp;&nbsp;<BR>restore&nbsp;&nbsp;database&nbsp;&nbsp;数据库名&nbsp;&nbsp;WITH&nbsp;&nbsp;RECOVERY&nbsp;&nbsp;<BR>sp_configure&nbsp;&nbsp;'allow',&nbsp;&nbsp;0&nbsp;&nbsp;<BR>reconfigure&nbsp;&nbsp;with&nbsp;&nbsp;override&nbsp;&nbsp;<BR>&nbsp;<BR>然后用DBCC&nbsp;&nbsp;CHECKDB&nbsp;&nbsp;('数据库名')看看有没有错误&nbsp;&nbsp;<BR>&nbsp;<BR>如果上面还是不行，试试吧数据库设为紧急模式，应该可以看到数据了，在把数据导出到一个新的数据库&nbsp;&nbsp;<BR>&nbsp;<BR>---------------------------------------------------------------&nbsp;&nbsp;<BR>&nbsp;<BR>sp_resetstatus&nbsp;&nbsp;<BR>重置置疑数据库的状态。&nbsp;&nbsp;<BR>&nbsp;<BR>语法&nbsp;&nbsp;<BR>sp_resetstatus&nbsp;&nbsp;[&nbsp;&nbsp;@DBName&nbsp;&nbsp;=&nbsp;&nbsp;]&nbsp;&nbsp;'database'&nbsp;&nbsp;<BR>&nbsp;<BR>参数&nbsp;&nbsp;<BR>[@DBName&nbsp;&nbsp;=]&nbsp;&nbsp;'database'&nbsp;&nbsp;<BR>&nbsp;<BR>是要重置的数据库名。database&nbsp;&nbsp;的数据类型为&nbsp;&nbsp;sysname，无默认值。&nbsp;&nbsp;<BR>&nbsp;<BR>&nbsp;<BR>重置置疑状态&nbsp;&nbsp;<BR>如果&nbsp;&nbsp;SQL&nbsp;&nbsp;Server&nbsp;&nbsp;因为磁盘驱动器不再有可用空间，而不能完成数据库的恢复，那么&nbsp;&nbsp;Microsoft?&nbsp;&nbsp;SQL&nbsp;&nbsp;Server?&nbsp;&nbsp;2000&nbsp;&nbsp;会返回错误&nbsp;&nbsp;1105&nbsp;&nbsp;并且将&nbsp;&nbsp;sysdatabases&nbsp;&nbsp;中的&nbsp;&nbsp;status&nbsp;&nbsp;列设为置疑。按下面的步骤解决这个问题：&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;<BR>执行&nbsp;&nbsp;sp_resetstatus。&nbsp;&nbsp;<BR>&nbsp;<BR>&nbsp;<BR>用&nbsp;&nbsp;ALTER&nbsp;&nbsp;DATABASE&nbsp;&nbsp;向数据库添加一个数据文件或日志文件。&nbsp;&nbsp;<BR>&nbsp;<BR>&nbsp;<BR>停止并重新启动&nbsp;&nbsp;SQL&nbsp;&nbsp;Server。&nbsp;&nbsp;&nbsp;&nbsp;<BR>用新的数据文件或日志文件所提供的额外空间，SQL&nbsp;&nbsp;Server&nbsp;&nbsp;应该能完成数据库的恢复。&nbsp;&nbsp;<BR>&nbsp;<BR>释放磁盘空间并且重新运行恢复操作。&nbsp;&nbsp;&nbsp;&nbsp;<BR>sp_resetstatus&nbsp;&nbsp;关闭数据库的置疑标志，但是原封不动地保持数据库的其它选项。&nbsp;&nbsp;<BR>&nbsp;<BR>&nbsp;<BR>&nbsp;<BR>注意&nbsp;&nbsp;&nbsp;&nbsp;只有在您的主要支持提供者指导下或有疑难解答建议的做法时，才可以使用&nbsp;&nbsp;sp_resetstatus。否则，可能会损坏数据库。&nbsp;&nbsp;<BR></P></FONT>