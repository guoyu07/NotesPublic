<meta http-equiv="content-type" content="text/html; charset=gb2312">&nbsp;<FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>×Ö·û´®-Numeric&nbsp;Conversions</B><BR>Introduction&nbsp;<BR>Continuing&nbsp;on&nbsp;with&nbsp;taming&nbsp;strings...&nbsp;
<P></P>
<P>Often&nbsp;when&nbsp;I&nbsp;am&nbsp;reporting&nbsp;data&nbsp;from&nbsp;SQL&nbsp;Server,&nbsp;I&nbsp;am&nbsp;concatenating&nbsp;information&nbsp;together&nbsp;to&nbsp;form&nbsp;more&nbsp;readable&nbsp;output.&nbsp;Many&nbsp;times&nbsp;this&nbsp;output&nbsp;will&nbsp;also&nbsp;include&nbsp;some&nbsp;numeric&nbsp;data&nbsp;that&nbsp;needs&nbsp;to&nbsp;be&nbsp;placed&nbsp;inside&nbsp;a&nbsp;string.&nbsp;I&nbsp;am&nbsp;not&nbsp;sure&nbsp;exactly&nbsp;why&nbsp;an&nbsp;integer&nbsp;is&nbsp;not&nbsp;implicitly&nbsp;converted&nbsp;to&nbsp;a&nbsp;string,&nbsp;but&nbsp;it&nbsp;doesn't&nbsp;work,&nbsp;so&nbsp;I&nbsp;have&nbsp;to&nbsp;use&nbsp;another&nbsp;solution.&nbsp;</P>
<P>The&nbsp;Problem&nbsp;<BR>Numeric&nbsp;values&nbsp;(whether&nbsp;integer&nbsp;or&nbsp;float)&nbsp;are&nbsp;not&nbsp;implicitly&nbsp;converted&nbsp;to&nbsp;characters&nbsp;within&nbsp;a&nbsp;string&nbsp;concatenation&nbsp;statement.&nbsp;Instead,&nbsp;the&nbsp;following&nbsp;statement&nbsp;(using&nbsp;Northwind):</P>
<P><BR>&nbsp;&nbsp;select&nbsp;customerID&nbsp;+&nbsp;5<BR>&nbsp;&nbsp;&nbsp;from&nbsp;customers</P>
<P>returns&nbsp;this:</P>
<P>Server:&nbsp;Msg&nbsp;245,&nbsp;Level&nbsp;16,&nbsp;State&nbsp;1,&nbsp;Line&nbsp;1<BR>Syntax&nbsp;error&nbsp;converting&nbsp;the&nbsp;nvarchar&nbsp;value&nbsp;'ALFKI'&nbsp;to&nbsp;a&nbsp;column&nbsp;of&nbsp;data&nbsp;type&nbsp;int.</P>
<P>And&nbsp;this&nbsp;code:</P>
<P>&nbsp;&nbsp;select&nbsp;5&nbsp;+&nbsp;customerID<BR>&nbsp;&nbsp;&nbsp;from&nbsp;customers</P>
<P>still&nbsp;returns&nbsp;this:</P>
<P>Server:&nbsp;Msg&nbsp;245,&nbsp;Level&nbsp;16,&nbsp;State&nbsp;1,&nbsp;Line&nbsp;1<BR>Syntax&nbsp;error&nbsp;converting&nbsp;the&nbsp;nvarchar&nbsp;value&nbsp;'ALFKI'&nbsp;to&nbsp;a&nbsp;column&nbsp;of&nbsp;data&nbsp;type&nbsp;int.</P>
<P>Apparently&nbsp;the&nbsp;numeric&nbsp;data&nbsp;type&nbsp;takes&nbsp;some&nbsp;precendence&nbsp;over&nbsp;the&nbsp;character&nbsp;data&nbsp;types.&nbsp;In&nbsp;some&nbsp;searching&nbsp;of&nbsp;Books&nbsp;Online,&nbsp;I&nbsp;have&nbsp;not&nbsp;found&nbsp;any&nbsp;documentation&nbsp;of&nbsp;this.&nbsp;<BR>In&nbsp;the&nbsp;past&nbsp;I&nbsp;have&nbsp;used&nbsp;CONVERT,&nbsp;and&nbsp;more&nbsp;recently&nbsp;CAST,&nbsp;to&nbsp;convert&nbsp;the&nbsp;numeric&nbsp;data&nbsp;into&nbsp;character&nbsp;data.&nbsp;However&nbsp;there&nbsp;are&nbsp;a&nbsp;few&nbsp;issues&nbsp;with&nbsp;this&nbsp;technique.&nbsp;Consider&nbsp;the&nbsp;following&nbsp;code:</P>
<P><BR>select&nbsp;quantity,&nbsp;<BR>&nbsp;&nbsp;cast(&nbsp;quantity&nbsp;as&nbsp;char(&nbsp;1))&nbsp;'Char_quantity'<BR>&nbsp;from&nbsp;[order&nbsp;details]</P>
<P>This&nbsp;results&nbsp;in&nbsp;something&nbsp;that&nbsp;looks&nbsp;like:&nbsp;<BR>quantity&nbsp;Char_quantity&nbsp;<BR>--------&nbsp;-------------&nbsp;<BR>12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<BR>10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<BR>5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5<BR>9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;9</P>
<P>Notice&nbsp;that&nbsp;a&nbsp;number&nbsp;of&nbsp;the&nbsp;results&nbsp;are&nbsp;not&nbsp;returned&nbsp;because&nbsp;the&nbsp;data&nbsp;type&nbsp;does&nbsp;not&nbsp;fit&nbsp;into&nbsp;the&nbsp;space&nbsp;allowed.&nbsp;So&nbsp;what&nbsp;can&nbsp;you&nbsp;do?</P>
<P>In&nbsp;the&nbsp;past,&nbsp;I&nbsp;have&nbsp;usually&nbsp;used&nbsp;code&nbsp;like&nbsp;the&nbsp;following:</P>
<P><BR>select&nbsp;quantity,&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtrim(&nbsp;cast(&nbsp;quantity&nbsp;as&nbsp;varchar(&nbsp;50)))&nbsp;'Char_quantity'<BR>&nbsp;from&nbsp;[order&nbsp;details]</P>
<P>This&nbsp;will&nbsp;ensure&nbsp;that&nbsp;I&nbsp;get&nbsp;all&nbsp;results,&nbsp;but&nbsp;still&nbsp;contains&nbsp;some&nbsp;issues.</P>
<P>Suppose&nbsp;that&nbsp;I&nbsp;have&nbsp;a&nbsp;series&nbsp;of&nbsp;decimals&nbsp;like&nbsp;the&nbsp;following:</P>
<P><BR>select&nbsp;4.35,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;12.423,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;234.34,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6.3345</P>
<P>which&nbsp;will&nbsp;return:&nbsp;<BR>-----&nbsp;-------&nbsp;-------&nbsp;-------&nbsp;<BR>4.35&nbsp;&nbsp;12.423&nbsp;&nbsp;234.34&nbsp;&nbsp;6.3345</P>
<P>Let&nbsp;us&nbsp;apply&nbsp;the&nbsp;previous&nbsp;formatting&nbsp;to&nbsp;this&nbsp;set&nbsp;of&nbsp;data&nbsp;and&nbsp;see&nbsp;the&nbsp;results.</P>
<P><BR>select&nbsp;rtrim(&nbsp;cast(&nbsp;4.35&nbsp;as&nbsp;varchar(&nbsp;50))),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtrim(&nbsp;cast(&nbsp;12.423&nbsp;as&nbsp;varchar(&nbsp;50))),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtrim(&nbsp;cast(&nbsp;234.34&nbsp;as&nbsp;varchar(&nbsp;50))),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtrim(&nbsp;cast(&nbsp;6.3345&nbsp;as&nbsp;varchar(&nbsp;50)))</P>
<P>------------&nbsp;--------------&nbsp;-----------&nbsp;----------------<BR>4.35&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;12.423&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;234.34&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6.3345</P>
<P>I&nbsp;have&nbsp;shortened&nbsp;the&nbsp;result&nbsp;set,&nbsp;but&nbsp;this&nbsp;results&nbsp;in&nbsp;a&nbsp;wide&nbsp;result&nbsp;set&nbsp;in&nbsp;Query&nbsp;Analyzer,&nbsp;though&nbsp;the&nbsp;actual&nbsp;strings&nbsp;are&nbsp;the&nbsp;proper&nbsp;length.&nbsp;</P>
<P>But&nbsp;what&nbsp;if&nbsp;I&nbsp;need&nbsp;specific&nbsp;formatting?&nbsp;What&nbsp;if&nbsp;I&nbsp;need&nbsp;a&nbsp;specific&nbsp;length&nbsp;for&nbsp;formatting&nbsp;columns&nbsp;in&nbsp;a&nbsp;report?&nbsp;What&nbsp;if&nbsp;I&nbsp;am&nbsp;looking&nbsp;for&nbsp;xx&nbsp;number&nbsp;of&nbsp;decimals?&nbsp;It&nbsp;is&nbsp;easy&nbsp;to&nbsp;use&nbsp;SUBSTRING&nbsp;and&nbsp;SPACE&nbsp;to&nbsp;trim&nbsp;and&nbsp;then&nbsp;pad&nbsp;the&nbsp;columns,&nbsp;but&nbsp;this&nbsp;is&nbsp;cumbersome.&nbsp;For&nbsp;the&nbsp;decimals,&nbsp;then&nbsp;you&nbsp;run&nbsp;into&nbsp;another&nbsp;problem.&nbsp;</P>
<P>select&nbsp;rtrim(&nbsp;cast(&nbsp;round(&nbsp;4.35,&nbsp;2)&nbsp;as&nbsp;varchar(&nbsp;50))),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtrim(&nbsp;cast(&nbsp;round(&nbsp;12.423,&nbsp;2)&nbsp;as&nbsp;varchar(&nbsp;50))),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtrim(&nbsp;cast(&nbsp;round(&nbsp;234.34,&nbsp;2)&nbsp;as&nbsp;varchar(&nbsp;50))),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtrim(&nbsp;cast(&nbsp;round(&nbsp;6.3345,&nbsp;2)&nbsp;as&nbsp;varchar(&nbsp;50)))</P>
<P>------------&nbsp;------------&nbsp;----------&nbsp;----------&nbsp;<BR>4.35&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;12.420&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;234.34&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6.3300</P>
<P>In&nbsp;this&nbsp;code,&nbsp;the&nbsp;numbers&nbsp;are&nbsp;rounded&nbsp;to&nbsp;the&nbsp;proper&nbsp;number&nbsp;of&nbsp;decimals,&nbsp;but&nbsp;there&nbsp;are&nbsp;still&nbsp;the&nbsp;original&nbsp;number&nbsp;of&nbsp;characters&nbsp;in&nbsp;the&nbsp;converted&nbsp;strings.&nbsp;SUBSTRING&nbsp;presents&nbsp;a&nbsp;problem&nbsp;here&nbsp;unless&nbsp;I&nbsp;use&nbsp;CHARINDEX&nbsp;to&nbsp;find&nbsp;the&nbsp;decimal&nbsp;and&nbsp;then&nbsp;perform&nbsp;the&nbsp;proper&nbsp;operations.&nbsp;This&nbsp;gets&nbsp;cumbersome&nbsp;and&nbsp;I&nbsp;decided&nbsp;to&nbsp;search&nbsp;for&nbsp;an&nbsp;easier&nbsp;solution.&nbsp;</P>
<P>The&nbsp;Solution&nbsp;<BR>I&nbsp;decided&nbsp;to&nbsp;search&nbsp;my&nbsp;handy-dandy&nbsp;Books&nbsp;Online&nbsp;(for&nbsp;those&nbsp;of&nbsp;you&nbsp;with&nbsp;young&nbsp;kids,&nbsp;you&nbsp;will&nbsp;get&nbsp;the&nbsp;joke.&nbsp;For&nbsp;the&nbsp;rest&nbsp;of&nbsp;you&nbsp;look&nbsp;here)&nbsp;in&nbsp;the&nbsp;string&nbsp;functions&nbsp;area&nbsp;and&nbsp;I&nbsp;found&nbsp;STR.&nbsp;This&nbsp;is&nbsp;a&nbsp;string&nbsp;function&nbsp;that&nbsp;is&nbsp;designed&nbsp;to&nbsp;convert&nbsp;numeric&nbsp;values&nbsp;to&nbsp;characters.&nbsp;Let&nbsp;us&nbsp;apply&nbsp;this&nbsp;to&nbsp;our&nbsp;sample&nbsp;data&nbsp;set.&nbsp;</P>
<P><BR>select&nbsp;str(&nbsp;4.35,&nbsp;5,&nbsp;2),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str(&nbsp;12.423,&nbsp;5,&nbsp;2),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str(&nbsp;234.34,&nbsp;5,&nbsp;2),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str(&nbsp;6.3345,&nbsp;5,&nbsp;2)</P>
<P>-----&nbsp;-----&nbsp;-----&nbsp;-----&nbsp;<BR>&nbsp;4.35&nbsp;12.42&nbsp;234.3&nbsp;&nbsp;6.33</P>
<P>This&nbsp;almost&nbsp;appears&nbsp;to&nbsp;work,&nbsp;but&nbsp;there&nbsp;are&nbsp;still&nbsp;some&nbsp;issues.&nbsp;Notice&nbsp;that&nbsp;in&nbsp;column&nbsp;3,&nbsp;the&nbsp;decimals&nbsp;are&nbsp;not&nbsp;set&nbsp;to&nbsp;2&nbsp;because&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;string&nbsp;exceeds&nbsp;the&nbsp;total&nbsp;length.&nbsp;If&nbsp;we&nbsp;adjust&nbsp;the&nbsp;query&nbsp;as&nbsp;follows:&nbsp;<BR>select&nbsp;ltrim(&nbsp;str(&nbsp;4.35,&nbsp;25,&nbsp;2)),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ltrim(&nbsp;str(&nbsp;12.423,&nbsp;25,&nbsp;2)),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ltrim(&nbsp;str(&nbsp;234.34,&nbsp;24,&nbsp;2)),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ltrim(&nbsp;str(&nbsp;6.3345,&nbsp;25,&nbsp;2))</P>
<P>-------------&nbsp;-------------&nbsp;------------&nbsp;--------------&nbsp;<BR>4.35&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;12.42&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;234.34&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6.33</P>
<P>Now&nbsp;I&nbsp;have&nbsp;strings&nbsp;with&nbsp;the&nbsp;proper&nbsp;number&nbsp;of&nbsp;decimals.&nbsp;Of&nbsp;course,&nbsp;if&nbsp;I&nbsp;want&nbsp;to&nbsp;get&nbsp;each&nbsp;string&nbsp;set&nbsp;to&nbsp;the&nbsp;same&nbsp;length&nbsp;and&nbsp;right&nbsp;justified,&nbsp;I&nbsp;still&nbsp;have&nbsp;some&nbsp;formatting&nbsp;to&nbsp;do,&nbsp;but&nbsp;I&nbsp;will&nbsp;stop&nbsp;here&nbsp;for&nbsp;now.</P>
<P>Conclusion&nbsp;<BR>I&nbsp;hope&nbsp;that&nbsp;I&nbsp;have&nbsp;shed&nbsp;some&nbsp;light&nbsp;on&nbsp;a&nbsp;little&nbsp;used&nbsp;funciton&nbsp;and&nbsp;an&nbsp;alternative&nbsp;for&nbsp;converting&nbsp;numeric&nbsp;values&nbsp;into&nbsp;strings.&nbsp;No&nbsp;earth&nbsp;shattering&nbsp;technical&nbsp;knowledge&nbsp;in&nbsp;this&nbsp;article,&nbsp;but&nbsp;perhaps&nbsp;I&nbsp;will&nbsp;spark&nbsp;an&nbsp;idea&nbsp;or&nbsp;two&nbsp;in&nbsp;some&nbsp;of&nbsp;you.&nbsp;</P>
<P>As&nbsp;always,&nbsp;I&nbsp;welcome&nbsp;feedback&nbsp;and&nbsp;please&nbsp;rate&nbsp;this&nbsp;article&nbsp;below&nbsp;(and&nbsp;any&nbsp;you&nbsp;read&nbsp;on&nbsp;Swynk).&nbsp;It&nbsp;helps&nbsp;to&nbsp;motivate&nbsp;and&nbsp;assist&nbsp;us&nbsp;authors&nbsp;in&nbsp;writing&nbsp;better&nbsp;columns.&nbsp;</P>
<P>Steve&nbsp;Jones<BR>November&nbsp;2000</P></FONT>