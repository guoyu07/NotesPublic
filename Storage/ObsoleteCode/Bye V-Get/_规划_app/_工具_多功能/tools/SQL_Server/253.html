<meta http-equiv="content-type" content="text/html; charset=gb2312"><FONT 
style="FONT-SIZE: 9pt; LINE-HEIGHT: 15pt"><B>交叉制表(sqlserver7编程技术内幕)的必要考虑(1)</B><BR>如何将数据返回给用户?如何在这个实际上表示行值的数值结构上创建列?如何对用户所要求的数据进行用户权限确认?从哪里开始入手?<BR>&nbsp;&nbsp;&nbsp;&nbsp;1.确定返回什么数据作为交叉表的数据的结果.在这种情况下最好使用一个临时表.但是只使用临时表还不能完成任务.临时表在结构和内容上需要作太多的修改,并且只使用t-sql也不能完成任务.<BR>&nbsp;&nbsp;&nbsp;&nbsp;需要使用一个永久表.对于所有的用户会如何呢?每个用户需要自己的表.当对数据进行交叉制表操作时多个登录机会会潜在的使用相同的表(被称为crosstable的表),从而存在潜在的冲突.<BR>&nbsp;&nbsp;&nbsp;由于tsql的性质,交叉表不能用动态执行进行定义.这要通过随机生成交叉表的名称进行定义.没有找到更好的方法.<BR>&nbsp;&nbsp;2.返回数据的方法建立以后,作一些实际的处理.参数由以下部分组成:一个标识行头的列,一个标识列头的列,一个聚合值的列以及源本身(一个表或一个视图)<BR>&nbsp;&nbsp;3.来检查列和源对象的存在性.如果都存在,则建立两个临时表用来保存行数据和列数据.创建交叉表,从行临时列表取出行并利用列临时表中的数据来改变行.<BR>&nbsp;&nbsp;&nbsp;数据一般不能用作列名称,因为它经常不符合sqlserver标识符的规则.检查数据并删除非法字符,以及如果打头的值为数字,则使用下划线将该值变换为前缀.<BR>&nbsp;&nbsp;4.再下一步创建一个游标保存数据.当用户遍历游标行时,执行一个execute语句来更新交叉表的内容.如果这些完成,则返回交叉表的结果,删除所有的表并释放游标.</FONT>